"use strict";(self.webpackChunklasagna=self.webpackChunklasagna||[]).push([[91],{1091:(K,y,r)=>{r.r(y),r.d(y,{CalculateRecipeComponent:()=>Q});var t=r(1007),j=r(1636),E=r(5642),I=r(1086),T=r(553);const w=["*"];let $=(()=>{class l{constructor(){}static \u0275fac=function(n){return new(n||l)};static \u0275cmp=t.VBU({type:l,selectors:[["lg-table-card"]],ngContentSelectors:w,decls:4,vars:1,consts:[[3,"flat"],[1,"table"],[1,"table__scroll"]],template:function(n,o){1&n&&(t.NAR(),t.j41(0,"lg-card",0)(1,"div",1)(2,"div",2),t.SdG(3),t.k0s()()()),2&n&&t.Y8G("flat",!0)},dependencies:[T.i],styles:[":host{display:flex;width:100%}.table__scroll{overflow-x:auto}table{width:100%;border-collapse:collapse;--border-color: #efefef}table thead tr{border-bottom:1px solid var(--border-color)}table thead th{text-align:left;padding:16px 24px;opacity:.4;font-size:.8em}table tbody tr{border-bottom:1px solid var(--border-color)}table tbody tr:last-child{border-bottom:none}td{padding:16px 24px}\n"],encapsulation:2})}return l})();var A=r(177),M=r(1119),N=r(7512),S=r(9895),k=r(9417),Y=r(7480),f=r(467),x=r(4625),X=r(9512),P=r(7201);let V=(()=>{class l{_recipeRepository;_productRepository;constructor(e,n){this._recipeRepository=e,this._productRepository=n}calculation;calculateRecipe(e,n=0){var o=this;return new Promise(function(){var a=(0,f.A)(function*(c,s){const _=[];let i=0,C=0;yield o._recipeRepository.getOne(e).then(function(){var F=(0,f.A)(function*(h){const g=(n||h?.outcome_amount||1)/(h?.outcome_amount||1),{table:m,totalAmount:p,totalWeight:u}=yield o._makeIngredientTable(h,g);i+=p||0,C+=u||0,_.push(...m),_.push(o._makeTotal(i,C)),c({recipe:h,result:_,total:i,totalWeight:C})});return function(h){return F.apply(this,arguments)}}())});return function(c,s){return a.apply(this,arguments)}}())}getRecipe(e){var n=this;return(0,f.A)(function*(){if(!e)return;const o=yield n._recipeRepository.getOne(e);if(!o)return;let a=0;return a=o.outcome_unit&&o.outcome_amount?o.outcome_amount:o?.ingredients?.reduce((c,s)=>"gram"!==s.unit?c:c+((0,x.N)(s.amount)||0),0)??0,{totalAmountInGrams:a||0,...o,pricePerUnit:0}})()}_makeRecipeSubTable(e,n=0){var o=this;return(0,f.A)(function*(){return new Promise(function(){var a=(0,f.A)(function*(c,s){const _=[];let i=0,C=0;const F=e.amount;yield o.getRecipe(e.recipe_id).then(function(){var h=(0,f.A)(function*(g){let m=F/(g?.totalAmountInGrams||1);const p=yield o._makeIngredientTable(g,n);p.table=p.table.map((R,G)=>{const Z=(R.amount||0)*(n||1)*m;return{...R,amount:parseFloat((Z||0).toFixed(5)),total:parseFloat((R.total?R.total*m:0).toFixed(5)),indent:R.indent+1}});let u=p.totalAmount?p.totalAmount/p.totalWeight:0;const b=(g?.totalAmountInGrams||0)*n*m,v=p.totalAmount*m;_.push(o._makeRecipeCaption({name:g?.name||"Unknown recipe",price_per_gram:u,amount:b,total:v,unit:e.unit,uuid:g?.uuid||""})),_.push(...p.table),C+=v,i+=p.totalWeight*m,c({table:_,totalAmount:C,totalWeight:i})});return function(g){return h.apply(this,arguments)}}())});return function(c,s){return a.apply(this,arguments)}}())})()}_makeIngredientTable(e,n=0){var o=this;const a=[];let c=0,s=0;return Promise.all(e?.ingredients.map(function(){var _=(0,f.A)(function*(i,C){const F=i.recipe_id,h=i.product_id,g=i.name;if(F||h||g)if(F){const m=yield o._makeRecipeSubTable(i,n);a.push(...m.table),s+=m.totalAmount,c+=m.totalWeight}else h?yield o._productRepository.getOne(i.product_id).then(function(){var p=(0,f.A)(function*(u){if(!u)return void a.push(o._makeRow({name:"Unknown product",price_per_gram:void 0,amount:i.amount*(n||1),total:void 0,uuid:u?.uuid||""}));if(!u?.price)return void a.push(o._makeRow({name:u.name,price_per_gram:0,amount:i.amount*(n||1),total:0,uuid:u?.uuid||""}));if(!u?.amount)return void a.push(o._makeRow({name:u.name,price_per_gram:0,amount:i.amount*(n||1),total:0,uuid:u?.uuid||""}));const b=i.amount*(n||1),v=((0,x.N)(u.price)||1)/((0,x.N)(u.amount)||1),R=v*((0,x.N)(b)||1),G="gram"===u.unit||!u.unit;a.push(o._makeRow({name:u.name,price_per_gram:v,amount:b,total:R,unit:u.unit,uuid:u?.uuid||""})),s+=R,G&&(c+=+b)});return function(u){return p.apply(this,arguments)}}()):g&&(a.push(o._makeRow({name:i.name,price_per_gram:void 0,amount:i.amount*(n||1),total:void 0,uuid:""})),c+=+i.amount*(n||1))});return function(i,C){return _.apply(this,arguments)}}())??[]).then(()=>({table:a,totalAmount:s,totalWeight:c}))}_makeRow(e){return{name:e.name,price_per_gram:parseFloat(e.price_per_gram?.toFixed(5)??"0"),amount:e.amount,total:parseFloat(e.total?.toFixed(5)??"0"),unit:e.unit||"gram",indent:e.indent??0,type:"row",uuid:e.uuid}}_makeCaption(e){return{name:e,unit:void 0,price_per_gram:void 0,amount:void 0,total:void 0,indent:0,type:"caption"}}_makeRecipeCaption(e){return{name:e.name,price_per_gram:parseFloat(e.price_per_gram.toFixed(5)),amount:e.amount,total:parseFloat(e.total.toFixed(2)),unit:e.unit||"gram",indent:0,type:"recipe-row",uuid:e.uuid}}_makeTotal(e,n){return{name:"Total",amount:n,unit:"gram",price_per_gram:parseFloat((e/n).toFixed(5)),total:parseFloat(e.toFixed(2)),indent:0,type:"total"}}static \u0275fac=function(n){return new(n||l)(t.KVO(X.m),t.KVO(P.d))};static \u0275prov=t.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();const z=(l,d)=>[l,d];function W(l,d){if(1&l){const e=t.RV6();t.j41(0,"lg-gap-row",3)(1,"lg-gap-row",4)(2,"div"),t.EFF(3," Calculation outcome: "),t.k0s(),t.j41(4,"div")(5,"lg-number-input",5),t.mxI("ngModelChange",function(o){t.eBV(e);const a=t.XpG(2);return t.DH7(a.outcome_amount,o)||(a.outcome_amount=o),t.Njj(o)}),t.bIt("onInputChange",function(o){t.eBV(e);const a=t.XpG(2);return t.Njj(a.onOutcomeChange(o))}),t.k0s()(),t.j41(6,"b"),t.EFF(7),t.k0s()(),t.j41(8,"lg-gap-row",6)(9,"div"),t.EFF(10," one "),t.k0s(),t.j41(11,"b"),t.EFF(12),t.k0s(),t.j41(13,"div"),t.EFF(14),t.nI1(15,"number"),t.k0s()()()}if(2&l){let e,n,o;const a=t.XpG(2);t.Y8G("fit",!0)("center",!0)("mobileMode",!0),t.R7$(),t.Y8G("size","small")("center",!0),t.R7$(4),t.R50("ngModel",a.outcome_amount),t.Y8G("placeholder","Amount"),t.R7$(2),t.SpI(" ",null==(e=a.result())||null==e.recipe?null:e.recipe.outcome_unit," "),t.R7$(),t.Y8G("size","small"),t.R7$(4),t.SpI(" ",null==(n=a.result())||null==n.recipe?null:n.recipe.outcome_unit," "),t.R7$(2),t.SpI(" costs: ",t.i5U(15,11,((null==(o=a.result())?null:o.total)||1)/(a.showedOutcome()||1),"1.2-2")," ")}}function U(l,d){if(1&l){const e=t.RV6();t.j41(0,"lg-gap-row",4)(1,"div"),t.EFF(2," Calculation outcome: "),t.k0s(),t.j41(3,"div")(4,"lg-number-input",5),t.mxI("ngModelChange",function(o){t.eBV(e);const a=t.XpG(2);return t.DH7(a.outcome_amount,o)||(a.outcome_amount=o),t.Njj(o)}),t.bIt("onInputChange",function(o){t.eBV(e);const a=t.XpG(2);return t.Njj(a.onOutcomeChange(o))}),t.k0s()(),t.j41(5,"div"),t.EFF(6),t.nI1(7,"number"),t.k0s()()}if(2&l){let e;const n=t.XpG(2);t.Y8G("size","small")("center",!0),t.R7$(4),t.R50("ngModel",n.outcome_amount),t.Y8G("placeholder","Amount"),t.R7$(2),t.SpI(" costs: ",t.i5U(7,5,null==(e=n.result())?null:e.total,"1.2-2")," ")}}function B(l,d){if(1&l&&(t.j41(0,"lg-gap-row",2),t.DNE(1,W,16,14,"lg-gap-row",3)(2,U,8,8,"lg-gap-row",4),t.k0s()),2&l){let e;const n=t.XpG();t.Y8G("center",!0),t.R7$(),t.vxM(null!=(e=n.result())&&null!=e.recipe&&e.recipe.outcome_unit&&"gram"!==(null==(e=n.result())||null==e.recipe?null:e.recipe.outcome_unit)?1:2)}}function D(l,d){if(1&l&&(t.j41(0,"a",13),t.EFF(1),t.k0s()),2&l){const e=t.XpG().$implicit;t.Y8G("routerLink",t.l_i(2,z,"recipe-row"===e.type?"/edit-recipe/":"/edit-product/",e.uuid)),t.R7$(),t.SpI(" ",e.name," ")}}function O(l,d){if(1&l&&t.EFF(0),2&l){const e=t.XpG().$implicit;t.SpI(" ",e.name," ")}}function J(l,d){if(1&l&&(t.j41(0,"tr",12)(1,"td"),t.EFF(2),t.k0s(),t.j41(3,"td")(4,"span",12),t.DNE(5,D,2,5,"a",13)(6,O,1,1),t.k0s()(),t.j41(7,"td"),t.EFF(8),t.k0s(),t.j41(9,"td"),t.EFF(10),t.k0s(),t.j41(11,"td"),t.EFF(12),t.k0s(),t.j41(13,"td"),t.EFF(14),t.k0s()()),2&l){const e=d.$implicit,n=d.$index;t.Y8G("ngClass",e.type),t.R7$(2),t.JRh(n+1),t.R7$(2),t.Y8G("ngClass","indent-"+e.indent),t.R7$(),t.vxM("total"!==e.type?5:6),t.R7$(3),t.JRh(e.amount),t.R7$(2),t.JRh(e.unit),t.R7$(2),t.JRh(e.price_per_gram),t.R7$(2),t.JRh(e.total)}}function H(l,d){if(1&l&&(t.j41(0,"table")(1,"colgroup"),t.nrm(2,"col",7)(3,"col",8)(4,"col",9)(5,"col",10)(6,"col",9)(7,"col",11),t.k0s(),t.j41(8,"thead")(9,"tr")(10,"th"),t.EFF(11,"#"),t.k0s(),t.j41(12,"th"),t.EFF(13,"Name"),t.k0s(),t.j41(14,"th"),t.EFF(15,"Amount"),t.k0s(),t.j41(16,"th"),t.EFF(17,"Unit"),t.k0s(),t.j41(18,"th"),t.EFF(19,"Price per unit"),t.k0s(),t.j41(20,"th"),t.EFF(21,"Total"),t.k0s()()(),t.j41(22,"tbody"),t.Z7z(23,J,15,8,"tr",12,t.Vm6),t.k0s()()),2&l){let e;const n=t.XpG();t.R7$(23),t.Dyx(null==(e=n.result())?null:e.result)}}function L(l,d){1&l&&(t.j41(0,"div"),t.EFF(1,"Loading..."),t.k0s())}let Q=(()=>{class l{_aRoute;_calculateRecipeService;constructor(e,n){this._aRoute=e,this._calculateRecipeService=n}uuid=(0,t.vPA)("");result=(0,t.vPA)(null);outcome_amount=(0,t.geq)(0);showedOutcome=(0,t.vPA)(0);onOutcomeChange=e=>{this._calculateRecipeService.calculateRecipe(this.uuid(),e).then(n=>{this.result.set(n),this.showedOutcome.set(e)})};ngOnInit(){this._aRoute.params.subscribe(e=>{this.uuid.set(e.uuid),this._calculateRecipeService.calculateRecipe(e.uuid).then(n=>{this.result.set(n),this.outcome_amount.set(n?.recipe?.outcome_amount||0),this.showedOutcome.set(n?.recipe?.outcome_amount||0)})})}static \u0275fac=function(n){return new(n||l)(t.rXU(j.nX),t.rXU(V))};static \u0275cmp=t.VBU({type:l,selectors:[["lg-calculate-recipe"]],inputs:{outcome_amount:[1,"outcome_amount"]},outputs:{outcome_amount:"outcome_amountChange"},decls:12,vars:15,consts:[[3,"center","mobileMode"],[3,"flat","link","size"],[3,"center"],[3,"fit","center","mobileMode"],[3,"size","center"],["lgParseMath","",3,"ngModelChange","onInputChange","ngModel","placeholder"],[3,"size"],["span","1",2,"width","1%"],["span","1",2,"width","20%"],["span","1",2,"width","5%"],["span","1",2,"width","3%"],["span","1",2,"width","7%"],[3,"ngClass"],["target","_blank",3,"routerLink"]],template:function(n,o){if(1&n&&(t.j41(0,"lg-container")(1,"lg-gap-row",0)(2,"lg-title"),t.EFF(3),t.k0s(),t.j41(4,"lg-button",1),t.EFF(5," Edit "),t.k0s(),t.j41(6,"lg-button",1),t.EFF(7," Back to list "),t.k0s()(),t.DNE(8,B,3,2,"lg-gap-row",2),t.j41(9,"lg-table-card"),t.DNE(10,H,25,0,"table")(11,L,2,0,"div"),t.k0s()()),2&n){let a,c,s;t.R7$(),t.Y8G("center",!0)("mobileMode",!0),t.R7$(2),t.SpI(" ",null==(a=o.result())||null==a.recipe?null:a.recipe.name," cost calculation "),t.R7$(),t.Aen("primary"),t.Y8G("flat",!0)("link","/edit-recipe/"+(null==(c=o.result())||null==c.recipe?null:c.recipe.uuid))("size","small"),t.R7$(2),t.Aen("warning"),t.Y8G("flat",!0)("link","/recipes")("size","small"),t.R7$(2),t.vxM(null!=(s=o.result())&&s.total?8:-1),t.R7$(2),t.vxM(o.result()?10:11)}},dependencies:[E.H,I.W,$,A.YU,M.Q,N.I,A.QX,S.N,k.YN,k.BC,k.vS,Y.t,j.Wk],styles:[":host{--control-bg: #fff}lg-number-input .lg-number-input{width:100px}\n"],encapsulation:2})}return l})()}}]);