"use strict";(self.webpackChunklasagna=self.webpackChunklasagna||[]).push([[12],{202:(A,h,c)=>{c.r(h),c.d(h,{AddRecipeComponent:()=>H});var e=c(1007),_=c(5642),v=c(553),F=c(1086),i=c(9417),E=c(3333),s=c(7504);const u=["*"];function d(o,a){if(1&o&&(e.j41(0,"p",1),e.EFF(1),e.k0s()),2&o){const t=e.XpG();e.R7$(),e.SpI(" ",t.label()," ")}}let p=(()=>{class o{constructor(){}label=(0,e.hFB)("");static \u0275fac=function(n){return new(n||o)};static \u0275cmp=e.VBU({type:o,selectors:[["lg-control-group"]],inputs:{label:[1,"label"]},ngContentSelectors:u,decls:4,vars:1,consts:[[1,"control-group"],[1,"control-group__label"],[1,"control-group__content"]],template:function(n,r){1&n&&(e.NAR(),e.j41(0,"div",0),e.DNE(1,d,2,1,"p",1),e.j41(2,"div",2),e.SdG(3),e.k0s()()),2&n&&(e.R7$(),e.vxM(r.label()?1:-1))},styles:["[_nghost-%COMP%]{display:flex;flex:1}.control-group[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:16px}.control-group__label[_ngcontent-%COMP%]{font-size:1.2rem;margin:0}.control-group__content[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:flex-end}.control-group__content[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{flex:1}"]})}return o})();var g=c(7782),m=c(1119);const f=["input"];let x=(()=>{class o{constructor(){}input;value="";placeholder=(0,e.hFB)("Enter text here");onChange=()=>{};onTouched=()=>{};writeValue(t){this.changeValue(t)}registerOnChange(t){this.onChange=t}focus(){this.input?.nativeElement.focus()}registerOnTouched(t){this.onTouched=t}changeValue(t){this.value=t,this.onChange(this.value)}onChangeInput(t){this.changeValue(t.target.value)}static \u0275fac=function(n){return new(n||o)};static \u0275cmp=e.VBU({type:o,selectors:[["lg-textarea"]],viewQuery:function(n,r){if(1&n&&e.GBs(f,7),2&n){let l;e.mGM(l=e.lsd())&&(r.input=l.first)}},inputs:{placeholder:[1,"placeholder"]},features:[e.Jv_([{provide:i.kq,useExisting:o,multi:!0}])],decls:2,vars:2,consts:[["input",""],["rows","5",1,"textarea",3,"input","placeholder","value"]],template:function(n,r){if(1&n){const l=e.RV6();e.j41(0,"textarea",1,0),e.bIt("input",function(j){return e.eBV(l),e.Njj(r.onChangeInput(j))}),e.k0s()}2&n&&e.Y8G("placeholder",r.placeholder())("value",r.value)},dependencies:[i.YN],styles:["[_nghost-%COMP%]{display:flex;flex:1}.textarea[_ngcontent-%COMP%]{flex:1;border:none;border-radius:12px;padding:16px;background-color:var(--control-bg);font-family:inherit;font-size:inherit}.textarea[_ngcontent-%COMP%]::placeholder{color:var(--placeholder)}.textarea[_ngcontent-%COMP%]:focus{outline:none;box-shadow:var(--focus-shadow)}"]})}return o})();var C=c(152),R=c(8456),b=c(416),y=c(177),G=c(8536),S=c(9895);const w=["*",[["rowActions"]]],I=["*","rowActions"];let V=(()=>{class o{constructor(){}static \u0275fac=function(n){return new(n||o)};static \u0275cmp=e.VBU({type:o,selectors:[["lg-controls-row"]],ngContentSelectors:I,decls:5,vars:0,consts:[[1,"controls-row"],[1,"controls-row__controls"],[1,"controls-row__actions"]],template:function(n,r){1&n&&(e.NAR(w),e.j41(0,"div",0)(1,"div",1),e.SdG(2),e.k0s(),e.j41(3,"div",2),e.SdG(4,1),e.k0s()())},styles:[":host{display:flex;gap:16px}.controls-row{width:100%;display:flex;align-items:flex-end;gap:16px;flex:1}.controls-row__controls,.controls-row__actions{display:flex;align-items:flex-end;gap:16px}.controls-row__controls{flex:1}.controls-row__actions{flex:0;white-space:nowrap}.controls-row__controls>*,.controls-row__actions>*{flex:1}\n"],encapsulation:2})}return o})(),N=(()=>{class o{constructor(){}width="100%";static \u0275fac=function(n){return new(n||o)};static \u0275dir=e.FsC({type:o,selectors:[["","lgExpand",""]],hostVars:2,hostBindings:function(n,r){2&n&&e.xc7("width",r.width)}})}return o})();var $=c(9512),k=c(1338);const M=(o,a)=>(null==a.value.product_id?null:a.value.product_id.id)||a.value.name||a.value.amount;function P(o,a){if(1&o){const t=e.RV6();e.j41(0,"lg-gap-column",17)(1,"lg-control",21),e.qex(2,22),e.j41(3,"span",23),e.bIt("click",function(){e.eBV(t);const r=e.XpG().$index,l=e.XpG();return e.Njj(l.closeTextField(r))}),e.EFF(4,"Hide"),e.k0s(),e.bVm(),e.nrm(5,"lg-input",24),e.k0s()()}2&o&&(e.Y8G("size","small"),e.R7$(5),e.Y8G("placeholder","Here you can write the name of the ingredient"))}function B(o,a){if(1&o){const t=e.RV6();e.j41(0,"lg-multiselect",30),e.bIt("onSelected",function(){e.eBV(t),e.XpG(2);const r=e.sdS(6);return e.Njj(r.focus())}),e.k0s()}2&o&&e.Y8G("resource","recipes")("autoLoad",!0)}function D(o,a){if(1&o){const t=e.RV6();e.j41(0,"lg-multiselect",31),e.bIt("onSelected",function(){e.eBV(t),e.XpG(2);const r=e.sdS(6);return e.Njj(r.focus())}),e.k0s()}2&o&&e.Y8G("resource","products")("autoLoad",!0)}function O(o,a){if(1&o){const t=e.RV6();e.j41(0,"lg-gap-column",17)(1,"lg-control"),e.qex(2,25),e.j41(3,"span",26),e.bIt("click",function(){e.eBV(t);const r=e.XpG().$index,l=e.XpG();return e.Njj(l.closeRecipeField(r))}),e.EFF(4," Product "),e.k0s(),e.bVm(),e.qex(5,27),e.j41(6,"span",26),e.bIt("click",function(){e.eBV(t);const r=e.XpG().$index,l=e.XpG();return e.Njj(l.openRecipeField(r))}),e.EFF(7,"Recipe"),e.k0s(),e.bVm(),e.qex(8,22),e.j41(9,"span",23),e.bIt("click",function(){e.eBV(t);const r=e.XpG().$index,l=e.XpG();return e.Njj(l.openTextField(r))}),e.EFF(10,"As text"),e.k0s(),e.bVm(),e.DNE(11,B,1,2,"lg-multiselect",28)(12,D,1,2,"lg-multiselect",29),e.k0s()()}if(2&o){const t=e.XpG().$index,n=e.XpG();e.Y8G("size","small"),e.R7$(3),e.Y8G("ngClass",n.recipeFieldState()[t]?"":"text-active text-bold"),e.R7$(3),e.Y8G("ngClass",n.recipeFieldState()[t]?"text-active text-bold":""),e.R7$(5),e.vxM(n.recipeFieldState()[t]?11:12)}}function Y(o,a){if(1&o){const t=e.RV6();e.qex(0,15),e.j41(1,"lg-controls-row"),e.DNE(2,P,6,2,"lg-gap-column",17)(3,O,13,4,"lg-gap-column",17),e.j41(4,"lg-control",18)(5,"lg-number-input",19,1),e.bIt("onKeydown",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.addLast())}),e.k0s()(),e.qex(7,20),e.j41(8,"lg-button",16),e.bIt("click",function(){const r=e.eBV(t).$index,l=e.XpG();return e.Njj(l.deleteIngredient(r))}),e.EFF(9," Delete Ingredient "),e.k0s(),e.bVm(),e.k0s(),e.bVm()}if(2&o){const t=a.$index,n=e.XpG();e.Y8G("formGroupName",t),e.R7$(2),e.vxM(n.textFieldState()[t]?2:3),e.R7$(3),e.Y8G("placeholder","In grams"),e.R7$(3),e.Aen("danger"),e.Y8G("size","small")}}function X(o,a){if(1&o){const t=e.RV6();e.j41(0,"lg-button",23),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.editRecipe(r.value))}),e.EFF(1," Edit Recipe "),e.k0s()}}function U(o,a){if(1&o){const t=e.RV6();e.j41(0,"lg-button",23),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.addRecipe(r.value))}),e.EFF(1," Add Recipe "),e.k0s()}}let L=(()=>{class o{_recipesRepository;_selectResourcesService;_router;constructor(t,n,r){this._recipesRepository=t,this._selectResourcesService=n,this._router=r}form=new i.gE({name:new i.MJ(null,i.k0.required),description:new i.MJ("",i.k0.required),outcome_amount:new i.MJ(null,i.k0.required),outcome_unit:new i.MJ("",i.k0.required),ingredients:new i.Yp([this._getIngredientGroup()])});uuid=(0,e.hFB)("");textFieldState=(0,e.vPA)({});recipeFieldState=(0,e.vPA)({});uuidEffect=(0,e.QZP)(()=>{this.uuid()&&this._recipesRepository.getOne(this.uuid(),t=>{this.form.reset({...t,ingredients:[]}),this.form.get("ingredients").clear(),t.ingredients.forEach((n,r)=>{this.ingredients.push(this._getIngredientGroup(n)),n.recipe_id&&this.openRecipeField(r),n.name&&this.openTextField(r)}),this.form.updateValueAndValidity()})});get ingredients(){return this.form.get("ingredients")}get value(){return this.form.value}get _values(){return(0,G.rY)((0,G.rh)(this.form.value))}addLast(){const t=this.ingredients.at(this.ingredients.length-1);(t.value.name||t.value.amount||t.value.product_id)&&this.addIngredient()}ngOnInit(){this.form.valueChanges.pipe((0,C.B)(500)).subscribe({next:t=>{console.log(t)}})}ngAfterViewInit(){this._selectResourcesService.load().then(t=>{})}addIngredient(){this.ingredients.push(new i.gE({name:new i.MJ("",i.k0.required),amount:new i.MJ(0,i.k0.required),product_id:new i.MJ("",i.k0.required)}))}deleteIngredient(t){this.ingredients.removeAt(t)}addRecipe(t){this._recipesRepository.addRecipe(this._values).then(()=>{this._router.navigate(["/recipes"])})}editRecipe(t){this._recipesRepository.editRecipe(this.uuid(),this._values).then(()=>{this._router.navigate(["/recipes"])})}openTextField(t){this.textFieldState.update(n=>({...n,[t]:!0})),this.ingredients.at(t).patchValue({product_id:null,recipe_id:null})}closeTextField(t){this.textFieldState.update(n=>({...n,[t]:!1})),this.ingredients.at(t).patchValue({product_id:null,recipe_id:null,name:""})}openRecipeField(t){this.recipeFieldState.update(n=>({...n,[t]:!0})),this.ingredients.at(t).patchValue({name:"",product_id:null})}closeRecipeField(t){this.recipeFieldState.update(n=>({...n,[t]:!1})),this.ingredients.at(t).patchValue({name:"",product_id:null})}_getIngredientGroup(t){return new i.gE({name:new i.MJ(t?.name),amount:new i.MJ(t?.amount.toString()??null,i.k0.required),product_id:new i.MJ(t?.product_id?{uuid:t.product_id}:null,i.k0.required),recipe_id:new i.MJ(t?.recipe_id?{uuid:t.recipe_id}:null,i.k0.required)})}static \u0275fac=function(n){return new(n||o)(e.rXU($.m),e.rXU(b.n),e.rXU(k.Ix))};static \u0275cmp=e.VBU({type:o,selectors:[["lg-add-recipe-form"]],inputs:{uuid:[1,"uuid"]},features:[e.Jv_([{provide:b.n,useClass:b.n}])],decls:22,vars:11,consts:[["desc",""],["amount",""],[3,"formGroup"],[3,"position"],["label","Name","lgExpand",""],["formControlName","name",3,"onInputChanged","placeholder"],["label","Description","lgExpand",""],["formControlName","description",3,"placeholder"],["lgExpand",""],["label","Amount of the outcome","lgExpand",""],["formControlName","outcome_amount",3,"placeholder"],["label","Outcome unit","lgExpand",""],["formControlName","outcome_unit",3,"placeholder"],["label","Ingredients","lgExpand",""],["formArrayName","ingredients","lgExpand",""],[3,"formGroupName"],[3,"click","size"],[3,"size"],["label","Amount"],["formControlName","amount",3,"onKeydown","placeholder"],["ngProjectAs","rowActions",5,["rowActions"]],["label","Name"],["ngProjectAs","endLabelTpl",5,["endLabelTpl"]],[3,"click"],["formControlName","name",3,"placeholder"],["ngProjectAs","labelTpl",5,["labelTpl"]],[3,"click","ngClass"],["ngProjectAs","afterLabelTpl",5,["afterLabelTpl"]],["formControlName","recipe_id",3,"resource","autoLoad"],["formControlName","product_id",3,"resource","autoLoad"],["formControlName","recipe_id",3,"onSelected","resource","autoLoad"],["formControlName","product_id",3,"onSelected","resource","autoLoad"]],template:function(n,r){if(1&n){const l=e.RV6();e.j41(0,"form",2)(1,"lg-gap-column",3)(2,"lg-control",4)(3,"lg-input",5),e.bIt("onInputChanged",function(){e.eBV(l);const j=e.sdS(6);return e.Njj(j.focus())}),e.k0s()(),e.j41(4,"lg-control",6),e.nrm(5,"lg-textarea",7,0),e.k0s(),e.j41(7,"lg-controls-row",8)(8,"lg-control",9),e.nrm(9,"lg-number-input",10,1),e.k0s(),e.j41(11,"lg-control",11),e.nrm(12,"lg-input",12),e.k0s()(),e.j41(13,"lg-control-group",13)(14,"lg-gap-column",3)(15,"lg-gap-column",14),e.Z7z(16,Y,10,6,"ng-container",15,M),e.k0s(),e.j41(18,"lg-button",16),e.bIt("click",function(){return e.eBV(l),e.Njj(r.addIngredient())}),e.EFF(19," Add Ingredient "),e.k0s()()(),e.DNE(20,X,2,0,"lg-button")(21,U,2,0,"lg-button"),e.k0s()()}2&n&&(e.Y8G("formGroup",r.form),e.R7$(),e.Y8G("position","start"),e.R7$(2),e.Y8G("placeholder","Your recipe name"),e.R7$(2),e.Y8G("placeholder","Describe your recipe, how to make it, what to pay attention to, etc."),e.R7$(4),e.Y8G("placeholder",r.form.value.outcome_unit||"Here you can write the amount of the outcome (e.g. 100, 12, etc.)"),e.R7$(3),e.Y8G("placeholder","And here the unit of the outcome (e.g. grams, pieces, etc.)"),e.R7$(2),e.Y8G("position","start"),e.R7$(2),e.Dyx(r.ingredients.controls),e.R7$(2),e.Aen("success"),e.Y8G("size","small"),e.R7$(2),e.vxM(r.uuid()?20:21))},dependencies:[i.X1,i.qT,i.BC,i.cb,i.j4,i.JD,i.$R,i.v8,E.S,s.X,p,g.K,m.Q,x,R.$,S.N,V,N,y.YU],encapsulation:2})}return o})();var J=c(7512);function z(o,a){if(1&o&&(e.j41(0,"lg-button",2),e.EFF(1," Calculate "),e.k0s()),2&o){const t=e.XpG();e.Aen("primary"),e.Y8G("flat",!0)("link","/calc-recipe/"+t.uuid())("size","small")}}let H=(()=>{class o{_aRoute;constructor(t){this._aRoute=t}uuid=(0,e.vPA)("");ngOnInit(){this._aRoute.params.subscribe(t=>{this.uuid.set(t.uuid)})}static \u0275fac=function(n){return new(n||o)(e.rXU(k.nX))};static \u0275cmp=e.VBU({type:o,selectors:[["app-add-recipe"]],decls:9,vars:9,consts:[[3,"center"],[3,"flat","link","size","style"],[3,"flat","link","size"],[3,"uuid"]],template:function(n,r){1&n&&(e.j41(0,"lg-container")(1,"lg-gap-row",0)(2,"lg-title"),e.EFF(3),e.k0s(),e.DNE(4,z,2,5,"lg-button",1),e.j41(5,"lg-button",2),e.EFF(6," Back to list "),e.k0s()(),e.j41(7,"lg-card"),e.nrm(8,"lg-add-recipe-form",3),e.k0s()()),2&n&&(e.R7$(),e.Y8G("center",!0),e.R7$(2),e.SpI("",r.uuid()?"Edit":"Add"," Recipe"),e.R7$(),e.vxM(r.uuid()?4:-1),e.R7$(),e.Aen("warning"),e.Y8G("flat",!0)("link","/recipes")("size","small"),e.R7$(3),e.Y8G("uuid",r.uuid()))},dependencies:[_.H,v.i,F.W,L,m.Q,J.I],encapsulation:2})}return o})()},4374:(A,h,c)=>{c.d(h,{F:()=>e});var e=function(_){return _.PRODUCTS="productsStore",_.RECIPES="recipesStore",_.CATEGORIES="categoryStore",_}(e||{})},5559:(A,h,c)=>{c.d(h,{Q:()=>F});var e=c(467),_=c(4374),v=c(1007);let F=(()=>{class i{constructor(){}get _uuid(){return Math.random().toString(36).substring(2)+Date.now().toString(36)}openDb(s){return new Promise(function(){var u=(0,e.A)(function*(d,p){const g=yield window.indexedDB.open("lasagna-db",1);g.onerror=m=>{p(m)},g.onsuccess=m=>{s(m.target?.result)},g.onupgradeneeded=m=>{const f=m.target?.result;f.createObjectStore(_.F.PRODUCTS,{keyPath:"uuid",autoIncrement:!0}).createIndex("name","name",{unique:!1}),f.createObjectStore(_.F.RECIPES,{keyPath:"uuid",autoIncrement:!0}).createIndex("name","name",{unique:!1}),f.createObjectStore(_.F.CATEGORIES,{keyPath:"uuid",autoIncrement:!0}).createIndex("name","name",{unique:!1})},d()});return function(d,p){return u.apply(this,arguments)}}())}addData(s,u){this.openDb(d=>{d.transaction(s,"readwrite").objectStore(s).add({...u,uuid:this._uuid})})}replaceData(s,u,d){return this.openDb(p=>{p.transaction(s,"readwrite").objectStore(s).put(d,"uuid")})}search(s,u,d,p){this.openDb(g=>{g.transaction(s,"readonly").objectStore(s).index(u).getAll(d).onsuccess=R=>{p(R.target.result)}})}getOne(s,u,d){this.openDb(p=>{p.transaction(s,"readonly").objectStore(s).get(u).onsuccess=x=>{d(x.target.result)}})}static \u0275fac=function(u){return new(u||i)};static \u0275prov=v.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})()}}]);