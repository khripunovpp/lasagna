import{a as Ne}from"./chunk-BY37E7YI.js";import{a as Ae,b as Ge}from"./chunk-4AZV5HWW.js";import{a as Ve}from"./chunk-CMFNAYLA.js";import{a as De}from"./chunk-7TT4R52F.js";import{a as j}from"./chunk-ACC6FC2Y.js";import{a as J,c as L}from"./chunk-4NJWONPW.js";import{a as Fe}from"./chunk-B4BPCK6P.js";import"./chunk-CWUUYJTE.js";import"./chunk-FK6H3RFT.js";import{a as Ee}from"./chunk-GFKJ3IXC.js";import{a as O}from"./chunk-VQHUADFJ.js";import{a as Re}from"./chunk-IVWGGHZS.js";import{a as I}from"./chunk-OSRCQ3N6.js";import{a as We}from"./chunk-I27O3RKJ.js";import"./chunk-MPFUNZLY.js";import{a as G}from"./chunk-Q75E6UIP.js";import{c as ve,h as Ie,k as Pe}from"./chunk-2U4XONR7.js";import"./chunk-XF6QJ4WA.js";import{C as T,D as be,E as N,G as B,H as A,I as we,J as xe,L as Se,M as ke,O as Te,Q as M,R as Be,T as Me,V as z,c as Ce,o as he,w as V,y as ye}from"./chunk-2GBIJY5Z.js";import"./chunk-VYSMWHEC.js";import"./chunk-CABIONZL.js";import"./chunk-EMIJRNYJ.js";import{m as _e}from"./chunk-HDEG74LV.js";import{Bc as $,Cb as C,Dc as ee,Eb as h,Gb as re,Hb as D,Ib as F,Jb as c,Kb as l,Lb as a,Lc as de,Mb as d,Mc as ue,Nc as ge,Pc as fe,Qb as S,Qc as W,Ub as v,Vb as p,Z as ne,_a as r,da as oe,db as R,ec as ae,fc as Z,gc as le,ic as m,jc as y,ka as u,kb as _,kc as se,la as g,nc as b,oc as w,pb as E,pc as x,qa as ie,qc as ce,rc as me,sc as pe,ua as f,vc as k}from"./chunk-NHWKWTII.js";import"./chunk-2RGDSI3Q.js";import{a as te}from"./chunk-C6Q5SG76.js";function Le(n,e){if(n&1){let t=S();l(0,"lg-gap-column",0)(1,"lg-control",6)(2,"lg-input",4),x("ngModelChange",function(i){u(t);let s=p(2);return w(s.product.name,i)||(s.product.name=i),g(i)}),a()(),l(3,"lg-control",6)(4,"lg-number-input",4),x("ngModelChange",function(i){u(t);let s=p(2);return w(s.product.amount,i)||(s.product.amount=i),g(i)}),a()(),l(5,"lg-control",6)(6,"lg-number-input",4),x("ngModelChange",function(i){u(t);let s=p(2);return w(s.product.price,i)||(s.product.price=i),g(i)}),a(),l(7,"div"),m(8),a()(),l(9,"lg-button",7),v("click",function(){u(t);let i=p(2);return g(i.addProduct())}),m(10,"Add product"),a()()}if(n&2){let t=p(2);c("size","medium"),r(),c("label","Name"),r(),b("ngModel",t.product.name),c("placeholder","Name"),r(),c("label","Amount"),r(),b("ngModel",t.product.amount),c("placeholder","Amount"),r(),c("label","Price"),r(),b("ngModel",t.product.price),c("placeholder","Price"),r(2),y(t.product.unit)}}function je(n,e){if(n&1){let t=S();d(0,"video",2),l(1,"lg-gap-column")(2,"lg-gap-row",3)(3,"lg-input",4),x("ngModelChange",function(i){u(t);let s=p();return w(s.barcode,i)||(s.barcode=i),g(i)}),a(),l(4,"lg-button",5),v("click",function(){u(t);let i=p();return g(i.onBarcodeManualInput())}),m(5,"Search"),a(),l(6,"lg-button",5),v("click",function(){u(t);let i=p();return g(i.clear())}),m(7,"Clear"),a()(),C(8,Le,11,11,"lg-gap-column",0),a()}if(n&2){let t=p();r(3),b("ngModel",t.barcode),c("placeholder","Barcode"),r(5),h(t.showProductForm()&&t.productResult()?8:-1)}}function qe(n,e){if(n&1){let t=S();l(0,"lg-button",5),v("click",function(){u(t);let i=p();return g(i.openScanner())}),m(1,"Scan"),a()}}var q=class n{constructor(e,t,o,i){this._openFoodFactsService=e;this._arcodeReaderService=t;this._productRepository=o;this._notificationService=i}productAdded=fe();barcode=f("");product={name:"",price:0,amount:0,unit:"gram"};lockRequest=!1;showFormInitially=W(!1);showScanerInitially=W(!1);showScanner=f(!1);showProductForm=f(!1);userResource=ge({params:()=>({id:this.barcode()}),loader:({params:e,abortSignal:t})=>this.lockRequest||!e.id?Promise.resolve(null):(this._notificationService.info("Barcode detected: "+e.id),this.lockRequest=!0,this._openFoodFactsService.getProductByBarcode(e.id).then(o=>(this.showProductForm.set(!0),o)))});productResult=de(()=>{let e=this.userResource.value();if(e?.status===1){let t=e.product;return this.product.name=(t.product_name||"")+" ("+(t.brands||"")+")",this.product.amount=this.extractAmount(t),this.product.unit=this.detectUnit(t),te({},this.product)}return null});onBarcodeManualInput(){this.lockRequest=!1}openScanner(){this.showScanner.set(!0),this.startCamera()}clear(){this.barcode.set(""),this.product={name:"",price:0,amount:0,unit:"gram"},this.showProductForm.set(!1),this.lockRequest=!1}closeScanner(){this.showScanner.set(!1),this.stopCamera()}extractAmount(e){if(e.quantity){let t=e.quantity.match(/\d+/);return t?+t[0]:0}return 0}stopCamera(){this._arcodeReaderService.stopCamera()}detectUnit(e){let t=(e.serving_quantity_unit||"").toLowerCase();return t.includes("g")||t.includes("ml")?"gram":t.includes("pc")||t.includes("\u0448\u0442")?"piece":"gram"}addProduct(){this._productRepository.addOne(Ce.fromRaw({name:this.product.name,price:this.product.price,amount:this.product.amount,unit:this.product.unit,source:"openfoodfacts",category_id:"",tags:[],createdAt:Date.now()})).then(e=>{this.productAdded.emit({uuid:e,name:this.product.name}),this.product={name:"",price:0,amount:0,unit:"gram"},this.barcode.set(""),this.lockRequest=!1})}startCamera(){return this._arcodeReaderService.startCamera("video",e=>{e&&this.barcode.set(e)})}async ngAfterViewInit(){this.showScanerInitially()&&(this.showScanner.set(!0),await this.startCamera())}ngOnDestroy(){this.stopCamera()}static \u0275fac=function(t){return new(t||n)(R(Ie),R(ve),R(Pe),R(Me))};static \u0275cmp=_({type:n,selectors:[["lg-barcode-add-product-widget"]],inputs:{showFormInitially:[1,"showFormInitially"],showScanerInitially:[1,"showScanerInitially"]},outputs:{productAdded:"productAdded"},features:[k([])],decls:6,vars:4,consts:[[3,"size"],[3,"top","mobileMode"],["id","video"],["lgExpand",""],["lgExpand","","lgParseMath","",3,"ngModelChange","ngModel","placeholder"],[3,"click"],[3,"label"],["lgShrink","",3,"click"]],template:function(t,o){t&1&&(l(0,"lg-gap-column",0)(1,"lg-title"),m(2," \u{1F4F7} Scan barcode or enter manually "),a(),l(3,"lg-gap-row",1),C(4,je,9,3)(5,qe,2,0,"lg-button"),a()()),t&2&&(c("size","medium"),r(3),c("top",!0)("mobileMode",!0),r(),h(o.showScanner()?4:5))},dependencies:[M,T,A,O,Ve,G,z,Ee,L,I,J,De,j],encapsulation:2})};var Ue=(n,e)=>e.value;function He(n,e){if(n&1){let t=S();l(0,"lg-button",2),v("click",function(){let i=u(t),s=i.$implicit,P=i.$index,Je=p();return g(Je.onClickItem(s,P))}),m(1),a()}if(n&2){let t=e.$implicit,o=e.$index,i=e.$count,s=p();le(t.style||"default"),Z("buttons-group__item--active",s.activeIndex()==o),c("active",s.activeIndex()==o)("flat",s.flat)("noScale",!0)("size",t.size||"default")("noLeftRadius",o===i-1)("noRightRadius",o===0)("noRadius",o!==0&&o!==i-1),r(),se(" ",t.label," ")}}var Y=class n{flat=!1;items=W();activeIndex=f(0);value=f("");effect=ue(()=>{let e=this.items()?.findIndex(t=>t.value===this.value())??-1;this.activeIndex.set(e===-1?0:e)});onClickItem(e,t){this.activeIndex.set(t),this.writeValue(e.value),e.onClick?.()}onChange=()=>{};onTouched=()=>{};writeValue(e){this._change(e)}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}onChangeInput(e){this._change(e.target.value)}_change(e){this.value.set(e),this.onChange(this.value())}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=_({type:n,selectors:[["lg-buttons-group"]],inputs:{flat:"flat",items:[1,"items"]},features:[k([{provide:V,useExisting:ne(()=>n),multi:!0}])],decls:3,vars:2,consts:[[1,"buttons-group"],[1,"buttons-group__item",3,"active","flat","noScale","style","size","noLeftRadius","noRightRadius","noRadius","buttons-group__item--active"],[1,"buttons-group__item",3,"click","active","flat","noScale","size","noLeftRadius","noRightRadius","noRadius"]],template:function(t,o){t&1&&(l(0,"div",0),D(1,He,2,12,"lg-button",1,Ue),a()),t&2&&(Z("buttons-group--flat",o.flat),r(),F(o.items()))},dependencies:[z],styles:[`.buttons-group{display:flex}.buttons-group lg-button{flex:1}.buttons-group lg-button button{width:100%}.buttons-group--flat{gap:16px;width:100%}
`],encapsulation:2})};var Ye={powder:{mass:n=>n*5+n},leaf:{mass:n=>n*5+n},mass:{powder:n=>n/6,leaf:n=>n/6}},Ke=n=>n*5,Qe=n=>n*5/6,Xe=(n,e)=>n/e,K=class{constructor(e,t=1){this.type=e;this.bloom=t}convertToBase(e,t,o=1){let i=Xe(this.bloom,o);return(Ye[this.type]?.[e]?.(t)||t)*i}convertToWater(e,t){return this.type==="mass"&&e==="mass"||this.type==="leaf"||e==="leaf"?0:this.type==="mass"?Ke(t):e==="mass"?Qe(t):0}};function Ze(n,e){if(n&1&&(l(0,"div",4),d(1,"div",5),l(2,"div",6),m(3),a()()),n&2){let t=e.$implicit,o=p();ae("left",(t-o.min)/(o.max-o.min)*100,"%"),r(3),y(t)}}var Q=class n{constructor(){}min=0;max=100;step=1;tickInterval;customTicks;value="";get ticks(){if(this.customTicks)return this.customTicks;if(this.tickInterval){let e=[];for(let t=this.min;t<=this.max;t+=this.tickInterval)e.push(t);return e}return[]}onChange=()=>{};onTouched=()=>{};writeValue(e){this.changeValue(e)}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}changeValue(e){this.value=e,this.onChange(this.value)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=_({type:n,selectors:[["lg-range"]],inputs:{min:"min",max:"max",step:"step",tickInterval:"tickInterval",customTicks:"customTicks"},features:[k([{provide:V,useExisting:n,multi:!0}])],decls:5,vars:4,consts:[[1,"range-wrapper"],["type","range",1,"custom-range",3,"ngModelChange","min","max","step","ngModel"],[1,"ticks"],[1,"tick",3,"left"],[1,"tick"],[1,"tick-line"],[1,"label"]],template:function(t,o){t&1&&(l(0,"div",0)(1,"input",1),x("ngModelChange",function(s){return w(o.value,s)||(o.value=s),s}),v("ngModelChange",function(s){return o.changeValue(s)}),a(),l(2,"div",2),D(3,Ze,4,3,"div",3,re),a()()),t&2&&(r(),c("min",o.min)("max",o.max)("step",o.step),b("ngModel",o.value),r(2),F(o.ticks))},dependencies:[M,ye,xe,T,A],styles:[".range-wrapper[_ngcontent-%COMP%]{position:relative;width:100%;padding-bottom:30px}.custom-range[_ngcontent-%COMP%]{width:100%;-webkit-appearance:none;background:transparent;position:relative;z-index:2;margin:0}.custom-range[_ngcontent-%COMP%]::-webkit-slider-runnable-track{height:6px;background:#ddd;border-radius:3px}.custom-range[_ngcontent-%COMP%]::-moz-range-track{height:6px;background:#ddd;border-radius:3px}.custom-range[_ngcontent-%COMP%]::-webkit-slider-thumb{-webkit-appearance:none;height:20px;width:20px;background:var(--accent-color);border-radius:50%;margin-top:-7px;cursor:pointer}.custom-range[_ngcontent-%COMP%]::-moz-range-thumb{height:20px;width:20px;background:var(--accent-color);border-radius:50%;cursor:pointer}.ticks[_ngcontent-%COMP%]{position:absolute;top:28px;left:2.4%;right:2.4%;height:30px;pointer-events:none}.tick[_ngcontent-%COMP%]{position:absolute;text-align:center;transform:translate(-50%)}.tick-line[_ngcontent-%COMP%]{width:1px;height:10px;background-color:#666;margin:0 auto}.label[_ngcontent-%COMP%]{font-size:10px;color:#666;margin-top:2px;display:block}"]})};function $e(n,e){n&1&&m(0," grams of ")}function et(n,e){n&1&&m(0," \u{1F35A} ")}function tt(n,e){n&1&&m(0," \u{1F343} ")}function nt(n,e){n&1&&m(0," \u{1F9EB} ")}function ot(n,e){n&1&&(l(0,"div"),m(1," With "),a())}function it(n,e){n&1&&(l(0,"div"),m(1," And "),a())}function rt(n,e){n&1&&(l(0,"div"),m(1," And "),a())}function at(n,e){n&1&&(d(0,"br"),m(1,"included "))}function lt(n,e){if(n&1&&(l(0,"lg-gap-column",9)(1,"div"),C(2,ot,2,0,"div"),C(3,it,2,0,"div")(4,rt,2,0,"div"),a(),l(5,"lg-gap-row",10)(6,"div"),m(7),$(8,"number"),a(),m(9," \u{1F4A7} "),a(),l(10,"div"),m(11," ml of water "),C(12,at,2,0),a()()),n&2){let t,o,i,s=p(),P=pe(10);c("size","small")("position","center"),r(2),h((t=P)==="mass"?2:-1),r(),h((o=P)==="powder"?3:o==="leaf"?4:-1),r(2),c("size","small"),r(2),y(ee(8,7,s.waterNeeded(),"1.0-2")),r(5),h((i=P)==="mass"?12:-1)}}var X=class n{constructor(){this.form.valueChanges.pipe(he(this.destroyRef)).subscribe(e=>{let t=parseFloat(String(e?.from?.amount));if(isNaN(t))return;let o=new K(e?.from?.type,e?.from?.bloom),i=o.convertToBase(e?.to?.type,t,e?.to?.bloom),s=o.convertToWater(e?.to?.type,i);this.result.set(i),this.waterNeeded.set(s)})}result=f(0);waterNeeded=f(0);destroyRef=oe(ie);form=new N({from:new N({type:new B("mass"),amount:new B(null),bloom:new B(140)}),to:new N({type:new B("powder"),bloom:new B(140)})});typeButtons=[{label:"powder",value:"powder",style:"secondary"},{label:"leaf",value:"leaf",style:"secondary"},{label:"mass",value:"mass",style:"secondary"}];static \u0275fac=function(t){return new(t||n)};static \u0275cmp=_({type:n,selectors:[["lg-jelly-widget"]],decls:27,vars:25,consts:[[3,"formGroup"],[3,"bottom","mobileMode"],["formGroupName","from"],["formControlName","amount","lgParseMath","",3,"placeholder"],["lgExtraTpl","","place","after"],["formControlName","bloom",3,"min","max","step","tickInterval"],["formControlName","type",3,"items"],["formGroupName","to"],[1,"text-center",3,"strictCenter"],["lgShrink","",3,"size","position"],[2,"font-size","2rem",3,"size"]],template:function(t,o){if(t&1&&(l(0,"lg-gap-column")(1,"form",0)(2,"lg-gap-row",1)(3,"lg-gap-column",2),m(4," In recipe you have "),l(5,"lg-number-input",3),E(6,$e,1,0,"ng-template",4),a(),d(7,"lg-range",5)(8,"lg-buttons-group",6),a(),l(9,"lg-gap-column",7),ce(10),l(11,"lg-gap-row",8)(12,"lg-gap-column",9)(13,"div"),m(14," You need "),a(),l(15,"lg-gap-row",10)(16,"div"),m(17),$(18,"number"),a(),C(19,et,1,0)(20,tt,1,0)(21,nt,1,0),a(),l(22,"div"),m(23," grams of "),a()(),C(24,lt,13,10,"lg-gap-column",9),a(),d(25,"lg-range",5)(26,"lg-buttons-group",6),a()()()()),t&2){let i;r(),c("formGroup",o.form),r(),c("bottom",!0)("mobileMode",!0),r(3),c("placeholder","Amount"),r(2),c("min",120)("max",220)("step",10)("tickInterval",20),r(),c("items",o.typeButtons),o.form.value==null||o.form.value.from==null||o.form.value.from.type,r(2);let s=me(o.form.value==null||o.form.value.to==null?null:o.form.value.to.type);r(),c("strictCenter",!0),r(),c("size","small")("position","center"),r(3),c("size","small"),r(2),y(ee(18,22,o.result(),"1.0-2")),r(2),h((i=s)==="powder"?19:i==="leaf"?20:i==="mass"?21:-1),r(5),h(o.waterNeeded()?24:-1),r(),c("min",120)("max",220)("step",10)("tickInterval",20),r(),c("items",o.typeButtons)}},dependencies:[M,we,T,be,Be,Se,Te,ke,O,I,Y,_e,j,Q,J,L,Fe],styles:[`:host{--control-bg: #fcfcfc}lg-eggs-widget{display:flex}.eggs-widget{display:flex;flex-direction:column}.eggs-widget__eggs{display:flex;align-items:flex-end;gap:8px}.eggs-widget__eggs img{width:40px}.eggs-widget__egg{display:flex;align-items:center;justify-content:center;flex:1;flex-direction:column;white-space:nowrap;gap:8px;background-color:var(--control-bg);border-radius:24px;padding:16px}.eggs-widget__egg:first-child img{transform:scale(.8)}.eggs-widget__egg:last-child img{transform:scale(1.2)}.eggs-widget__egg.selected{background-color:#61b789}.eggs-widget__egg.selected:first-child{background-color:#b4b8f8}.eggs-widget__egg.selected:last-child{background-color:#ff8080}
`],encapsulation:2})};function st(n,e){n&1&&d(0,"lg-jelly-widget")}function ct(n,e){n&1&&d(0,"lg-eggs-widget")}function mt(n,e){n&1&&d(0,"lg-barcode-add-product-widget")}var ze=class n{static \u0275fac=function(t){return new(t||n)};static \u0275cmp=_({type:n,selectors:[["lg-widgets-page"]],decls:9,vars:1,consts:[[3,"center"],["label","Jelly calculator","alias","jelly-calculator","lgTab",""],["label","Eggs calculator","alias","eggs-calculator","lgTab",""],["label","Barcode Seeker","alias","barcode-seeker","lgTab",""]],template:function(t,o){t&1&&(l(0,"lg-fade-in")(1,"lg-container")(2,"lg-gap-row",0)(3,"lg-title"),m(4," Widgets "),a()(),l(5,"lg-tabs"),E(6,st,1,0,"ng-template",1)(7,ct,1,0,"ng-template",2)(8,mt,1,0,"ng-template",3),a()()()),t&2&&(r(2),c("center",!0))},dependencies:[Ne,Re,I,G,q,We,Ae,Ge,X],encapsulation:2})};export{ze as WidgetsPageComponent};
