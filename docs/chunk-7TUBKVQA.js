import{a as lt,b as pt,c as mt,d as st,e as ut,f as D,g as _t,h as Ct}from"./chunk-CVEEDAJ2.js";import{a as dt}from"./chunk-PRC2TUST.js";import{a as rt,c as ct}from"./chunk-ILBTCWXJ.js";import{a as nt}from"./chunk-KBNI6SUZ.js";import{b as at}from"./chunk-KVV4HYGD.js";import"./chunk-KSHXEBR5.js";import{b as ft}from"./chunk-SIPVOCOP.js";import{a as et}from"./chunk-AVXGYE4I.js";import{a as O,b as K,c as L}from"./chunk-EZQMYR76.js";import{a as W}from"./chunk-W227WBY4.js";import"./chunk-BBWM53XJ.js";import{a as ot}from"./chunk-AHEQBTWV.js";import"./chunk-4KMY27TT.js";import{a as X,c as it}from"./chunk-CPI3FXNZ.js";import"./chunk-2DQNHQVY.js";import{a as tt}from"./chunk-HL6AWMYV.js";import{a as Y}from"./chunk-GFLX5G5M.js";import"./chunk-SNDQO5FA.js";import{a as J}from"./chunk-LN6FDTLB.js";import{s as H}from"./chunk-WGXVQ5TO.js";import{j as q}from"./chunk-CPBCMYDO.js";import{Ab as c,Bb as T,Fb as h,Ib as x,Jb as m,P as j,Sa as o,Vb as a,Wb as I,X as V,Xa as f,Xb as s,Yb as k,Z as C,ab as B,ac as U,ea as w,fa as b,fb as g,gc as A,hc as G,ic as Q,k as M,la as z,nb as p,q as E,qb as P,s as N,tb as u,ub as _,vb as F,xb as S,yb as y,zb as r}from"./chunk-KOVCW6OE.js";import"./chunk-DELOOZDJ.js";import{f as $}from"./chunk-2WH2EVR6.js";var gt=new V("CategorizedProductsList",{factory:()=>{let e=C(L),i=C(W);return M(e.loadRecipes()).pipe(j(()=>e.products$)).pipe(E(n=>n.toSorted((l,d)=>l.name.localeCompare(d.name))),E(n=>dt(n,"category_id")),N(n=>$(void 0,null,function*(){let l=[];for(let v in n){let R=n[v],vt=yield i.getOne(v);l.push({category:vt?.name,products:R})}if(!l.length)return[];let[d,...Z]=l.toSorted((v,R)=>v.category>R.category?1:-1);return d?.category?[d].concat(Z):Z.concat([d])})))}});var Pt=(e,i)=>i==null?null:i.createdAt;function St(e,i){e&1&&(r(0,"lg-button",6),T(1,"mat-icon",7),c()),e&2&&(P("success"),p("icon",!0)("link","/products/add")("size","medium"))}function yt(e,i){if(e&1&&(r(0,"span"),a(1),c()),e&2){let t=m(2).$implicit;o(),s("from ",t.source)}}function Tt(e,i){if(e&1&&(r(0,"span"),a(1),c(),r(2,"span"),a(3),c(),u(4,yt,2,1,"span")),e&2){let t=m().$implicit;o(),I(t.name),o(2),k("",t.amount,"gr for ",t.price),o(),_(t.source?4:-1)}}function It(e,i){if(e&1&&(r(0,"span"),a(1),c()),e&2){let t=m(2).$implicit;o(),s("from ",t==null?null:t.source)}}function Lt(e,i){if(e&1&&(r(0,"span"),a(1),c(),r(2,"span"),a(3),c(),u(4,It,2,1,"span")),e&2){let t=m().$implicit;o(),I(t==null?null:t.name),o(2),k("",t==null?null:t.amount," gr for ",t==null?null:t.price),o(),_(t!=null&&t.source?4:-1)}}function Dt(e,i){if(e&1&&u(0,Tt,5,4)(1,Lt,5,4),e&2){let t=i.flow;_(t==="new"?0:1)}}function Rt(e,i){e&1&&a(0," Unsaved existing product: ")}function Et(e,i){e&1&&a(0," Draft product: ")}function wt(e,i){if(e&1&&(r(0,"a",9)(1,"lg-gap-row",5)(2,"div"),u(3,Rt,1,0)(4,Et,1,0),a(5),c(),r(6,"div"),a(7),A(8,"timeAgo"),c()()()),e&2){let t=m().$implicit;p("routerLink","/products/draft/"+(t==null?null:t.uuid)),o(),p("center",!0),o(2),_(!(t==null||t.meta==null)&&t.meta.uuid?3:4),o(2),s(" ",(t==null||t.data==null?null:t.data.name)??""," "),o(2),s("Created at: ",G(8,5,t==null?null:t.createdAt))}}function bt(e,i){e&1&&g(0,wt,9,7,"ng-template",8)}function Ft(e,i){if(e&1&&(r(0,"lg-card-list",4),S(1,bt,1,0,null,8,Pt),c()),e&2){let t=m();o(),y(t.draft())}}function ht(e,i){e&1&&a(0," per gram ")}function kt(e,i){if(e&1&&a(0),e&2){let t=m(2).$implicit;s(" per ",t.unit," ")}}function At(e,i){if(e&1){let t=h();r(0,"lg-gap-row",5)(1,"div",13)(2,"lg-gap-row",5)(3,"div",14)(4,"a",9),a(5),c()(),r(6,"div",15),a(7),c(),r(8,"div",16),a(9),A(10,"number"),u(11,ht,1,0)(12,kt,1,1),c()()(),r(13,"lg-button",17),x("click",function(){w(t);let l=m().$implicit,d=m(2);return b(d.deleteProduct(l))}),T(14,"mat-icon",18),c()()}if(e&2){let t=m().$implicit,n=m(2);p("center",!0),o(2),p("center",!0),o(2),p("routerLink","/products/edit/"+t.uuid),o(),I(t.name),o(2),s(" ",t.source??""),o(2),s(" ",Q(10,11,n.getPricePerGram(t),"1.2-5")," "),o(2),_(!t.unit||t.unit==="gram"?11:12),o(2),P("danger"),p("size","tiny")("icon",!0)}}function Ot(e,i){if(e&1&&g(0,At,15,14,"ng-template",12),e&2){let t=i.$implicit;p("uuid",t.uuid)}}function Zt(e,i){if(e&1){let t=h();r(0,"lg-title",10),a(1),c(),r(2,"lg-card-list",11),x("onSelected",function(l){w(t);let d=m();return b(d.selectionZoneService.putSelected(l))}),S(3,Ot,1,1,null,12,F),c()}if(e&2){let t=i.$implicit,n=m();p("level",3),o(),s(" ",(t==null?null:t.category)||"Uncategorized"," "),o(),p("mode",n.selectionZoneService.selectionMode())("selectAll",n.selectionZoneService.selectAll())("deselectAll",n.selectionZoneService.deselectAll()),o(),y(t.products)}}function $t(e,i){e&1&&(r(0,"lg-gap-row",5)(1,"lg-title",10),a(2," No products found "),c()()),e&2&&(p("center",!0),o(),p("level",5))}var xt=class e{constructor(i,t,n,l,d){this._productsRepository=i;this._csvReaderService=t;this._transferDataService=n;this._notificationsService=l;this.selectionZoneService=d}products=at(C(gt));draft=z([]);ProductDbInputScheme=K;Stores=J;getPricePerGram(i){return(O(i.price)||1)/(O(i.amount)||1)}exportProducts(i){this._transferDataService.exportTable("productsStore","json",{selected:Array.from(i)})}deleteProduct(i){i.uuid&&this._productsRepository.deleteProduct(i.uuid).then(()=>{this._notificationsService.success("Product deleted"),this.loadProducts()})}ngOnInit(){this.loadProducts();let i=this._productsRepository.getDraftProducts();i&&this.draft.set(i)}loadProducts(){this._productsRepository.loadRecipes()}static \u0275fac=function(t){return new(t||e)(f(L),f(pt),f(Ct),f(ft),f(D))};static \u0275cmp=B({type:e,selectors:[["lg-product-list"]],features:[U([D])],decls:15,vars:8,consts:[["lgQuickActionsTpl",""],[3,"click","flat","size"],[3,"onDone","schema","storeName"],["lgImportRowTpl",""],[2,"--card-bg","#bee5ff"],[3,"center"],[3,"icon","link","size"],["aria-hidden","false","fontIcon","add"],["lgCardListItem",""],[3,"routerLink"],[3,"level"],[3,"onSelected","mode","selectAll","deselectAll"],["lgCardListItem","",3,"uuid"],[1,"expand"],[2,"flex","20%"],[2,"flex","10%"],[2,"flex","70%"],[3,"click","size","icon"],["aria-hidden","false","aria-label","Example home icon","fontIcon","close"]],template:function(t,n){if(t&1&&(r(0,"lg-controls-bar"),g(1,St,2,5,"ng-template",0),T(2,"lg-selection-tools"),r(3,"lg-button",1),x("click",function(){return n.exportProducts(n.selectionZoneService.selected())}),a(4," Export "),c(),r(5,"lg-import",2),x("onDone",function(){return n.loadProducts()}),g(6,Dt,2,1,"ng-template",3),c()(),r(7,"lg-fade-in")(8,"lg-container")(9,"lg-title"),a(10," Products "),c(),u(11,Ft,3,0,"lg-card-list",4),S(12,Zt,5,5,null,null,F,!1,$t,3,2,"lg-gap-row",5),c()()),t&2){let l;o(3),P("info"),p("flat",!0)("size","small"),o(2),p("schema",n.ProductDbInputScheme)("storeName",n.Stores.PRODUCTS),o(6),_((l=n.draft())!=null&&l.length?11:-1),o(),y(n.products())}},dependencies:[it,ot,nt,X,Y,q,ct,rt,mt,H,lt,tt,ut,st,_t,et],styles:["[_nghost-%COMP%]{display:block}"]})};export{xt as ProductListComponent};
