import{a as me}from"./chunk-PZ6Z5BDB.js";import{a as pt}from"./chunk-VRJM5NPF.js";import{a as nt,b as rt,c as lt}from"./chunk-6L6ZWLUL.js";import{a as st}from"./chunk-WD2SLVHY.js";import{a as Je,b as Ze,c as et,e as te,f as tt}from"./chunk-2CBSSBS2.js";import{a as ot,b as it,c as at}from"./chunk-T22XBE6G.js";import{a as $e}from"./chunk-FFDATYAX.js";import"./chunk-DWOBUQ35.js";import{a as Ke}from"./chunk-HHXJ7M2I.js";import{a as ze}from"./chunk-K2T7WYSM.js";import{a as Xe}from"./chunk-W7F36SB2.js";import{a as Ye}from"./chunk-R3RPCOKV.js";import{a as ee}from"./chunk-U5EBB5PJ.js";import{a as J}from"./chunk-HMU5FZIU.js";import{a as Ge}from"./chunk-O7M42S4C.js";import{a as He,b as Z}from"./chunk-WR2UF3SH.js";import{a as qe}from"./chunk-ALZEZ7BP.js";import{a as Qe}from"./chunk-BC325NGK.js";import"./chunk-SNDQO5FA.js";import{a as q,b as ue,k as z,q as $}from"./chunk-HY6TZTL2.js";import"./chunk-M3F6BOZF.js";import"./chunk-5KSZNU56.js";import{a as X}from"./chunk-L3DC7GP3.js";import"./chunk-WZGWS77O.js";import{a as Me,d as O,f as Y,g as Ve,h as Ne,i as D,j as Be,k as Oe,m as We,p as Ue,r as je,s as Le,u as K}from"./chunk-ODQSNCKZ.js";import"./chunk-2SYRDFEF.js";import{o as Fe,r as Q}from"./chunk-UQJ3VPU4.js";import"./chunk-652DFWNF.js";import{f as Ee,g as De,k as ke}from"./chunk-QHW4G2KK.js";import{$ as ye,$b as L,Ab as Pe,Bb as Se,Cb as a,Db as l,Eb as b,F as W,H as he,Ib as P,Lb as m,Mb as f,Nb as Te,Ob as de,Pb as ce,T as Ce,Ta as be,Ua as pe,V as ve,Va as n,Vb as A,Wb as I,Xb as k,Yb as u,Za as U,Zb as Re,_a as y,_b as x,db as S,dc as Ae,fc as H,ga as C,ha as v,ib as we,jc as d,kc as c,lc as G,na as g,qb as s,r as _e,rb as xe,sb as j,sc as Ie,tb as B,tc as M,wb as _,wc as V,xb as h,xc as T,yc as E}from"./chunk-VF5EQBCE.js";import"./chunk-DELOOZDJ.js";import"./chunk-2WH2EVR6.js";var ct=["element"],ut=["*",[["content"]]],mt=["*","content"];function ft(i,t){if(i&1&&(a(0,"div",4,0),de(2,1),l(),b(3,"lg-portal",5)),i&2){let e=k(1);n(3),s("appendTarget","body")("targetElement",e)("wrapClass","tooltip tooltip--ejected")}}var oe=class i{constructor(){}renderer=ye(U);gap=T(16);displayed=g(!1);full=T(!1);position=T("top");element=E("element");onClose=V();coordinates=g({x:0,y:0});coordinatesEffect=M(()=>{this.renderer.setProperty(document.body,"style",`--tooltip-x: ${this.coordinates().x}px;--tooltip-y: ${this.coordinates().y}px;`)});toggle(t){if(this.displayed.set(!this.displayed()),this.displayed()||this.onClose.emit(),t){t.stopPropagation();let[e,o]=[t.clientX,t.clientY];console.log("x",e,"y",o),setTimeout(()=>{let p=this.element()?.nativeElement?.getBoundingClientRect(),w=p?.width,F=p?.height,fe=window.innerWidth,ge=window.innerHeight,R=16,ae=e,se=o;e+w+R>fe&&(ae=fe-w-R),o+F+R>ge&&(se=ge-F-R),e-w-R<0&&(ae=R),o-F-R<0&&(se=R),this.coordinates.set({x:ae,y:se})})}}close(){this.displayed.set(!1),this.onClose.emit()}onClick(t){t.target instanceof HTMLElement&&(t.target.closest(".tooltip")||(this.displayed.set(!1),this.onClose.emit()))}onKeydown(t){t.key==="Escape"&&(this.displayed.set(!1),this.onClose.emit())}onScroll(t){this.displayed.set(!1),this.onClose.emit()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=S({type:i,selectors:[["lg-tooltip"]],viewQuery:function(e,o){e&1&&A(o.element,ct,5),e&2&&I()},hostBindings:function(e,o){e&1&&m("click",function(p){return o.onClick(p)},pe)("keydown",function(p){return o.onKeydown(p)},pe)("scroll",function(p){return o.onScroll(p)},be)},inputs:{gap:[1,"gap"],full:[1,"full"],position:[1,"position"]},outputs:{onClose:"onClose"},ngContentSelectors:mt,decls:5,vars:6,consts:[["element",""],[1,"tooltip",3,"ngClass"],[1,"tooltip__anchor"],[3,"click"],[1,"tooltip__content"],[3,"appendTarget","targetElement","wrapClass"]],template:function(e,o){e&1&&(Te(ut),a(0,"div",1)(1,"div",2)(2,"div",3),m("click",function(p){return o.toggle(p)}),de(3),l(),_(4,ft,4,3),l()()),e&2&&(xe("--gap",o.gap(),"px"),j("fullscreen",o.full()),s("ngClass",o.position()),n(4),h(o.displayed()?4:-1))},dependencies:[Ee,Ke],styles:[`.tooltip{display:inline-block}.tooltip--ejected{position:fixed;inset:0}.tooltip--ejected .tooltip__content{inset:0;position:fixed;display:flex;align-items:center;justify-content:center;padding-top:calc(var(--header-height) + 12px + 16px + 16px)}.tooltip__anchor{position:relative}.tooltip__content{position:absolute;background-color:#fff;border-radius:16px;padding:16px;box-shadow:0 4px 8px #0000001a;z-index:100}.tooltip.top .tooltip__content,.tooltip.bottom .tooltip__content{bottom:calc(100% + var(--gap));right:50%;transform:translate(50%)}.tooltip.left .tooltip__content{bottom:50%;right:calc(100% + var(--gap));transform:translateY(50%)}.tooltip.right .tooltip__content{bottom:50%;left:calc(100% + var(--gap));transform:translateY(-50%)}.tooltip.fullscreen .tooltip__content{position:fixed;inset:0;background-color:#fff;border-radius:0;padding:32px;transform:none;overflow-y:auto}
`],encapsulation:2})};function gt(i,t){if(i&1){let e=P();a(0,"div",3)(1,"lg-eggs-widget",4),m("changed",function(r){C(e);let p=f();return v(p.onEggsChanged(r))}),l()()}}var re=class i{constructor(){}eggsChanged=V();selectedWidget=g(null);onWidgetSelect(t){this.selectedWidget.set(t)}onEggsChanged(t){t&&this.eggsChanged.emit(t)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=S({type:i,selectors:[["lg-amount-widgets"]],outputs:{eggsChanged:"eggsChanged"},decls:5,vars:3,consts:[[1,"amount-widgets"],[1,"amount-widgets__buttons"],[1,"amount-widgets__button",3,"click"],[1,"amount-widgets__wrapper"],[3,"changed"]],template:function(e,o){e&1&&(a(0,"div",0)(1,"div",1)(2,"button",2),m("click",function(){return o.onWidgetSelect("eggs")}),u(3,"Eggs "),l()(),_(4,gt,2,0,"div",3),l()),e&2&&(j("selected",o.selectedWidget()!=null),n(4),h(o.selectedWidget()==="eggs"?4:-1))},dependencies:[pt],styles:[".amount-widgets[_ngcontent-%COMP%]{display:flex;gap:16px;flex-direction:column}.amount-widgets__input[_ngcontent-%COMP%]{flex:1}.amount-widgets__buttons[_ngcontent-%COMP%]{display:flex;gap:16px;flex-wrap:wrap;padding:16px;background-color:#fafafa;border-radius:12px;margin:-16px}.amount-widgets.selected[_ngcontent-%COMP%]   .amount-widgets__buttons[_ngcontent-%COMP%]{margin-bottom:0}.amount-widgets__button[_ngcontent-%COMP%]{display:flex;padding:8px 16px;border-radius:16px;background-color:#e5de38;appearance:none;border:none;font-family:inherit;font-size:inherit}"]})};var Ct=i=>({background:i}),vt=(i,t)=>(t==null?null:t.name)??(t==null?null:t.label)??t;function yt(i,t){if(i&1&&u(0),i&2){let e=t.item;x(" ",(e==null?null:e.name)??(e==null?null:e.label)??e," ")}}function bt(i,t){if(i&1&&u(0),i&2){let e=t.item;x(" ",(e==null?null:e.name)??(e==null?null:e.label)??e," ")}}function wt(i,t){if(i&1){let e=P();a(0,"div",5)(1,"span",6),u(2),l(),a(3,"span",7),m("click",function(){let r=C(e).$implicit,p=f().clear;return v(p(r))}),u(4,"\xD7"),l()()}if(i&2){let e=t.$implicit;s("ngStyle",H(2,Ct,e!=null&&e.color?e==null?null:e.color:null)),n(2),x(" ",(e==null?null:e.name)??(e==null?null:e.label)??e," ")}}function xt(i,t){if(i&1&&Pe(0,wt,5,4,"div",5,vt),i&2){let e=t.items;Se(e)}}var le=class i{constructor(t){this._selectResourcesService=t}placeholder="";resource=T("");autoLoad=T(!1);multi=T(!1);loadedList=g([]);onSelected=V();value=null;selectComponent=E(te);addTagFn(t){return q.fromRaw(t)}onChange=()=>{};onTouched=()=>{};searchFn=(t,e)=>e?.toString().toLowerCase().includes(t.toLowerCase());compareWith=(t,e)=>t===e;writeValue(t){this.change(t)}change(t){Array.isArray(t)?this.value=t.map(e=>q.fromRaw(e).toDTO()):this.value=q.fromRaw(t).toDTO(),this.onChange(this.value)}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}onChangeInput(t){this.change(t)}onChangeSelect(t){this.change(t),this.onSelected.emit(t)}ngOnInit(){this._selectResourcesService.register(this.resource()),this.autoLoad()&&this._selectResourcesService.load([this.resource()]),this._selectResourcesService.subscribe(t=>{let e=t.get(this.resource())?.list??[];this.loadedList.set(e)})}reload(){return this._selectResourcesService.load([this.resource()],!0)}static \u0275fac=function(e){return new(e||i)(y(X,8))};static \u0275cmp=S({type:i,selectors:[["lg-tags-control"]],viewQuery:function(e,o){e&1&&A(o.selectComponent,te,5),e&2&&I()},inputs:{placeholder:"placeholder",resource:[1,"resource"],autoLoad:[1,"autoLoad"],multi:[1,"multi"]},outputs:{onSelected:"onSelected"},features:[Ae([{provide:Me,useExisting:ve(()=>i),multi:!0}])],decls:5,vars:8,consts:[[1,"tags-control"],[3,"change","ngModelChange","addTag","appendTo","compareWith","items","multiple","ngModel","placeholder","searchFn"],["ng-label-tmp",""],["ng-option-tmp",""],["ng-multi-label-tmp",""],[1,"ng-value",3,"ngStyle"],[1,"ng-value-label"],["aria-hidden","true",1,"ng-value-icon","right",3,"click"]],template:function(e,o){e&1&&(a(0,"div",0)(1,"ng-select",1),m("change",function(p){return o.onChangeSelect(p)})("ngModelChange",function(p){return o.onChangeInput(p)}),we(2,yt,1,1,"ng-template",2)(3,bt,1,1,"ng-template",3)(4,xt,2,0,"ng-template",4),l()()),e&2&&(n(),s("addTag",o.addTagFn)("appendTo","body")("compareWith",o.compareWith)("items",o.loadedList())("multiple",o.multi())("ngModel",o.value)("placeholder",o.placeholder)("searchFn",o.searchFn))},dependencies:[te,je,Y,Be,Je,Ze,et,De],styles:[`lg-tags-control{display:flex;flex:1;min-width:150px}.tags-control{flex:1}.tags-control .ng-select .ng-select-container{height:51px}.tags-control .ng-select .ng-select-container{border:none;border-radius:12px;background-color:var(--control-bg)}.tags-control .ng-select .ng-select-container .ng-input{top:16px!important}.tags-control .ng-select .ng-select-container .ng-input>input{color:var(--text);font-family:inherit;font-size:inherit}.tags-control .ng-dropdown-panel{border:none;box-shadow:0 4px 16px #0000001a;border-radius:12px;overflow:hidden}.tags-control .ng-dropdown-panel .ng-option{padding:16px;border-radius:12px}
`],encapsulation:2})};var Rt=["nameField"],At=i=>({unit:i});function It(i,t){if(i&1&&b(0,"lg-chips-list",12),i&2){let e=f(),o=k(41);s("control",o)("items",e.topCategories())}}var N=class i{constructor(t,e,o,r){this._productsRepository=t;this._selectResourcesService=e;this._router=o;this._notificationsService=r}form=new Ne({name:new D(null,O.required),amount:new D(null,O.required),price:new D(null,O.required),unit:new D("gram"),source:new D(null),category_id:new D(null,O.required),tags:new D([])});buttons=[{label:"gr",value:"gram",style:"info",size:"small",onClick:()=>{console.log("Grams")}},{label:"pc",value:"piece",style:"info",size:"small",onClick:()=>{console.log("Piece")}}];product=T(null);topCategories=g([]);topSources=g([]);nameField=E("nameField");productEffect=M(()=>{!this.product()||this.form.dirty||(console.log("Product effect",this.product()),this.form.reset(me(this.product())),this.form.markAsPristine())});get _defFormValue(){return{name:null,amount:null,price:null,source:null,category_id:null,unit:"gram",tags:[]}}get _formValid(){return this.form.valid}eggsChanged(t){this.form.patchValue({amount:t})}ngOnInit(){this._loadUsingHistory(),this.form.valueChanges.pipe(Ce(t=>console.log("Form value changed",t)),W(100)).subscribe(t=>{this.form.dirty&&this.product()?.update(t)})}resetForm(t){console.log("Reset form",t),this.form.reset(t?me(t):this._defFormValue),this.form.markAsPristine(),this._loadUsingHistory()}validateForm(){return this._formValid?!0:(this._notificationsService.error(this._notificationsService.parseFormErrors(this.form).join(", ")),!1)}ngAfterViewInit(){this._selectResourcesService.load().then(t=>{}),this.form.markAsPristine()}_loadUsingHistory(){this._productsRepository.getTopCategories().then(t=>{this.topCategories.set(t.map(e=>({label:e.name,value:e.uuid??"",color:e.ownColor})))}),this._productsRepository.getTopSources().then(t=>{this.topSources.set(t.map(e=>({label:e,value:e})))})}static \u0275fac=function(e){return new(e||i)(y($),y(X),y(Q),y(K))};static \u0275cmp=S({type:i,selectors:[["lg-add-product-form"]],viewQuery:function(e,o){e&1&&A(o.nameField,Rt,5),e&2&&I()},inputs:{product:[1,"product"]},decls:44,vars:52,consts:[["nameField",""],["sourceInput",""],["sourceChips",""],["priceInput",""],["categorySelect",""],[3,"formGroup"],[3,"mobileMode"],["lgExpand",""],["formControlName","name",3,"key","placeholder","resource"],["lgWidth","40%"],["formControlName","source",3,"onSelected","noLoad","placeholder","resource"],[3,"hidden"],[3,"control","items"],[3,"center","mobileMode"],["formControlName","amount","lgParseMath","",3,"onInputChange","placeholder"],["ngProjectAs","after",5,["after"]],[3,"position"],[3,"flat","icon"],["aria-hidden","false","fontIcon","add"],["ngProjectAs","content",5,["content"]],[3,"eggsChanged"],["formControlName","unit",3,"flat","items"],["formControlName","price","lgParseMath","",3,"placeholder"],[2,"--control-bg","#ffffff",3,"equal","mobileMode","top"],["lgExpand","",3,"label"],["formControlName","tags",3,"multi","placeholder","resource"],[3,"label"],["formControlName","category_id",3,"placeholder","resource"]],template:function(e,o){if(e&1){let r=P();a(0,"form",5)(1,"lg-gap-column")(2,"lg-card")(3,"lg-gap-column")(4,"lg-gap-row",6)(5,"lg-control",7),b(6,"lg-autocomplete",8,0),d(8,"translate"),l(),a(9,"lg-gap-column",9)(10,"lg-control")(11,"lg-autocomplete",10,1),d(13,"translate"),m("onSelected",function(){C(r);let w=k(16);return v(w.clearSelected())}),l()(),a(14,"div",11),b(15,"lg-chips-list",12,2),l()()(),a(17,"lg-gap-row",13)(18,"lg-control",7)(19,"lg-number-input",14),d(20,"translate"),m("onInputChange",function(){C(r);let w=k(30);return v(w.focus())}),a(21,"div",15)(22,"lg-tooltip",16)(23,"lg-button",17),b(24,"mat-icon",18),l(),a(25,"div",19)(26,"lg-amount-widgets",20),m("eggsChanged",function(w){return C(r),v(o.eggsChanged(w))}),l()()()()()(),b(27,"lg-buttons-group",21),a(28,"lg-control",9),b(29,"lg-number-input",22,3),d(31,"translate"),l()()()(),a(32,"lg-gap-row",23)(33,"lg-control",24),d(34,"translate"),b(35,"lg-tags-control",25),d(36,"translate"),l(),a(37,"lg-gap-column")(38,"lg-control",26),d(39,"translate"),b(40,"lg-multiselect",27,4),d(42,"translate"),l(),_(43,It,1,2,"lg-chips-list",12),l()()()()}if(e&2){let r=k(12);s("formGroup",o.form),n(4),s("mobileMode",!0),n(2),s("key","name")("placeholder",c(8,33,"product.form.name.placeholder"))("resource","products-names"),n(5),s("noLoad",!0)("placeholder",c(13,35,"product.form.source.placeholder"))("resource","sources"),n(3),s("hidden",!o.topSources().length),n(),s("control",r)("items",o.topSources()),n(2),s("center",!0)("mobileMode",!0),n(2),s("placeholder",G(20,37,"product.form.amount.placeholder",H(50,At,o.form.value.unit))),n(3),s("position","left"),n(),B("success"),s("flat",!0)("icon",!0),n(4),s("flat",!0)("items",o.buttons),n(2),s("placeholder",c(31,40,"product.form.price.placeholder")),n(3),s("equal",!0)("mobileMode",!0)("top",!0),n(),ce("label",c(34,42,"product.form.tags.label")),n(2),s("multi",!0)("placeholder",c(36,44,"product.form.tags.placeholder"))("resource","tags"),n(3),ce("label",c(39,46,"product.form.category_id.label")),n(2),s("placeholder",c(42,48,"product.form.category_id.placeholder"))("resource","categories"),n(3),h(o.topCategories().length?43:-1)}},dependencies:[Le,Oe,Y,Ve,We,Ue,$e,J,tt,ot,oe,re,it,Z,nt,Xe,rt,lt,le,z,Ge,Ye,ee,st],styles:[`lg-eggs-widget{min-width:300px}
`],encapsulation:2})};function Et(i,t){if(i&1&&(a(0,"lg-title"),u(1),d(2,"translate"),l()),i&2){let e,o=f();n(),L(" ",c(2,2,"edit-label")," ",(e=o.product())==null?null:e.name," ")}}function Dt(i,t){i&1&&(a(0,"lg-title"),u(1),d(2,"translate"),l()),i&2&&(n(),x(" ",c(2,1,"product.form.title")," "))}function kt(i,t){if(i&1&&(u(0),d(1,"number")),i&2){let e,o=f();L(" (",(e=o.product())==null?null:e.perUnitLabel," ",G(1,2,(e=o.product())==null?null:e.pricePerUnit,"1.2-5"),") ")}}function Ft(i,t){i&1&&(a(0,"span"),u(1),d(2,"translate"),l()),i&2&&(n(),Re(c(2,1,"saved-draft-label")))}function Mt(i,t){if(i&1&&(a(0,"span"),u(1),d(2,"translate"),d(3,"timeAgo"),l()),i&2){let e,o=f();n(),L(" (",c(2,2,"edited-at-label")," ",c(3,4,(e=o.product())==null?null:e.updatedAt),")")}}function Vt(i,t){i&1&&(u(0),d(1,"translate")),i&2&&x(" ",c(1,1,"product.form.save-btn.edit.active")," ")}function Nt(i,t){i&1&&(u(0),d(1,"translate")),i&2&&x(" ",c(1,1,"product.form.save-btn.edit.disabled")," ")}function Bt(i,t){if(i&1){let e=P();a(0,"lg-button",5),m("click",function(){C(e);let r=f();return v(r.onEditProduct())}),_(1,Vt,2,3)(2,Nt,2,3),l()}if(i&2){let e,o,r=f();s("disabled",!(!((e=r.formComponent())==null||e.form==null)&&e.form.dirty)),n(),h(!((o=r.formComponent())==null||o.form==null)&&o.form.dirty?1:2)}}function Ot(i,t){i&1&&(u(0),d(1,"translate")),i&2&&x(" ",c(1,1,"product.form.save-btn.add.active")," ")}function Wt(i,t){i&1&&(u(0),d(1,"translate")),i&2&&x(" ",c(1,1,"product.form.save-btn.add.disabled")," ")}function Ut(i,t){if(i&1){let e=P();a(0,"lg-button",5),m("click",function(){C(e);let r=f();return v(r.onAddProduct())}),_(1,Ot,2,3)(2,Wt,2,3),l()}if(i&2){let e,o,r=f();s("disabled",!(!((e=r.formComponent())==null||e.form==null)&&e.form.dirty)),n(),h(!((o=r.formComponent())==null||o.form==null)&&o.form.dirty?1:2)}}function jt(i,t){if(i&1){let e=P();a(0,"lg-button",6),m("click",function(){C(e);let r=f();return v(r.onRemoveDraft())}),u(1),d(2,"translate"),l()}i&2&&(B("danger"),n(),x(" ",c(2,3,"product.form.delete-draft-btn")," "))}function Lt(i,t){if(i&1){let e=P();a(0,"lg-button",6),m("click",function(){C(e);let r=f();return v(r.onDeleteProduct())}),u(1),d(2,"translate"),l()}i&2&&(B("danger"),n(),x(" ",c(2,3,"product.form.delete-btn")," "))}var dt=class i{constructor(t,e,o,r,p){this._router=t;this._aRoute=e;this._productsRepository=o;this._notificationsService=r;this._renderer=p}draftOrProductUUID=g(void 0);product=g(null);formComponent=E(N);draftRef=g(null);draftByExistingProduct=Ie(()=>this.draftRef().meta?.uuid);isDraftRoute=g(!1);productEffect=M(()=>{this.product()?this._renderer.setProperty(document.body,"style",`--background-color: ${this.product().ownColor}`):this._renderer.removeAttribute(document.body,"style")});ngOnDestroy(){this._renderer.removeAttribute(document.body,"style")}ngOnInit(){_e([this._aRoute.params,this._aRoute.data]).pipe(he(1)).subscribe(([t,e])=>{this.draftOrProductUUID.set(t.uuid),e.draft?(this.draftRef.set(e.draft),this.product.set(ue.fromRaw(e.draft.data))):this.draftOrProductUUID()?this._loadProduct(this.draftOrProductUUID()):this.product.set(ue.empty()),this.isDraftRoute.set(!!e.draftRoute)})}ngAfterViewInit(){this.formComponent()?.form.valueChanges.pipe(W(500)).subscribe(t=>{!this.formComponent().form.dirty||!this.product()||(this.draftRef()?.uuid?this._productsRepository.updateDraftProduct(this.draftRef().uuid,this.product(),this.draftRef().meta?.uuid):this.draftRef.set(this._productsRepository.saveDraftProduct(this.product(),this.draftOrProductUUID()??"")))})}onAddProduct(){!this.formComponent()?.validateForm()||!this.product()||this._addProduct(this.product())}onEditProduct(){!this.formComponent()?.validateForm()||!this.product()||this._editProduct(this.product())}onRemoveDraft(){this._removeDraft(),this._router.navigate(["products"])}onDeleteProduct(){this.product()?.uuid&&this._productsRepository.deleteProduct(this.product().uuid).then(()=>{this._notificationsService.success("Product deleted"),this._router.navigate(["products"])})}_addProduct(t){this._productsRepository.addOne(t).then(()=>{this.formComponent()?.resetForm(),this._notificationsService.success("Product added"),this.product.set(null),this.draftRef()&&this._removeDraft(),this.isDraftRoute()&&this._router.navigate(["products"])})}_editProduct(t){if(!this.draftOrProductUUID())return;let e=this.draftRef()?.meta?.uuid??this.draftOrProductUUID();this._productsRepository.updateOne(e,t).then(()=>{this.formComponent()?.resetForm(t),this._notificationsService.success("Product edited"),this.draftRef()&&this._removeDraft(),this.isDraftRoute()&&this._router.navigate(["products","edit",e])})}_removeDraft(){this.draftRef()&&(this._productsRepository.removeDraftProduct(this.draftRef().uuid),this.draftRef.set(null))}_loadProduct(t){t&&this._productsRepository.getOne(t,!0).then(e=>{e&&this.product.set(e)})}static \u0275fac=function(e){return new(e||i)(y(Q),y(Fe),y($),y(K),y(U))};static \u0275cmp=S({type:i,selectors:[["app-add-recipe"]],viewQuery:function(e,o){e&1&&A(o.formComponent,N,5),e&2&&I()},decls:15,vars:11,consts:[[3,"center","mobileMode"],[3,"product"],[3,"mobileMode","relaxed"],["lgShrink","",3,"disabled"],["lgShrink","",3,"style"],["lgShrink","",3,"click","disabled"],["lgShrink","",3,"click"]],template:function(e,o){if(e&1&&(a(0,"lg-fade-in")(1,"lg-container")(2,"lg-gap-column")(3,"lg-gap-row",0),_(4,Et,3,4,"lg-title")(5,Dt,3,3,"lg-title"),_(6,kt,2,5),l(),_(7,Ft,3,3,"span"),_(8,Mt,4,6,"span"),l(),b(9,"lg-add-product-form",1),a(10,"lg-gap-row",2),_(11,Bt,3,2,"lg-button",3)(12,Ut,3,2,"lg-button",3),_(13,jt,3,5,"lg-button",4)(14,Lt,3,5,"lg-button",4),l()()()),e&2){let r,p,w,F;n(3),s("center",!0)("mobileMode",!0),n(),h((r=o.product())!=null&&r.uuid&&!o.draftRef()||o.draftRef()&&o.draftByExistingProduct()?4:5),n(2),h((p=o.product())!=null&&p.pricePerUnit?6:-1),n(),h(o.draftRef()?7:-1),n(),h((w=o.product())!=null&&w.updatedAt?8:-1),n(),s("product",o.product()),n(),s("mobileMode",!0)("relaxed",!0),n(),h(o.product()&&!o.draftRef()||o.draftRef()&&o.draftByExistingProduct()?11:12),n(2),h(o.isDraftRoute()?13:(F=o.product())!=null&&F.uuid?14:-1)}},dependencies:[He,Qe,N,Z,qe,ee,at,ze,ke,z,J],encapsulation:2})};export{dt as AddProductComponent};
