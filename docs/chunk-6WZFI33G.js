import{a as Ke}from"./chunk-4WXVQTO3.js";import{a as Je}from"./chunk-6OLY25VE.js";import{a as Qe,b as qe,c as Ye}from"./chunk-GLCF5VGU.js";import{a as Ue,b as Le,c as Be,e as L,f as je}from"./chunk-4MG5C2GO.js";import{a as B}from"./chunk-5IJ4PYPF.js";import{a as Ge,b as He,c as ze}from"./chunk-DH7JWPG6.js";import{a as We}from"./chunk-WEB6HDWD.js";import"./chunk-5GSF3GE7.js";import{a as Oe}from"./chunk-Y253D3CO.js";import{a as Ne}from"./chunk-IMBV6HKK.js";import{b as U}from"./chunk-D2BCHPSI.js";import{a as xe}from"./chunk-K6ET3LZC.js";import{a as O}from"./chunk-2UVWRFCK.js";import"./chunk-MTWI3FYG.js";import{a as Te,b as Re,d as M,f as W,g as Ae,h as Ie,i as A,j as De,k as Ee,m as ke,p as Me,r as Fe,s as Ve}from"./chunk-O7CSOEHI.js";import{a as Se}from"./chunk-WQFB6RUU.js";import{a as ye,b as Pe,c as N}from"./chunk-A5B4YQGG.js";import{c as te}from"./chunk-G7HHG7D5.js";import"./chunk-HG4USQGA.js";import{a as be}from"./chunk-4ISSSXDT.js";import{a as we}from"./chunk-PU3XS3SA.js";import"./chunk-SNDQO5FA.js";import{o as ve,r as V}from"./chunk-RFFWLM6I.js";import{f as Ce,j as he}from"./chunk-J66PYGJX.js";import{Ab as i,Bb as y,F as re,Fb as P,Ib as p,Jb as u,Kb as de,Lb as $,Ra as K,Sa as r,Sb as x,T as le,Tb as T,Ub as I,Vb as d,Xa as v,Xb as D,Yb as pe,ab as w,ac as ue,ea as g,fa as f,fb as ae,gc as ee,hc as me,ic as ge,la as m,nb as s,ob as X,pb as F,pc as fe,qb as Z,qc as _e,r as ie,tb as _,tc as E,ub as C,uc as b,vc as R,xb as se,yb as ce,zb as l}from"./chunk-MV5CNZ6J.js";import"./chunk-DELOOZDJ.js";import"./chunk-2WH2EVR6.js";var Ze=["element"],$e=["*",[["content"]]],et=["*","content"];function tt(n,t){if(n&1&&(l(0,"div",4,0),$(2,1),i(),y(3,"lg-portal",5)),n&2){let e=I(1),o=u();X("left",o.coordinates().x,"px")("top",o.coordinates().y,"px"),r(3),s("appendTarget","body")("targetElement",e)("wrapClass","tooltip")}}var j=class n{constructor(){}gap=b(16);displayed=m(!1);full=b(!1);position=b("top");element=R("element");onClose=E();coordinates=m({x:0,y:0});toggle(t){if(this.displayed.set(!this.displayed()),this.displayed()||this.onClose.emit(),t){t.stopPropagation();let[e,o]=[t.clientX,t.clientY];setTimeout(()=>{let c=(this.element()?.nativeElement).getBoundingClientRect(),h=c.width,Y=c.height,oe=window.innerWidth,ne=window.innerHeight,S=16,z=e,J=o;e+h+S>oe&&(z=oe-h-S),o+Y+S>ne&&(J=ne-Y-S),e-h-S<0&&(z=S),o-Y-S<0&&(J=S),this.coordinates.set({x:z,y:J})})}}close(){this.displayed.set(!1),this.onClose.emit()}onClick(t){t.target instanceof HTMLElement&&(t.target.closest(".tooltip")||(this.displayed.set(!1),this.onClose.emit()))}onKeydown(t){t.key==="Escape"&&(this.displayed.set(!1),this.onClose.emit())}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=w({type:n,selectors:[["lg-tooltip"]],viewQuery:function(e,o){e&1&&x(o.element,Ze,5),e&2&&T()},hostBindings:function(e,o){e&1&&p("click",function(c){return o.onClick(c)},K)("keydown",function(c){return o.onKeydown(c)},K)},inputs:{gap:[1,"gap"],full:[1,"full"],position:[1,"position"]},outputs:{onClose:"onClose"},ngContentSelectors:et,decls:5,vars:6,consts:[["element",""],[1,"tooltip",3,"ngClass"],[1,"tooltip__anchor"],[3,"click"],[1,"tooltip__content"],[3,"appendTarget","targetElement","wrapClass"]],template:function(e,o){e&1&&(de($e),l(0,"div",1)(1,"div",2)(2,"div",3),p("click",function(c){return o.toggle(c)}),$(3),i(),_(4,tt,4,7),i()()),e&2&&(X("--gap",o.gap(),"px"),F("fullscreen",o.full()),s("ngClass",o.position()),r(4),C(o.displayed()?4:-1))},dependencies:[Ce,Oe],styles:[".tooltip[_ngcontent-%COMP%]{position:relative;display:inline-block}.tooltip__anchor[_ngcontent-%COMP%]{position:relative}.tooltip__content[_ngcontent-%COMP%]{position:absolute;background-color:#fff;border-radius:16px;padding:16px;box-shadow:0 4px 8px #0000001a;z-index:100}.tooltip.top[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%], .tooltip.bottom[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%]{bottom:calc(100% + var(--gap));right:50%;transform:translate(50%)}.tooltip.left[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%]{bottom:50%;right:calc(100% + var(--gap));transform:translateY(50%)}.tooltip.right[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%]{bottom:50%;left:calc(100% + var(--gap));transform:translateY(-50%)}.tooltip.fullscreen[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#fff;border-radius:0;padding:32px;transform:none;overflow-y:auto}"]})};function ot(n,t){if(n&1){let e=P();l(0,"div",3)(1,"lg-eggs-widget",4),p("changed",function(a){g(e);let c=u();return f(c.onEggsChanged(a))}),i()()}}var Q=class n{constructor(){}eggsChanged=E();selectedWidget=m(null);onWidgetSelect(t){this.selectedWidget.set(t)}onEggsChanged(t){t&&this.eggsChanged.emit(t)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=w({type:n,selectors:[["lg-amount-widgets"]],outputs:{eggsChanged:"eggsChanged"},decls:5,vars:3,consts:[[1,"amount-widgets"],[1,"amount-widgets__buttons"],[1,"amount-widgets__button",3,"click"],[1,"amount-widgets__wrapper"],[3,"changed"]],template:function(e,o){e&1&&(l(0,"div",0)(1,"div",1)(2,"button",2),p("click",function(){return o.onWidgetSelect("eggs")}),d(3,"Eggs "),i()(),_(4,ot,2,0,"div",3),i()),e&2&&(F("selected",o.selectedWidget()!=null),r(4),C(o.selectedWidget()==="eggs"?4:-1))},dependencies:[Je],styles:[".amount-widgets[_ngcontent-%COMP%]{display:flex;gap:16px;flex-direction:column}.amount-widgets__input[_ngcontent-%COMP%]{flex:1}.amount-widgets__buttons[_ngcontent-%COMP%]{display:flex;gap:16px;flex-wrap:wrap;padding:16px;background-color:#fafafa;border-radius:12px;margin:-16px}.amount-widgets.selected[_ngcontent-%COMP%]   .amount-widgets__buttons[_ngcontent-%COMP%]{margin-bottom:0}.amount-widgets__button[_ngcontent-%COMP%]{display:flex;padding:8px 16px;border-radius:16px;background-color:#e5de38;appearance:none;border:none;font-family:inherit;font-size:inherit}"]})};var rt=(n,t)=>(t==null?null:t.name)??(t==null?null:t.label)??t;function lt(n,t){if(n&1&&d(0),n&2){let e=t.item;D(" ",(e==null?null:e.name)??(e==null?null:e.label)??e," ")}}function at(n,t){if(n&1&&d(0),n&2){let e=t.item;D(" ",(e==null?null:e.name)??(e==null?null:e.label)??e," ")}}function st(n,t){if(n&1){let e=P();l(0,"div",5)(1,"span",6),d(2),i(),l(3,"span",7),p("click",function(){let a=g(e).$implicit,c=u().clear;return f(c(a))}),d(4,"\xD7"),i()()}if(n&2){let e=t.$implicit;r(2),D(" ",(e==null?null:e.name)??(e==null?null:e.label)??e," ")}}function ct(n,t){if(n&1&&se(0,st,5,1,"div",5,rt),n&2){let e=t.items;ce(e)}}var q=class n{constructor(t){this._selectResourcesService=t}resource=b("");autoLoad=b(!1);multi=b(!1);loadedList=m([]);onSelected=E();value=null;selectComponent=R(L);onChange=()=>{};onTouched=()=>{};searchFn=(t,e)=>e?.toString().toLowerCase().includes(t.toLowerCase());compareWith=(t,e)=>t===e;writeValue(t){this.change(t)}change(t){this.value=t,this.onChange(this.value)}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}onChangeInput(t){this.change(t)}onChangeSelect(t){this.change(t),this.onSelected.emit(t)}ngOnInit(){this._selectResourcesService.register(this.resource()),this.autoLoad()&&this._selectResourcesService.load([this.resource()]),this._selectResourcesService.subscribe(t=>{let e=t.get(this.resource())?.list??[];this.loadedList.set(e)})}reload(){return this._selectResourcesService.load([this.resource()],!0)}static \u0275fac=function(e){return new(e||n)(v(B,8))};static \u0275cmp=w({type:n,selectors:[["lg-tags-control"]],viewQuery:function(e,o){e&1&&x(o.selectComponent,L,5),e&2&&T()},inputs:{resource:[1,"resource"],autoLoad:[1,"autoLoad"],multi:[1,"multi"]},outputs:{onSelected:"onSelected"},features:[ue([{provide:Re,useExisting:le(()=>n),multi:!0}])],decls:5,vars:7,consts:[[1,"tags-control"],[3,"change","ngModelChange","addTag","bindValue","compareWith","items","multiple","ngModel","searchFn"],["ng-label-tmp",""],["ng-option-tmp",""],["ng-multi-label-tmp",""],[1,"ng-value"],[1,"ng-value-label"],["aria-hidden","true",1,"ng-value-icon","right",3,"click"]],template:function(e,o){e&1&&(l(0,"div",0)(1,"ng-select",1),p("change",function(c){return o.onChangeSelect(c)})("ngModelChange",function(c){return o.onChangeInput(c)}),ae(2,lt,1,1,"ng-template",2)(3,at,1,1,"ng-template",3)(4,ct,2,0,"ng-template",4),i()()),e&2&&(r(),s("addTag",!0)("bindValue","name")("compareWith",o.compareWith)("items",o.loadedList())("multiple",o.multi())("ngModel",o.value)("searchFn",o.searchFn))},dependencies:[L,Fe,W,De,Ue,Le,Be],styles:[`lg-tags-control{display:flex;flex:1;min-width:150px}.tags-control{flex:1}.tags-control .ng-select .ng-select-container{height:51px}.tags-control .ng-select .ng-select-container{border:none;border-radius:12px;background-color:var(--control-bg)}.tags-control .ng-select .ng-select-container .ng-input{top:16px!important}.tags-control .ng-select .ng-select-container .ng-input>input{color:var(--text);font-family:inherit;font-size:inherit}.tags-control .ng-dropdown-panel{border:none;box-shadow:0 4px 16px #0000001a;border-radius:12px;overflow:hidden}.tags-control .ng-dropdown-panel .ng-option{padding:16px;border-radius:12px}
`],encapsulation:2})};var mt=["nameField"];function gt(n,t){if(n&1&&y(0,"lg-chips-list",23),n&2){let e=u(),o=I(29);s("control",o)("items",e.topCategories())}}var k=class n{constructor(t,e,o,a){this._productsRepository=t;this._selectResourcesService=e;this._router=o;this._notificationsService=a}form=new Ie({name:new A(null,M.required),amount:new A(null,M.required),price:new A(null,M.required),unit:new A("gram"),source:new A(null),category_id:new A(null,M.required),tags:new A([])});buttons=[{label:"Grams",value:"gram",style:"secondary",onClick:()=>{console.log("Grams")}},{label:"Pieces",value:"piece",style:"secondary",onClick:()=>{console.log("Piece")}}];product=b(null);topCategories=m([]);topSources=m([]);nameField=R("nameField");productEffect=_e(()=>{this.product()&&(this.form.reset(Ke(this.product())),this.form.markAsPristine())});get _defFormValue(){return{name:null,amount:null,price:null,source:null,category_id:null,unit:"gram",tags:[]}}get _formValid(){return this.form.valid}eggsChanged(t){this.form.patchValue({amount:t})}ngOnInit(){this._loadUsingHistory(),this.form.valueChanges.subscribe(t=>{this.product()?.update(t)})}resetForm(t){this.form.reset(t?t?.toDTO():this._defFormValue),this.form.markAsPristine(),this._loadUsingHistory()}validateForm(){return this._formValid?!0:(this._notificationsService.error(this._notificationsService.parseFormErrors(this.form).join(", ")),!1)}ngAfterViewInit(){this._selectResourcesService.load().then(t=>{}),this.form.markAsPristine()}_loadUsingHistory(){this._productsRepository.getTopCategories().then(t=>{this.topCategories.set(t.map(e=>({label:e.name,value:e.uuid})))}),this._productsRepository.getTopSources().then(t=>{this.topSources.set(t.map(e=>({label:e,value:e})))})}static \u0275fac=function(e){return new(e||n)(v(O),v(B),v(V),v(U))};static \u0275cmp=w({type:n,selectors:[["lg-add-product-form"]],viewQuery:function(e,o){e&1&&x(o.nameField,mt,5),e&2&&T()},inputs:{product:[1,"product"]},decls:31,vars:18,consts:[["nameField",""],["priceInput",""],["sourceInput",""],["sourceChips",""],["categorySelect",""],[3,"formGroup"],["label","Tags"],["formControlName","tags",3,"resource","multi"],["label","Name"],["formControlName","name",3,"key","resource"],[3,"bottom","mobileMode"],["label","Amount","lgExpand",""],["formControlName","amount","lgParseMath","",3,"onInputChange","placeholder"],["ngProjectAs","after",5,["after"]],[3,"position"],["ngProjectAs","content",5,["content"]],[3,"eggsChanged"],["formControlName","unit",3,"items"],["label","Price"],["formControlName","price","lgParseMath","",3,"placeholder"],["label","Source"],["formControlName","source",3,"onSelected","noLoad","resource"],[3,"hidden"],[3,"control","items"],["label","Category"],["formControlName","category_id",3,"resource"]],template:function(e,o){if(e&1){let a=P();l(0,"form",5)(1,"lg-gap-column")(2,"lg-control",6),y(3,"lg-tags-control",7),i(),l(4,"lg-control",8),y(5,"lg-autocomplete",9,0),i(),l(7,"lg-gap-row",10)(8,"lg-control",11)(9,"lg-number-input",12),p("onInputChange",function(){g(a);let h=I(18);return f(h.focus())}),l(10,"div",13)(11,"lg-tooltip",14),d(12," Widgets "),l(13,"div",15)(14,"lg-amount-widgets",16),p("eggsChanged",function(h){return g(a),f(o.eggsChanged(h))}),i()()()()()(),y(15,"lg-buttons-group",17),i(),l(16,"lg-control",18),y(17,"lg-number-input",19,1),i(),l(19,"lg-gap-column")(20,"lg-control",20)(21,"lg-autocomplete",21,2),p("onSelected",function(){g(a);let h=I(25);return f(h.clearSelected())}),i()(),l(23,"div",22),y(24,"lg-chips-list",23,3),i()(),l(26,"lg-gap-column")(27,"lg-control",24),y(28,"lg-multiselect",25,4),i(),_(30,gt,1,2,"lg-chips-list",23),i()()()}if(e&2){let a=I(22);s("formGroup",o.form),r(3),s("resource","tags")("multi",!0),r(2),s("key","name")("resource","products-names"),r(2),s("bottom",!0)("mobileMode",!0),r(2),s("placeholder","In "+o.form.value.unit),r(2),s("position","left"),r(4),s("items",o.buttons),r(2),s("placeholder","For the entire product in your currency"),r(4),s("noLoad",!0)("resource","sources"),r(2),s("hidden",!o.topSources().length),r(),s("control",a)("items",o.topSources()),r(4),s("resource","categories"),r(2),C(o.topCategories().length?30:-1)}},dependencies:[Ve,Ee,W,Ae,ke,Me,We,Se,je,Ge,j,Q,He,N,Qe,Ne,qe,Ye,q],styles:[`lg-eggs-widget{min-width:300px}
`],encapsulation:2})};function ft(n,t){if(n&1&&(l(0,"lg-title"),d(1," Edit "),l(2,"span",5),d(3),i()()),n&2){let e,o=u();r(3),D(" ",(e=o.product())==null?null:e.name," ")}}function _t(n,t){n&1&&(l(0,"lg-title"),d(1,"Add Product"),i())}function Ct(n,t){n&1&&d(0," (saved as draft) ")}function ht(n,t){if(n&1&&(d(0),ee(1,"timeAgo")),n&2){let e,o=u();D(" (last edited ",me(1,1,(e=o.product())==null?null:e.updatedAt),") ")}}function vt(n,t){if(n&1&&(d(0),ee(1,"number")),n&2){let e,o=u();pe(" (",(e=o.product())==null?null:e.perUnitLabel," ",ge(1,2,(e=o.product())==null?null:e.pricePerUnit,"1.2-2"),") ")}}function yt(n,t){if(n&1){let e=P();l(0,"lg-button",6),p("click",function(){g(e);let a=u();return f(a.onEditProduct())}),d(1," Edit Product "),i()}}function Pt(n,t){if(n&1){let e=P();l(0,"lg-button",6),p("click",function(){g(e);let a=u();return f(a.onAddProduct())}),d(1," Add Product "),i()}}function wt(n,t){if(n&1){let e=P();l(0,"lg-button",6),p("click",function(){g(e);let a=u();return f(a.onRemoveDraft())}),d(1," Delete this draft "),i()}n&2&&Z("danger")}function bt(n,t){if(n&1){let e=P();l(0,"lg-button",6),p("click",function(){g(e);let a=u();return f(a.onDeleteProduct())}),d(1," Delete Product "),i()}n&2&&Z("danger")}var Xe=class n{constructor(t,e,o,a){this._router=t;this._aRoute=e;this._productsRepository=o;this._notificationsService=a}draftOrProductUUID=m(void 0);product=m(null);formComponent=R(k);draftRef=m(null);draftByExistingProduct=fe(()=>this.draftRef().meta?.uuid);isDraftRoute=m(!1);ngOnInit(){ie([this._aRoute.params,this._aRoute.data]).subscribe(([t,e])=>{this.draftOrProductUUID.set(t.uuid),e.draft?(this.draftRef.set(e.draft),this.product.set(te.fromRaw(e.draft.data))):this._loadProduct(this.draftOrProductUUID()),this.isDraftRoute.set(!!e.draftRoute)})}ngAfterViewInit(){this.formComponent()?.form.valueChanges.pipe(re(500)).subscribe(t=>{this.formComponent().form.dirty&&(this.product.update(e=>e?(e.update(t),e):te.empty()),this.draftRef()?.uuid?this._productsRepository.updateDraftProduct(this.draftRef().uuid,this.product(),this.draftRef().meta?.uuid):this.draftRef.set(this._productsRepository.saveDraftProduct(this.product(),this.draftOrProductUUID()??"")))})}onAddProduct(){!this.formComponent()?.validateForm()||!this.product()||this._addProduct(this.product())}onEditProduct(){!this.formComponent()?.validateForm()||!this.product()||this._editProduct(this.product())}onRemoveDraft(){this._removeDraft(),this._router.navigate(["products"])}onDeleteProduct(){this.product()?.uuid&&this._productsRepository.deleteProduct(this.product().uuid).then(()=>{this._notificationsService.success("Product deleted"),this._router.navigate(["products"])})}_addProduct(t){this._productsRepository.addOne(t).then(()=>{this.formComponent()?.resetForm(),this._notificationsService.success("Product added"),this.draftRef()&&this._removeDraft(),this.isDraftRoute()&&this._router.navigate(["products"])})}_editProduct(t){if(!this.draftOrProductUUID())return;let e=this.draftRef()?.meta?.uuid??this.draftOrProductUUID();this._productsRepository.updateOne(e,t).then(()=>{this.formComponent()?.resetForm(t),this._notificationsService.success("Product edited"),this.draftRef()&&this._removeDraft(),this.isDraftRoute()&&this._router.navigate(["products","edit",e])})}_removeDraft(){this.draftRef()&&(this._productsRepository.removeDraftProduct(this.draftRef().uuid),this.draftRef.set(null))}_loadProduct(t){t&&this._productsRepository.getOne(t).then(e=>{e&&this.product.set(e)})}static \u0275fac=function(e){return new(e||n)(v(V),v(ve),v(O),v(U))};static \u0275cmp=w({type:n,selectors:[["app-add-recipe"]],viewQuery:function(e,o){e&1&&x(o.formComponent,k,5),e&2&&T()},decls:16,vars:10,consts:[[3,"center"],[3,"product"],[3,"mobileMode","relaxed"],["lgShrink",""],["lgShrink","",3,"style"],[1,"text-active"],["lgShrink","",3,"click"]],template:function(e,o){if(e&1&&(l(0,"lg-fade-in")(1,"lg-container")(2,"lg-gap-row",0),_(3,ft,4,1,"lg-title")(4,_t,2,0,"lg-title"),_(5,Ct,1,0),i(),l(6,"div"),_(7,ht,2,3),_(8,vt,2,5),i(),l(9,"lg-card"),y(10,"lg-add-product-form",1),i(),l(11,"lg-gap-row",2),_(12,yt,2,0,"lg-button",3)(13,Pt,2,0,"lg-button",3),_(14,wt,2,2,"lg-button",4)(15,bt,2,2,"lg-button",4),i()()()),e&2){let a,c,h;r(2),s("center",!0),r(),C(o.product()&&!o.draftRef()||o.draftRef()&&o.draftByExistingProduct()?3:4),r(2),C(o.draftRef()?5:-1),r(2),C((a=o.product())!=null&&a.updatedAt?7:-1),r(),C((c=o.product())!=null&&c.pricePerUnit?8:-1),r(2),s("product",o.product()),r(),s("mobileMode",!0)("relaxed",!0),r(),C(o.product()&&!o.draftRef()||o.draftRef()&&o.draftByExistingProduct()?12:13),r(2),C(o.isDraftRoute()?14:(h=o.product())!=null&&h.uuid?15:-1)}},dependencies:[ye,Pe,we,k,N,be,Te,ze,xe,he],encapsulation:2})};export{Xe as AddProductComponent};
