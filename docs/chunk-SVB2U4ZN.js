import{a as nt}from"./chunk-PZ6Z5BDB.js";import{a as Yt}from"./chunk-CD37LFSG.js";import{a as Ht,b as Gt,c as Qt}from"./chunk-WESCC3GL.js";import{e as Ut}from"./chunk-7ETWNIZQ.js";import{a as qt}from"./chunk-PSHXJXBG.js";import{a as Wt,b as jt,c as Lt}from"./chunk-HYPZY6RD.js";import{a as Ot}from"./chunk-NTNOTNFZ.js";import"./chunk-XVBVUDZI.js";import{a as Bt}from"./chunk-6B5WCZG7.js";import{a as Vt}from"./chunk-UVHKGMQ5.js";import{a as Nt}from"./chunk-S5HI73SL.js";import{a as Mt}from"./chunk-V2E2AQQX.js";import{a as $}from"./chunk-MQJWIQ3W.js";import{a as z}from"./chunk-KNGN5IJR.js";import{a as Dt}from"./chunk-XIO6VEU6.js";import{a as Et,b as K}from"./chunk-E6C4JVEO.js";import{a as Ft}from"./chunk-6IJ5CQKN.js";import{a as kt}from"./chunk-3KK5VW3S.js";import"./chunk-SNDQO5FA.js";import{a as it,j as Q,p as Y}from"./chunk-GVIXIWOU.js";import"./chunk-WAPO4JPN.js";import"./chunk-5KSZNU56.js";import{a as It}from"./chunk-LXGI5QAA.js";import"./chunk-TWZFER64.js";import{d as q,f as Pt,g as wt,h as xt,i as A,k as Rt,m as St,p as At,s as Tt,u as L}from"./chunk-BEK46ZVO.js";import"./chunk-2SENDHZQ.js";import{o as bt,r as G}from"./chunk-4S3SNKRC.js";import"./chunk-652DFWNF.js";import{f as vt,k as yt}from"./chunk-O377EGFO.js";import{$ as ut,$b as W,Cb as d,Db as l,Eb as v,F as N,H as st,Ib as w,Lb as f,Mb as g,Nb as gt,Ob as ot,T as ct,Ta as mt,Ua as et,Va as n,Vb as E,Wb as D,Xb as T,Yb as _,Za as O,Zb as _t,_a as P,_b as S,db as R,fc as Ct,ga as y,ha as b,jc as s,kc as c,lc as j,na as C,qb as a,r as pt,rb as ft,sb as U,sc as ht,tb as B,tc as k,wb as u,wc as H,xb as m,xc as F,yc as V}from"./chunk-TBUBSNFD.js";import"./chunk-DELOOZDJ.js";import"./chunk-2WH2EVR6.js";var Kt=["element"],$t=["*",[["content"]]],Xt=["*","content"];function Jt(i,e){if(i&1&&(d(0,"div",4,0),ot(2,1),l(),v(3,"lg-portal",5)),i&2){let t=T(1);n(3),a("appendTarget","body")("targetElement",t)("wrapClass","tooltip tooltip--ejected")}}var X=class i{constructor(){}renderer=ut(O);gap=F(16);displayed=C(!1);full=F(!1);position=F("top");element=V("element");onClose=H();coordinates=C({x:0,y:0});coordinatesEffect=k(()=>{this.renderer.setProperty(document.body,"style",`--tooltip-x: ${this.coordinates().x}px;--tooltip-y: ${this.coordinates().y}px;`)});toggle(e){if(this.displayed.set(!this.displayed()),this.displayed()||this.onClose.emit(),e){e.stopPropagation();let[t,o]=[e.clientX,e.clientY];console.log("x",t,"y",o),setTimeout(()=>{let p=this.element()?.nativeElement?.getBoundingClientRect(),h=p?.width,I=p?.height,dt=window.innerWidth,at=window.innerHeight,x=16,Z=t,tt=o;t+h+x>dt&&(Z=dt-h-x),o+I+x>at&&(tt=at-I-x),t-h-x<0&&(Z=x),o-I-x<0&&(tt=x),this.coordinates.set({x:Z,y:tt})})}}close(){this.displayed.set(!1),this.onClose.emit()}onClick(e){e.target instanceof HTMLElement&&(e.target.closest(".tooltip")||(this.displayed.set(!1),this.onClose.emit()))}onKeydown(e){e.key==="Escape"&&(this.displayed.set(!1),this.onClose.emit())}onScroll(e){this.displayed.set(!1),this.onClose.emit()}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=R({type:i,selectors:[["lg-tooltip"]],viewQuery:function(t,o){t&1&&E(o.element,Kt,5),t&2&&D()},hostBindings:function(t,o){t&1&&f("click",function(p){return o.onClick(p)},et)("keydown",function(p){return o.onKeydown(p)},et)("scroll",function(p){return o.onScroll(p)},mt)},inputs:{gap:[1,"gap"],full:[1,"full"],position:[1,"position"]},outputs:{onClose:"onClose"},ngContentSelectors:Xt,decls:5,vars:6,consts:[["element",""],[1,"tooltip",3,"ngClass"],[1,"tooltip__anchor"],[3,"click"],[1,"tooltip__content"],[3,"appendTarget","targetElement","wrapClass"]],template:function(t,o){t&1&&(gt($t),d(0,"div",1)(1,"div",2)(2,"div",3),f("click",function(p){return o.toggle(p)}),ot(3),l(),u(4,Jt,4,3),l()()),t&2&&(ft("--gap",o.gap(),"px"),U("fullscreen",o.full()),a("ngClass",o.position()),n(4),m(o.displayed()?4:-1))},dependencies:[vt,Bt],styles:[`.tooltip{display:inline-block}.tooltip--ejected{position:fixed;inset:0}.tooltip--ejected .tooltip__content{inset:0;position:fixed;display:flex;align-items:center;justify-content:center;padding-top:calc(var(--header-height) + 12px + 16px + 16px)}.tooltip__anchor{position:relative}.tooltip__content{position:absolute;background-color:#fff;border-radius:16px;padding:16px;box-shadow:0 4px 8px #0000001a;z-index:100}.tooltip.top .tooltip__content,.tooltip.bottom .tooltip__content{bottom:calc(100% + var(--gap));right:50%;transform:translate(50%)}.tooltip.left .tooltip__content{bottom:50%;right:calc(100% + var(--gap));transform:translateY(50%)}.tooltip.right .tooltip__content{bottom:50%;left:calc(100% + var(--gap));transform:translateY(-50%)}.tooltip.fullscreen .tooltip__content{position:fixed;inset:0;background-color:#fff;border-radius:0;padding:32px;transform:none;overflow-y:auto}
`],encapsulation:2})};function Zt(i,e){if(i&1){let t=w();d(0,"div",3)(1,"lg-eggs-widget",4),f("changed",function(r){y(t);let p=g();return b(p.onEggsChanged(r))}),l()()}}var J=class i{constructor(){}eggsChanged=H();selectedWidget=C(null);onWidgetSelect(e){this.selectedWidget.set(e)}onEggsChanged(e){e&&this.eggsChanged.emit(e)}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=R({type:i,selectors:[["lg-amount-widgets"]],outputs:{eggsChanged:"eggsChanged"},decls:5,vars:3,consts:[[1,"amount-widgets"],[1,"amount-widgets__buttons"],[1,"amount-widgets__button",3,"click"],[1,"amount-widgets__wrapper"],[3,"changed"]],template:function(t,o){t&1&&(d(0,"div",0)(1,"div",1)(2,"button",2),f("click",function(){return o.onWidgetSelect("eggs")}),_(3,"Eggs "),l()(),u(4,Zt,2,0,"div",3),l()),t&2&&(U("selected",o.selectedWidget()!=null),n(4),m(o.selectedWidget()==="eggs"?4:-1))},dependencies:[Yt],styles:[".amount-widgets[_ngcontent-%COMP%]{display:flex;gap:16px;flex-direction:column}.amount-widgets__input[_ngcontent-%COMP%]{flex:1}.amount-widgets__buttons[_ngcontent-%COMP%]{display:flex;gap:16px;flex-wrap:wrap;padding:16px;background-color:#fafafa;border-radius:12px;margin:-16px}.amount-widgets.selected[_ngcontent-%COMP%]   .amount-widgets__buttons[_ngcontent-%COMP%]{margin-bottom:0}.amount-widgets__button[_ngcontent-%COMP%]{display:flex;padding:8px 16px;border-radius:16px;background-color:#e5de38;appearance:none;border:none;font-family:inherit;font-size:inherit}"]})};var ie=["nameField"],ne=i=>({unit:i});function re(i,e){if(i&1&&v(0,"lg-chips-list",22),i&2){let t=g(),o=T(35);a("control",o)("items",t.topCategories())}}var M=class i{constructor(e,t,o,r){this._productsRepository=e;this._selectResourcesService=t;this._router=o;this._notificationsService=r}form=new xt({name:new A(null,q.required),amount:new A(null,q.required),price:new A(null,q.required),unit:new A("gram"),source:new A(null),category_id:new A(null),tags:new A([])});buttons=[{label:"gr",value:"gram",style:"secondary"},{label:"pc",value:"piece",style:"secondary"}];product=F(null);topCategories=C([]);topSources=C([]);nameField=V("nameField");productEffect=k(()=>{!this.product()||this.form.dirty||(console.log("Product effect",this.product()),this.form.reset(nt(this.product())),this.form.markAsPristine())});get _defFormValue(){return{name:null,amount:null,price:null,source:null,category_id:null,unit:"gram",tags:[]}}get _formValid(){return this.form.valid}eggsChanged(e){this.form.patchValue({amount:e})}ngOnInit(){this._loadUsingHistory(),this.form.valueChanges.pipe(ct(e=>console.log("Form value changed",e)),N(100)).subscribe(e=>{this.form.dirty&&this.product()?.update(e)})}resetForm(e){console.log("Reset form",e),this.form.reset(e?nt(e):this._defFormValue),this.form.markAsPristine(),this._loadUsingHistory()}validateForm(){return this._formValid?!0:(this._notificationsService.error(this._notificationsService.parseFormErrors(this.form).join(", ")),!1)}ngAfterViewInit(){this._selectResourcesService.load().then(e=>{}),this.form.markAsPristine()}_loadUsingHistory(){this._productsRepository.getTopCategories().then(e=>{this.topCategories.set(e.map(t=>({label:t.name,value:t.uuid??"",color:t.ownColor})))}),this._productsRepository.getTopSources().then(e=>{this.topSources.set(e.map(t=>({label:t,value:t})))})}static \u0275fac=function(t){return new(t||i)(P(Y),P(It),P(G),P(L))};static \u0275cmp=R({type:i,selectors:[["lg-add-product-form"]],viewQuery:function(t,o){t&1&&E(o.nameField,ie,5),t&2&&D()},inputs:{product:[1,"product"]},decls:38,vars:39,consts:[["nameField",""],["priceInput",""],["sourceInput",""],["sourceChips",""],["categorySelect",""],[3,"formGroup"],["formControlName","name",3,"key","placeholder","resource"],[3,"center","mobileMode"],["lgExpand",""],["formControlName","amount","lgParseMath","",3,"onInputChange","placeholder"],["ngProjectAs","after",5,["after"]],[3,"position"],[3,"flat","icon"],["aria-hidden","false","fontIcon","add"],["ngProjectAs","content",5,["content"]],[3,"eggsChanged"],["formControlName","unit","lgWidth","130px",3,"items"],["lgWidth","40%"],["formControlName","price","lgParseMath","",3,"placeholder"],[2,"--control-bg","#ffffff",3,"equal","mobileMode","top"],["formControlName","source",3,"onSelected","noLoad","placeholder","resource"],[3,"hidden"],[3,"control","items"],["formControlName","category_id",3,"placeholder","resource"]],template:function(t,o){if(t&1){let r=w();d(0,"form",5)(1,"lg-gap-column")(2,"lg-card")(3,"lg-gap-column")(4,"lg-control"),v(5,"lg-autocomplete",6,0),s(7,"translate"),l(),d(8,"lg-gap-row",7)(9,"lg-control",8)(10,"lg-number-input",9),s(11,"translate"),f("onInputChange",function(){y(r);let h=T(21);return b(h.focus())}),d(12,"div",10)(13,"lg-tooltip",11)(14,"lg-button",12),v(15,"mat-icon",13),l(),d(16,"div",14)(17,"lg-amount-widgets",15),f("eggsChanged",function(h){return y(r),b(o.eggsChanged(h))}),l()()()()()(),v(18,"lg-buttons-group",16),d(19,"lg-control",17),v(20,"lg-number-input",18,1),s(22,"translate"),l()()()(),d(23,"lg-gap-row",19)(24,"lg-gap-column")(25,"lg-control")(26,"lg-autocomplete",20,2),s(28,"translate"),f("onSelected",function(){y(r);let h=T(31);return b(h.clearSelected())}),l()(),d(29,"div",21),v(30,"lg-chips-list",22,3),l()(),d(32,"lg-gap-column")(33,"lg-control"),v(34,"lg-multiselect",23,4),s(36,"translate"),l(),u(37,re,1,2,"lg-chips-list",22),l()()()()}if(t&2){let r=T(27);a("formGroup",o.form),n(5),a("key","name")("placeholder",c(7,26,"product.form.name.placeholder"))("resource","products-names"),n(3),a("center",!0)("mobileMode",!0),n(2),a("placeholder",j(11,28,"product.form.amount.placeholder",Ct(37,ne,o.form.value.unit))),n(3),a("position","left"),n(),B("success"),a("flat",!0)("icon",!0),n(4),a("items",o.buttons),n(2),a("placeholder",c(22,31,"product.form.price.placeholder")),n(3),a("equal",!0)("mobileMode",!0)("top",!0),n(3),a("noLoad",!0)("placeholder",c(28,33,"product.form.source.placeholder"))("resource","sources"),n(3),a("hidden",!o.topSources().length),n(),a("control",r)("items",o.topSources()),n(4),a("placeholder",c(36,35,"product.form.category_id.placeholder"))("resource","categories"),n(3),m(o.topCategories().length?37:-1)}},dependencies:[Tt,Rt,Pt,wt,St,At,Ot,z,Ut,Wt,X,J,jt,K,Ht,Nt,Gt,Qt,Q,Dt,Mt,$,qt],styles:[`lg-eggs-widget{min-width:300px}
`],encapsulation:2})};function le(i,e){if(i&1&&(d(0,"lg-title"),_(1),s(2,"translate"),l()),i&2){let t,o=g();n(),W(" ",c(2,2,"edit-label")," ",(t=o.product())==null?null:t.name," ")}}function de(i,e){i&1&&(d(0,"lg-title"),_(1),s(2,"translate"),l()),i&2&&(n(),S(" ",c(2,1,"product.form.title")," "))}function ae(i,e){if(i&1&&(_(0),s(1,"number")),i&2){let t,o=g();W(" (",(t=o.product())==null?null:t.perUnitLabel," ",j(1,2,(t=o.product())==null?null:t.pricePerUnit,"1.2-5"),") ")}}function pe(i,e){i&1&&(d(0,"span"),_(1),s(2,"translate"),l()),i&2&&(n(),_t(c(2,1,"saved-draft-label")))}function se(i,e){if(i&1&&(d(0,"span"),_(1),s(2,"translate"),s(3,"timeAgo"),l()),i&2){let t,o=g();n(),W(" (",c(2,2,"edited-at-label")," ",c(3,4,(t=o.product())==null?null:t.updatedAt),")")}}function ce(i,e){i&1&&(_(0),s(1,"translate")),i&2&&S(" ",c(1,1,"product.form.save-btn.edit.active")," ")}function ue(i,e){i&1&&(_(0),s(1,"translate")),i&2&&S(" ",c(1,1,"product.form.save-btn.edit.disabled")," ")}function me(i,e){if(i&1){let t=w();d(0,"lg-button",6),f("click",function(){y(t);let r=g();return b(r.onEditProduct())}),u(1,ce,2,3)(2,ue,2,3),l()}if(i&2){let t,o,r=g();a("disabled",!(!((t=r.formComponent())==null||t.form==null)&&t.form.dirty)&&!r.draftRef()),n(),m(!((o=r.formComponent())==null||o.form==null)&&o.form.dirty||r.draftRef()?1:2)}}function fe(i,e){i&1&&(_(0),s(1,"translate")),i&2&&S(" ",c(1,1,"product.form.save-btn.add.active")," ")}function ge(i,e){i&1&&(_(0),s(1,"translate")),i&2&&S(" ",c(1,1,"product.form.save-btn.add.disabled")," ")}function _e(i,e){if(i&1){let t=w();d(0,"lg-button",6),f("click",function(){y(t);let r=g();return b(r.onAddProduct())}),u(1,fe,2,3)(2,ge,2,3),l()}if(i&2){let t,o,r=g();a("disabled",!(!((t=r.formComponent())==null||t.form==null)&&t.form.dirty)&&!r.draftRef()),n(),m(!((o=r.formComponent())==null||o.form==null)&&o.form.dirty||r.draftRef()?1:2)}}function Ce(i,e){if(i&1){let t=w();d(0,"lg-button",7),f("click",function(){y(t);let r=g();return b(r.onRemoveDraft())}),_(1),s(2,"translate"),l()}i&2&&(B("danger"),n(),S(" ",c(2,3,"product.form.delete-draft-btn")," "))}function he(i,e){if(i&1){let t=w();d(0,"lg-button",7),f("click",function(){y(t);let r=g();return b(r.onDeleteProduct())}),_(1),s(2,"translate"),l()}i&2&&(B("danger"),n(),S(" ",c(2,3,"product.form.delete-btn")," "))}var zt=class i{constructor(e,t,o,r,p){this._router=e;this._aRoute=t;this._productsRepository=o;this._notificationsService=r;this._renderer=p}draftOrProductUUID=C(void 0);product=C(null);formComponent=V(M);draftRef=C(null);draftByExistingProduct=ht(()=>this.draftRef().meta?.uuid);isDraftRoute=C(!1);productEffect=k(()=>{this.product()?this._renderer.setProperty(document.body,"style",`--background-color: ${this.product().ownColor}`):this._renderer.removeAttribute(document.body,"style")});ngOnDestroy(){this._renderer.removeAttribute(document.body,"style")}ngOnInit(){pt([this._aRoute.params,this._aRoute.data]).pipe(st(1)).subscribe(([e,t])=>{this.draftOrProductUUID.set(e.uuid),t.draft?(this.draftRef.set(t.draft),this.product.set(it.fromRaw(t.draft.data))):this.draftOrProductUUID()?this._loadProduct(this.draftOrProductUUID()):this.product.set(it.empty()),this.isDraftRoute.set(!!t.draftRoute)})}ngAfterViewInit(){this.formComponent()?.form.valueChanges.pipe(N(500)).subscribe(e=>{!this.formComponent().form.dirty||!this.product()||(this.draftRef()?.uuid?this._productsRepository.updateDraftProduct(this.draftRef().uuid,this.product(),this.draftRef().meta?.uuid):(this.draftRef.set(this._productsRepository.saveDraftProduct(this.product(),this.draftOrProductUUID()??"")),this.isDraftRoute()||window.history.replaceState({},"",this._router.createUrlTree(["products/draft/"+this.draftRef().uuid]).toString())))})}onAddProduct(){!this.formComponent()?.validateForm()||!this.product()||this._addProduct(this.product())}onEditProduct(){!this.formComponent()?.validateForm()||!this.product()||this._editProduct(this.product())}onRemoveDraft(){this._removeDraft(),this._router.navigate(["products"])}onDeleteProduct(){this.product()?.uuid&&this._productsRepository.deleteProduct(this.product().uuid).then(()=>{this._notificationsService.success("Product deleted"),this._router.navigate(["products"])})}_addProduct(e){this._productsRepository.addOne(e).then(()=>{this.formComponent()?.resetForm(),this._notificationsService.success("Product added"),this.product.set(null),this.draftRef()&&this._removeDraft(),this.isDraftRoute()&&this._router.navigate(["products"])})}_editProduct(e){if(!this.draftOrProductUUID())return;let t=this.draftRef()?.meta?.uuid??this.draftOrProductUUID();this._productsRepository.updateOne(t,e).then(()=>{this.formComponent()?.resetForm(e),this._notificationsService.success("Product edited"),this.draftRef()&&this._removeDraft(),this.isDraftRoute()&&this._router.navigate(["products","edit",t])})}_removeDraft(){this.draftRef()&&(this._productsRepository.removeDraftProduct(this.draftRef().uuid),this.draftRef.set(null))}_loadProduct(e){e&&this._productsRepository.getOne(e,!0).then(t=>{t&&this.product.set(t)})}static \u0275fac=function(t){return new(t||i)(P(G),P(bt),P(Y),P(L),P(O))};static \u0275cmp=R({type:i,selectors:[["app-add-recipe"]],viewQuery:function(t,o){t&1&&E(o.formComponent,M,5),t&2&&D()},decls:15,vars:11,consts:[["size","medium"],[3,"center","mobileMode"],[3,"product"],[3,"mobileMode","relaxed"],["lgShrink","",3,"disabled"],["lgShrink","",3,"style"],["lgShrink","",3,"click","disabled"],["lgShrink","",3,"click"]],template:function(t,o){if(t&1&&(d(0,"lg-fade-in")(1,"lg-container")(2,"lg-gap-column",0)(3,"lg-gap-row",1),u(4,le,3,4,"lg-title")(5,de,3,3,"lg-title"),u(6,ae,2,5),l(),u(7,pe,3,3,"span"),u(8,se,4,6,"span"),l(),v(9,"lg-add-product-form",2),d(10,"lg-gap-row",3),u(11,me,3,2,"lg-button",4)(12,_e,3,2,"lg-button",4),u(13,Ce,3,5,"lg-button",5)(14,he,3,5,"lg-button",5),l()()()),t&2){let r,p,h,I;n(3),a("center",!0)("mobileMode",!0),n(),m((r=o.product())!=null&&r.uuid&&!o.draftRef()||o.draftRef()&&o.draftByExistingProduct()?4:5),n(2),m((p=o.product())!=null&&p.pricePerUnit?6:-1),n(),m(o.draftRef()?7:-1),n(),m((h=o.product())!=null&&h.updatedAt?8:-1),n(),a("product",o.product()),n(),a("mobileMode",!0)("relaxed",!0),n(),m(o.product()&&!o.draftRef()||o.draftRef()&&o.draftByExistingProduct()?11:12),n(2),m(o.isDraftRoute()?13:(I=o.product())!=null&&I.uuid?14:-1)}},dependencies:[Et,kt,M,K,Ft,$,Lt,Vt,yt,Q,z],encapsulation:2})};export{zt as AddProductComponent};
