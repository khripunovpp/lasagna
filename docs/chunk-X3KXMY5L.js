import{v as x,z as O}from"./chunk-RFFWLM6I.js";import{Ab as f,Fb as y,Ib as g,Kb as _,Lb as w,Sa as S,Sb as C,Tb as F,U as c,Ub as j,Y as u,ab as h,ea as m,fa as v,nb as b,tc as D,uc as R,vc as k,zb as l}from"./chunk-MV5CNZ6J.js";import{f as a}from"./chunk-2WH2EVR6.js";var U=["input"],V=["*"],N=class s{filesSelected=D();accept=R(".csv");input=k("input");onFileChange(t){let n=t.target.files?.[0];n&&this.filesSelected.emit([n])}clear(){this.input()?.nativeElement&&(this.input().nativeElement.value="",this.input().nativeElement.files=null)}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=h({type:s,selectors:[["lg-upload"]],viewQuery:function(e,n){e&1&&C(n.input,U,5),e&2&&F()},inputs:{accept:[1,"accept"]},outputs:{filesSelected:"filesSelected"},ngContentSelectors:V,decls:5,vars:1,consts:[["input",""],[1,"lg-upload",3,"click"],["type","file",3,"change","accept"],[1,"lg-upload__content"]],template:function(e,n){if(e&1){let i=y();_(),l(0,"div",1),g("click",function(){m(i);let o=j(2);return v(o.click())}),l(1,"input",2,0),g("change",function(o){return m(i),v(n.onFileChange(o))}),f(),l(3,"div",3),w(4),f()()}e&2&&(S(),b("accept",n.accept()))},styles:["input[_ngcontent-%COMP%]{display:none}"]})};var p=class s{constructor(){}readFromCSVFile(t){return new Promise((e,n)=>{let i=new FileReader;i.onload=()=>{let r=i.result,o=this.parseData(r),[d,...E]=o,I=this.arrayToObjects(E,d);e(I)},i.onerror=()=>{n(i.error)},i.readAsText(t)})}readFromJSONFile(t){return new Promise((e,n)=>{let i=new FileReader;i.onload=()=>{try{let r=i.result,o=JSON.parse(r);e(o)}catch(r){n(r)}},i.onerror=()=>{n(i.error)},i.readAsText(t)})}parseData(t){return t.split(/\r\n|\n/).map(e=>e.split(",")).filter(e=>e.length>1&&e.some(n=>n.length>0))}arrayToObjects(t,e){return t.map(n=>{let i={};return e.forEach((r,o)=>{i[r]=n[o]}),i})}makeCsv(t){let e=Object.keys(t[0]),n=t.map(r=>e.map(o=>r[o]));return[e,...n].map(r=>r.join(",")).join(`\r
`)}saveToCSVFile(t,e){let n=this.makeCsv(t),i=new Blob([n],{type:"text/csv"}),r=URL.createObjectURL(i),o=document.createElement("a");document.body.appendChild(o),o.setAttribute("href",r),o.setAttribute("download",e),o.click(),URL.revokeObjectURL(r)}saveToJSONFile(t,e){let n=JSON.stringify(t,null,2),i=new Blob([n],{type:"application/json"}),r=URL.createObjectURL(i),o=document.createElement("a");document.body.appendChild(o),o.setAttribute("href",r),o.setAttribute("download",e),o.click(),URL.revokeObjectURL(r)}static \u0275fac=function(e){return new(e||s)};static \u0275prov=c({token:s,factory:s.\u0275fac,providedIn:"root"})};var A=class s{constructor(t,e){this._indexDbService=t;this._csvReaderService=e}exportTable(i){return a(this,arguments,function*(t,e="csv",n={}){let r=[];if(n.selected?.length?r=yield this._indexDbService.getMany(t,n.selected):r=yield this._indexDbService.getAll(t),e==="json"){this._csvReaderService.saveToJSONFile(r,this._getFileName(t,e));return}this._csvReaderService.saveToCSVFile(r,this._getFileName(t,e))})}exportAll(t="csv"){return a(this,null,function*(){let e=[],n=Object.values(x).filter(i=>i!=="indicesStore");for(let i of n){let r=yield this._indexDbService.getAll(i),o=yield this._indexDbService.getVersion(i),d=Date.now();e.push({store:i,data:r,version:o,createdAt:d})}if(t==="json"){this._csvReaderService.saveToJSONFile(e,this._getFileName(n[0],t));return}this._csvReaderService.saveToCSVFile(e,this._getFileName(n[0],t))})}restoreAllData(t){return a(this,null,function*(){if(t?.length&&t.length>1)throw new Error("Only one file is allowed");let e=yield this._csvReaderService.readFromJSONFile(t[0]);console.log({data:e}),yield this._indexDbService.restoreAllData(e)})}makeCsv(t){return this._csvReaderService.makeCsv(t)}_getFileName(t,e){let n=new Date().toISOString();return`${t}_export_${n}.${e}`}static \u0275fac=function(e){return new(e||s)(u(O),u(p))};static \u0275prov=c({token:s,factory:s.\u0275fac,providedIn:"root"})};export{N as a,p as b,A as c};
