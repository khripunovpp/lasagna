import{a as Dt}from"./chunk-GF2ZG5B5.js";import{a as Rt,b as St,c as xt}from"./chunk-G4BMNHMU.js";import{a as wt}from"./chunk-XZXT4SRM.js";import{e as yt}from"./chunk-LODJKPFY.js";import{a as vt}from"./chunk-SU62LMDG.js";import{a as Pt,c as bt,d as At}from"./chunk-7MA2WGFT.js";import{a as ht}from"./chunk-EPO23GDK.js";import"./chunk-TAQBGISU.js";import{a as Ct}from"./chunk-67XZZGJY.js";import{b as W}from"./chunk-5QDKKGEV.js";import{c as O}from"./chunk-KSJHJEER.js";import"./chunk-NRQ7W7MN.js";import"./chunk-BBWM53XJ.js";import{a as _t}from"./chunk-4J6QSXGQ.js";import{a as N}from"./chunk-5TOARGWW.js";import"./chunk-CL46QNG2.js";import{c as F,h as lt,k as I,m as dt,n as ct,o as pt,p as S,r as ut,t as mt,w as ft,z as gt}from"./chunk-X5YAN5AH.js";import"./chunk-DELOOZDJ.js";import{a as nt,b as rt}from"./chunk-QE42GE7B.js";import{A as at,c as ot,s as it,v as k,z as st}from"./chunk-UAPQ4Z4N.js";import{Ab as n,Bb as f,F as J,Fb as b,Ib as d,Jb as v,Kb as $,Lb as L,Ra as Q,Sa as r,Sb as x,Tb as A,Ub as R,Vb as g,Xa as h,ab as w,ea as _,fa as C,la as p,nb as l,ob as q,pb as M,pc as tt,qb as Z,qc as et,tb as u,tc as T,ub as m,uc as D,vc as E,zb as s}from"./chunk-SYQBEC7E.js";import"./chunk-2WH2EVR6.js";var Vt=["element"],Ft=["*",[["content"]]],It=["*","content"];function Mt(i,t){if(i&1&&(s(0,"div",4,0),L(2,1),n(),f(3,"lg-portal",5)),i&2){let e=R(1),o=v();q("left",o.coordinates().x,"px")("top",o.coordinates().y,"px"),r(3),l("appendTarget","body")("targetElement",e)("wrapClass","tooltip")}}var U=class i{constructor(){}gap=D(16);displayed=p(!1);full=D(!1);position=D("top");element=E("element");onClose=T();coordinates=p({x:0,y:0});toggle(t){if(this.displayed.set(!this.displayed()),this.displayed()||this.onClose.emit(),t){t.stopPropagation();let[e,o]=[t.clientX,t.clientY];setTimeout(()=>{let c=(this.element()?.nativeElement).getBoundingClientRect(),y=c.width,G=c.height,K=window.innerWidth,X=window.innerHeight,P=16,H=e,B=o;e+y+P>K&&(H=K-y-P),o+G+P>X&&(B=X-G-P),e-y-P<0&&(H=P),o-G-P<0&&(B=P),this.coordinates.set({x:H,y:B})})}}close(){this.displayed.set(!1),this.onClose.emit()}onClick(t){t.target instanceof HTMLElement&&(t.target.closest(".tooltip")||(this.displayed.set(!1),this.onClose.emit()))}onKeydown(t){t.key==="Escape"&&(this.displayed.set(!1),this.onClose.emit())}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=w({type:i,selectors:[["lg-tooltip"]],viewQuery:function(e,o){e&1&&x(o.element,Vt,5),e&2&&A()},hostBindings:function(e,o){e&1&&d("click",function(c){return o.onClick(c)},Q)("keydown",function(c){return o.onKeydown(c)},Q)},inputs:{gap:[1,"gap"],full:[1,"full"],position:[1,"position"]},outputs:{onClose:"onClose"},ngContentSelectors:It,decls:5,vars:6,consts:[["element",""],[1,"tooltip",3,"ngClass"],[1,"tooltip__anchor"],[3,"click"],[1,"tooltip__content"],[3,"appendTarget","targetElement","wrapClass"]],template:function(e,o){e&1&&($(Ft),s(0,"div",1)(1,"div",2)(2,"div",3),d("click",function(c){return o.toggle(c)}),L(3),n(),u(4,Mt,4,7),n()()),e&2&&(q("--gap",o.gap(),"px"),M("fullscreen",o.full()),l("ngClass",o.position()),r(4),m(o.displayed()?4:-1))},dependencies:[ot,Ct],styles:[".tooltip[_ngcontent-%COMP%]{position:relative;display:inline-block}.tooltip__anchor[_ngcontent-%COMP%]{position:relative}.tooltip__content[_ngcontent-%COMP%]{position:absolute;background-color:#fff;border-radius:16px;padding:16px;box-shadow:0 4px 8px #0000001a;z-index:100}.tooltip.top[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%], .tooltip.bottom[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%]{bottom:calc(100% + var(--gap));right:50%;transform:translate(50%)}.tooltip.left[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%]{bottom:50%;right:calc(100% + var(--gap));transform:translateY(50%)}.tooltip.right[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%]{bottom:50%;left:calc(100% + var(--gap));transform:translateY(-50%)}.tooltip.fullscreen[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#fff;border-radius:0;padding:32px;transform:none;overflow-y:auto}"]})};function Tt(i,t){if(i&1){let e=b();s(0,"div",3)(1,"lg-eggs-widget",4),d("changed",function(a){_(e);let c=v();return C(c.onEggsChanged(a))}),n()()}}var j=class i{constructor(){}eggsChanged=T();selectedWidget=p(null);onWidgetSelect(t){this.selectedWidget.set(t)}onEggsChanged(t){t&&this.eggsChanged.emit(t)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=w({type:i,selectors:[["lg-amount-widgets"]],outputs:{eggsChanged:"eggsChanged"},decls:5,vars:3,consts:[[1,"amount-widgets"],[1,"amount-widgets__buttons"],[1,"amount-widgets__button",3,"click"],[1,"amount-widgets__wrapper"],[3,"changed"]],template:function(e,o){e&1&&(s(0,"div",0)(1,"div",1)(2,"button",2),d("click",function(){return o.onWidgetSelect("eggs")}),g(3,"Eggs "),n()(),u(4,Tt,2,0,"div",3),n()),e&2&&(M("selected",o.selectedWidget()!=null),r(4),m(o.selectedWidget()==="eggs"?4:-1))},dependencies:[Dt],styles:[".amount-widgets[_ngcontent-%COMP%]{display:flex;gap:16px;flex-direction:column}.amount-widgets__input[_ngcontent-%COMP%]{flex:1}.amount-widgets__buttons[_ngcontent-%COMP%]{display:flex;gap:16px;flex-wrap:wrap;padding:16px;background-color:#fafafa;border-radius:12px;margin:-16px}.amount-widgets.selected[_ngcontent-%COMP%]   .amount-widgets__buttons[_ngcontent-%COMP%]{margin-bottom:0}.amount-widgets__button[_ngcontent-%COMP%]{display:flex;padding:8px 16px;border-radius:16px;background-color:#e5de38;appearance:none;border:none;font-family:inherit;font-size:inherit}"]})};var Wt=["nameField"];function Ut(i,t){if(i&1&&f(0,"lg-chips-list",21),i&2){let e=v(),o=R(27);l("control",o)("items",e.topCategories())}}var V=class i{constructor(t,e,o,a){this._productsRepository=t;this._selectResourcesService=e;this._router=o;this._notificationsService=a}form=new pt({name:new S(null,I.required),amount:new S(null,I.required),price:new S(null,I.required),unit:new S("gram"),source:new S(null),category_id:new S(null,I.required)});buttons=[{label:"Grams",value:"gram",style:"secondary",onClick:()=>{console.log("Grams")}},{label:"Pieces",value:"piece",style:"secondary",onClick:()=>{console.log("Piece")}}];product=D(null);topCategories=p([]);topSources=p([]);nameField=E("nameField");productEffect=et(()=>{this.product()&&(this.form.reset(this.product()),this.form.markAsPristine())});get value(){return this.form.value}get _defFormValue(){return{name:null,amount:null,price:null,source:null,category_id:null,unit:"gram"}}get _formValid(){return this.form.valid}get _productModel(){return F(this.value)}eggsChanged(t){this.form.patchValue({amount:t})}ngOnInit(){this._loadUsingHistory()}resetForm(t){this.form.reset(t??this._defFormValue),this.form.markAsPristine(),this._loadUsingHistory()}validateForm(){return this._formValid?!0:(this._notificationsService.error(this._notificationsService.parseFormErrors(this.form).join(", ")),!1)}ngAfterViewInit(){this._selectResourcesService.load().then(t=>{}),this.form.markAsPristine()}_loadUsingHistory(){this._productsRepository.getTopCategories().then(t=>{this.topCategories.set(t.map(e=>({label:e.name,value:e.uuid})))}),this._productsRepository.getTopSources().then(t=>{this.topSources.set(t.map(e=>({label:e,value:e})))})}static \u0275fac=function(e){return new(e||i)(h(O),h(vt),h(k),h(W))};static \u0275cmp=w({type:i,selectors:[["lg-add-product-form"]],viewQuery:function(e,o){e&1&&x(o.nameField,Wt,5),e&2&&A()},inputs:{product:[1,"product"]},decls:29,vars:16,consts:[["nameField",""],["priceInput",""],["sourceInput",""],["sourceChips",""],["categorySelect",""],[3,"formGroup"],["label","Name"],["formControlName","name",3,"key","resource"],[3,"bottom","mobileMode"],["label","Amount","lgExpand",""],["formControlName","amount","lgParseMath","",3,"onInputChange","placeholder"],["ngProjectAs","after",5,["after"]],[3,"position"],["ngProjectAs","content",5,["content"]],[3,"eggsChanged"],["formControlName","unit",3,"items"],["label","Price"],["formControlName","price","lgParseMath","",3,"placeholder"],["label","Source"],["formControlName","source",3,"onSelected","noLoad","resource"],[3,"hidden"],[3,"control","items"],["label","Category"],["formControlName","category_id",3,"resource"]],template:function(e,o){if(e&1){let a=b();s(0,"form",5)(1,"lg-gap-column")(2,"lg-control",6),f(3,"lg-autocomplete",7,0),n(),s(5,"lg-gap-row",8)(6,"lg-control",9)(7,"lg-number-input",10),d("onInputChange",function(){_(a);let y=R(16);return C(y.focus())}),s(8,"div",11)(9,"lg-tooltip",12),g(10," Widgets "),s(11,"div",13)(12,"lg-amount-widgets",14),d("eggsChanged",function(y){return _(a),C(o.eggsChanged(y))}),n()()()()()(),f(13,"lg-buttons-group",15),n(),s(14,"lg-control",16),f(15,"lg-number-input",17,1),n(),s(17,"lg-gap-column")(18,"lg-control",18)(19,"lg-autocomplete",19,2),d("onSelected",function(){_(a);let y=R(23);return C(y.clearSelected())}),n()(),s(21,"div",20),f(22,"lg-chips-list",21,3),n()(),s(24,"lg-gap-column")(25,"lg-control",22),f(26,"lg-multiselect",23,4),n(),u(28,Ut,1,2,"lg-chips-list",21),n()()()}if(e&2){let a=R(20);l("formGroup",o.form),r(3),l("key","name")("resource","products-names"),r(2),l("bottom",!0)("mobileMode",!0),r(2),l("placeholder","In "+o.form.value.unit),r(2),l("position","left"),r(4),l("items",o.buttons),r(2),l("placeholder","For the entire product in your currency"),r(4),l("noLoad",!0)("resource","sources"),r(2),l("hidden",!o.topSources().length),r(),l("control",a)("items",o.topSources()),r(4),l("resource","categories"),r(2),m(o.topCategories().length?28:-1)}},dependencies:[gt,ut,dt,ct,mt,ft,ht,_t,yt,Pt,U,j,bt,N,Rt,wt,St,xt],styles:[`lg-eggs-widget{min-width:300px}
`],encapsulation:2})};function jt(i,t){i&1&&(s(0,"lg-title"),g(1,"Edit Product"),n())}function Gt(i,t){i&1&&(s(0,"lg-title"),g(1,"Add Product"),n())}function Ht(i,t){i&1&&g(0," (saved as draft) ")}function Bt(i,t){if(i&1){let e=b();s(0,"lg-button",5),d("click",function(){_(e);let a=v();return C(a.onEditProduct())}),g(1," Edit Product "),n()}}function Qt(i,t){if(i&1){let e=b();s(0,"lg-button",5),d("click",function(){_(e);let a=v();return C(a.onAddProduct())}),g(1," Add Product "),n()}}function qt(i,t){if(i&1){let e=b();s(0,"lg-button",5),d("click",function(){_(e);let a=v();return C(a.onRemoveDraft())}),g(1," Delete this draft "),n()}i&2&&Z("danger")}var Et=class i{constructor(t,e,o,a){this._router=t;this._aRoute=e;this._productsRepository=o;this._notificationsService=a}draftOrProductUUID=p(void 0);product=p(null);formComponent=E(V);draftRef=p(null);draftByExistingProduct=tt(()=>this.draftRef().meta?.uuid);isDraftRoute=p(!1);ngOnInit(){this._aRoute.params.subscribe(t=>{this.draftOrProductUUID.set(t.uuid),this._loadProduct(this.draftOrProductUUID())}),this._aRoute.data.subscribe(t=>{t.draft&&(this.draftRef.set(t.draft),this.product.set(t.draft.data)),this.isDraftRoute.set(!!t.draftRoute)})}ngAfterViewInit(){this.formComponent()?.form.valueChanges.pipe(J(500)).subscribe(t=>{this.formComponent().form.dirty&&(this.draftRef()?.uuid?this._productsRepository.updateDraftProduct(this.draftRef().uuid,t,this.draftRef().meta?.uuid):this.draftRef.set(this._productsRepository.saveDraftProduct(t,this.draftOrProductUUID()??"")))})}onAddProduct(){this.formComponent()?.validateForm()&&this._addProduct(this.formComponent().value)}onEditProduct(){this.formComponent()?.validateForm()&&this._editProduct(this.formComponent().value)}onRemoveDraft(){this._removeDraft(),this._router.navigate(["products"])}_addProduct(t){this._productsRepository.addProduct(F(t)).then(()=>{this.formComponent()?.resetForm(),this._notificationsService.success("Product added"),this.draftRef()&&this._removeDraft(),this.isDraftRoute()&&this._router.navigate(["products"])})}_editProduct(t){if(!this.draftOrProductUUID())return;let e=this.draftRef()?.meta?.uuid??this.draftOrProductUUID();this._productsRepository.editProduct(e,F(t)).then(()=>{this.formComponent()?.resetForm(t),this._notificationsService.success("Product edited"),this.draftRef()&&this._removeDraft(),this.isDraftRoute()&&this._router.navigate(["products","edit",e])})}_removeDraft(){this.draftRef()&&(this._productsRepository.removeDraftProduct(this.draftRef().uuid),this.draftRef.set(null))}_loadProduct(t){t&&this._productsRepository.getOne(t).then(e=>{e&&this.product.set(e)})}static \u0275fac=function(e){return new(e||i)(h(k),h(it),h(O),h(W))};static \u0275cmp=w({type:i,selectors:[["app-add-recipe"]],viewQuery:function(e,o){e&1&&x(o.formComponent,V,5),e&2&&A()},decls:12,vars:8,consts:[[3,"center"],[3,"product"],[3,"relaxed","mobileMode"],["lgShrink",""],["lgShrink","",3,"style"],["lgShrink","",3,"click"]],template:function(e,o){e&1&&(s(0,"lg-fade-in")(1,"lg-container")(2,"lg-gap-row",0),u(3,jt,2,0,"lg-title")(4,Gt,2,0,"lg-title"),u(5,Ht,1,0),n(),s(6,"lg-card"),f(7,"lg-add-product-form",1),n(),s(8,"lg-gap-row",2),u(9,Bt,2,0,"lg-button",3)(10,Qt,2,0,"lg-button",3),u(11,qt,2,2,"lg-button",4),n()()()),e&2&&(r(2),l("center",!0),r(),m(o.product()&&!o.draftRef()||o.draftRef()&&o.draftByExistingProduct()?3:4),r(2),m(o.draftRef()?5:-1),r(2),l("product",o.product()),r(),l("relaxed",!0)("mobileMode",!0),r(),m(o.product()&&!o.draftRef()||o.draftRef()&&o.draftByExistingProduct()?9:10),r(2),m(o.isDraftRoute()?11:-1))},dependencies:[nt,rt,st,V,N,at,lt,At],encapsulation:2})};export{Et as AddProductComponent};
