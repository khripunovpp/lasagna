import{a as Ee}from"./chunk-ZEKB2U6M.js";import"./chunk-BSYU4TDD.js";import{a as ve,b as $}from"./chunk-7R6HS6JU.js";import{a as ne}from"./chunk-7COEMPT6.js";import{a as we,b as Re,c as Fe}from"./chunk-QRS76EMV.js";import{a as ye}from"./chunk-T6K3LUN6.js";import{a as he}from"./chunk-6QHNBYN5.js";import{a as be,b as Se}from"./chunk-PBY37YKW.js";import{a as Ae}from"./chunk-KJHYIYGH.js";import{a as V}from"./chunk-QNQJNRNH.js";import{a as ge,b as Ce}from"./chunk-ZYT64JFR.js";import{c as le,e as ce,f as ae,g as B,h as g,j as se,k as pe,l as me,m as de,n as ue,o as _e,q as fe}from"./chunk-FMSTASSM.js";import{a as xe}from"./chunk-GKQZ6TBK.js";import{c as j}from"./chunk-TQTLV33A.js";import{a as Ie}from"./chunk-2NSFWKSX.js";import{a as oe,b as re}from"./chunk-HMFW6PL3.js";import{$a as m,B as H,Ca as R,Da as b,Ga as U,Ha as Y,Ia as r,Ib as ee,Ja as l,Ka as y,La as S,Ma as F,Oa as C,Pa as _,Qa as s,Ra as N,Sa as E,U as d,V as u,Wb as D,Ya as k,Yb as te,Z as T,Za as J,_a as I,a as x,ac as ie,b as v,bb as M,f as q,gb as X,ia as c,la as h,na as w,tb as Z,wa as a,xb as P,ya as K,za as A,zb as G}from"./chunk-EBX4ADAM.js";var Ne=["*"];function ke(o,t){if(o&1&&(r(0,"p",1),m(1),l()),o&2){let e=s();c(),M(" ",e.label()," ")}}var O=class o{constructor(){}label=P("");static \u0275fac=function(e){return new(e||o)};static \u0275cmp=w({type:o,selectors:[["lg-control-group"]],inputs:{label:[1,"label"]},ngContentSelectors:Ne,decls:4,vars:1,consts:[[1,"control-group"],[1,"control-group__label"],[1,"control-group__content"]],template:function(e,n){e&1&&(N(),r(0,"div",0),R(1,ke,2,1,"p",1),r(2,"div",2),E(3),l()()),e&2&&(c(),b(n.label()?1:-1))},styles:["[_nghost-%COMP%]{display:flex;flex:1}.control-group[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:16px}.control-group__label[_ngcontent-%COMP%]{font-size:1.2rem;margin:0}.control-group__content[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:flex-end}.control-group__content[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{flex:1}"]})};var Me=["*",[["rowActions"]]],Pe=["*","rowActions"],z=class o{constructor(){}mobileMode=P(!1);static \u0275fac=function(e){return new(e||o)};static \u0275cmp=w({type:o,selectors:[["lg-controls-row"]],inputs:{mobileMode:[1,"mobileMode"]},ngContentSelectors:Pe,decls:5,vars:2,consts:[[1,"controls-row"],[1,"controls-row__controls"],[1,"controls-row__actions"]],template:function(e,n){e&1&&(N(Me),r(0,"div",0)(1,"div",1),E(2),l(),r(3,"div",2),E(4,1),l()()),e&2&&K("controls-row__mobile",n.mobileMode())},styles:[`:host{display:flex;gap:16px}.controls-row{width:100%;display:flex;align-items:flex-end;gap:16px;flex:1}.controls-row__controls,.controls-row__actions{display:flex;align-items:flex-end;gap:16px}.controls-row__controls{flex:1}.controls-row__actions{flex:0;white-space:nowrap}.controls-row__controls>*,.controls-row__actions>*{flex:1}@media (max-width: 600px){.controls-row__mobile,.controls-row__mobile .controls-row__controls{flex-direction:column;align-items:stretch}}
`],encapsulation:2})};var De=["tooltipComponent"],je=["products"],$e=["productsSelector"],Oe=(o,t)=>(t.value.product_id==null?null:t.value.product_id.id)||t.value.name||t.value.amount;function ze(o,t){if(o&1){let e=C();r(0,"lg-gap-column",18)(1,"lg-control",23),S(2,24),r(3,"span",25),_("click",function(){d(e);let i=s().$index,p=s();return u(p.closeTextField(i))}),m(4,"Hide"),l(),F(),r(5,"lg-input",6),_("onInputChanged",function(){d(e);let i=s().$index,p=I(6),f=s();return u(f.onIngredientSelected(p,i,["product_id","recipe_id"]))}),l()()()}o&2&&(a("size","small"),c(5),a("placeholder","Here you can write the name of the ingredient"))}function Le(o,t){if(o&1){let e=C();r(0,"lg-multiselect",31),_("onSelected",function(){d(e);let i=s(2).$index,p=I(6),f=s();return u(f.onIngredientSelected(p,i,["product_id","name"]))}),l()}o&2&&a("resource","recipes")("autoLoad",!0)}function Be(o,t){if(o&1){let e=C();r(0,"lg-multiselect",32,2),_("onSelected",function(){d(e);let i=s(2).$index,p=I(6),f=s();return u(f.onIngredientSelected(p,i,["recipe_id","name"]))}),l()}o&2&&a("resource","products")("autoLoad",!0)}function We(o,t){if(o&1){let e=C();r(0,"lg-gap-column",18)(1,"lg-control"),S(2,26),r(3,"span",27),_("click",function(){d(e);let i=s().$index,p=s();return u(p.closeRecipeField(i))}),m(4," Product "),l(),F(),S(5,28),r(6,"span",27),_("click",function(){d(e);let i=s().$index,p=s();return u(p.openRecipeField(i))}),m(7,"Recipe"),l(),F(),S(8,24),r(9,"span",25),_("click",function(){d(e);let i=s().$index,p=s();return u(p.openTextField(i))}),m(10,"As text"),l(),F(),R(11,Le,1,2,"lg-multiselect",29)(12,Be,2,2,"lg-multiselect",30),l()()}if(o&2){let e=s().$index,n=s();a("size","small"),c(3),a("ngClass",n.recipeFieldState()[e]?"":"text-active text-bold"),c(3),a("ngClass",n.recipeFieldState()[e]?"text-active text-bold":""),c(5),b(n.recipeFieldState()[e]?11:12)}}function Qe(o,t){if(o&1){let e=C();S(0,15),r(1,"lg-controls-row",17),R(2,ze,6,2,"lg-gap-column",18)(3,We,13,4,"lg-gap-column",18),r(4,"lg-control",19)(5,"lg-number-input",20,1),_("onKeydown",function(){d(e);let i=s();return u(i.addLast())}),l()(),y(7,"lg-buttons-group",21),S(8,22),r(9,"lg-button",16),_("click",function(){let i=d(e).$index,p=s();return u(p.deleteIngredient(i))}),m(10," Delete Ingredient "),l(),F(),l(),F()}if(o&2){let e=t.$index,n=s();a("formGroupName",e),c(),a("mobileMode",!0),c(),b(n.textFieldState()[e]?2:3),c(3),a("placeholder","In "+((n.form.value.ingredients==null||n.form.value.ingredients[e]==null?null:n.form.value.ingredients[e].unit)||"gram")),c(2),a("items",n.buttons),c(2),A("danger"),a("size","small")}}function qe(o,t){if(o&1){let e=C();r(0,"lg-button",25),_("click",function(){d(e);let i=s();return u(i.editRecipe(i.value))}),m(1," Edit Recipe "),l()}}function He(o,t){if(o&1){let e=C();r(0,"lg-button",25),_("click",function(){d(e);let i=s();return u(i.addRecipe(i.value))}),m(1," Add Recipe "),l()}}var L=class o{constructor(t,e,n,i,p){this._recipesRepository=t;this._selectResourcesService=e;this._router=n;this._aRoute=i;this._notificationsService=p;this._aRoute.data.pipe(Ae()).subscribe(f=>{this.recipe.set(f.recipe||null)})}recipe=T(null);uuid=$("uuid");form=new B({name:new g(null,le.required),description:new g(""),outcome_amount:new g(null),outcome_unit:new g(""),ingredients:new _e([this._getIngredientGroup()])},t=>{let e=t.value?.outcome_amount,n=t.value?.ingredients?.reduce((i,p)=>p.unit!=="gram"?i:i+(+p.amount||0),0)||0;return e&&e>n?{outcomeAmountGreaterThanIngredients:!0}:null});textFieldState=T({});recipeFieldState=T({});buttons=[{label:"Grams",value:"gram",style:"secondary",onClick:()=>{console.log("Grams")}},{label:"Pieces",value:"piece",style:"secondary",onClick:()=>{console.log("Piece")}}];tooltipComponent=G("tooltipComponent");productsWidget=G("products");productsSelector=G("productsSelector");recipeEffect=Z(()=>{this.recipe()&&(this.form.reset(v(x({},this.recipe()),{ingredients:[]})),this.form.get("ingredients").clear(),this.recipe()?.ingredients.forEach((t,e)=>{this.ingredients.push(this._getIngredientGroup(t)),t.recipe_id&&this.openRecipeField(e),t.name&&this.openTextField(e)}),this.form.updateValueAndValidity())});get ingredients(){return this.form.get("ingredients")}get value(){return this.form.value}get _values(){let t=this.form.value;return Re(we(t))}get _formValid(){return this.form.valid&&!this.checkCycleRecipe(this.form.value.ingredients,this.uuid())}productAdded(t,e){return q(this,null,function*(){yield this._selectResourcesService.load(),this.tooltipComponent()?.at(e)?.close(),this.productsWidget()?.at(e)?.stopCamera(),this.ingredients.at(e).get("product_id")?.reset({uuid:t.uuid,name:t.name})})}addLast(){let t=this.ingredients.at(this.ingredients.length-1);(t.value.name||t.value.amount||t.value.product_id)&&this.addIngredient()}ngOnInit(){this.form.valueChanges.pipe(H(100)).subscribe({next:t=>{this.checkCycleRecipe(t.ingredients,this.uuid())&&this._notificationsService.error("You cannot add a recipe to itself"),console.log(t)}})}ngAfterViewInit(){this._selectResourcesService.load().then(t=>{})}addIngredient(){this.ingredients.push(this._getIngredientGroup())}deleteIngredient(t){this.ingredients.removeAt(t)}addRecipe(t){if(!this._formValid){this._notificationsService.error(this._notificationsService.parseFormErrors(this.form).join(", "));return}this._recipesRepository.addRecipe(this._values).then(()=>{this._router.navigate(["/recipes"])})}editRecipe(t){if(!this._formValid){this._notificationsService.error(this._notificationsService.parseFormErrors(this.form).join(", "));return}this._recipesRepository.editRecipe(this.uuid(),this._values).then(()=>{this._router.navigate(["/recipes"])}).catch(e=>{console.error(e)})}onIngredientSelected(t,e,n){t.focus();let i=this.ingredients.at(e).value,p=i.product_id?.unit==="gram"||i.recipe_id?.unit==="gram";console.log({value:i}),this.ingredients.at(e).patchValue(v(x({},Array.isArray(n)?n.reduce((f,Te)=>v(x({},f),{[Te]:null}),{}):{[n]:null}),{unit:i.product_id?.unit||i.recipe_id?.unit||"gram"}))}openTextField(t){this.textFieldState.update(e=>v(x({},e),{[t]:!0}))}closeTextField(t){this.textFieldState.update(e=>v(x({},e),{[t]:!1}))}openRecipeField(t){this.recipeFieldState.update(e=>v(x({},e),{[t]:!0}))}closeRecipeField(t){this.recipeFieldState.update(e=>v(x({},e),{[t]:!1}))}checkCycleRecipe(t,e){let n=!1;for(let i of t){let p=i.recipe_id?.uuid;if(p&&p===e){n=!0;break}}return n}_getIngredientGroup(t){return new B({name:new g(t?.name),amount:new g(t?.amount?.toString()??null),product_id:new g(t?.product_id?t.product_id:null),recipe_id:new g(t?.recipe_id?t.recipe_id:null),unit:new g(t?.unit??"gram")},e=>{if(!e.value.product_id&&!e.value.name&&!e.value.recipe_id&&!parseInt(e.value.amount))return null;if((e.value.product_id||e.value.name||e.value.recipe_id)&&!parseInt(e.value.amount))return{ingredientAmountRequired:!0};if(!this.uuid)return null;let n=this.uuid();return this.checkCycleRecipe([e.value],n)?{cycleRecipe:!0}:!e.value.product_id&&!e.value.name&&!e.value.recipe_id?{ingredientRequired:!0}:null})}static \u0275fac=function(e){return new(e||o)(h(ne),h(V),h(te),h(D),h(Ee))};static \u0275cmp=w({type:o,selectors:[["lg-add-recipe-form"]],viewQuery:function(e,n){e&1&&(k(n.tooltipComponent,De,5),k(n.productsWidget,je,5),k(n.productsSelector,$e,5)),e&2&&J(3)},features:[X([{provide:V,useClass:V}])],decls:21,vars:12,consts:[["desc",""],["amount",""],["productsSelector",""],[3,"formGroup"],[3,"position"],["label","Name","lgExpand",""],["formControlName","name",3,"onInputChanged","placeholder"],["label","Description","lgExpand",""],["formControlName","description",3,"placeholder"],["lgExpand","",3,"mobileMode"],["label","Amount of the outcome","lgExpand",""],["formControlName","outcome_amount","lgParseMath","",3,"placeholder"],["formControlName","outcome_unit",3,"items"],["label","Ingredients","lgExpand",""],["formArrayName","ingredients","lgExpand",""],[3,"formGroupName"],[3,"click","size"],[3,"mobileMode"],[3,"size"],["label","Amount"],["lgParseMath","","formControlName","amount",3,"onKeydown","placeholder"],["formControlName","unit",3,"items"],["ngProjectAs","rowActions",5,["rowActions"]],["label","Name"],["ngProjectAs","endLabelTpl",5,["endLabelTpl"]],[3,"click"],["ngProjectAs","labelTpl",5,["labelTpl"]],[3,"click","ngClass"],["ngProjectAs","afterLabelTpl",5,["afterLabelTpl"]],["formControlName","recipe_id",3,"resource","autoLoad"],["formControlName","product_id",3,"resource","autoLoad"],["formControlName","recipe_id",3,"onSelected","resource","autoLoad"],["formControlName","product_id",3,"onSelected","resource","autoLoad"]],template:function(e,n){if(e&1){let i=C();r(0,"form",3)(1,"lg-gap-column",4)(2,"lg-control",5)(3,"lg-input",6),_("onInputChanged",function(){d(i);let f=I(6);return u(f.focus())}),l()(),r(4,"lg-control",7),y(5,"lg-textarea",8,0),l(),r(7,"lg-controls-row",9)(8,"lg-control",10),y(9,"lg-number-input",11,1),l(),y(11,"lg-buttons-group",12),l(),r(12,"lg-control-group",13)(13,"lg-gap-column",4)(14,"lg-gap-column",14),U(15,Qe,11,8,"ng-container",15,Oe),l(),r(17,"lg-button",16),_("click",function(){return d(i),u(n.addIngredient())}),m(18," Add Ingredient "),l()()(),R(19,qe,2,0,"lg-button")(20,He,2,0,"lg-button"),l()()}e&2&&(a("formGroup",n.form),c(),a("position","start"),c(2),a("placeholder","Your recipe name"),c(2),a("placeholder","Describe your recipe, how to make it, what to pay attention to, etc."),c(2),a("mobileMode",!0),c(2),a("placeholder",n.form.value.outcome_unit||"Here you can write the amount of the outcome (e.g. 100, 12, etc.)"),c(2),a("items",n.buttons),c(2),a("position","start"),c(2),Y(n.ingredients.controls),c(2),A("success"),a("size","small"),c(2),b(n.uuid()?19:20))},dependencies:[fe,se,ce,ae,pe,ue,me,de,ge,Ce,O,xe,j,ve,he,be,z,ye,ee,Se,Fe],encapsulation:2})};function Ke(o,t){if(o&1&&(r(0,"lg-button",2),m(1," Calculate "),l()),o&2){let e=s();A("primary"),a("flat",!0)("link","/calc-recipe/"+e.uuid())("size","small")}}var Ve=class o{constructor(t){this._aRoute=t}uuid=$("uuid");static \u0275fac=function(e){return new(e||o)(h(D))};static \u0275cmp=w({type:o,selectors:[["app-add-recipe"]],decls:9,vars:9,consts:[[3,"center","mobileMode"],[3,"flat","link","size","style"],[3,"flat","link","size"]],template:function(e,n){e&1&&(r(0,"lg-container")(1,"lg-gap-row",0)(2,"lg-title"),m(3),l(),R(4,Ke,2,5,"lg-button",1),r(5,"lg-button",2),m(6," Back to list "),l()(),r(7,"lg-card"),y(8,"lg-add-recipe-form"),l()()),e&2&&(c(),a("center",!0)("mobileMode",!0),c(2),M("",n.uuid()?"Edit":"Add"," Recipe"),c(),b(n.uuid()?4:-1),c(),A("warning"),a("flat",!0)("link","/recipes")("size","small"))},dependencies:[ie,oe,re,L,j,Ie],encapsulation:2})};export{Ve as AddRecipeComponent};
