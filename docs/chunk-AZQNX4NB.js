import{a as Ee}from"./chunk-OIBLLAAC.js";import{a as q,c as be,d as Pe,e as Se}from"./chunk-AY44UDQR.js";import{a as ye}from"./chunk-MN42LU3T.js";import{a as xe}from"./chunk-FPMFOF25.js";import{e as he}from"./chunk-NDH2T75U.js";import{a as Ce}from"./chunk-47737BAE.js";import{a as ve,b as we}from"./chunk-FNMHIIFF.js";import{b as _e}from"./chunk-VZQQYTJ7.js";import{a as ge}from"./chunk-G42TUXVK.js";import{b as fe}from"./chunk-RNBI2NK7.js";import{c as ee}from"./chunk-QL2JQFZX.js";import"./chunk-WPYBGKJW.js";import"./chunk-RFEBMF6P.js";import"./chunk-FG5PJ7WR.js";import{d as re,g as A,i as le,j as se,k as ae,l as S,n as ce,o as de,r as pe,u as me}from"./chunk-CXKCNMAZ.js";import{a as ue}from"./chunk-ZTZGKGRL.js";import{a as I}from"./chunk-JXYZKXYP.js";import{a as te,b as oe,c as ne}from"./chunk-L3VKWLRX.js";import{c as J,r as Z,t as $,x as ie}from"./chunk-O3EHXZ3L.js";import{$b as P,Ab as w,Ac as T,Bb as b,Bc as E,Cc as k,Gb as l,Hb as i,Ib as p,Mb as x,Pb as d,Qb as h,Rb as z,Sb as B,Ya as j,Za as r,Zb as M,_b as V,ac as v,cb as y,cc as K,hb as C,la as f,ma as _,sa as m,ub as a,vb as G,wb as F,xc as X}from"./chunk-46OIECST.js";var Fe=["element"],Me=["*",[["content"]]],Ve=["*","content"];function Te(n,e){if(n&1&&(l(0,"div",4,0),B(2,1),i(),p(3,"lg-portal",5)),n&2){let t=P(1),o=h();G("left",o.coordinates().x,"px")("top",o.coordinates().y,"px"),r(3),a("appendTarget","body")("targetElement",t)("wrapClass","tooltip")}}var R=class n{constructor(){}gap=E(16);displayed=m(!1);full=E(!1);position=E("top");element=k("element");onClose=T();coordinates=m({x:0,y:0});toggle(e){if(this.displayed.set(!this.displayed()),this.displayed()||this.onClose.emit(),e){e.stopPropagation();let[t,o]=[e.clientX,e.clientY];setTimeout(()=>{let c=(this.element()?.nativeElement).getBoundingClientRect(),u=c.width,D=c.height,U=window.innerWidth,Y=window.innerHeight,g=16,W=t,H=o;t+u+g>U&&(W=U-u-g),o+D+g>Y&&(H=Y-D-g),t-u-g<0&&(W=g),o-D-g<0&&(H=g),this.coordinates.set({x:W,y:H})})}}close(){this.displayed.set(!1),this.onClose.emit()}onClick(e){e.target instanceof HTMLElement&&(e.target.closest(".tooltip")||(this.displayed.set(!1),this.onClose.emit()))}onKeydown(e){e.key==="Escape"&&(this.displayed.set(!1),this.onClose.emit())}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=C({type:n,selectors:[["lg-tooltip"]],viewQuery:function(t,o){t&1&&M(o.element,Fe,5),t&2&&V()},hostBindings:function(t,o){t&1&&d("click",function(c){return o.onClick(c)},j)("keydown",function(c){return o.onKeydown(c)},j)},inputs:{gap:[1,"gap"],full:[1,"full"],position:[1,"position"]},outputs:{onClose:"onClose"},ngContentSelectors:Ve,decls:5,vars:6,consts:[["element",""],[1,"tooltip",3,"ngClass"],[1,"tooltip__anchor"],[3,"click"],[1,"tooltip__content"],[3,"appendTarget","targetElement","wrapClass"]],template:function(t,o){t&1&&(z(Me),l(0,"div",1)(1,"div",2)(2,"div",3),d("click",function(c){return o.toggle(c)}),B(3),i(),w(4,Te,4,7),i()()),t&2&&(G("--gap",o.gap(),"px"),F("fullscreen",o.full()),a("ngClass",o.position()),r(4),b(o.displayed()?4:-1))},dependencies:[J,ge],styles:[".tooltip[_ngcontent-%COMP%]{position:relative;display:inline-block}.tooltip__anchor[_ngcontent-%COMP%]{position:relative}.tooltip__content[_ngcontent-%COMP%]{position:absolute;background-color:#fff;border-radius:16px;padding:16px;box-shadow:0 4px 8px #0000001a;z-index:100}.tooltip.top[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%], .tooltip.bottom[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%]{bottom:calc(100% + var(--gap));right:50%;transform:translate(50%)}.tooltip.left[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%]{bottom:50%;right:calc(100% + var(--gap));transform:translateY(50%)}.tooltip.right[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%]{bottom:50%;left:calc(100% + var(--gap));transform:translateY(-50%)}.tooltip.fullscreen[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#fff;border-radius:0;padding:32px;transform:none;overflow-y:auto}"]})};function ke(n,e){if(n&1){let t=x();l(0,"div",3)(1,"lg-eggs-widget",4),d("changed",function(s){f(t);let c=h();return _(c.onEggsChanged(s))}),i()()}}var O=class n{constructor(){}eggsChanged=T();selectedWidget=m(null);onWidgetSelect(e){this.selectedWidget.set(e)}onEggsChanged(e){e&&this.eggsChanged.emit(e)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=C({type:n,selectors:[["lg-amount-widgets"]],outputs:{eggsChanged:"eggsChanged"},decls:5,vars:3,consts:[[1,"amount-widgets"],[1,"amount-widgets__buttons"],[1,"amount-widgets__button",3,"click"],[1,"amount-widgets__wrapper"],[3,"changed"]],template:function(t,o){t&1&&(l(0,"div",0)(1,"div",1)(2,"button",2),d("click",function(){return o.onWidgetSelect("eggs")}),v(3,"Eggs "),i()(),w(4,ke,2,0,"div",3),i()),t&2&&(F("selected",o.selectedWidget()!=null),r(4),b(o.selectedWidget()==="eggs"?4:-1))},dependencies:[Ee],styles:[".amount-widgets[_ngcontent-%COMP%]{display:flex;gap:16px;flex-direction:column}.amount-widgets__input[_ngcontent-%COMP%]{flex:1}.amount-widgets__buttons[_ngcontent-%COMP%]{display:flex;gap:16px;flex-wrap:wrap;padding:16px;background-color:#fafafa;border-radius:12px;margin:-16px}.amount-widgets.selected[_ngcontent-%COMP%]   .amount-widgets__buttons[_ngcontent-%COMP%]{margin-bottom:0}.amount-widgets__button[_ngcontent-%COMP%]{display:flex;padding:8px 16px;border-radius:16px;background-color:#e5de38;appearance:none;border:none;font-family:inherit;font-size:inherit}"]})};var Re=["nameField"];function Oe(n,e){if(n&1&&p(0,"lg-chips-list",21),n&2){let t=h(),o=P(27);a("control",o)("items",t.topCategories())}}function Ne(n,e){if(n&1){let t=x();l(0,"lg-button",25),d("click",function(){f(t);let s=h();return _(s.editProduct(s.value))}),v(1," Edit Product "),i()}}function De(n,e){if(n&1){let t=x();l(0,"lg-button",25),d("click",function(){f(t);let s=h();return _(s.addProduct(s.value))}),v(1," Add Product "),i()}}var N=class n{constructor(e,t,o,s){this._productsRepository=e;this._selectResourcesService=t;this._router=o;this._notificationsService=s}form=new ae({name:new S(null,A.required),amount:new S(null,A.required),price:new S(null,A.required),unit:new S("gram"),source:new S(null),category_id:new S(null,A.required)});buttons=[{label:"Grams",value:"gram",style:"secondary",onClick:()=>{console.log("Grams")}},{label:"Pieces",value:"piece",style:"secondary",onClick:()=>{console.log("Piece")}}];uuid=E("");topCategories=m([]);topSources=m([]);nameField=k("nameField");uuidEffect=X(()=>{this.uuid()&&this._productsRepository.getOne(this.uuid()).then(e=>{console.log({product:e}),this.form.reset(e)})});get value(){return this.form.value}get _defFormValue(){return{name:null,amount:null,price:null,source:null,category_id:null,unit:"gram"}}get _formValid(){return this.form.valid}eggsChanged(e){this.form.patchValue({amount:e})}ngOnInit(){this._loadUsingHistory()}addProduct(e){if(!this._formValid){this._notificationsService.error(this._notificationsService.parseFormErrors(this.form).join(", "));return}this._productsRepository.addProduct(q(e)).then(()=>{this.form.reset(this._defFormValue),this._notificationsService.success("Product added"),this._loadUsingHistory()})}editProduct(e){if(!this._formValid){this._notificationsService.error(this._notificationsService.parseFormErrors(this.form).join(", "));return}this._productsRepository.editProduct(this.uuid(),q(e)).then(()=>{this._notificationsService.success("Product edited"),this._loadUsingHistory()})}ngAfterViewInit(){this._selectResourcesService.load().then(e=>{}),this.nameField().focus()}_loadUsingHistory(){this._productsRepository.getTopCategories().then(e=>{this.topCategories.set(e.map(t=>({label:t.name,value:t.uuid})))}),this._productsRepository.getTopSources().then(e=>{this.topSources.set(e.map(t=>({label:t,value:t})))})}static \u0275fac=function(t){return new(t||n)(y(ee),y(Ce),y($),y(fe))};static \u0275cmp=C({type:n,selectors:[["lg-add-product-form"]],viewQuery:function(t,o){t&1&&M(o.nameField,Re,5),t&2&&V()},inputs:{uuid:[1,"uuid"]},decls:31,vars:17,consts:[["nameField",""],["priceInput",""],["sourceInput",""],["sourceChips",""],["categorySelect",""],[3,"formGroup"],["label","Name"],["formControlName","name",3,"key","resource"],[3,"bottom","mobileMode"],["label","Amount","lgExpand",""],["formControlName","amount","lgParseMath","",3,"onInputChange","placeholder"],["ngProjectAs","after",5,["after"]],[3,"position"],["ngProjectAs","content",5,["content"]],[3,"eggsChanged"],["formControlName","unit",3,"items"],["label","Price"],["formControlName","price","lgParseMath","",3,"placeholder"],["label","Source"],["formControlName","source",3,"onSelected","noLoad","resource"],[3,"hidden"],[3,"control","items"],["label","Category"],["formControlName","category_id",3,"resource"],["lgShrink",""],["lgShrink","",3,"click"]],template:function(t,o){if(t&1){let s=x();l(0,"form",5)(1,"lg-gap-column")(2,"lg-control",6),p(3,"lg-autocomplete",7,0),i(),l(5,"lg-gap-row",8)(6,"lg-control",9)(7,"lg-number-input",10),d("onInputChange",function(){f(s);let u=P(16);return _(u.focus())}),l(8,"div",11)(9,"lg-tooltip",12),v(10," Widgets "),l(11,"div",13)(12,"lg-amount-widgets",14),d("eggsChanged",function(u){return f(s),_(o.eggsChanged(u))}),i()()()()()(),p(13,"lg-buttons-group",15),i(),l(14,"lg-control",16),p(15,"lg-number-input",17,1),i(),l(17,"lg-gap-column")(18,"lg-control",18)(19,"lg-autocomplete",19,2),d("onSelected",function(){f(s);let u=P(23);return _(u.clearSelected())}),i()(),l(21,"div",20),p(22,"lg-chips-list",21,3),i()(),l(24,"lg-gap-column")(25,"lg-control",22),p(26,"lg-multiselect",23,4),i(),w(28,Oe,1,2,"lg-chips-list",21),i(),w(29,Ne,2,0,"lg-button",24)(30,De,2,0,"lg-button",24),i()()}if(t&2){let s=P(20);a("formGroup",o.form),r(3),a("key","name")("resource","products-names"),r(2),a("bottom",!0)("mobileMode",!0),r(2),a("placeholder","In "+o.form.value.unit),r(2),a("position","left"),r(4),a("items",o.buttons),r(2),a("placeholder","For the entire product in your currency"),r(4),a("noLoad",!0)("resource","sources"),r(2),a("hidden",!o.topSources().length),r(),a("control",s)("items",o.topSources()),r(4),a("resource","categories"),r(2),b(o.topCategories().length?28:-1),r(),b(o.uuid()?29:30)}},dependencies:[me,ce,le,se,de,pe,_e,ue,re,he,ve,R,O,we,I,be,ye,Pe,Se,xe],styles:[`lg-eggs-widget{min-width:300px}
`],encapsulation:2})};var Ae=class n{constructor(e){this._aRoute=e}uuid=m("");ngOnInit(){this._aRoute.params.subscribe(e=>{this.uuid.set(e.uuid)})}static \u0275fac=function(t){return new(t||n)(y(Z))};static \u0275cmp=C({type:n,selectors:[["app-add-recipe"]],decls:7,vars:3,consts:[[3,"center"],[3,"uuid"]],template:function(t,o){t&1&&(l(0,"lg-fade-in")(1,"lg-container")(2,"lg-gap-row",0)(3,"lg-title"),v(4),i()(),l(5,"lg-card"),p(6,"lg-add-product-form",1),i()()()),t&2&&(r(2),a("center",!0),r(2),K("",o.uuid()?"Edit":"Add"," Product"),r(2),a("uuid",o.uuid()))},dependencies:[te,oe,ne,N,I,ie],encapsulation:2})};export{Ae as AddProductComponent};
