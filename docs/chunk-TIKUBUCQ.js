import{a as de}from"./chunk-PM7YWHQO.js";import{a as pe}from"./chunk-WRGZH7UL.js";import{a as ne,b as re,c as oe}from"./chunk-QSVWUNKY.js";import{a as ae}from"./chunk-3QIAGCJF.js";import{a as ie}from"./chunk-PHGQT4GW.js";import{a as ce,b as le,c as ue}from"./chunk-IYLEDS7Q.js";import{a as me}from"./chunk-OW4OSQWU.js";import{a as se}from"./chunk-D6TZV7MY.js";import"./chunk-BDK6RPQ7.js";import"./chunk-I4TJ6JFG.js";import{b as Z}from"./chunk-CBJ5O2TR.js";import"./chunk-SCYWH7FS.js";import{a as te}from"./chunk-YSX2TPIK.js";import{a as B,c as ee}from"./chunk-UYEJDPNH.js";import"./chunk-JQ7DWKTJ.js";import"./chunk-DKKRBT3L.js";import"./chunk-P7L2C53Q.js";import"./chunk-5ZHT4QO7.js";import"./chunk-Z2KUFMIF.js";import{f as H,g as L,h as S,i as l,m as U,n as z,o as J,p as q,q as K,r as Q,s as Y}from"./chunk-TYLDJUNJ.js";import{z as X}from"./chunk-K7R7MOA3.js";import"./chunk-IZT3LVRQ.js";import{Ab as s,Bb as m,Cb as _,Db as V,Eb as M,Gb as W,Jb as u,Kb as p,Ta as n,V as b,Wb as T,Ya as y,Z as D,bb as F,db as k,fa as x,ga as f,gb as A,ma as w,ob as r,pb as N,qb as O,qc as P,rb as h,rc as $,ub as R,vb as E,vc as j,yb as I,zb as G}from"./chunk-PNZYYIKS.js";import"./chunk-DELOOZDJ.js";import{f as g}from"./chunk-2WH2EVR6.js";var c=class t{constructor(e){this.name=String(e.name).trim(),this.amount=parseFloat(String(e.amount)),this.percentage=e.percentage,this.description=String(e.description||"").trim(),this.items=e.items,this.uuid=e.uuid}name;amount;percentage;description;items;uuid;static fromRaw(e){debugger;return new t({name:e?.name||"",amount:e?.amount||0,percentage:e?.percentage||!1,description:e?.description||"",items:e?.items||[],uuid:e?.uuid||""})}static empty(){return new t({name:"",amount:0,percentage:!0,description:"",items:[],uuid:""})}update(e){return this.name=e.name||this.name,this.amount=e.amount||this.amount,this.percentage=e.percentage||this.percentage,this.description=e.description||this.description,this.items=e.items||this.items,this.uuid=e.uuid||this.uuid,this}toDTO(){return{name:this.name||"",amount:this.amount||0,percentage:this.percentage||!1,description:this.description||"",items:this.items||[],uuid:this.uuid||""}}};var ge=t=>t instanceof Error?t.message:typeof t=="string"?t:typeof t=="object"&&t!==null?JSON.stringify(t):"Unknown error";var C=class t{constructor(){}lgWidth=j(0);get maxWidth(){return this.lgWidth()}get flex(){return`1 0 ${this.lgWidth()}px`}static \u0275fac=function(i){return new(i||t)};static \u0275dir=k({type:t,selectors:[["","lgWidth",""]],hostVars:4,hostBindings:function(i,o){i&2&&N("max-width",o.maxWidth,"px")("flex",o.flex)},inputs:{lgWidth:[1,"lgWidth"]}})};var fe=t=>({name:t.name,description:t.description,amount:t.value,percentage:t.percentage,uuid:t.uuid});var v=class t{constructor(e){this._indexDbService=e}addOne(e){return this._indexDbService.addData("taxes",e.toDTO())}updateOne(e,i){return this._indexDbService.replaceData("taxes",e,i.toDTO())}getOne(e){return g(this,null,function*(){return new Promise((i,o)=>g(this,null,function*(){if(e=typeof e=="string"?e:e.uuid,!e){i(void 0);return}yield this._indexDbService.getOne("taxes",e).then(a=>{i(c.fromRaw(a))})}))})}getAll(){return this._indexDbService.getAll("taxes").then(e=>e.map(i=>c.fromRaw(i)))}addMany(e){return this._indexDbService.balkAdd("taxes",e.map(i=>i.toDTO()),!1)}deleteOne(e){return this._indexDbService.remove("taxes",e)}static \u0275fac=function(i){return new(i||t)(D(X))};static \u0275prov=b({token:t,factory:t.\u0275fac,providedIn:"root"})};var Te=(t,e)=>e.value.name+e.value.value;function Ce(t,e){if(t&1){let i=W();s(0,"section",5)(1,"div",6)(2,"lg-gap-row",7)(3,"lg-control",8),_(4,"lg-input",9),m(),s(5,"lg-control",8),_(6,"lg-textarea",10),m(),s(7,"lg-control",8)(8,"lg-checkbox",11),u("onCheckboxChanged",function(){x(i);let a=p().$index,d=p();return f(d.onTaxValueChange(a))}),m()(),s(9,"lg-control",12)(10,"lg-number-input",13),u("onInputChange",function(){x(i);let a=p().$index,d=p();return f(d.onTaxValueChange(a))}),m()(),s(11,"lg-button",14),u("click",function(){x(i);let a=p().$index,d=p();return f(d.deleteTxRow(a))}),_(12,"mat-icon",15),m()()()()}if(t&2){let i=p().$index;r("formGroupName",i),n(),O("taxes__row--odd",i%2!==0),n(),r("bottom",!0)("fit",!0),n(),r("label","Name"),n(),r("placeholder","Name"),n(),r("label","Description"),n(),r("rows",3)("placeholder","Description"),n(),r("label","Use percentage"),n(),r("customMark","%"),n(),r("label","Value")("lgWidth",200),n(),r("placeholder","Value"),n(),h("danger"),r("size","tiny")("icon",!0)}}function ve(t,e){t&1&&A(0,Ce,13,19,"ng-template",2)}function we(t,e){t&1&&T(0," Save changes ")}function ye(t,e){t&1&&T(0," No changes ")}var he=class t{constructor(e,i){this._taxesRepository=e;this._notificationService=i}taxes=w([]);rows=P(()=>this.taxes().map(e=>c.fromRaw(e)));taxesForm=new S({rows:new K([this._getRowGroup()])});rowsEffect=$(()=>{this._rowsFormArray.clear(),this.rows().forEach((e,i)=>{this._rowsFormArray.push(this._getRowGroup(e))}),this.taxesForm.updateValueAndValidity(),this.taxesForm.markAsPristine()});totalTaxes=w(0);formValues=this.taxesForm.valueChanges.pipe(ae());get _rowsFormArray(){return this.taxesForm.get("rows")}ngOnInit(){this._taxesRepository.getAll().then(e=>{this.taxes.set(e)})}onTaxValueChange(e){}deleteTxRow(e){let i=this.taxesForm.value.rows?.[e]?.uuid;this._rowsFormArray.removeAt(e),this.taxesForm.markAsDirty(),i&&this._taxesRepository.deleteOne(i)}addTaxRow(){this._rowsFormArray.push(this._getRowGroup()),this.taxesForm.markAsDirty()}saveTaxes(){return g(this,null,function*(){try{let e=this.taxesForm.value.rows?.map(i=>c.fromRaw(fe(i)))??[];yield this._taxesRepository.addMany(e),this._notificationService.success("Taxes saved successfully"),this.taxesForm.markAsPristine()}catch(e){this._notificationService.error(ge(e))}})}_getRowGroup(e){return new S({name:new l(e?.name||""),description:new l(e?.description||""),value:new l(e?.amount||0),amount:new l(0),percentage:new l(e?.percentage||!1),uuid:new l(e?.uuid||"")})}static \u0275fac=function(i){return new(i||t)(y(v),y(Z))};static \u0275cmp=F({type:t,selectors:[["lg-backup-settings"]],decls:11,vars:7,consts:[[3,"formGroup"],["formArrayName","rows"],["lgCardListItem",""],["lgSelfCenter","","lgShrink","",3,"click","disabled"],["lgSelfCenter","","lgShrink","",3,"click"],[1,"taxes",3,"formGroupName"],[1,"taxes__row"],[3,"bottom","fit"],[3,"label"],["formControlName","name",3,"placeholder"],["formControlName","description",3,"rows","placeholder"],["formControlName","percentage",3,"onCheckboxChanged","customMark"],[3,"label","lgWidth"],["lgParseMath","","formControlName","value",3,"onInputChange","placeholder"],["lgSelfCenter","","lgShrink","",3,"click","size","icon"],["aria-hidden","false","aria-label","Example home icon","fontIcon","close"]],template:function(i,o){i&1&&(s(0,"lg-container")(1,"lg-card-list",0),V(2,1),I(3,ve,1,0,null,2,Te),M(),m(),s(5,"lg-gap-row")(6,"lg-button",3),u("click",function(){return o.saveTaxes()}),R(7,we,1,0)(8,ye,1,0),m(),s(9,"lg-button",4),u("click",function(){return o.addTaxRow()}),T(10," Add tax "),m()()()),i&2&&(n(),r("formGroup",o.taxesForm),n(2),G(o.taxesForm.controls.rows.controls),n(3),h("success"),r("disabled",!o.taxesForm.dirty),n(),E(o.taxesForm.dirty?7:8),n(2),h("warning"))},dependencies:[ee,re,Q,H,L,te,B,oe,ne,me,se,ie,ce,le,Y,U,q,z,J,de,ue,pe,C],encapsulation:2})};export{he as TaxesSettingsComponent};
