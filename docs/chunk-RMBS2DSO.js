import{B as m,d as h}from"./chunk-DGKRNV7D.js";import{$ as p,ca as u,da as c,ea as f,g as d,q as a}from"./chunk-TMZLFVGH.js";import{a as l,b as g}from"./chunk-C6Q5SG76.js";var T=new u("UserLanguage");var D=class s{constructor(e,i){this._http=e;this._indexedDB=i}orderTitles={"getting-started":1,invoices:4,settings:5,recipes:3,storage:2};_userLang=f(T);docs$=new d([]);tree$=new d([]);async init(){try{let e=await a(this._http.get("./docs/meta.json")),o=(await this._indexedDB.getAll("documentation"))?.find(t=>t.key==="meta")?.value;if(!o||new Date(e.updatedAt)>new Date(o.updatedAt)){let[t,n]=await Promise.all([a(this._http.get("./docs/data.json")),a(this._http.get("./docs/tree.json"))]);await this._indexedDB.balkAdd("documentation",[{key:"meta",value:e},{key:"data",value:t},{key:"tree",value:n}]),this.docs$.next(t),this.tree$.next(n)}else{let t=await this._getStoredDocs();this.tree$.next(t.tree),this.docs$.next(t.docs)}}catch(e){throw new Error(`Failed to initialize docs service: ${e}`)}}filterLanguage(e,i){if(e.language&&e.language!==i)return null;if(e.type==="file")return e;let o=(e.children||[]).reduce((r,t)=>{let n=this.filterLanguage(t,i);return n&&r.push(n),r},[]);return o.length>0?g(l({},e),{children:o.toSorted((r,t)=>(r.order||0)-(t.order||0))}):null}getDocs(){return this.docs$.asObservable()}getTree(){return this.tree$.asObservable()}async getDocByPath(e){}async _getStoredDocs(){let e=await this._indexedDB.getAll("documentation"),i=(e?.find(r=>r.key==="tree")?.value.reduce((r,t)=>{let n=this.filterLanguage(t,this._userLang());return n&&r.push(n),r},[])||[]).toSorted((r,t)=>(this.orderTitles[r.name||""]||0)-(this.orderTitles[t.name||""]||0)),o=e?.find(r=>r.key==="data")?.value;return{tree:i,docs:o}}static \u0275fac=function(i){return new(i||s)(c(h),c(m))};static \u0275prov=p({token:s,factory:s.\u0275fac,providedIn:"root"})};export{T as a,D as b};
