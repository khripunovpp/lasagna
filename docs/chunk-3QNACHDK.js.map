{
  "version": 3,
  "sources": ["src/app/features/settings/view/categories/category-product/add-category/add-category-form.component.ts"],
  "sourcesContent": ["import {Component, DestroyRef, effect, EventEmitter, inject, input, OnInit, Output, signal} from '@angular/core';\nimport {FormControl, FormGroup, ReactiveFormsModule, Validators} from '@angular/forms';\nimport {ControlComponent} from '../../../../../controls/form/control-item/control.component';\nimport {InputComponent} from '../../../../../controls/form/input.component';\nimport {ButtonComponent} from '../../../../../../shared/view/ui/button/button.component';\nimport {FlexRowComponent} from '../../../../../../shared/view/layout/flex-row.component';\nimport {ExpandDirective} from '../../../../../../shared/view/directives/expand.directive';\nimport {NoWrapDirective} from '../../../../../../shared/view/directives/no-wrap.directive';\nimport {CategoryProductsRepository} from '../../../../../../shared/service/repositories';\nimport {NotificationsService} from '../../../../../../shared/service/services';\nimport {CategoryProduct} from '../../../../service/models/CategoryProduct';\nimport {\n  categoryProductDTOFromFormValue,\n  categoryProductToFormValue,\n  errorHandler\n} from '../../../../../../shared/helpers';\nimport {TranslatePipe} from '@ngx-translate/core';\nimport {takeUntilDestroyed} from '@angular/core/rxjs-interop';\nimport {FadeInComponent} from '../../../../../../shared/view/ui/fade-in.component';\nimport {FlexColumnComponent} from '../../../../../../shared/view/layout/flex-column.component';\nimport {matchMediaSignal} from '../../../../../../shared/view/signals/match-media.signal';\nimport {mobileBreakpoint} from '../../../../../../shared/view/const/breakpoints';\n\n@Component({\n  selector: 'lg-add-category-form',\n  standalone: true,\n  template: `\n    <lg-fade-in>\n      <lg-flex-column [size]=\"'small'\">\n        <div class=\"text-small\">{{ 'categories.add-recipe' | translate }}</div>\n\n        <form [formGroup]=\"form\">\n          <lg-flex-row [bottom]=\"true\"\n                       [size]=\"'medium'\">\n            <lg-control lgExpand>\n              <lg-input (onEnter)=\"onEnter()\"\n                        [placeholder]=\"'settings.category.placeholder' | translate\"\n                        [size]=\"isMobile() ? 'small' : 'normal'\"\n                        formControlName=\"name\"></lg-input>\n            </lg-control>\n\n            <div lgNoWrap>\n              @if (uuid()) {\n                <lg-button [disabled]=\"!form.dirty\"\n                           [style]=\"'primary'\"\n                           [size]=\"isMobile() ? 'small' : 'regular'\"\n                           (click)=\"editCategory()\">\n                  @if (form.dirty) {\n                    {{ 'settings.category.save' | translate }}\n                  } @else {\n                    {{ 'settings.category.no-changes' | translate }}\n                  }\n                </lg-button>\n              } @else {\n                <lg-button [disabled]=\"!form.dirty\"\n                           [style]=\"'primary'\"\n                           [size]=\"isMobile() ? 'small' : 'regular'\"\n                           (click)=\"addCategory()\">\n                  @if (form.dirty) {\n                    {{ 'settings.category.add' | translate }}\n                  } @else {\n                    {{ 'settings.category.enter-name' | translate }}\n                  }\n                </lg-button>\n              }</div>\n          </lg-flex-row>\n        </form>\n      </lg-flex-column>\n    </lg-fade-in>\n  `,\n  imports: [\n    ReactiveFormsModule,\n    InputComponent,\n    ControlComponent,\n    ButtonComponent,\n    FlexRowComponent,\n    ExpandDirective,\n    NoWrapDirective,\n    TranslatePipe,\n    FadeInComponent,\n    FlexColumnComponent\n  ],\n  styles: [\n    `\n    `\n  ],\n})\nexport class AddCategoryFormComponent\n  implements OnInit {\n  constructor(\n    public _categoryRepository: CategoryProductsRepository,\n    private _notificationsService: NotificationsService,\n  ) {\n  }\n\n  isMobile = matchMediaSignal(mobileBreakpoint);\n  form = new FormGroup({\n    name: new FormControl('', Validators.required),\n  });\n  category = signal<CategoryProduct | undefined>(undefined);\n  uuid = input<string>('');\n  @Output() onSaved = new EventEmitter<string>();\n  private uuidEffect = effect(() => {\n    if (!this.uuid()) {\n      this.category.set(CategoryProduct.empty());\n      return;\n    }\n    this._categoryRepository.getOne(this.uuid())\n      .then(category => {\n        this.reset(category);\n      })\n      .catch(error => {\n        this._notificationsService.error(errorHandler(error));\n      });\n  });\n  private readonly _destroyRef = inject(DestroyRef);\n\n  reset(\n    category: CategoryProduct,\n  ) {\n    this.form.reset(categoryProductToFormValue(category));\n    this.category.set(category);\n    this.form.markAsPristine();\n  }\n\n  ngOnInit() {\n    this.form.valueChanges.pipe(\n      takeUntilDestroyed(this._destroyRef),\n    ).subscribe(values => {\n      this.category()?.update(categoryProductDTOFromFormValue(values));\n    })\n  }\n\n  addCategory() {\n    if (!this.category() || !this.form.dirty) {\n      return Promise.resolve();\n    }\n\n    return this._categoryRepository.addOne(this.category()!)\n      .then(() => {\n        this.onSaved.emit(this.uuid());\n        this.form.reset({\n          name: '',\n        });\n        this._notificationsService.success('settings.category.added');\n        this.form.markAsPristine();\n        this._categoryRepository.loadAll();\n      })\n      .catch(error => {\n        this._notificationsService.error(errorHandler(error));\n      });\n  }\n\n  editCategory() {\n    if (!this.category() || !this.form.dirty) {\n      return Promise.resolve();\n    }\n\n    return this._categoryRepository.updateOne(this.uuid(), this.category()!)\n      .then(() => {\n        this.onSaved.emit(this.uuid());\n        this.form.reset({\n          name: '',\n        });\n        this._notificationsService.success('settings.category.edited');\n        this.form.markAsPristine();\n        this._categoryRepository.loadAll();\n      })\n      .catch(error => {\n        this._notificationsService.error(errorHandler(error));\n      });\n  }\n\n  onEnter() {\n    if (this.uuid()) {\n      this.editCategory();\n    } else {\n      this.addCategory();\n    }\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
