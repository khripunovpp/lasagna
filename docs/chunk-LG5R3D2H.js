import{a as oe,b as ne,c as re,d as ce,e as ae,f as pe}from"./chunk-BXFYC4PP.js";import{a as ee,c as te}from"./chunk-6JHNEPZF.js";import{a as Y}from"./chunk-DA2HX24K.js";import{b as ie}from"./chunk-EURMNGHK.js";import{a as le}from"./chunk-MNN7Q45Z.js";import"./chunk-FXU5CNHZ.js";import{a as F,b as H,c as L}from"./chunk-B3EIBHPV.js";import{a as J}from"./chunk-42PC7HUI.js";import"./chunk-C2HXCXZW.js";import"./chunk-QE7K5G3A.js";import"./chunk-ZUL4ERHZ.js";import{a as q,d as X}from"./chunk-O7XKGAI7.js";import"./chunk-BBFZC3NA.js";import{a as W}from"./chunk-YBQWK7UJ.js";import{a as K,c as Q}from"./chunk-SPWCQEFX.js";import{Ba as S,Ea as C,Fa as x,Ga as z,I as M,Ia as b,Ja as h,Ka as r,La as c,Ma as j,P as N,Qa as I,R as u,Ra as v,Rb as U,Sa as s,V as _,W as f,bb as T,bc as B,cb as a,db as w,eb as d,f as O,fb as k,ka as o,n as V,na as g,pa as $,pb as Z,r as E,rb as G,s as A,ta as D,ya as l}from"./chunk-2LMMMB25.js";var se=new N("CategorizedProductsList",{factory:()=>{let t=u(L),i=u(J);return V(t.loadRecipes()).pipe(M(()=>t.products$)).pipe(E(n=>n.toSorted((p,m)=>p.name.localeCompare(m.name))),E(n=>ce(n,"category_id")),A(n=>O(void 0,null,function*(){let p=[];for(let y in n){let R=n[y],de=yield i.getOne(y);p.push({category:de?.name,products:R})}if(!p.length)return[];let[m,...P]=p.toSorted((y,R)=>y.category>R.category?1:-1);return m?.category?[m].concat(P):P.concat([m])})))}});var ue=(t,i)=>i==null?null:i.category;function _e(t,i){if(t&1&&(r(0,"span"),a(1),c()),t&2){let e=s(2).$implicit;o(),d("from ",e.source)}}function fe(t,i){if(t&1&&(r(0,"span"),a(1),c(),r(2,"span"),a(3),c(),C(4,_e,2,1,"span")),t&2){let e=s().$implicit;o(),w(e.name),o(2),k("",e.amount,"gr for ",e.price),o(),x(e.source?4:-1)}}function ge(t,i){if(t&1&&(r(0,"span"),a(1),c()),t&2){let e=s(2).$implicit;o(),d("from ",e==null?null:e.source)}}function Ce(t,i){if(t&1&&(r(0,"span"),a(1),c(),r(2,"span"),a(3),c(),C(4,ge,2,1,"span")),t&2){let e=s().$implicit;o(),w(e==null?null:e.name),o(2),k("",e==null?null:e.amount," gr for ",e==null?null:e.price),o(),x(e!=null&&e.source?4:-1)}}function xe(t,i){if(t&1&&C(0,fe,5,4)(1,Ce,5,4),t&2){let e=i.flow;x(e==="new"?0:1)}}function ve(t,i){t&1&&a(0," per gram ")}function Pe(t,i){if(t&1&&a(0),t&2){let e=s(2).$implicit;d(" per ",e.unit," ")}}function ye(t,i){if(t&1){let e=I();r(0,"lg-gap-row",1)(1,"div",9)(2,"lg-gap-row",1)(3,"div",10)(4,"a",11),a(5),c()(),r(6,"div",12),a(7),c(),r(8,"div",13),a(9),Z(10,"number"),C(11,ve,1,0)(12,Pe,1,1),c()()(),r(13,"lg-button",14),v("click",function(){_(e);let p=s().$implicit,m=s(2);return f(m.deleteProduct(p))}),j(14,"mat-icon",15),c()()}if(t&2){let e=s().$implicit,n=s(2);l("center",!0),o(2),l("center",!0),o(2),l("routerLink","/products/edit/"+e.uuid),o(),w(e.name),o(2),d(" ",e.source??""),o(2),d(" ",G(10,11,n.getPricePerGram(e),"1.2-5")," "),o(2),x(!e.unit||e.unit==="gram"?11:12),o(2),S("danger"),l("size","small")("icon",!0)}}function Se(t,i){if(t&1&&D(0,ye,15,14,"ng-template",8),t&2){let e=i.$implicit;l("uuid",e.uuid)}}function Ie(t,i){if(t&1){let e=I();r(0,"lg-title",6),a(1),c(),r(2,"lg-card-list",7),v("onSelected",function(p){_(e),s();let m=T(11);return f(m.putSelected(p))}),b(3,Se,1,1,null,8,z),c()}if(t&2){let e=i.$implicit;s();let n=T(11);l("level",3),o(),d(" ",(e==null?null:e.category)||"Uncategorized"," "),o(),l("mode",n.selectionMode())("selectAll",n.selectAll())("deselectAll",n.deselectAll()),o(),h(e.products)}}function Te(t,i){t&1&&(r(0,"lg-gap-row",1)(1,"lg-title",6),a(2," No products found "),c()()),t&2&&(l("center",!0),o(),l("level",5))}var me=class t{constructor(i,e,n,p){this._productsRepository=i;this._csvReaderService=e;this._transferDataService=n;this._notificationsService=p}products=ie(u(se));ProductDbInputScheme=H;Stores=q;getPricePerGram(i){return(F(i.price)||1)/(F(i.amount)||1)}exportProducts(i){this._transferDataService.exportTable("productsStore","json",{selected:Array.from(i)})}deleteProduct(i){i.uuid&&this._productsRepository.deleteProduct(i.uuid).then(()=>{this._notificationsService.success("Product deleted"),this.loadProducts()})}ngOnInit(){this.loadProducts()}loadProducts(){this._productsRepository.loadRecipes()}static \u0275fac=function(e){return new(e||t)(g(L),g(ne),g(pe),g(le))};static \u0275cmp=$({type:t,selectors:[["lg-product-list"]],decls:15,vars:13,consts:[["selectionZone",""],[3,"center"],[3,"flat","link","size"],[3,"click","flat","size"],[3,"onDone","schema","storeName"],["lgImportRowTpl",""],[3,"level"],[3,"onSelected","mode","selectAll","deselectAll"],["lgCardListItem","",3,"uuid"],[1,"expand"],[2,"flex","20%"],[3,"routerLink"],[2,"flex","10%"],[2,"flex","70%"],[3,"click","size","icon"],["aria-hidden","false","aria-label","Example home icon","fontIcon","close"]],template:function(e,n){if(e&1){let p=I();r(0,"lg-container")(1,"lg-title"),a(2," Products "),c(),r(3,"lg-gap-row",1)(4,"lg-button",2),a(5," Add "),c(),r(6,"lg-button",3),v("click",function(){_(p);let P=T(11);return f(n.exportProducts(P.selected()))}),a(7," Export "),c(),r(8,"lg-import",4),v("onDone",function(){return _(p),f(n.loadProducts())}),D(9,xe,2,1,"ng-template",5),c()(),r(10,"lg-selection-zone",null,0),b(12,Ie,5,5,null,null,ue,!1,Te,3,2,"lg-gap-row",1),c()()}e&2&&(o(3),l("center",!0),o(),S("primary"),l("flat",!0)("link","/products/add")("size","small"),o(2),S("info"),l("flat",!0)("size","small"),o(2),l("schema",n.ProductDbInputScheme)("storeName",n.Stores.PRODUCTS),o(4),h(n.products()))},dependencies:[W,X,Y,K,Q,U,te,ee,re,B,oe,ae],styles:["[_nghost-%COMP%]{display:block}"]})};export{me as ProductListComponent};
