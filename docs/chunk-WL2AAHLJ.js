import{a as me,b as ue,c as fe,d as ge,e as Ce,h as xe}from"./chunk-GED7GUSS.js";import"./chunk-SBEFIX5R.js";import{a as _e}from"./chunk-PRC2TUST.js";import{a as le}from"./chunk-HE3R4OYU.js";import{a as pe,c as de}from"./chunk-MY6KHXHO.js";import{b as se}from"./chunk-XWIK56RR.js";import"./chunk-HHXJ7M2I.js";import{a as ne}from"./chunk-VVO2QOJB.js";import{a as ve}from"./chunk-W7F36SB2.js";import{a as ae}from"./chunk-R3RPCOKV.js";import{a as ce}from"./chunk-6T67R27S.js";import"./chunk-HMU5FZIU.js";import"./chunk-O7M42S4C.js";import{a as te,b as re}from"./chunk-WR2UF3SH.js";import{a as oe}from"./chunk-ALZEZ7BP.js";import{a as ie}from"./chunk-BC325NGK.js";import"./chunk-SNDQO5FA.js";import{f as W,j as X,n as A,o as ee,p as R}from"./chunk-CB3MWB2Z.js";import{b as K}from"./chunk-M3F6BOZF.js";import"./chunk-5KSZNU56.js";import"./chunk-L3DC7GP3.js";import"./chunk-WZGWS77O.js";import{u as Y}from"./chunk-ODQSNCKZ.js";import"./chunk-2SYRDFEF.js";import{s as H,w as J}from"./chunk-UQJ3VPU4.js";import"./chunk-652DFWNF.js";import{k as q}from"./chunk-QHW4G2KK.js";import{$ as S,$b as _,Ab as b,Bb as E,Cb as r,Db as l,Eb as L,Ib as w,Lb as g,Mb as d,R as M,Va as o,Yb as p,Z as V,Zb as F,_a as C,_b as f,db as z,dc as U,ec as G,ga as P,ha as y,ib as T,jc as s,k as Z,kc as u,lc as Q,na as j,q as k,qb as c,s as $,tb as I,wb as x,xb as v,yb as N}from"./chunk-VF5EQBCE.js";import"./chunk-DELOOZDJ.js";import{f as O}from"./chunk-2WH2EVR6.js";var Se=new V("CategorizedProductsList",{factory:()=>{let t=S(R),i=S(K);return Z(t.loadAll()).pipe(M(()=>t.products$)).pipe(k(n=>n.toSorted((a,m)=>a.name.localeCompare(m.name))),k(n=>_e(n,"category_id")),$(n=>O(void 0,null,function*(){let a=[];for(let D in n){let h=n[D],ye=yield i.getOne(D);a.push({category:ye?.name,products:h})}if(!a.length)return[];let[m,...B]=a.toSorted((D,h)=>D.category>h.category?1:-1);return m?.category?[m].concat(B):B.concat([m])})))}});var Te=()=>["draft","product"],Ie=(t,i)=>i.uuid,Le=(t,i)=>i==null?null:i.uuid;function we(t,i){t&1&&(r(0,"lg-button",7),L(1,"mat-icon",8),l()),t&2&&(I("success"),c("icon",!0)("link","/products/add")("size","medium"))}function De(t,i){if(t&1&&(r(0,"span"),p(1),s(2,"translate"),l()),t&2){let e=d(2).$implicit;o(),_("",u(2,2,"from-location")," ",e.source)}}function be(t,i){if(t&1&&(r(0,"span"),p(1),l(),r(2,"span"),p(3),l(),x(4,De,3,4,"span")),t&2){let e=d().$implicit;o(),F(e.name),o(2),_("",e.amount,"gr for ",e.price),o(),v(e.source?4:-1)}}function Ee(t,i){if(t&1&&(r(0,"span"),p(1),s(2,"translate"),l()),t&2){let e=d(2).$implicit;o(),_("",u(2,2,"from-location")," ",e==null?null:e.source)}}function Ae(t,i){if(t&1&&(r(0,"span"),p(1),l(),r(2,"span"),p(3),l(),x(4,Ee,3,4,"span")),t&2){let e=d().$implicit;o(),F(e==null?null:e.name),o(2),_("",e==null?null:e.amount," gr for ",e==null?null:e.price),o(),v(e!=null&&e.source?4:-1)}}function Re(t,i){if(t&1&&x(0,be,5,4)(1,Ae,5,4),t&2){let e=i.flow;v(e==="new"?0:1)}}function he(t,i){t&1&&(p(0),s(1,"translate")),t&2&&f(" ",u(1,1,"draft.list-prefix.existing")," ")}function ke(t,i){t&1&&(p(0),s(1,"translate")),t&2&&f(" ",u(1,1,"draft.list-prefix.new")," ")}function Fe(t,i){if(t&1){let e=w();r(0,"lg-gap-row",6)(1,"a",11),x(2,he,2,3)(3,ke,2,3),p(4),l(),r(5,"small",12),p(6),s(7,"translate"),s(8,"timeAgo"),l(),r(9,"lg-button",13),g("click",function(){P(e);let a=d().$implicit,m=d(2);return y(m.deleteDraft(a))}),L(10,"mat-icon",14),l()()}if(t&2){let e=d().$implicit;c("center",!0),o(),c("routerLink","/products/draft/"+(e==null?null:e.uuid)),o(),v(!(e==null||e.meta==null)&&e.meta.uuid?2:3),o(2),f(" ",(e==null||e.data==null?null:e.data.name)||"Unknown"," "),o(2),_(" ",u(7,10,"edited-at-label")," ",u(8,12,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," "),o(3),I("danger"),c("size","tiny")("icon",!0)}}function Be(t,i){if(t&1&&T(0,Fe,11,14,"ng-template",10),t&2){let e=i.$implicit;c("uuid",e.uuid)}}function Oe(t,i){if(t&1){let e=w();r(0,"lg-card-list",9),g("onSelected",function(a){P(e);let m=d();return y(m.selectionZoneService.putSelected(a))}),b(1,Be,1,1,null,10,Ie),l()}if(t&2){let e=d();c("mode",e.selectionZoneService.selectionMode())("selectAll",e.selectionZoneService.selectAll().draft)("deselectAll",e.selectionZoneService.deselectAll().draft),o(),E(e.draft())}}function Ze(t,i){if(t&1){let e=w();r(0,"lg-gap-row",6)(1,"div",18)(2,"lg-gap-row",6)(3,"lg-gap-row",19)(4,"a",20),p(5),l(),r(6,"div"),p(7),s(8,"number"),l()(),r(9,"small",21),p(10),s(11,"translate"),s(12,"timeAgo"),l()()(),r(13,"lg-button",13),g("click",function(){P(e);let a=d().$implicit,m=d(2);return y(m.deleteProduct(a))}),L(14,"mat-icon",14),l()()}if(t&2){let e=d().$implicit;c("center",!0),o(2),c("center",!0),o(),c("center",!0),o(),c("routerLink","/products/edit/"+e.uuid),o(),_(" ",e.name," ",e.source?"- "+e.source:""," "),o(2),_(" ",Q(8,14,e.pricePerUnit,"1.2-5")," ",e.perUnitLabel," "),o(3),_(" ",u(11,17,"edited-at-label")," ",u(12,19,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," "),o(3),I("danger"),c("size","tiny")("icon",!0)}}function $e(t,i){if(t&1&&T(0,Ze,15,21,"ng-template",17),t&2){let e=i.$implicit;c("uuid",e.uuid)}}function Me(t,i){if(t&1){let e=w();r(0,"lg-title",15),p(1),s(2,"translate"),l(),r(3,"lg-card-list",16),g("onSelected",function(a){P(e);let m=d();return y(m.selectionZoneService.putSelected(a))}),b(4,$e,1,1,null,17,Le),l()}if(t&2){let e=i.$implicit,n=d();c("level",3),o(),f(" ",(e==null?null:e.category)||u(2,5,"without-category-label")," "),o(2),c("mode",n.selectionZoneService.selectionMode())("selectAll",n.selectionZoneService.selectAll().product)("deselectAll",n.selectionZoneService.deselectAll().product),o(),E(e.products)}}function Ve(t,i){t&1&&(r(0,"lg-gap-row",6)(1,"lg-title",15),p(2),s(3,"translate"),l()()),t&2&&(c("center",!0),o(),c("level",5),o(),f(" ",u(3,3,"no-products")," "))}var Pe=class t{constructor(i,e,n,a,m){this._productsRepository=i;this._csvReaderService=e;this._transferDataService=n;this._notificationsService=a;this.selectionZoneService=m}products=se(S(Se));draft=j([]);ProductDbInputScheme=xe;Stores=J;exportProducts(i){this._transferDataService.exportTable("productsStore","json",{selected:Array.from(i??[])})}deleteProduct(i){i.uuid&&this._productsRepository.deleteProduct(i.uuid).then(()=>{this._notificationsService.success("Product deleted"),this.loadProducts()})}deleteDraft(i){this._productsRepository.removeDraftProduct(i.uuid),this.draft.update(e=>e.filter(n=>n?.uuid!==i.uuid))}ngOnInit(){this.loadProducts();let i=this._productsRepository.getDraftProducts();i&&this.draft.set(i)}loadProducts(){this._productsRepository.loadAll()}static \u0275fac=function(e){return new(e||t)(C(R),C(W),C(ee),C(Y),C(A))};static \u0275cmp=z({type:t,selectors:[["lg-product-list"]],features:[U([A])],decls:18,vars:19,consts:[["lgQuickActionsTpl",""],[3,"selectionTypes"],[3,"click","flat","size"],[3,"onDone","label","schema","storeName"],["lgImportRowTpl",""],[2,"--card-bg","#bee5ff",3,"mode","selectAll","deselectAll"],[3,"center"],[3,"icon","link","size"],["aria-hidden","false","fontIcon","add"],[2,"--card-bg","#bee5ff",3,"onSelected","mode","selectAll","deselectAll"],["lgCardListItem","","type","draft",3,"uuid"],["lgExpand","",3,"routerLink"],["lgPull","",1,"text-muted","text-cursive"],[3,"click","size","icon"],["aria-hidden","false","fontIcon","close"],[3,"level"],[3,"onSelected","mode","selectAll","deselectAll"],["lgCardListItem","","type","product",3,"uuid"],[1,"expand"],["lgExpand","",3,"center"],[3,"routerLink"],[1,"text-muted","text-cursive"]],template:function(e,n){if(e&1&&(r(0,"lg-controls-bar"),T(1,we,2,5,"ng-template",0),L(2,"lg-selection-tools",1),r(3,"lg-button",2),g("click",function(){return n.exportProducts(n.selectionZoneService.selected().product)}),p(4),s(5,"translate"),l(),r(6,"lg-import",3),s(7,"translate"),g("onDone",function(){return n.loadProducts()}),T(8,Re,2,1,"ng-template",4),l()(),r(9,"lg-fade-in")(10,"lg-container")(11,"lg-title"),p(12),s(13,"translate"),l(),x(14,Oe,3,3,"lg-card-list",5),b(15,Me,6,7,null,null,N,!1,Ve,4,5,"lg-gap-row",6),l()()),e&2){let a;o(2),c("selectionTypes",G(18,Te)),o(),I("info"),c("flat",!0)("size","small"),o(),f(" ",u(5,12,"export-label")," products "),o(2),c("label",u(7,14,"import-label")+" products")("schema",n.ProductDbInputScheme)("storeName",n.Stores.PRODUCTS),o(6),f(" ",u(13,16,"products.list-title")," "),o(2),v((a=n.draft())!=null&&a.length?14:-1),o(),E(n.products())}},dependencies:[re,ce,ae,te,ie,q,de,pe,ue,H,me,oe,ge,fe,Ce,ne,ve,le,X],styles:["[_nghost-%COMP%]{display:block}"]})};export{Pe as ProductListComponent};
