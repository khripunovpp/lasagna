import{a as Re}from"./chunk-ZUQV6MUV.js";import{a as q,c as xe,d as Se,e as Te}from"./chunk-3DG2TKHX.js";import{a as Pe}from"./chunk-3AU4JWYB.js";import{a as Me}from"./chunk-XMJFHZKM.js";import{e as we}from"./chunk-X7B5YFHF.js";import{a as ye}from"./chunk-ATDP5PY5.js";import{a as be,b as Ee}from"./chunk-XEEO3NY2.js";import{b as ve}from"./chunk-HWJHNQRN.js";import{a as he}from"./chunk-B4GE2TBC.js";import"./chunk-CEEQQY3I.js";import{c as re}from"./chunk-E2BQUR23.js";import"./chunk-BO7SREKA.js";import"./chunk-RKFCCI7E.js";import{c as T,e as ce,f as de,g as me,h as E,j as ue,k as ge,n as fe,q as Ce}from"./chunk-MQ26JLPX.js";import"./chunk-KPGIGGUF.js";import{d as I}from"./chunk-NQH67WTM.js";import{a as _e}from"./chunk-FTNH4PRO.js";import{a as A}from"./chunk-PFLOR5BA.js";import{a as le,b as se,c as ae}from"./chunk-42ANHTC5.js";import{b as oe,p as ne,r as ie,v as pe}from"./chunk-2WRE22FH.js";import{$a as K,Ac as te,Eb as l,Fb as i,Gb as d,Kb as x,Nb as c,Ob as y,Pb as X,Qb as L,Wa as G,Xa as r,Xb as J,Yb as Z,Zb as P,_b as C,ab as u,ac as $,fb as g,ka as h,la as v,ra as m,sb as s,tb as B,ub as M,vb as Q,vc as ee,xa as Y,yb as w,yc as R,zb as b,zc as S}from"./chunk-7IKCFNVS.js";var k=class n{constructor(e,t){this.renderer=e;this._elementRef=t}targetElement;appendTarget="";wrapClass="";portalContainer;get _appendTarget(){return this.appendTarget?this.appendTarget==="body"?document.body:this.appendTarget:this._elementRef.nativeElement}ngAfterViewInit(){this.portalContainer=this.renderer.createElement("div"),this.renderer.appendChild(this._appendTarget,this.portalContainer),this.targetElement&&(this.wrapClass&&this.wrapClass.split(" ").forEach(t=>this.renderer.addClass(this.portalContainer,t)),this.renderer.appendChild(this.portalContainer,this.targetElement))}ngOnDestroy(){this.targetElement&&this.renderer.removeChild(this.portalContainer,this.targetElement),this.renderer.removeChild(this._appendTarget,this.portalContainer)}static \u0275fac=function(t){return new(t||n)(u(K),u(Y))};static \u0275cmp=g({type:n,selectors:[["lg-portal"]],inputs:{targetElement:"targetElement",appendTarget:"appendTarget",wrapClass:"wrapClass"},decls:0,vars:0,template:function(t,o){},styles:["[_nghost-%COMP%]{display:flex;height:100%;width:100%}"]})};var Ie=["element"],ke=["*",[["content"]]],Ve=["*","content"];function Fe(n,e){if(n&1&&(l(0,"div",4,0),L(2,1),i(),d(3,"lg-portal",5)),n&2){let t=P(1),o=y();B("left",o.coordinates().x,"px")("top",o.coordinates().y,"px"),r(3),s("appendTarget","body")("targetElement",t)("wrapClass","tooltip")}}var O=class n{constructor(){}gap=S(16);displayed=m(!1);full=S(!1);position=S("top");element=te("element");onClose=R();coordinates=m({x:0,y:0});toggle(e){if(this.displayed.set(!this.displayed()),this.displayed()||this.onClose.emit(),e){e.stopPropagation();let[t,o]=[e.clientX,e.clientY];setTimeout(()=>{let p=(this.element()?.nativeElement).getBoundingClientRect(),f=p.width,W=p.height,z=window.innerWidth,U=window.innerHeight,_=16,H=t,j=o;t+f+_>z&&(H=z-f-_),o+W+_>U&&(j=U-W-_),t-f-_<0&&(H=_),o-W-_<0&&(j=_),this.coordinates.set({x:H,y:j})})}}close(){this.displayed.set(!1),this.onClose.emit()}onClick(e){e.target instanceof HTMLElement&&(e.target.closest(".tooltip")||(this.displayed.set(!1),this.onClose.emit()))}onKeydown(e){e.key==="Escape"&&(this.displayed.set(!1),this.onClose.emit())}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=g({type:n,selectors:[["lg-tooltip"]],viewQuery:function(t,o){t&1&&J(o.element,Ie,5),t&2&&Z()},hostBindings:function(t,o){t&1&&c("click",function(p){return o.onClick(p)},G)("keydown",function(p){return o.onKeydown(p)},G)},inputs:{gap:[1,"gap"],full:[1,"full"],position:[1,"position"]},outputs:{onClose:"onClose"},ngContentSelectors:Ve,decls:5,vars:6,consts:[["element",""],[1,"tooltip",3,"ngClass"],[1,"tooltip__anchor"],[3,"click"],[1,"tooltip__content"],[3,"appendTarget","targetElement","wrapClass"]],template:function(t,o){t&1&&(X(ke),l(0,"div",1)(1,"div",2)(2,"div",3),c("click",function(p){return o.toggle(p)}),L(3),i(),w(4,Fe,4,7),i()()),t&2&&(B("--gap",o.gap(),"px"),M("fullscreen",o.full()),s("ngClass",o.position()),r(4),b(o.displayed()?4:-1))},dependencies:[oe,k],styles:[".tooltip[_ngcontent-%COMP%]{position:relative;display:inline-block}.tooltip__anchor[_ngcontent-%COMP%]{position:relative}.tooltip__content[_ngcontent-%COMP%]{position:absolute;background-color:#fff;border-radius:16px;padding:16px;box-shadow:0 4px 8px #0000001a;z-index:100}.tooltip.top[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%], .tooltip.bottom[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%]{bottom:calc(100% + var(--gap));right:50%;transform:translate(50%)}.tooltip.left[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%]{bottom:50%;right:calc(100% + var(--gap));transform:translateY(50%)}.tooltip.right[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%]{bottom:50%;left:calc(100% + var(--gap));transform:translateY(-50%)}.tooltip.fullscreen[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#fff;border-radius:0;padding:32px;transform:none;overflow-y:auto}"]})};function Oe(n,e){if(n&1){let t=x();l(0,"div",3)(1,"lg-eggs-widget",4),c("changed",function(a){h(t);let p=y();return v(p.onEggsChanged(a))}),i()()}}var D=class n{constructor(){}eggsChanged=R();selectedWidget=m(null);onWidgetSelect(e){this.selectedWidget.set(e)}onEggsChanged(e){e&&this.eggsChanged.emit(e)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=g({type:n,selectors:[["lg-amount-widgets"]],outputs:{eggsChanged:"eggsChanged"},decls:5,vars:3,consts:[[1,"amount-widgets"],[1,"amount-widgets__buttons"],[1,"amount-widgets__button",3,"click"],[1,"amount-widgets__wrapper"],[3,"changed"]],template:function(t,o){t&1&&(l(0,"div",0)(1,"div",1)(2,"button",2),c("click",function(){return o.onWidgetSelect("eggs")}),C(3,"Eggs "),i()(),w(4,Oe,2,0,"div",3),i()),t&2&&(M("selected",o.selectedWidget()!=null),r(4),b(o.selectedWidget()==="eggs"?4:-1))},dependencies:[Re],styles:[".amount-widgets[_ngcontent-%COMP%]{display:flex;gap:16px;flex-direction:column}.amount-widgets__input[_ngcontent-%COMP%]{flex:1}.amount-widgets__buttons[_ngcontent-%COMP%]{display:flex;gap:16px;flex-wrap:wrap;padding:16px;background-color:#fafafa;border-radius:12px;margin:-16px}.amount-widgets.selected[_ngcontent-%COMP%]   .amount-widgets__buttons[_ngcontent-%COMP%]{margin-bottom:0}.amount-widgets__button[_ngcontent-%COMP%]{display:flex;padding:8px 16px;border-radius:16px;background-color:#e5de38;appearance:none;border:none;font-family:inherit;font-size:inherit}"]})};function Ne(n,e){if(n&1&&d(0,"lg-chips-list",20),n&2){let t=y(),o=P(26);s("control",o)("items",t.topCategories())}}function We(n,e){if(n&1){let t=x();l(0,"lg-button",24),c("click",function(){h(t);let a=y();return v(a.editProduct(a.value))}),C(1," Edit Product "),i()}}function He(n,e){if(n&1){let t=x();l(0,"lg-button",24),c("click",function(){h(t);let a=y();return v(a.addProduct(a.value))}),C(1," Add Product "),i()}}var N=class n{constructor(e,t,o,a){this._productsRepository=e;this._selectResourcesService=t;this._router=o;this._notificationsService=a}form=new me({name:new E(null,T.required),amount:new E(null,T.required),price:new E(null,T.required),unit:new E("gram"),source:new E(null),category_id:new E(null,T.required)});buttons=[{label:"Grams",value:"gram",style:"secondary",onClick:()=>{console.log("Grams")}},{label:"Pieces",value:"piece",style:"secondary",onClick:()=>{console.log("Piece")}}];uuid=S("");topCategories=m([]);topSources=m([]);uuidEffect=ee(()=>{this.uuid()&&this._productsRepository.getOne(this.uuid()).then(e=>{console.log({product:e}),this.form.reset(e)})});get value(){return this.form.value}get _defFormValue(){return{name:null,amount:null,price:null,source:null,category_id:null,unit:"gram"}}eggsChanged(e){this.form.patchValue({amount:e})}ngOnInit(){this._loadUsingHistory()}addProduct(e){this._productsRepository.addProduct(q(e)).then(()=>{debugger;this.form.reset(this._defFormValue),this._notificationsService.success("Product added"),this._loadUsingHistory()})}editProduct(e){debugger;this._productsRepository.editProduct(this.uuid(),q(e)).then(()=>{debugger;this._notificationsService.success("Product edited"),this._loadUsingHistory()})}ngAfterViewInit(){this._selectResourcesService.load().then(e=>{})}_loadUsingHistory(){this._productsRepository.getTopCategories().then(e=>{this.topCategories.set(e.map(t=>({label:t.name,value:t.uuid})))}),this._productsRepository.getTopSources().then(e=>{this.topSources.set(e.map(t=>({label:t,value:t})))})}static \u0275fac=function(t){return new(t||n)(u(re),u(ye),u(ie),u(he))};static \u0275cmp=g({type:n,selectors:[["lg-add-product-form"]],inputs:{uuid:[1,"uuid"]},decls:30,vars:17,consts:[["priceInput",""],["sourceInput",""],["sourceChips",""],["categorySelect",""],[3,"formGroup"],["label","Name"],["formControlName","name",3,"key","resource"],[3,"bottom","mobileMode"],["label","Amount","lgExpand",""],["formControlName","amount","lgParseMath","",3,"onInputChange","placeholder"],["ngProjectAs","after",5,["after"]],[3,"position"],["ngProjectAs","content",5,["content"]],[3,"eggsChanged"],["formControlName","unit",3,"items"],["label","Price"],["formControlName","price","lgParseMath","",3,"placeholder"],["label","Source"],["formControlName","source",3,"onSelected","noLoad","resource"],[3,"hidden"],[3,"control","items"],["label","Category"],["formControlName","category_id",3,"resource"],["lgShrink",""],["lgShrink","",3,"click"]],template:function(t,o){if(t&1){let a=x();l(0,"form",4)(1,"lg-gap-column")(2,"lg-control",5),d(3,"lg-autocomplete",6),i(),l(4,"lg-gap-row",7)(5,"lg-control",8)(6,"lg-number-input",9),c("onInputChange",function(){h(a);let f=P(15);return v(f.focus())}),l(7,"div",10)(8,"lg-tooltip",11),C(9," Widgets "),l(10,"div",12)(11,"lg-amount-widgets",13),c("eggsChanged",function(f){return h(a),v(o.eggsChanged(f))}),i()()()()()(),d(12,"lg-buttons-group",14),i(),l(13,"lg-control",15),d(14,"lg-number-input",16,0),i(),l(16,"lg-gap-column")(17,"lg-control",17)(18,"lg-autocomplete",18,1),c("onSelected",function(){h(a);let f=P(22);return v(f.clearSelected())}),i()(),l(20,"div",19),d(21,"lg-chips-list",20,2),i()(),l(23,"lg-gap-column")(24,"lg-control",21),d(25,"lg-multiselect",22,3),i(),w(27,Ne,1,2,"lg-chips-list",20),i(),w(28,We,2,0,"lg-button",23)(29,He,2,0,"lg-button",23),i()()}if(t&2){let a=P(19);s("formGroup",o.form),r(3),s("key","name")("resource","products-names"),r(),s("bottom",!0)("mobileMode",!0),r(2),s("placeholder","In "+o.form.value.unit),r(2),s("position","left"),r(4),s("items",o.buttons),r(2),s("placeholder","For the entire product in your currency"),r(4),s("noLoad",!0)("resource","sources"),r(2),s("hidden",!o.topSources().length),r(),s("control",a)("items",o.topSources()),r(4),s("resource","categories"),r(2),b(o.topCategories().length?27:-1),r(),b(o.uuid()?28:29)}},dependencies:[Ce,ue,ce,de,ge,fe,ve,_e,I,we,be,O,D,Ee,A,xe,Pe,Se,Te,Me],styles:[`lg-eggs-widget{min-width:300px}
`],encapsulation:2})};var Ae=class n{constructor(e){this._aRoute=e}uuid=m("");ngOnInit(){this._aRoute.params.subscribe(e=>{this.uuid.set(e.uuid)})}static \u0275fac=function(t){return new(t||n)(u(ne))};static \u0275cmp=g({type:n,selectors:[["app-add-recipe"]],decls:9,vars:8,consts:[[3,"center"],[3,"flat","link","size"],[3,"uuid"]],template:function(t,o){t&1&&(l(0,"lg-fade-in")(1,"lg-container")(2,"lg-gap-row",0)(3,"lg-title"),C(4),i(),l(5,"lg-button",1),C(6," Back to list "),i()(),l(7,"lg-card"),d(8,"lg-add-product-form",2),i()()()),t&2&&(r(2),s("center",!0),r(2),$("",o.uuid()?"Edit":"Add"," Product"),r(),Q("warning"),s("flat",!0)("link","/products")("size","small"),r(3),s("uuid",o.uuid()))},dependencies:[le,se,ae,N,I,A,pe],encapsulation:2})};export{Ae as AddProductComponent};
