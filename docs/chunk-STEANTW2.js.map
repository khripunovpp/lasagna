{
  "version": 3,
  "sources": ["src/app/features/settings/view/backup/backup-settings.component.ts"],
  "sourcesContent": ["import {AfterViewInit, Component, inject} from '@angular/core';\nimport {FormsModule} from '@angular/forms';\nimport {CardComponent} from '../../../../shared/view/ui/card/card.component';\nimport {FlexRowComponent} from '../../../../shared/view/layout/flex-row.component';\nimport {FlexColumnComponent} from '../../../../shared/view/layout/flex-column.component';\nimport {TimeAgoPipe} from '../../../../shared/view/pipes/time-ago.pipe';\nimport {ButtonComponent} from '../../../../shared/view/ui/button/button.component';\nimport {UploadComponent} from '../../../controls/form/upload.component';\nimport {TranslatePipe, TranslateService} from '@ngx-translate/core';\nimport {injectQueryParams} from '../../../../shared/helpers';\nimport {NotificationsService, TransferDataService} from '../../../../shared/service/services';\nimport {DexieIndexDbService} from '../../../../shared/service/db/dexie-index-db.service';\nimport {SelfStartDirective} from '../../../../shared/view/directives/self-start.directive';\nimport {\n  DeleteConfirmationService\n} from '../../../../shared/view/ui/delete-confirmation-popover/delete-confirmation.service';\nimport {\n  DeleteConfirmationPopoverComponent\n} from '../../../../shared/view/ui/delete-confirmation-popover/delete-confirmation-popover.component';\nimport {WINDOW} from '../../../../shared/service/tokens/window.token';\n\n@Component({\n  selector: 'lg-backup-settings',\n  standalone: true,\n  template: `\n    <lg-flex-column>\n      <lg-flex-row [center]=\"true\" [mobileMode]=\"true\">\n        <lg-button (click)=\"onBackup()\"\n                   [style]=\"'success'\"\n                   lgSelfStart>\n          {{ 'backup.make-btn'|translate }}\n        </lg-button>\n\n        @if (transferDataService.currenBackupDate) {\n          {{ 'backup.last-label'|translate }} {{ transferDataService.currenBackupDate | timeAgo }}\n        }\n      </lg-flex-row>\n\n      <lg-card style=\"--card-bg:#fcd9b5\">\n        <lg-flex-column [position]=\"'center'\">\n          <div class=\"text-center\">\n            {{ 'backup.flush-informer'|translate }}\n          </div>\n\n          <lg-button (click)=\"onFlush()\" [style]=\"'success'\">\n            {{ 'backup.flush-btn'|translate }}\n          </lg-button>\n        </lg-flex-column>\n      </lg-card>\n\n      <lg-upload (filesSelected)=\"onRestore($event)\" [accept]=\"'.json'\">\n        <lg-card style=\"--card-bg:#e78888\">\n          <lg-flex-column [position]=\"'center'\">\n            <div class=\"text-center text-inverse\">\n              {{ 'backup.restore-informer'|translate }}\n            </div>\n\n            <lg-button [style]=\"'danger'\">\n              {{ 'backup.restore-btn'|translate }}\n            </lg-button>\n          </lg-flex-column>\n        </lg-card>\n      </lg-upload>\n\n      <lg-card style=\"--card-bg:#e78888\">\n        <lg-flex-column [position]=\"'center'\">\n          <div class=\"text-center text-inverse\">\n            {{ 'backup.delete-all.informer'|translate }}\n          </div>\n\n          <lg-button (click)=\"onDeleteAll()\" [style]=\"'danger'\">\n            {{ 'backup.delete-all.btn'|translate }}\n          </lg-button>\n        </lg-flex-column>\n      </lg-card>\n    </lg-flex-column>\n\n    <lg-delete-confirmation-popover></lg-delete-confirmation-popover>\n  `,\n  styles: [``],\n  imports: [\n    CardComponent,\n    FlexRowComponent,\n    FlexColumnComponent,\n    FormsModule,\n    TimeAgoPipe,\n    ButtonComponent,\n    UploadComponent,\n    TranslatePipe,\n    SelfStartDirective,\n    DeleteConfirmationPopoverComponent\n  ],\n  providers: [\n    DeleteConfirmationService,\n  ],\n})\nexport class BackupSettingsComponent\n  implements AfterViewInit {\n  constructor() {\n  }\n\n  readonly deleteConfirmationService = inject(DeleteConfirmationService);\n  readonly downloadBackupParam = injectQueryParams('download_backup');\n  readonly transferDataService = inject(TransferDataService);\n  readonly notificationsService = inject(NotificationsService);\n  readonly dexieIndexDbService = inject(DexieIndexDbService);\n  readonly translate = inject(TranslateService);\n  private readonly _window = inject(WINDOW);\n\n  ngAfterViewInit() {\n    if (this.downloadBackupParam()) {\n      this.onBackup();\n    }\n  }\n\n  async onBackup() {\n    const loader = this.notificationsService.loading(this.translate.instant('backup.creating'));\n    try {\n      await this.transferDataService.exportAll('json');\n      this.notificationsService.success(this.translate.instant('backup.created'));\n      this._window?.localStorage.setItem('lastBackupDate', Date.now().toString());\n    } catch (e) {\n      this.notificationsService.showJsonErrors([JSON.stringify(e)], this.translate.instant('backup.failed'));\n      console.error(e);\n    } finally {\n      loader.close();\n    }\n  }\n\n  async onRestore(event: File[]) {\n    this.deleteConfirmationService.configure({\n      message: this.translate.instant('backup.restore-confirmation'),\n      confirmText: this.translate.instant('backup.restore-confirmation-confirm'),\n      onSuccess: async () => {\n        const loader = this.notificationsService.loading(this.translate.instant('backup.restoring'));\n\n        try {\n          await this.transferDataService.restoreAllData(event);\n          this.notificationsService.success(this.translate.instant('backup.restored'));\n        } catch (e) {\n          this.notificationsService.showJsonErrors([JSON.stringify(e?.toString()).trim()], this.translate.instant('backup.restore-failed'));\n          console.error(e);\n        } finally {\n          loader.close();\n          loader.close();\n        }\n      },\n    });\n  }\n\n  async onFlush() {\n    this.deleteConfirmationService.configure({\n      message: this.translate.instant('backup.flush-confirmation'),\n      confirmText: this.translate.instant('backup.flush-confirmation-confirm'),\n      onSuccess: async () => {\n        try {\n          await this.dexieIndexDbService.flushCache();\n          this.notificationsService.success(this.translate.instant('backup.flushed'));\n          this._window?.location.reload();\n        } catch (e) {\n          this.notificationsService.showJsonErrors([JSON.stringify(e)], this.translate.instant('backup.flush-failed'));\n          console.error(e);\n        } finally {\n        }\n      }\n    });\n  }\n\n  async onDeleteAll() {\n    this.deleteConfirmationService.configure({\n      message: this.translate.instant('backup.delete-all.confirmation'),\n      confirmText: this.translate.instant('backup.delete-all.confirmation-confirm'),\n      onSuccess: async () => {\n        try {\n          await this.dexieIndexDbService.deleteAllData();\n          this._window?.localStorage.clear();\n          this.notificationsService.success(this.translate.instant('all-data.deleted'));\n          setTimeout(() => {\n            this._window?.location.reload();\n          }, 1000);\n        } catch (e) {\n          this.notificationsService.showJsonErrors([JSON.stringify(e)], this.translate.instant('all-data.delete-failed'));\n          console.error(e);\n        } finally {\n        }\n      }\n    });\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
