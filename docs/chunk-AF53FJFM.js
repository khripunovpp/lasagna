import{a as m}from"./chunk-NJUXFY6Z.js";import{a as p}from"./chunk-IAXPE3GV.js";import{c as s}from"./chunk-X7YFISNV.js";import{M as d,P as o,a as u,b as a,f as r}from"./chunk-LOAPDVIX.js";var g=class n{constructor(e,i,t){this._indexDbService=e;this._usingHistoryService=i;this._categoryRepository=t}addRecipe(e){return r(this,null,function*(){return this._indexDbService.addData("recipesStore",e).then(i=>(e.category_id&&this._saveCategory(e.category_id),i))})}getRecipes(){return this._indexDbService.getAll("recipesStore").then(e=>e.toSorted((i,t)=>i.name.localeCompare(t.name)))}getOne(e){return r(this,null,function*(){return new Promise((i,t)=>r(this,null,function*(){if(!e){i(void 0);return}e=e.uuid||e,yield this._indexDbService.getOne("recipesStore",e).then(c=>{i(this.recipeFromDTO(c))})}))})}editRecipe(e,i){return this._indexDbService.replaceData("recipesStore",e,i)}deleteRecipe(e){return this._indexDbService.remove("recipesStore",e)}ingredientToDto(e){return{name:e.name,amount:e.amount,unit:e.unit,product_id:e.product_id?.uuid,recipe_id:e.recipe_id?.uuid,uuid:e.uuid}}recipeFromDTO(e){if(e)return{name:e.name,description:e.description,outcome_amount:e.outcome_amount,outcome_unit:e.outcome_unit,uuid:e.uuid,ingredients:e.ingredients.map(i=>a(u({},i),{product_id:i.product_id?{uuid:i.product_id}:void 0,recipe_id:i.recipe_id?{uuid:i.recipe_id}:void 0})),taxTemplateName:e.taxTemplateName,category_id:e.category_id?{uuid:e.category_id}:null}}recipeToDto(e){return{name:e.name,description:e.description,outcome_amount:e.outcome_amount,outcome_unit:e.outcome_unit,uuid:e.uuid,ingredients:e.ingredients.map(i=>this.ingredientToDto(i)),taxTemplateName:e.taxTemplateName,category_id:e.category_id?e.category_id.uuid:null}}getTopCategories(){let{top:e}=this._usingHistoryService.read("recipes_categories"),i=Object.keys(e);return i.length===0?Promise.resolve([]):this._categoryRepository.getManyCategories(i).then(t=>t.toSorted((c,_)=>e[_.uuid].count>e[c.uuid].count?1:-1))}_saveCategory(e){this._usingHistoryService.count("recipes_categories",e)}static \u0275fac=function(i){return new(i||n)(o(s),o(p),o(m))};static \u0275prov=d({token:n,factory:n.\u0275fac,providedIn:"root"})};export{g as a};
