import{a as qe}from"./chunk-ZUROYBM5.js";import{a as Ze,b as Oe,c,d as Pe,e as Ve,f as $e}from"./chunk-5ABWMEXF.js";import{a as Ae,b as Be}from"./chunk-H22U4TT4.js";import"./chunk-LNFF7QOH.js";import"./chunk-EFWVSS3F.js";import{a as ne,b as je}from"./chunk-NWSNIWTI.js";import{a as Ne}from"./chunk-DB6RCYRB.js";import{a as He}from"./chunk-TBOQ3X6G.js";import"./chunk-34N6S3VM.js";import"./chunk-2YDEY5QM.js";import{a as Ge}from"./chunk-WFZDMQQ5.js";import{a as te,b as ie}from"./chunk-FHCFN5NX.js";import{a as Qe}from"./chunk-5ZBILTT3.js";import{v as ee}from"./chunk-6MF4VL6X.js";import"./chunk-BB67CUFS.js";import{a as X}from"./chunk-TKRM7P4A.js";import{a as ze}from"./chunk-3I72BRDH.js";import{a as z}from"./chunk-57SGI4YT.js";import{a as Y}from"./chunk-RWYIQ5OP.js";import"./chunk-4U4Z3QUR.js";import{a as Fe}from"./chunk-HK2A7YRA.js";import"./chunk-MPFUNZLY.js";import{a as W}from"./chunk-SDVVFYH2.js";import{j as Me,l as U}from"./chunk-V37G44FO.js";import"./chunk-UXDGYM6T.js";import{D as Ie,H as ke,L as Le,T as Ee,aa as J,ja as K,ka as x,la as D,o as Te,p as we,r as H}from"./chunk-DE57DFLU.js";import{m as be,p as Re,q as $,u as q}from"./chunk-CKZTBBM3.js";import"./chunk-CABIONZL.js";import{a as De}from"./chunk-EMIJRNYJ.js";import{i as he}from"./chunk-VKLQR74F.js";import{$a as o,$b as E,Bb as ge,Cc as C,Db as T,Dc as S,Ec as ye,Fb as w,Hb as fe,Ib as Z,Jb as O,Kb as s,Lb as l,Mb as a,Nb as k,Nc as A,Qb as _e,Rb as h,Rc as xe,Vb as g,Wb as u,Xb as Ce,Yb as Se,Zb as L,ac as M,bb as P,ea as I,eb as f,hc as _,jc as p,kc as de,la as v,lb as b,lc as m,ma as y,mc as N,nb as V,qb as R,ra as ue,sb as me,va as B,wc as j,xc as ve,yc as Q}from"./chunk-TMZLFVGH.js";import"./chunk-2RGDSI3Q.js";import"./chunk-FK6H3RFT.js";import"./chunk-C6Q5SG76.js";var Je=c.object({name:c.string(),amount:c.number().or(c.string()),uuid:c.string().optional(),product_id:Ve,recipe_id:c.lazy(()=>oe),unit:c.enum(["gram","portion","piece"])});var oe=c.object({name:c.string(),uuid:c.string().optional(),description:c.string(),ingredients:c.array(c.lazy(()=>Je)),outcome_unit:Pe,outcome_amount:c.number().or(c.string()),taxTemplateName:c.string().optional(),category_id:c.string().nullable().optional(),createdAt:c.union([c.string(),c.number()]).optional(),updatedAt:c.union([c.string(),c.number()]).optional(),tags:c.array(c.string()).optional(),color:c.string().optional(),priceModifiers:c.array(c.object({action:c.enum(["add","subtract","round"]),value:c.number().or(c.string()),unit:c.enum(["currency","percent"])})).optional()});var We=i=>({length:i}),Xe=(i,t)=>t.uuid;function Ye(i,t){if(i&1){let e=h();l(0,"lg-button",4),g("click",function(){v(e);let r=u(2);return y(r.selectionZoneService.onSelection())}),p(1),C(2,"translate"),a()}i&2&&(_("success"),s("flat",!0)("size","small"),o(),m(" ",S(2,5,"select-many-label")," "))}function et(i,t){if(i&1){let e=h();l(0,"lg-button",4),g("click",function(){v(e);let r=u(2);return y(r.deleteAllDrafts())}),p(1),C(2,"translate"),a()}i&2&&(_("danger"),s("flat",!0)("size","small"),o(),m(" ",S(2,5,"delete-all-label")," "))}function tt(i,t){if(i&1){let e=h();l(0,"lg-button",5),g("click",function(){v(e);let r=u(3);return y(r.deletedSelectedDrafts())}),p(1),C(2,"translate"),a()}if(i&2){let e=u();_("danger"),s("flat",!0)("disabled",!(e!=null&&e.size))("size","small"),o(),m(" ",S(2,6,"delete-selected-label")," ")}}function it(i,t){i&1&&R(0,tt,3,8,"ng-template",1)}function nt(i,t){i&1&&(p(0),C(1,"translate")),i&2&&m(" ",S(1,1,"draft.list-prefix.existing")," ")}function ot(i,t){i&1&&(p(0),C(1,"translate")),i&2&&m(" ",S(1,1,"draft.list-prefix.new")," ")}function rt(i,t){if(i&1&&(l(0,"lg-flex-row",6)(1,"a",7),T(2,nt,2,3)(3,ot,2,3),p(4),a(),l(5,"small",8),p(6),C(7,"translate"),C(8,"timeAgo"),a()()),i&2){let e=u().$implicit;s("center",!0),o(),s("routerLink","/recipes/draft/"+(e==null?null:e.uuid)),o(),w(!(e==null||e.meta==null)&&e.meta.uuid?2:3),o(2),m(" ",(e==null||e.data==null?null:e.data.name)??""," "),o(2),N(" ",S(7,6,"edited-at-label")," ",S(8,8,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," ")}}function lt(i,t){if(i&1&&R(0,rt,9,10,"ng-template",3),i&2){let e=t.$implicit;s("uuid",e.uuid)}}function at(i,t){if(i&1){let e=h();l(0,"lg-expander",0),C(1,"translate"),C(2,"translate"),l(3,"lg-inline-separated-group"),R(4,Ye,3,7,"ng-template",1)(5,et,3,7,"ng-template",1),T(6,it,1,0,null,1),a(),l(7,"lg-card-list",2),g("onDeleteOne",function(r){v(e);let d=u();return y(d.deleteDraft(r==null?null:r.uuid))})("onSelected",function(r){v(e);let d=u();return y(d.selectionZoneService.putSelected(r))}),Z(8,lt,1,1,null,3,Xe),a()()}if(i&2){let e,n,r=u();s("closeLabel",S(1,6,"drafts-close-label"))("openLabel",ye(2,8,"drafts-label",Q(11,We,(e=r.drafts())==null?null:e.length))),o(6),w((n=r.selectionZoneService.selected())?6:-1,n),o(),s("mode",r.selectionZoneService.selectionMode())("selectAll",r.selectionZoneService.selectAll())("deselectAll",r.selectionZoneService.deselectAll()),o(),O(r.drafts())}}var re=class i{constructor(t,e,n){this._recipesRepository=t;this._notificationsService=e;this.selectionZoneService=n}drafts=B([]);Stores=q;get hidden(){return this.drafts()?.length===0?!0:null}ngOnInit(){let t=this._recipesRepository.getDraftRecipe();t&&this.drafts.set(t)}deleteAllDrafts(){this._recipesRepository.removeDraftMany(this.drafts().map(t=>t.uuid)).then(()=>{this.drafts.set([]),this._notificationsService.success("Drafts deleted")})}deletedSelectedDrafts(){let t=this.selectionZoneService.selected();t&&this._recipesRepository.removeDraftMany(Array.from(t)).then(()=>{this.drafts.update(e=>e.filter(n=>!t.has(n.uuid))),this._notificationsService.success("Drafts deleted")})}deleteDraft(t){t&&(this._recipesRepository.removeDraftRecipe(t),this.drafts.update(e=>e.filter(n=>n?.uuid!==t)))}static \u0275fac=function(e){return new(e||i)(f(U),f(K),f(x))};static \u0275cmp=b({type:i,selectors:[["lg-draft-recipes-list"]],hostVars:1,hostBindings:function(e,n){e&2&&ge("hidden",n.hidden)},features:[j([x])],decls:1,vars:1,consts:[[3,"closeLabel","openLabel"],["lgInlineSeparatedGroup",""],[2,"--card-bg","#bee5ff",3,"onDeleteOne","onSelected","mode","selectAll","deselectAll"],["lgCardListItem","","type","draft",3,"uuid"],[3,"click","flat","size"],[3,"click","flat","disabled","size"],[3,"center"],["lgExpand","",3,"routerLink"],[1,"text-muted","text-cursive"]],template:function(e,n){if(e&1&&T(0,at,10,13,"lg-expander",0),e&2){let r;w((r=n.drafts())!=null&&r.length?0:-1)}},dependencies:[z,D,je,ne,$,Y,Qe,J,$e,ie,te],encapsulation:2})};var ae=class i{constructor(t){this.templateRef=t}static \u0275fac=function(e){return new(e||i)(f(P))};static \u0275dir=V({type:i,selectors:[["","lgGroupingSortingContainer",""]]})};var se=class i{constructor(){}groupingToLabel={category:"By category",tag:"By tag",createdAt:"By creation date",alphabetical:"By first letter"};groupingDirectionToLabel={asc:"From A to Z (from old to new)",desc:"From Z to A (from new to old)"};router=I(Re);aRouter=I(be);context;sortChange=new me;groupChange=new me;groupingParam=H("groupBy");sortDirection=H("sortDirection");sortField=H("sortField");defaultDirection="asc";sorting=B({field:"name",direction:this.defaultDirection,group:"category"});sortingEffect=A(()=>{let t=this.sorting();this.sortChange.emit(t)});ngOnInit(){let t=this.aRouter.snapshot.queryParams,e=this.groupingParam(),n=this.sortDirection(),r=this.sortField();this.sorting.set({field:r?.toString()||"name",direction:n?n==="asc"?"asc":"desc":this.defaultDirection,group:e?.toString()||"category"})}onSortChange(t){this.sorting.set({field:t.field||this.sorting().field,direction:t.direction||this.sorting().direction,group:t.group||this.sorting().group}),this.sortChange.emit(this.sorting()),this.router.navigate([],{queryParams:{sortField:t.field||this.sorting().field,sortDirection:t.direction||this.sorting().direction,groupBy:t.group||this.sorting().group},relativeTo:this.aRouter}).then(()=>{window.location.reload()})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=b({type:i,selectors:[["lg-grouping-sorting"]],contentQueries:function(e,n,r){if(e&1&&L(r,ae,5),e&2){let d;E(d=M())&&(n.context=d.first)}},outputs:{sortChange:"sortChange",groupChange:"groupChange"},decls:25,vars:36,consts:[["lgDropdownAnchor","",3,"size"],[3,"size"],[3,"click","flat","size"]],template:function(e,n){e&1&&(l(0,"lg-flex-row")(1,"lg-dropdown")(2,"lg-button",0),p(3),a(),l(4,"lg-flex-column",1)(5,"span"),p(6,"Grouping"),a(),l(7,"lg-button",2),g("click",function(){return n.onSortChange({group:"category"})}),p(8),a(),l(9,"lg-button",2),g("click",function(){return n.onSortChange({group:"tag"})}),p(10),a(),l(11,"lg-button",2),g("click",function(){return n.onSortChange({group:"createdAt"})}),p(12),a(),l(13,"lg-button",2),g("click",function(){return n.onSortChange({group:"alphabetical"})}),p(14),a()()(),l(15,"lg-dropdown")(16,"lg-button",0),p(17),a(),l(18,"lg-flex-column",1)(19,"span"),p(20,"Grouping direction"),a(),l(21,"lg-button",2),g("click",function(){return n.onSortChange({direction:"asc"})}),p(22),a(),l(23,"lg-button",2),g("click",function(){return n.onSortChange({direction:"desc"})}),p(24),a()()()()),e&2&&(o(2),s("size","small"),o(),m(" ",n.groupingToLabel[n.sorting().group]," "),o(),s("size","small"),o(3),_("warning"),s("flat",!0)("size","small"),o(),m(" ",n.groupingToLabel.category," "),o(),_("warning"),s("flat",!0)("size","small"),o(),m(" ",n.groupingToLabel.tag," "),o(),_("warning"),s("flat",!0)("size","small"),o(),m(" ",n.groupingToLabel.createdAt," "),o(),_("warning"),s("flat",!0)("size","small"),o(),m(" ",n.groupingToLabel.alphabetical," "),o(2),s("size","small"),o(),m(" ",n.groupingDirectionToLabel[n.sorting().direction]," "),o(),s("size","small"),o(3),_("warning"),s("flat",!0)("size","small"),o(),m(" ",n.groupingDirectionToLabel.asc," "),o(),_("warning"),s("flat",!0)("size","small"),o(),m(" ",n.groupingDirectionToLabel.desc," "))},dependencies:[z,D,qe,X],encapsulation:2})};var G=class i{constructor(t){this.templateRef=t}static \u0275fac=function(e){return new(e||i)(f(P))};static \u0275dir=V({type:i,selectors:[["","lgGroupingTail",""]]})};var st=["*"];function ct(i,t){if(i&1){let e=h();l(0,"lg-checkbox",4),g("onCheckboxChanged",function(r){v(e);let d=u();return y(d.onChanges(r))}),a()}if(i&2){let e=u();s("size","medium")("formControl",e.selected)("value",e.key())}}function pt(i,t){if(i&1){let e=h();l(0,"lg-button",5),g("click",function(){v(e);let r=u();return y(r.selectionZoneService.putDelete(r.key()))}),k(1,"mat-icon",6),a()}i&2&&(_("danger"),s("size","tiny")("icon",!0))}var ce=class i{constructor(t){this.selectionZoneService=t}key=xe(De());items;selected=new ke;effectMode=A(()=>{this.selectionZoneService.selectionMode()&&this.selected.reset()});effectSelectAll=A(()=>{this.selectionZoneService.selectAll()?this.selected.setValue(!0):this.selectionZoneService.deselectAll()&&this.selected.setValue(!1)});onChanges(t){this.selectionZoneService.putSelected([!!t,this.key()])}static \u0275fac=function(e){return new(e||i)(f(x,12))};static \u0275cmp=b({type:i,selectors:[["lg-selectable-section"]],contentQueries:function(e,n,r){if(e&1&&L(r,ne,4),e&2){let d;E(d=M())&&(n.items=d)}},inputs:{key:[1,"key"]},ngContentSelectors:st,decls:5,vars:2,consts:[[1,"lg-selectable-section"],[3,"size","formControl","value"],[1,"lg-selectable-section__inner"],[3,"style","size","icon"],[3,"onCheckboxChanged","size","formControl","value"],[3,"click","size","icon"],["aria-hidden","false","fontIcon","close"]],template:function(e,n){e&1&&(Ce(),l(0,"section",0),T(1,ct,1,3,"lg-checkbox",1),l(2,"div",2),Se(3),a(),T(4,pt,2,4,"lg-button",3),a()),e&2&&(o(),w(n.selectionZoneService.selectionMode()==="selection"?1:-1),o(3),w(n.selectionZoneService.selectionMode()==="selection"?4:-1))},dependencies:[Ee,Ie,Le,Ne,D,ee],styles:[".lg-checkbox[_ngcontent-%COMP%]{--control-bg: #abc2ff;--control-bg-selected: #abc2ff}.lg-selectable-section[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}"]})};var mt=i=>({$implicit:i}),dt=(i,t)=>t==null?null:t.field;function ut(i,t){if(i&1&&(l(0,"div",5)(1,"lg-selectable-section",6)(2,"div",7),_e(3,8),a()()()),i&2){let e=t.$implicit,n=u(2);o(),s("key",e.uuid),o(2),s("ngTemplateOutlet",n.groupingTailDirective.templateRef)("ngTemplateOutletContext",Q(3,mt,e))}}function gt(i,t){if(i&1&&(l(0,"section",1)(1,"header",2)(2,"lg-title",3),p(3),a()(),l(4,"div",4),Z(5,ut,4,5,"div",5,fe),a()()),i&2){let e=t.$implicit;o(2),s("level",3),o(),m(" ",(e==null?null:e.field)||"Unknown"," "),o(2),O(e==null?null:e.items)}}var pe=class i{constructor(t){this.selectionZoneService=t}sortResult;groupingTailDirective;static \u0275fac=function(e){return new(e||i)(f(x,8))};static \u0275cmp=b({type:i,selectors:[["lg-grouping-tails"]],contentQueries:function(e,n,r){if(e&1&&L(r,G,5),e&2){let d;E(d=M())&&(n.groupingTailDirective=d.first)}},inputs:{sortResult:"sortResult"},decls:3,vars:0,consts:[[1,"grouping-tails"],[1,"grouping-tails__section"],[1,"grouping-tails__header"],[3,"level"],[1,"grouping-tails__content"],[1,"grouping-tails__item"],[3,"key"],[1,"grouping-tails__item-inner"],[3,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(e,n){e&1&&(l(0,"section",0),Z(1,gt,7,2,"section",1,dt),a()),e&2&&(o(),O(n.sortResult==null?null:n.sortResult.groups))},dependencies:[W,he,ce],styles:[".grouping-tails[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:32px}.grouping-tails__section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}.grouping-tails__content[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:16px}.grouping-tails__item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.grouping-tails__item-inner[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;padding:16px;border-radius:32px;background-color:#fff}"]})};var ft=()=>["recipe"];function _t(i,t){if(i&1){let e=h();l(0,"lg-button",8),g("click",function(){v(e);let r=u();return y(r.exportRecipes(r.selectionZoneService.selected()))}),p(1),C(2,"translate"),a()}i&2&&(_("info"),s("flat",!0)("size","small"),o(),m(" ",S(2,5,"export-label")," recipes "))}function Ct(i,t){if(i&1&&(l(0,"span"),p(1),a()),i&2){let e=t.$implicit;o(),de(e==null?null:e.name)}}function St(i,t){if(i&1){let e=h();l(0,"lg-import",9),C(1,"translate"),g("onDone",function(){v(e);let r=u();return y(r.loadRecipes())}),R(2,Ct,2,1,"ng-template",10),a()}if(i&2){let e=u();s("label",S(1,3,"import-label")+" products")("schema",e.RecipeScheme)("storeName",e.Stores.RECIPES)}}function vt(i,t){if(i&1&&(l(0,"lg-flex-column")(1,"a",11),p(2),a(),l(3,"lg-flex-row")(4,"lg-button",12),p(5),C(6,"translate"),a(),l(7,"small",13),p(8),C(9,"translate"),C(10,"timeAgo"),a()()()),i&2){let e=t.$implicit;o(),s("routerLink","/recipes/edit/"+e.uuid),o(),de(e.name),o(2),_("primary"),s("size","small")("link","/recipes/calculate/"+e.uuid)("flat",!0),o(),m(" ",S(6,10,"recipes.calculate-btn")," "),o(3),N(" ",S(9,12,"edited-at-label")," ",S(10,14,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," ")}}var Ue=class i{constructor(t,e,n,r){this._recipesRepository=t;this._notificationsService=e;this._transferDataService=n;this.selectionZoneService=r;this._recipesRepository.recipes$.subscribe({next:d=>{console.log("recipes loaded",d)},error:d=>{}}),this.selectionZoneService.onDelete.pipe(Te(this.destroyRef)).subscribe(d=>{this.deleteRecipe(d)})}destroyRef=I(ue);recipes=we(I(He));Stores=q;RecipeScheme=oe;ngOnInit(){this.loadRecipes()}deleteRecipe(t){t&&this._recipesRepository.deleteOne(t).then(()=>{this._notificationsService.success("Recipe deleted"),this.loadRecipes()})}loadRecipes(){return this._recipesRepository.loadRecipes()}exportRecipes(t){return this._transferDataService.exportTable("recipesStore","json",{selected:Array.from(t||[])})}static \u0275fac=function(e){return new(e||i)(f(U),f(K),f(Me),f(x))};static \u0275cmp=b({type:i,selectors:[["lg-recipes-list"]],features:[j([x])],decls:18,vars:13,consts:[[3,"icon","link","size"],["aria-hidden","false","fontIcon","add"],["lgInlineSeparatedGroup",""],[3,"center"],[3,"size"],[3,"selectionTypes"],[3,"sortResult"],["lgGroupingTail",""],[3,"click","flat","size"],[3,"onDone","label","schema","storeName"],["lgImportRowTpl",""],[3,"routerLink"],[3,"size","link","flat"],["lgPull","",1,"text-muted","text-cursive"]],template:function(e,n){e&1&&(l(0,"lg-controls-bar")(1,"lg-button",0),k(2,"mat-icon",1),a(),l(3,"lg-inline-separated-group"),R(4,_t,3,7,"ng-template",2)(5,St,3,5,"ng-template",2),a()(),l(6,"lg-fade-in")(7,"lg-container")(8,"lg-flex-row",3)(9,"lg-title"),p(10),C(11,"translate"),a()(),k(12,"lg-draft-recipes-list"),l(13,"lg-flex-column",4),k(14,"lg-grouping-sorting")(15,"lg-selection-tools",5),a(),l(16,"lg-grouping-tails",6),R(17,vt,11,16,"ng-template",7),a()()()),e&2&&(o(),_("success"),s("icon",!0)("link","/recipes/add")("size","medium"),o(7),s("center",!0),o(2),m(" ",S(11,10,"recipes.list-title")," "),o(3),s("size","medium"),o(2),s("selectionTypes",ve(12,ft)),o(),s("sortResult",n.recipes()))},dependencies:[z,D,$,ee,ze,W,Oe,Ze,Fe,Ae,Be,Y,Ge,J,re,ie,te,se,pe,G,X],styles:["[_nghost-%COMP%]{display:block}"]})};export{Ue as RecipesListComponent};
