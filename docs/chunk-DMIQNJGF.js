import{a as Se,b as ve,c as ye,d as H,e as q,f as De,i as w,j as Te}from"./chunk-4NNI634T.js";import"./chunk-4UP3VRXZ.js";import{a as Pe}from"./chunk-UOPYIIM6.js";import{a as xe}from"./chunk-C7Y4XD5I.js";import{a as G,c as $}from"./chunk-UKASGQDE.js";import{b as U}from"./chunk-UL2AXCZQ.js";import"./chunk-6B5WCZG7.js";import{a as M}from"./chunk-UVHKGMQ5.js";import{a as J}from"./chunk-S5HI73SL.js";import{a as j}from"./chunk-V2E2AQQX.js";import{a as N}from"./chunk-MQJWIQ3W.js";import"./chunk-KNGN5IJR.js";import"./chunk-XIO6VEU6.js";import{a as fe,b as z}from"./chunk-E6C4JVEO.js";import{a as Ce}from"./chunk-6IJ5CQKN.js";import{a as ge}from"./chunk-3KK5VW3S.js";import"./chunk-SNDQO5FA.js";import{j as Z,n as y,o as _e,p as L}from"./chunk-GVIXIWOU.js";import{b as ue}from"./chunk-WAPO4JPN.js";import"./chunk-5KSZNU56.js";import"./chunk-LXGI5QAA.js";import"./chunk-TWZFER64.js";import{u as O}from"./chunk-BEK46ZVO.js";import"./chunk-2SENDHZQ.js";import{s as B,w as me}from"./chunk-4S3SNKRC.js";import"./chunk-652DFWNF.js";import{k as de}from"./chunk-O377EGFO.js";import{$ as D,$b as I,Ab as b,Bb as h,Cb as c,Db as a,Eb as T,Ib as g,Lb as C,Mb as p,R as oe,Va as r,Yb as s,Z as ne,Zb as ae,_a as S,_b as x,db as R,dc as V,ec as pe,fc as se,ga as _,ha as f,ib as P,jc as d,k as te,kc as m,lc as F,na as re,pb as le,q as X,qb as l,s as ie,tb as v,wb as k,xb as A,yb as ce}from"./chunk-TBUBSNFD.js";import"./chunk-DELOOZDJ.js";import{f as ee}from"./chunk-2WH2EVR6.js";var K=new ne("CategorizedProductsList",{factory:()=>{let t=D(L),i=D(ue);return te(t.loadAll()).pipe(oe(()=>t.products$)).pipe(X(n=>n.toSorted((o,u)=>o.name.localeCompare(u.name))),X(n=>Pe(n,"category_id")),ie(n=>ee(void 0,null,function*(){let o=[];for(let E in n){let W=n[E],Le=yield i.getOne(E);o.push({category:Le?.toString(),products:W})}if(!o.length)return[];let[u,...Y]=o.toSorted((E,W)=>E.category>W.category?1:-1);return u?.category?[u].concat(Y):Y.concat([u])})))}});var we=t=>({length:t}),Ee=(t,i)=>i.uuid;function Re(t,i){if(t&1){let e=g();c(0,"lg-button",4),C("click",function(){_(e);let o=p(2);return f(o.selectionZoneService.onSelection())}),s(1),d(2,"translate"),a()}t&2&&(v("success"),l("flat",!0)("size","small"),r(),x(" ",m(2,5,"select-many-label")," "))}function ke(t,i){if(t&1){let e=g();c(0,"lg-button",4),C("click",function(){_(e);let o=p(2);return f(o.deleteAllDrafts())}),s(1," Delete all "),a()}t&2&&(v("danger"),l("flat",!0)("size","small"))}function Ae(t,i){if(t&1){let e=g();c(0,"lg-button",5),C("click",function(){_(e);let o=p(3);return f(o.deletedSelectedDrafts())}),s(1," Delete selected "),a()}if(t&2){let e=p();v("danger"),l("flat",!0)("disabled",!(e.draft!=null&&e.draft.size))("size","small")}}function Ve(t,i){t&1&&P(0,Ae,2,5,"ng-template",1)}function Fe(t,i){t&1&&(s(0),d(1,"translate")),t&2&&x(" ",m(1,1,"draft.list-prefix.existing")," ")}function Be(t,i){t&1&&(s(0),d(1,"translate")),t&2&&x(" ",m(1,1,"draft.list-prefix.new")," ")}function Ze(t,i){if(t&1){let e=g();c(0,"lg-gap-row",6)(1,"a",7),k(2,Fe,2,3)(3,Be,2,3),s(4),a(),c(5,"small",8),s(6),d(7,"translate"),d(8,"timeAgo"),a(),c(9,"lg-button",9),C("click",function(){_(e);let o=p().$implicit,u=p(2);return f(u.deleteDraft(o))}),T(10,"mat-icon",10),a()()}if(t&2){let e=p().$implicit;l("center",!0),r(),l("routerLink","/products/draft/"+(e==null?null:e.uuid)),r(),A(!(e==null||e.meta==null)&&e.meta.uuid?2:3),r(2),x(" ",(e==null||e.data==null?null:e.data.name)||"Unknown"," "),r(2),I(" ",m(7,10,"edited-at-label")," ",m(8,12,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," "),r(3),v("danger"),l("size","tiny")("icon",!0)}}function Oe(t,i){if(t&1&&P(0,Ze,11,14,"ng-template",3),t&2){let e=i.$implicit;l("uuid",e.uuid)}}function Me(t,i){if(t&1){let e=g();c(0,"lg-expander",0),d(1,"translate"),d(2,"translate"),c(3,"lg-inline-separated-group"),P(4,Re,3,7,"ng-template",1)(5,ke,2,4,"ng-template",1),k(6,Ve,1,0,null,1),a(),c(7,"lg-card-list",2),C("onSelected",function(o){_(e);let u=p();return f(u.selectionZoneService.putSelected(o))}),b(8,Oe,1,1,null,3,Ee),a()()}if(t&2){let e,n,o=p();l("closeLabel",m(1,6,"drafts-close-label"))("openLabel",F(2,8,"drafts-label",se(11,we,(e=o.drafts())==null?null:e.length))),r(6),A((n=o.selectionZoneService.selected())?6:-1,n),r(),l("mode",o.selectionZoneService.selectionMode())("selectAll",o.selectionZoneService.selectAll().draft)("deselectAll",o.selectionZoneService.deselectAll().draft),r(),h(o.drafts())}}var Q=class t{constructor(i,e,n){this._productsRepository=i;this._notificationsService=e;this.selectionZoneService=n}products=U(D(K));drafts=re([]);ProductDbInputScheme=w;get hidden(){return this.drafts()?.length===0?!0:null}deleteDraft(i){this._productsRepository.removeDraftProduct(i.uuid),this.drafts.update(e=>e.filter(n=>n?.uuid!==i.uuid))}deleteAllDrafts(){this._productsRepository.removeDraftMany(this.drafts().map(i=>i.uuid)).then(()=>{this.drafts.set([]),this._notificationsService.success("Drafts deleted")})}deletedSelectedDrafts(){let i=this.selectionZoneService.selected().draft;i&&this._productsRepository.removeDraftMany(Array.from(i)).then(()=>{this.drafts.update(e=>e.filter(n=>!i.has(n.uuid))),this._notificationsService.success("Drafts deleted")})}ngOnInit(){let i=this._productsRepository.getDraftProducts();i&&this.drafts.set(i)}static \u0275fac=function(e){return new(e||t)(S(L),S(O),S(y))};static \u0275cmp=R({type:t,selectors:[["lg-draft-products-list"]],hostVars:1,hostBindings:function(e,n){e&2&&le("hidden",n.hidden)},features:[V([y])],decls:1,vars:1,consts:[[3,"closeLabel","openLabel"],["lgInlineSeparatedGroup",""],[2,"--card-bg","#bee5ff",3,"onSelected","mode","selectAll","deselectAll"],["lgCardListItem","","type","draft",3,"uuid"],[3,"click","flat","size"],[3,"click","flat","disabled","size"],[3,"center"],["lgExpand","",3,"routerLink"],["lgPull","",1,"text-muted","text-cursive"],[3,"click","size","icon"],["aria-hidden","false","fontIcon","close"]],template:function(e,n){if(e&1&&k(0,Me,10,13,"lg-expander",0),e&2){let o;A((o=n.drafts())!=null&&o.length?0:-1)}},dependencies:[z,N,j,$,G,B,M,J,xe,Z,Te,q,H],encapsulation:2})};var ze=()=>["product"],Ne=(t,i)=>i==null?null:i.uuid;function je(t,i){if(t&1){let e=g();c(0,"lg-button",5),C("click",function(){_(e);let o=p();return f(o.exportProducts(o.selectionZoneService.selected().product))}),s(1),d(2,"translate"),a()}t&2&&(v("info"),l("flat",!0)("size","small"),r(),x(" ",m(2,5,"export-label")," products "))}function Ge(t,i){if(t&1&&(c(0,"span"),s(1),a()),t&2){let e=i.$implicit;r(),ae(e==null?null:e.name)}}function $e(t,i){if(t&1){let e=g();c(0,"lg-import",6),d(1,"translate"),C("onDone",function(){_(e);let o=p();return f(o.loadProducts())}),P(2,Ge,2,1,"ng-template",7),a()}if(t&2){let e=p();l("label",m(1,3,"import-label")+" products")("schema",e.ProductScheme)("storeName",e.Stores.PRODUCTS)}}function Ue(t,i){if(t&1){let e=g();c(0,"lg-gap-row",4)(1,"div",11)(2,"lg-gap-row",4)(3,"lg-gap-row",12)(4,"a",13),s(5),a(),c(6,"div"),s(7),d(8,"number"),a()(),c(9,"small",14),s(10),d(11,"translate"),d(12,"timeAgo"),a()()(),c(13,"lg-button",15),C("click",function(){_(e);let o=p().$implicit,u=p(2);return f(u.deleteProduct(o))}),T(14,"mat-icon",16),a()()}if(t&2){let e=p().$implicit;l("center",!0),r(2),l("center",!0),r(),l("center",!0),r(),l("routerLink","/products/edit/"+e.uuid),r(),I(" ",e.name," ",e.source?"- "+e.source:""," "),r(2),I(" ",F(8,14,e.pricePerUnit,"1.2-5")," ",e.perUnitLabel," "),r(3),I(" ",m(11,17,"edited-at-label")," ",m(12,19,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," "),r(3),v("danger"),l("size","tiny")("icon",!0)}}function He(t,i){if(t&1&&P(0,Ue,15,21,"ng-template",10),t&2){let e=i.$implicit;l("uuid",e.uuid)}}function qe(t,i){if(t&1){let e=g();c(0,"lg-title",8),s(1),d(2,"translate"),a(),c(3,"lg-card-list",9),C("onSelected",function(o){_(e);let u=p();return f(u.selectionZoneService.putSelected(o))}),b(4,He,1,1,null,10,Ne),a()}if(t&2){let e=i.$implicit,n=p();l("level",3),r(),x(" ",(e==null?null:e.category)||m(2,5,"without-category-label")," "),r(2),l("mode",n.selectionZoneService.selectionMode())("selectAll",n.selectionZoneService.selectAll().product)("deselectAll",n.selectionZoneService.deselectAll().product),r(),h(e.products)}}function Je(t,i){t&1&&(c(0,"lg-gap-row",4)(1,"lg-title",8),s(2),d(3,"translate"),a()()),t&2&&(l("center",!0),r(),l("level",5),r(),x(" ",m(3,3,"no-products")," "))}var Ie=class t{constructor(i,e,n,o){this._productsRepository=i;this._transferDataService=e;this._notificationsService=n;this.selectionZoneService=o}products=U(D(K));ProductDbInputScheme=w;Stores=me;exportProducts(i){this._transferDataService.exportTable("productsStore","json",{selected:Array.from(i??[])})}deleteProduct(i){i.uuid&&this._productsRepository.deleteProduct(i.uuid).then(()=>{this._notificationsService.success("Product deleted"),this.loadProducts()})}ngOnInit(){this.loadProducts()}loadProducts(){this._productsRepository.loadAll()}ProductScheme=w;static \u0275fac=function(e){return new(e||t)(S(L),S(_e),S(O),S(y))};static \u0275cmp=R({type:t,selectors:[["lg-product-list"]],features:[V([y])],decls:16,vars:11,consts:[[3,"icon","link","size"],["aria-hidden","false","fontIcon","add"],["lgInlineSeparatedGroup",""],[3,"selectionTypes"],[3,"center"],[3,"click","flat","size"],[3,"onDone","label","schema","storeName"],["lgImportRowTpl",""],[3,"level"],[3,"onSelected","mode","selectAll","deselectAll"],["lgCardListItem","","type","product",3,"uuid"],[1,"expand"],["lgExpand","",3,"center"],[3,"routerLink"],[1,"text-muted","text-cursive"],[3,"click","size","icon"],["aria-hidden","false","fontIcon","close"]],template:function(e,n){e&1&&(c(0,"lg-controls-bar")(1,"lg-button",0),T(2,"mat-icon",1),a(),c(3,"lg-inline-separated-group"),P(4,je,3,7,"ng-template",2)(5,$e,3,5,"ng-template",2),a()(),c(6,"lg-fade-in")(7,"lg-container")(8,"lg-title"),s(9),d(10,"translate"),a(),T(11,"lg-draft-products-list")(12,"lg-selection-tools",3),b(13,qe,6,7,null,null,ce,!1,Je,4,5,"lg-gap-row",4),a()()),e&2&&(r(),v("success"),l("icon",!0)("link","/products/add")("size","medium"),r(8),x(" ",m(10,8,"products.list-title")," "),r(3),l("selectionTypes",pe(10,ze)),r(),h(n.products()))},dependencies:[z,N,j,fe,ge,de,$,G,ve,B,Se,Ce,ye,De,M,J,Z,Q,q,H],styles:["[_nghost-%COMP%]{display:block}"]})};export{Ie as ProductListComponent};
