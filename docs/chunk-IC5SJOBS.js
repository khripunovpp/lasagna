import{a as ot,b as rt}from"./chunk-VVCVIHN6.js";import{a as it}from"./chunk-6SCHF63Q.js";import{a as Ye,b as Je,c as Xe,e as ne,f as Ze}from"./chunk-YZBY2JK6.js";import{a as lt}from"./chunk-PJN73GXT.js";import{a as Ke}from"./chunk-H6EUHFZS.js";import{a as at}from"./chunk-KLASXVLN.js";import{a as tt,c as nt}from"./chunk-L3LCR6UX.js";import{a as pt}from"./chunk-655VU2I6.js";import{a as et}from"./chunk-QM3SBOTO.js";import"./chunk-CWUUYJTE.js";import{a as We,b as qe}from"./chunk-FHCFN5NX.js";import{a as He}from"./chunk-5ZBILTT3.js";import{v as Qe}from"./chunk-6MF4VL6X.js";import{a as Ge}from"./chunk-BB67CUFS.js";import{a as ee}from"./chunk-TKRM7P4A.js";import{a as Be}from"./chunk-3I72BRDH.js";import{a as te}from"./chunk-57SGI4YT.js";import{a as $e}from"./chunk-RWYIQ5OP.js";import"./chunk-4U4Z3QUR.js";import{a as je}from"./chunk-HK2A7YRA.js";import"./chunk-MPFUNZLY.js";import{a as ze}from"./chunk-SDVVFYH2.js";import{i as k,l as Z}from"./chunk-V37G44FO.js";import"./chunk-UXDGYM6T.js";import{B as Ee,D as K,E as ke,F as ae,H as S,I as De,J as Ve,M as Me,N as Ne,O as Oe,P as Ue,R as Le,S as Y,T as Pe,aa as J,e as Te,g as Ae,ja as X,l as le,la as ie,q as Fe,t as q,v as H,x as Ie}from"./chunk-DE57DFLU.js";import{m as W,p as be,q as we}from"./chunk-CKZTBBM3.js";import"./chunk-CABIONZL.js";import"./chunk-EMIJRNYJ.js";import{h as Se}from"./chunk-VKLQR74F.js";import{$a as r,Cc as m,Db as h,Dc as f,Ec as ve,Fb as v,H as P,Ib as B,Jb as G,Kb as l,Lb as a,Mb as p,Mc as Re,Nb as x,Nc as xe,Ob as U,Pb as L,Qc as ye,Rb as y,Rc as I,Sc as N,Tc as Q,Vb as _,Wb as s,Xb as ue,Yb as fe,_ as de,cc as T,dc as M,ea as me,eb as R,ec as z,hc as E,jc as d,kc as _e,la as g,lb as F,lc as u,ma as C,mc as ge,qb as w,s as se,uc as Ce,va as b,vc as he,wc as j,yc as $}from"./chunk-TMZLFVGH.js";import"./chunk-2RGDSI3Q.js";import"./chunk-FK6H3RFT.js";import{a as D,b as V}from"./chunk-C6Q5SG76.js";var st=["*"];function dt(i,t){if(i&1&&(a(0,"p",1),d(1),p()),i&2){let e=s();r(),u(" ",e.label()," ")}}var oe=class i{constructor(){}label=I("");static \u0275fac=function(e){return new(e||i)};static \u0275cmp=F({type:i,selectors:[["lg-control-group"]],inputs:{label:[1,"label"]},ngContentSelectors:st,decls:4,vars:1,consts:[[1,"control-group"],[1,"control-group__label"],[1,"control-group__content"]],template:function(e,n){e&1&&(ue(),a(0,"div",0),h(1,dt,2,1,"p",1),a(2,"div",2),fe(3),p()()),e&2&&(r(),v(n.label()?1:-1))},styles:["[_nghost-%COMP%]{display:flex;flex:1}.control-group[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:16px}.control-group__label[_ngcontent-%COMP%]{font-size:1.2rem;margin:0}.control-group__content[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:flex-end}.control-group__content[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{flex:1}"]})};var ft=i=>({background:i}),_t=(i,t)=>(t==null?null:t.name)??(t==null?null:t.label)??t;function gt(i,t){if(i&1&&d(0),i&2){let e=t.item;u(" ",(e==null?null:e.name)??(e==null?null:e.label)??e," ")}}function Ct(i,t){if(i&1&&d(0),i&2){let e=t.item;u(" ",(e==null?null:e.name)??(e==null?null:e.label)??e," ")}}function ht(i,t){if(i&1){let e=y();a(0,"div",5)(1,"span",6),d(2),p(),a(3,"span",7),_("click",function(){let o=g(e).$implicit,c=s().clear;return C(c(o))}),d(4,"\xD7"),p()()}if(i&2){let e=t.$implicit;l("ngStyle",$(2,ft,e!=null&&e.color?e==null?null:e.color:null)),r(2),u(" ",(e==null?null:e.name)??(e==null?null:e.label)??e," ")}}function vt(i,t){if(i&1&&B(0,ht,5,4,"div",5,_t),i&2){let e=t.items;G(e)}}var re=class i{constructor(t){this._selectResourcesService=t}placeholder="";resource=I("");autoLoad=I(!1);multi=I(!1);loadedList=b([]);onSelected=ye();value=null;selectComponent=N(ne);addTagFn(t){return q.fromRaw(t)}onChange=()=>{};onTouched=()=>{};searchFn=(t,e)=>e?.toString().toLowerCase().includes(t.toLowerCase());compareWith=(t,e)=>t===e;writeValue(t){this.change(t)}change(t){Array.isArray(t)?this.value=t.map(e=>q.fromRaw(e).toDTO()):this.value=q.fromRaw(t).toDTO(),console.log("new tags value",t),this.onChange(this.value)}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}onChangeInput(t){this.change(t)}onChangeSelect(t){this.change(t),this.onSelected.emit(t)}ngOnInit(){this._selectResourcesService.register(this.resource()),this.autoLoad()&&this._selectResourcesService.load([this.resource()]),this._selectResourcesService.subscribe(t=>{let e=t.get(this.resource())?.list??[];this.loadedList.set(e)})}reload(){return this._selectResourcesService.load([this.resource()],!0)}static \u0275fac=function(e){return new(e||i)(R(k,8))};static \u0275cmp=F({type:i,selectors:[["lg-tags-control"]],viewQuery:function(e,n){e&1&&T(n.selectComponent,ne,5),e&2&&M()},inputs:{placeholder:"placeholder",resource:[1,"resource"],autoLoad:[1,"autoLoad"],multi:[1,"multi"]},outputs:{onSelected:"onSelected"},features:[j([{provide:Ie,useExisting:de(()=>i),multi:!0}])],decls:5,vars:8,consts:[[1,"tags-control"],[3,"change","ngModelChange","addTag","appendTo","compareWith","items","multiple","ngModel","placeholder","searchFn"],["ng-label-tmp",""],["ng-option-tmp",""],["ng-multi-label-tmp",""],[1,"ng-value",3,"ngStyle"],[1,"ng-value-label"],["aria-hidden","true",1,"ng-value-icon","right",3,"click"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"ng-select",1),_("change",function(c){return n.onChangeSelect(c)})("ngModelChange",function(c){return n.onChangeInput(c)}),w(2,gt,1,1,"ng-template",2)(3,Ct,1,1,"ng-template",3)(4,vt,2,0,"ng-template",4),p()()),e&2&&(r(),l("addTag",n.addTagFn)("appendTo","body")("compareWith",n.compareWith)("items",n.loadedList())("multiple",n.multi())("ngModel",n.value)("placeholder",n.placeholder)("searchFn",n.searchFn))},dependencies:[ne,Y,K,De,Ye,Je,Xe,Se],styles:[`lg-tags-control{display:flex;flex:1;min-width:150px}.tags-control{flex:1;width:100%}.tags-control .ng-select .ng-select-container{height:51px}.tags-control .ng-select .ng-select-container{border:none;border-radius:12px;background-color:var(--control-bg)}.tags-control .ng-select .ng-select-container .ng-input{top:16px!important}.tags-control .ng-select .ng-select-container .ng-input>input{color:var(--text);font-family:inherit;font-size:inherit}.tags-control .ng-dropdown-panel{border:none;box-shadow:0 4px 16px #0000001a;border-radius:12px;overflow:hidden}.tags-control .ng-dropdown-panel .ng-option{padding:16px;border-radius:12px}
`],encapsulation:2})};var xt=["tooltipComponent"],yt=["products"],St=["productsSelector"],bt=["nameField"],wt=i=>({unit:i}),Tt=(i,t)=>t.value.amount+i+1;function At(i,t){i&1&&x(0,"lg-unit-switcher",19)}function Ft(i,t){if(i&1){let e=y();a(0,"lg-multiselect",32),_("onSelected",function(){g(e);let o=s().$index,c=z(14),A=s();return C(A.onIngredientSelected(c,o,["product_id","name"]))}),p()}i&2&&l("resource","recipes")("autoLoad",!0)}function It(i,t){if(i&1){let e=y();a(0,"lg-multiselect",33,3),_("onSelected",function(){g(e);let o=s().$index,c=z(14),A=s();return C(A.onIngredientSelected(c,o,["recipe_id","name"]))}),p()}i&2&&l("resource","products")("autoLoad",!0)}function Et(i,t){i&1&&x(0,"lg-unit-switcher",34)}function kt(i,t){i&1&&x(0,"hr",31)}function Dt(i,t){if(i&1){let e=y();U(0,12),a(1,"lg-controls-row",20)(2,"lg-flex-column",21),U(3,22),a(4,"lg-button",23),_("click",function(){let o=g(e).$index,c=s();return C(c.closeRecipeField(o))}),d(5),m(6,"translate"),p(),L(),U(7,24),a(8,"lg-button",23),_("click",function(){let o=g(e).$index,c=s();return C(c.openRecipeField(o))}),d(9),m(10,"translate"),p(),L(),h(11,Ft,1,2,"lg-multiselect",25)(12,It,2,2,"lg-multiselect",26),p(),a(13,"lg-number-input",27,1),m(15,"translate"),_("onKeydown",function(){g(e);let o=s();return C(o.addLast())}),w(16,Et,1,0,"ng-template",9),p(),U(17,28),a(18,"lg-button",29),_("click",function(){let o=g(e).$index,c=s();return C(c.deleteIngredient(o))}),x(19,"mat-icon",30),p(),L(),p(),h(20,kt,1,0,"hr",31),L()}if(i&2){let e=t.$index,n=t.$count,o=s();l("formGroupName",e),r(),l("mobileMode",!0),r(),l("size","small"),r(2),l("flat",!0)("size","small")("active",!o.recipeFieldState()[e]),r(),u(" ",f(6,18,"recipe.form.ingredients.product_id.label")," "),r(3),l("flat",!0)("size","small")("active",o.recipeFieldState()[e]),r(),u(" ",f(10,20,"recipe.form.ingredients.recipe_id.label")," "),r(2),v(o.recipeFieldState()[e]?11:12),r(2),l("placeholder",ve(15,22,"recipe.form.ingredients.amount.placeholder",$(25,wt,(o.form.value.ingredients==null||o.form.value.ingredients[e]==null?null:o.form.value.ingredients[e].unit)||"gram"))),r(5),E("danger"),l("size","tiny")("icon",!0),r(2),v(e!==n-1?20:-1)}}function Vt(i,t){if(i&1&&x(0,"lg-chips-list",17),i&2){let e=s(),n=z(27);l("control",n)("items",e.topCategories())}}var O=class i{constructor(t,e,n,o,c){this._recipesRepository=t;this._selectResourcesService=e;this._router=n;this._aRoute=o;this._notificationsService=c}recipe=I(void 0);uuid=Fe("uuid");form=new ae({name:new S(null,Ee.required),description:new S(""),outcome_amount:new S(null),outcome_unit:new S(""),ingredients:new Le([this._getIngredientGroup()]),category_id:new S(null),tags:new S([])},t=>H.fromRaw(t.value).outcomeAmountGreaterThanIngredients?{outcomeAmountGreaterThanIngredients:!0}:null);recipeFieldState=b({});tooltipComponent=Q("tooltipComponent");productsWidget=Q("products");productsSelector=Q("productsSelector");nameField=N("nameField");topCategories=b([]);recipeEffect=xe(()=>{this.recipe()&&this.fillForm(this.recipe())});get ingredients(){return this.form.get("ingredients")}get _formValid(){return this.form.valid&&!this.checkCycleRecipe(this.form.getRawValue().ingredients,this.uuid())}fillForm(t){this.form.reset({ingredients:[]}),this.ingredients.clear(),t&&(console.log("newformValue",le(t)),this.form.reset(V(D({},le(t)),{ingredients:[]})),t.ingredients.length?t.ingredients.forEach((e,n)=>{this.ingredients.push(this._getIngredientGroup(e)),e.recipe_id&&this.openRecipeField(n)}):this.ingredients.push(this._getIngredientGroup()),this.form.updateValueAndValidity(),this.form.markAsPristine())}resetForm(t){this.fillForm(t),this._loadUsingHistory(),this.form.markAsPristine()}validateForm(){return this._formValid?!0:(this._notificationsService.error(this._notificationsService.parseFormErrors(this.form).join(", ")),!1)}addLast(){let t=this.ingredients.at(this.ingredients.length-1);(t.value.name||t.value.amount||t.value.product_id)&&this.addIngredient()}ngOnInit(){this._loadUsingHistory(),this.form.valueChanges.pipe(P(100)).subscribe({next:t=>{if(console.log("form values",t),!this.form.dirty)return;this.recipe()?.update(this.form.getRawValue()),this.checkCycleRecipe(this.form.getRawValue().ingredients,this.uuid())&&this._notificationsService.error("You cannot add a recipe to itself")}})}ngAfterViewInit(){this._selectResourcesService.load().then(t=>{}),this.recipe()?.uuid||this.nameField().focus()}addIngredient(){this.ingredients.push(this._getIngredientGroup()),this.form.markAsDirty()}deleteIngredient(t){this.ingredients.removeAt(t),this.form.markAsDirty()}onIngredientSelected(t,e,n){t.focus();let o=this.ingredients.at(e).value;this.ingredients.at(e).patchValue(V(D({},Array.isArray(n)?n.reduce((c,A)=>V(D({},c),{[A]:null}),{}):{[n]:null}),{unit:o.product_id?.unit||o.recipe_id?.unit||"gram"}))}openRecipeField(t){this.recipeFieldState.update(e=>V(D({},e),{[t]:!0}))}closeRecipeField(t){this.recipeFieldState.update(e=>V(D({},e),{[t]:!1}))}checkCycleRecipe(t,e){let n=!1;for(let o of t){let c=o.recipe_id?.uuid;if(c&&c===e){n=!0;break}}return n}_loadUsingHistory(){this._recipesRepository.getTopCategories().then(t=>{this.topCategories.set(t.map(e=>({label:e.name,value:{uuid:e.uuid,name:e.name}})))})}_getIngredientGroup(t){return new ae({name:new S(t?.name),amount:new S(t?.amount?.toString()??null),product_id:new S(t?.product_id?t.product_id:null),recipe_id:new S(t?.recipe_id?t.recipe_id:null),unit:new S(t?.unit??"gram")},e=>{let n=Te.fromRaw(e.value);if(n.allEmpty)return null;if(n.typeSelected&&!n.amountValid)return{ingredientAmountRequired:!0};if(!this.uuid)return null;let o=this.uuid();return this.checkCycleRecipe([e.value],o)?{cycleRecipe:!0}:n.typeSelected?null:{ingredientRequired:!0}})}static \u0275fac=function(e){return new(e||i)(R(Z),R(k),R(be),R(W),R(X))};static \u0275cmp=F({type:i,selectors:[["lg-add-recipe-form"]],viewQuery:function(e,n){e&1&&(T(n.tooltipComponent,xt,5),T(n.productsWidget,yt,5),T(n.productsSelector,St,5),T(n.nameField,bt,5)),e&2&&M(4)},inputs:{recipe:[1,"recipe"]},features:[j([{provide:k,useClass:k}])],decls:30,vars:34,consts:[["nameField",""],["amount",""],["categorySelect",""],["productsSelector",""],[3,"formGroup"],[3,"position"],["appendTo","body","formControlName","name","lgExpand","",3,"key","placeholder","resource"],["formControlName","description","lgExpand","",3,"placeholder"],["formControlName","outcome_amount","lgExpand","","lgParseMath","",3,"placeholder"],["lgExtraTpl","","place","after"],["lgExpand","",3,"label"],["formArrayName","ingredients","lgExpand","",3,"size"],[3,"formGroupName"],[3,"click","size"],[2,"--control-bg","#ffffff",3,"equal","mobileMode"],[3,"position","size"],["appendTo","body","formControlName","category_id","lgExpand","",3,"resource"],[3,"control","items"],["formControlName","tags",3,"multi","resource"],["formControlName","outcome_unit"],[3,"mobileMode"],[3,"size"],["ngProjectAs","labelTpl",5,["labelTpl"]],[3,"click","flat","size","active"],["ngProjectAs","afterLabelTpl",5,["afterLabelTpl"]],["appendTo","body","formControlName","recipe_id",3,"resource","autoLoad"],["appendTo","body","formControlName","product_id",3,"resource","autoLoad"],["lgParseMath","","formControlName","amount",3,"onKeydown","placeholder"],["ngProjectAs","rowActions",5,["rowActions"]],[3,"click","size","icon"],["aria-hidden","false","fontIcon","close"],["size","2","lgExpand","","color","#fafafa"],["appendTo","body","formControlName","recipe_id",3,"onSelected","resource","autoLoad"],["appendTo","body","formControlName","product_id",3,"onSelected","resource","autoLoad"],["formControlName","unit"]],template:function(e,n){if(e&1){let o=y();a(0,"form",4)(1,"lg-flex-column")(2,"lg-card")(3,"lg-flex-column",5),x(4,"lg-autocomplete",6,0),m(6,"translate"),x(7,"lg-textarea",7),m(8,"translate"),p()(),a(9,"lg-card")(10,"lg-flex-column",5)(11,"lg-number-input",8,1),m(13,"translate"),w(14,At,1,0,"ng-template",9),p(),a(15,"lg-control-group",10),m(16,"translate"),a(17,"lg-flex-column",5)(18,"lg-flex-column",11),B(19,Dt,21,27,"ng-container",12,Tt),p(),a(21,"lg-button",13),_("click",function(){return g(o),C(n.addIngredient())}),d(22),m(23,"translate"),p()()()()(),a(24,"lg-flex-row",14)(25,"lg-flex-column",15),x(26,"lg-multiselect",16,2),h(28,Vt,1,2,"lg-chips-list",17),p(),x(29,"lg-tags-control",18),p()()()}e&2&&(l("formGroup",n.form),r(3),l("position","start"),r(),l("key","name")("placeholder",f(6,24,"recipe.form.name.placeholder"))("resource","recipes-names"),r(3),l("placeholder",f(8,26,"recipe.form.description.placeholder")),r(3),l("position","start"),r(),l("placeholder",f(13,28,"recipe.form.outcome_amount.placeholder")),r(4),l("label",Ce(f(16,30,"recipe.form.ingredients.label"))),r(2),l("position","start"),r(),l("size","medium"),r(),G(n.ingredients.controls),r(2),E("success"),l("size","small"),r(),u(" ",f(23,32,"recipe.form.ingredients.add-btn")," "),r(2),l("equal",!0)("mobileMode",!0),r(),l("position","start")("size","medium"),r(),l("resource","recipes-categories"),r(2),v(n.topCategories().length?28:-1),r(),l("multi",!0)("resource","tags"))},dependencies:[Pe,Ve,K,ke,Me,Ue,Ne,Oe,oe,ee,ie,Ke,Ze,tt,it,He,nt,ot,rt,Y,Qe,J,lt,Ge,et,re,te],encapsulation:2})};function Mt(i,t){i&1&&(a(0,"p"),d(1,"You just added new recipe. "),a(2,"a",4),d(3,"Want to have a look?"),p()()),i&2&&(r(2),l("routerLink",he("/recipes/edit/",t)))}function Nt(i,t){if(i&1&&(a(0,"lg-button",9),d(1),m(2,"translate"),p()),i&2){let e,n=s(2);E("primary"),l("flat",!0)("link","/recipes/calculate/"+((e=n.recipe())==null?null:e.uuid))("size","small"),r(),u(" ",f(2,6,"recipe.calculate-btn")," ")}}function Ot(i,t){i&1&&(a(0,"lg-fade-in"),d(1),m(2,"translate"),p()),i&2&&(r(),u(" ",f(2,1,"saved-draft-label")," "))}function Ut(i,t){i&1&&w(0,Ot,3,3,"ng-template",7)}function Lt(i,t){if(i&1){let e=y();a(0,"lg-button",11),_("click",function(){g(e);let o=s(3);return C(o.onRemoveDraft())}),d(1),m(2,"translate"),p()}i&2&&(E("danger"),l("flat",!0),r(),u(" ",f(2,4,"recipe.form.delete-draft-btn")," "))}function Pt(i,t){if(i&1){let e=y();a(0,"lg-button",11),_("click",function(){g(e);let o=s(3);return C(o.onDeleteRecipe())}),d(1),m(2,"translate"),p()}i&2&&(E("danger"),l("flat",!0),r(),u(" ",f(2,4,"recipe.form.delete-btn")," "))}function Bt(i,t){if(i&1&&h(0,Lt,3,6,"lg-button",10)(1,Pt,3,6,"lg-button",10),i&2){let e,n=s(2);v(n.isDraftRoute()?0:(e=n.recipe())!=null&&e.uuid?1:-1)}}function Gt(i,t){if(i&1&&(a(0,"small",8),d(1),m(2,"translate"),m(3,"timeAgo"),p()),i&2){let e,n=s(2);r(),ge(" ",f(2,2,"edited-at-label")," ",f(3,4,(e=n.recipe())==null?null:e.updatedAt)," ")}}function zt(i,t){if(i&1&&(a(0,"lg-flex-row",5)(1,"lg-title")(2,"span",6),d(3),p()()(),a(4,"lg-inline-separated-group"),w(5,Nt,3,8,"ng-template",7),h(6,Ut,1,0,null,7),w(7,Bt,2,1,"ng-template",7),p(),h(8,Gt,4,6,"small",8)),i&2){let e,n,o,c=s();l("mobileMode",!0)("center",!0),r(3),_e((e=c.recipe())==null?null:e.name),r(3),v(c.draftRef()&&(!((n=c.formComponent())==null||n.form==null)&&n.form.dirty)?6:-1),r(2),v((o=c.recipe())!=null&&o.updatedAt?8:-1)}}function jt(i,t){i&1&&(a(0,"lg-title"),d(1),m(2,"translate"),p()),i&2&&(r(),u(" ",f(2,1,"recipe.form.title")," "))}function $t(i,t){i&1&&(d(0),m(1,"translate")),i&2&&u(" ",f(1,1,"recipe.form.save-btn.edit.active")," ")}function Qt(i,t){i&1&&(d(0),m(1,"translate")),i&2&&u(" ",f(1,1,"recipe.form.save-btn.edit.disabled")," ")}function Wt(i,t){if(i&1){let e=y();a(0,"lg-button",12),_("click",function(){g(e);let o=s();return C(o.onEditRecipe())}),h(1,$t,2,3)(2,Qt,2,3),p()}if(i&2){let e,n,o=s();l("disabled",!(!((e=o.formComponent())==null||e.form==null)&&e.form.dirty)&&!o.draftRef()),r(),v(!((n=o.formComponent())==null||n.form==null)&&n.form.dirty||o.draftRef()?1:2)}}function qt(i,t){i&1&&(d(0),m(1,"translate")),i&2&&u(" ",f(1,1,"recipe.form.save-btn.add.active")," ")}function Ht(i,t){i&1&&(d(0),m(1,"translate")),i&2&&u(" ",f(1,1,"recipe.form.save-btn.add.disabled")," ")}function Kt(i,t){if(i&1){let e=y();a(0,"lg-button",12),_("click",function(){g(e);let o=s();return C(o.onAddRecipe())}),h(1,qt,2,3)(2,Ht,2,3),p()}if(i&2){let e,n,o=s();l("disabled",!(!((e=o.formComponent())==null||e.form==null)&&e.form.dirty)&&!o.draftRef()),r(),v(!((n=o.formComponent())==null||n.form==null)&&n.form.dirty||o.draftRef()?1:2)}}var ct=class i{constructor(t,e,n){this._aRoute=t;this._recipesRepository=e;this._notificationsService=n}draftOrRecipeUUID=b(void 0);recipe=b(void 0);formComponent=N(O);draftRef=b(void 0);draftByExistingRecipe=Re(()=>this.draftRef().meta?.uuid);isDraftRoute=b(!1);draftRecipeModel;addedRecipeInformerUUID=b(null);_routerManager=me(pt);ngOnInit(){se([this._aRoute.params,this._aRoute.data]).subscribe(([t,e])=>{let n=e.draft;this.draftOrRecipeUUID.set(t.uuid),n?(this.draftRef.set(n),this.recipe.set(n.data)):e.recipe?this.recipe.set(e.recipe):this.draftOrRecipeUUID()?this._loadRecipe(this.draftOrRecipeUUID()):this.recipe.set(H.empty()),this.isDraftRoute.set(!!e.draftRoute)})}ngAfterViewInit(){this.formComponent()?.form.valueChanges.pipe(P(500)).subscribe(t=>{this.formComponent().form.dirty&&(this.draftRef()?.uuid?this._recipesRepository.updateDraftRecipe(this.draftRef().uuid,this.recipe(),this.draftRef().meta?.uuid):this.recipe()&&(this.draftRef.set(this._recipesRepository.saveDraftRecipe(this.recipe(),this.draftOrRecipeUUID()??"")),this.isDraftRoute()||this._routerManager.replace(["recipes/draft/"+this.draftRef().uuid])))})}async onAddRecipe(){try{if(!this.formComponent()?.validateForm()||!this.recipe())return;let t=await this._addRecipe(this.recipe());this.addedRecipeInformerUUID.set(t)}catch(t){this._notificationsService.error(Ae(t))}}async onEditRecipe(){!this.formComponent()?.validateForm()||!this.recipe()||await this._editRecipe(this.recipe())}onRemoveDraft(){this._removeDraft(),this._routerManager.navigate(["recipes"])}onDeleteRecipe(){this.recipe()?.uuid&&this._recipesRepository.deleteOne(this.recipe().uuid).then(()=>{this._notificationsService.success("Recipe deleted"),this._routerManager.navigate(["recipes"])})}_addRecipe(t){return this._recipesRepository.addRecipe(t).then(e=>(this.formComponent()?.resetForm(),this._notificationsService.success("Recipe added"),this.recipe.set(void 0),this.draftRef()&&this._removeDraft(),this._routerManager.navigateWithReset(["recipes","edit",e]),e))}_editRecipe(t){if(!this.draftOrRecipeUUID())return Promise.resolve();let e=this.draftRef()?.meta?.uuid??this.draftOrRecipeUUID();return this._recipesRepository.editRecipe(e,t).then(()=>{this.formComponent()?.resetForm(t),this._notificationsService.success("Recipe edited"),this.draftRef()&&this._removeDraft(),this._routerManager.navigateWithReset(["recipes","edit",e])})}_removeDraft(){this.draftRef()&&(this._recipesRepository.removeDraftRecipe(this.draftRef().uuid),this.draftRef.set(void 0))}_loadRecipe(t){t&&this._recipesRepository.getOne(t).then(e=>{e&&this.recipe.set(e)})}static \u0275fac=function(e){return new(e||i)(R(W),R(Z),R(X))};static \u0275cmp=F({type:i,selectors:[["app-add-recipe"]],viewQuery:function(e,n){e&1&&T(n.formComponent,O,5),e&2&&M()},decls:10,vars:6,consts:[["size","medium"],[3,"recipe"],[3,"mobileMode","relaxed"],["lgShrink","",3,"disabled"],[3,"routerLink"],[3,"mobileMode","center"],[1,"text-active"],["lgInlineSeparatedGroup",""],[1,"text-muted","text-cursive"],[3,"flat","link","size"],["lgShrink","",3,"style","flat"],["lgShrink","",3,"click","flat"],["lgShrink","",3,"click","disabled"]],template:function(e,n){if(e&1&&(a(0,"lg-fade-in")(1,"lg-container")(2,"lg-flex-column",0),h(3,Mt,4,2,"p"),h(4,zt,9,5)(5,jt,3,3,"lg-title"),p(),x(6,"lg-add-recipe-form",1),a(7,"lg-flex-row",2),h(8,Wt,3,2,"lg-button",3)(9,Kt,3,2,"lg-button",3),p()()()),e&2){let o,c,A;r(3),v((o=n.addedRecipeInformerUUID())?3:-1,o),r(),v((c=n.recipe())!=null&&c.uuid&&!n.draftRef()||n.draftRef()&&n.draftByExistingRecipe()?4:5),r(2),l("recipe",n.recipe()),r(),l("mobileMode",!0)("relaxed",!0),r(),v((A=n.recipe())!=null&&A.uuid&&!n.draftRef()||n.draftRef()&&n.draftByExistingRecipe()?8:9)}},dependencies:[Be,ze,O,ie,te,je,at,$e,ee,J,we,qe,We],encapsulation:2})};export{ct as AddRecipeComponent};
