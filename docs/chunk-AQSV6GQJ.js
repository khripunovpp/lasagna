import{a as ze}from"./chunk-MMV6CZNQ.js";import{a as he,b as Re,c as l,d as Te,e as Ie,f as ke}from"./chunk-EM3JJMDU.js";import{a as be,b as De}from"./chunk-FI4EEUH6.js";import"./chunk-5QR6COKJ.js";import{a as Be,c as Ge}from"./chunk-PTQJONKF.js";import"./chunk-KQ5QEUS5.js";import{a as we}from"./chunk-YNVNIL7S.js";import{a as Le}from"./chunk-QL7ZW4I4.js";import"./chunk-DR46QMBJ.js";import{a as Ae}from"./chunk-EOJINCHP.js";import"./chunk-YAO3K425.js";import"./chunk-B7X622D5.js";import{a as ye}from"./chunk-O43MYOCU.js";import{a as N,b as Q}from"./chunk-HCUERNTX.js";import{a as Ee}from"./chunk-C5H2I4FC.js";import{v as xe}from"./chunk-VLSBBD43.js";import{a as Ce}from"./chunk-EIVKJBV7.js";import{a as _e}from"./chunk-TBBEROLX.js";import{a as L}from"./chunk-U5RG623K.js";import{a as j}from"./chunk-MUGSSU5U.js";import{a as Z}from"./chunk-7C3OD2VZ.js";import"./chunk-4U4Z3QUR.js";import{a as ve}from"./chunk-VPY63KRA.js";import"./chunk-MPFUNZLY.js";import{a as Se}from"./chunk-O2QGAP6D.js";import{k as fe,m as O}from"./chunk-F7IPTZBX.js";import"./chunk-JIYA5WDW.js";import{ma as V,na as R,o as de,oa as w,q as ue,s as P,y as ge,z as I}from"./chunk-SCGAETAM.js";import{m as ce,p as me,q as F,u as M}from"./chunk-J6CDYHKM.js";import"./chunk-CABIONZL.js";import"./chunk-EMIJRNYJ.js";import"./chunk-ZA7VU5CB.js";import{$a as n,$b as oe,Bb as ee,Cc as d,Db as k,Dc as u,Ec as pe,Fb as z,Ib as te,Jb as ie,Kb as s,Lb as a,Mb as p,Nb as B,Nc as se,Rb as h,Vb as g,Wb as C,Zb as ne,ac as re,bb as Y,ea as b,eb as _,hc as f,jc as c,kc as T,la as v,lb as D,lc as m,ma as y,mc as G,nb as U,qb as x,ra as X,sb as K,va as E,wc as A,xc as le,yc as ae}from"./chunk-X5WXA3YI.js";import"./chunk-2RGDSI3Q.js";import"./chunk-FK6H3RFT.js";import"./chunk-C6Q5SG76.js";var Fe=l.object({name:l.string(),amount:l.number().or(l.string()),uuid:l.string().optional(),product_id:Ie,recipe_id:l.lazy(()=>$),unit:l.enum(["gram","portion","piece"])});var $=l.object({name:l.string(),uuid:l.string().optional(),description:l.string(),ingredients:l.array(l.lazy(()=>Fe)),outcome_unit:Te,outcome_amount:l.number().or(l.string()),taxTemplateName:l.string().optional(),category_id:l.string().nullable().optional(),createdAt:l.union([l.string(),l.number()]).optional(),updatedAt:l.union([l.string(),l.number()]).optional(),tags:l.array(l.string()).optional(),color:l.string().optional(),priceModifiers:l.array(l.object({action:l.enum(["add","subtract","round"]),value:l.number().or(l.string()),unit:l.enum(["currency","percent"])})).optional()});var Ve=i=>({length:i}),Oe=(i,t)=>t.uuid;function Ze(i,t){if(i&1){let e=h();a(0,"lg-button",4),g("click",function(){v(e);let r=C(2);return y(r.selectionZoneService.onSelection())}),c(1),d(2,"translate"),p()}i&2&&(f("success"),s("flat",!0)("size","small"),n(),m(" ",u(2,5,"select-many-label")," "))}function je(i,t){if(i&1){let e=h();a(0,"lg-button",4),g("click",function(){v(e);let r=C(2);return y(r.deleteAllDrafts())}),c(1),d(2,"translate"),p()}i&2&&(f("danger"),s("flat",!0)("size","small"),n(),m(" ",u(2,5,"delete-all-label")," "))}function Ne(i,t){if(i&1){let e=h();a(0,"lg-button",5),g("click",function(){v(e);let r=C(3);return y(r.deletedSelectedDrafts())}),c(1),d(2,"translate"),p()}if(i&2){let e=C();f("danger"),s("flat",!0)("disabled",!(e!=null&&e.size))("size","small"),n(),m(" ",u(2,6,"delete-selected-label")," ")}}function Qe(i,t){i&1&&x(0,Ne,3,8,"ng-template",1)}function $e(i,t){i&1&&(c(0),d(1,"translate")),i&2&&m(" ",u(1,1,"draft.list-prefix.existing")," ")}function qe(i,t){i&1&&(c(0),d(1,"translate")),i&2&&m(" ",u(1,1,"draft.list-prefix.new")," ")}function He(i,t){if(i&1&&(a(0,"lg-flex-row",6)(1,"a",7),k(2,$e,2,3)(3,qe,2,3),c(4),p(),a(5,"small",8),c(6),d(7,"translate"),d(8,"timeAgo"),p()()),i&2){let e=C().$implicit;s("center",!0),n(),s("routerLink","/recipes/draft/"+(e==null?null:e.uuid)),n(),z(!(e==null||e.meta==null)&&e.meta.uuid?2:3),n(2),m(" ",(e==null||e.data==null?null:e.data.name)??""," "),n(2),G(" ",u(7,6,"edited-at-label")," ",u(8,8,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," ")}}function Je(i,t){if(i&1&&x(0,He,9,10,"ng-template",3),i&2){let e=t.$implicit;s("uuid",e.uuid)}}function Ke(i,t){if(i&1){let e=h();a(0,"lg-expander",0),d(1,"translate"),d(2,"translate"),a(3,"lg-inline-separated-group"),x(4,Ze,3,7,"ng-template",1)(5,je,3,7,"ng-template",1),k(6,Qe,1,0,null,1),p(),a(7,"lg-card-list",2),g("onDeleteOne",function(r){v(e);let S=C();return y(S.deleteDraft(r==null?null:r.uuid))})("onSelected",function(r){v(e);let S=C();return y(S.selectionZoneService.putSelected(r))}),te(8,Je,1,1,null,3,Oe),p()()}if(i&2){let e,o,r=C();s("closeLabel",u(1,6,"drafts-close-label"))("openLabel",pe(2,8,"drafts-label",ae(11,Ve,(e=r.drafts())==null?null:e.length))),n(6),z((o=r.selectionZoneService.selected())?6:-1,o),n(),s("mode",r.selectionZoneService.selectionMode())("selectAll",r.selectionZoneService.selectAll())("deselectAll",r.selectionZoneService.deselectAll()),n(),ie(r.drafts())}}var q=class i{constructor(t,e,o){this._recipesRepository=t;this._notificationsService=e;this.selectionZoneService=o}drafts=E([]);Stores=M;get hidden(){return this.drafts()?.length===0?!0:null}ngOnInit(){let t=this._recipesRepository.getDraftRecipe();t&&this.drafts.set(t)}deleteAllDrafts(){this._recipesRepository.removeDraftMany(this.drafts().map(t=>t.uuid)).then(()=>{this.drafts.set([]),this._notificationsService.success("Drafts deleted")})}deletedSelectedDrafts(){let t=this.selectionZoneService.selected();t&&this._recipesRepository.removeDraftMany(Array.from(t)).then(()=>{this.drafts.update(e=>e.filter(o=>!t.has(o.uuid))),this._notificationsService.success("Drafts deleted")})}deleteDraft(t){t&&(this._recipesRepository.removeDraftRecipe(t),this.drafts.update(e=>e.filter(o=>o?.uuid!==t)))}static \u0275fac=function(e){return new(e||i)(_(O),_(V),_(R))};static \u0275cmp=D({type:i,selectors:[["lg-draft-recipes-list"]],hostVars:1,hostBindings:function(e,o){e&2&&ee("hidden",o.hidden)},features:[A([R])],decls:1,vars:1,consts:[[3,"closeLabel","openLabel"],["lgInlineSeparatedGroup",""],[2,"--card-bg","#bee5ff",3,"onDeleteOne","onSelected","mode","selectAll","deselectAll"],["lgCardListItem","","type","draft",3,"uuid"],[3,"click","flat","size"],[3,"click","flat","disabled","size"],[3,"center"],["lgExpand","",3,"routerLink"],[1,"text-muted","text-cursive"]],template:function(e,o){if(e&1&&k(0,Ke,10,13,"lg-expander",0),e&2){let r;z((r=o.drafts())!=null&&r.length?0:-1)}},dependencies:[L,w,we,Le,F,j,Ee,I,ke,Q,N],encapsulation:2})};var H=class i{constructor(t){this.templateRef=t}static \u0275fac=function(e){return new(e||i)(_(Y))};static \u0275dir=U({type:i,selectors:[["","lgGroupingSortingContainer",""]]})};var J=class i{constructor(t){this.translateService=t}groupingToLabel={category:"grouping.by-category",tag:"grouping.by-tag",createdAt:"grouping.by-creation-date",alphabetical:"grouping.by-first-letter"};groupingDirectionToLabel={asc:"grouping.direction.asc",desc:"grouping.direction.desc"};router=b(me);aRouter=b(ce);context;sortChange=new K;groupChange=new K;groupingParam=P("groupBy");sortDirection=P("sortDirection");sortField=P("sortField");defaultDirection="asc";sorting=E({field:"name",direction:this.defaultDirection,group:"category"});sortingEffect=se(()=>{let t=this.sorting();this.sortChange.emit(t)});ngOnInit(){let t=this.aRouter.snapshot.queryParams,e=this.groupingParam(),o=this.sortDirection(),r=this.sortField();this.sorting.set({field:r?.toString()||"name",direction:o?o==="asc"?"asc":"desc":this.defaultDirection,group:e?.toString()||"category"})}onSortChange(t){this.sorting.set({field:t.field||this.sorting().field,direction:t.direction||this.sorting().direction,group:t.group||this.sorting().group}),this.sortChange.emit(this.sorting()),this.router.navigate([],{queryParams:{sortField:t.field||this.sorting().field,sortDirection:t.direction||this.sorting().direction,groupBy:t.group||this.sorting().group},relativeTo:this.aRouter}).then(()=>{window.location.reload()})}getGroupingLabel(t){let e=this.groupingToLabel[t];return e?this.translateService.instant(e):t}getGroupingDirectionLabel(t){let e=this.groupingDirectionToLabel[t];return e?this.translateService.instant(e):t}static \u0275fac=function(e){return new(e||i)(_(ge))};static \u0275cmp=D({type:i,selectors:[["lg-grouping-sorting"]],contentQueries:function(e,o,r){if(e&1&&ne(r,H,5),e&2){let S;oe(S=re())&&(o.context=S.first)}},outputs:{sortChange:"sortChange",groupChange:"groupChange"},decls:27,vars:42,consts:[["lgDropdownAnchor","",3,"size"],[3,"size"],[3,"click","flat","size"]],template:function(e,o){e&1&&(a(0,"lg-flex-row")(1,"lg-dropdown")(2,"lg-button",0),c(3),p(),a(4,"lg-flex-column",1)(5,"span"),c(6),d(7,"translate"),p(),a(8,"lg-button",2),g("click",function(){return o.onSortChange({group:"category"})}),c(9),p(),a(10,"lg-button",2),g("click",function(){return o.onSortChange({group:"tag"})}),c(11),p(),a(12,"lg-button",2),g("click",function(){return o.onSortChange({group:"createdAt"})}),c(13),p(),a(14,"lg-button",2),g("click",function(){return o.onSortChange({group:"alphabetical"})}),c(15),p()()(),a(16,"lg-dropdown")(17,"lg-button",0),c(18),p(),a(19,"lg-flex-column",1)(20,"span"),c(21),d(22,"translate"),p(),a(23,"lg-button",2),g("click",function(){return o.onSortChange({direction:"asc"})}),c(24),p(),a(25,"lg-button",2),g("click",function(){return o.onSortChange({direction:"desc"})}),c(26),p()()()()),e&2&&(n(2),s("size","small"),n(),m(" ",o.getGroupingLabel(o.sorting().group)," "),n(),s("size","small"),n(2),T(u(7,38,"grouping.title")),n(2),f("warning"),s("flat",!0)("size","small"),n(),m(" ",o.groupingToLabel.category," "),n(),f("warning"),s("flat",!0)("size","small"),n(),m(" ",o.groupingToLabel.tag," "),n(),f("warning"),s("flat",!0)("size","small"),n(),m(" ",o.groupingToLabel.createdAt," "),n(),f("warning"),s("flat",!0)("size","small"),n(),m(" ",o.groupingToLabel.alphabetical," "),n(2),s("size","small"),n(),m(" ",o.getGroupingDirectionLabel(o.sorting().direction)," "),n(),s("size","small"),n(2),T(u(22,40,"grouping.direction.title")),n(2),f("warning"),s("flat",!0)("size","small"),n(),m(" ",o.groupingDirectionToLabel.asc," "),n(),f("warning"),s("flat",!0)("size","small"),n(),m(" ",o.groupingDirectionToLabel.desc," "))},dependencies:[L,w,ze,Z,I],encapsulation:2})};var We=()=>["recipe"];function Xe(i,t){if(i&1){let e=h();a(0,"lg-button",8),g("click",function(){v(e);let r=C();return y(r.exportRecipes(r.selectionZoneService.selected()))}),c(1),d(2,"translate"),p()}i&2&&(f("info"),s("flat",!0)("size","small"),n(),m(" ",u(2,5,"export-label")," recipes "))}function Ye(i,t){if(i&1&&(a(0,"span"),c(1),p()),i&2){let e=t.$implicit;n(),T(e==null?null:e.name)}}function Ue(i,t){if(i&1){let e=h();a(0,"lg-import",9),d(1,"translate"),g("onDone",function(){v(e);let r=C();return y(r.loadRecipes())}),x(2,Ye,2,1,"ng-template",10),p()}if(i&2){let e=C();s("label",u(1,3,"import-label")+" products")("schema",e.RecipeScheme)("storeName",e.Stores.RECIPES)}}function et(i,t){if(i&1&&(a(0,"lg-card")(1,"lg-flex-column")(2,"a",11),c(3),p(),a(4,"lg-flex-row")(5,"lg-button",12),c(6),d(7,"translate"),p(),a(8,"small",13),c(9),d(10,"translate"),d(11,"timeAgo"),p()()()()),i&2){let e=t.$implicit;n(2),s("routerLink","/recipes/edit/"+e.uuid),n(),T(e.name),n(2),f("primary"),s("size","small")("link","/recipes/calculate/"+e.uuid)("flat",!0),n(),m(" ",u(7,10,"recipes.calculate-btn")," "),n(3),G(" ",u(10,12,"edited-at-label")," ",u(11,14,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," ")}}var Pe=class i{constructor(t,e,o,r){this._recipesRepository=t;this._notificationsService=e;this._transferDataService=o;this.selectionZoneService=r;this._recipesRepository.recipes$.subscribe({next:S=>{console.log("recipes loaded",S)},error:S=>{}}),this.selectionZoneService.onDelete.pipe(de(this.destroyRef)).subscribe(S=>{this.deleteRecipe(S)})}destroyRef=b(X);recipes=ue(b(Ae));Stores=M;RecipeScheme=$;ngOnInit(){this.loadRecipes()}deleteRecipe(t){t&&this._recipesRepository.deleteOne(t).then(()=>{this._notificationsService.success("Recipe deleted"),this.loadRecipes()})}loadRecipes(){return this._recipesRepository.loadRecipes()}exportRecipes(t){return this._transferDataService.exportTable("recipesStore","json",{selected:Array.from(t||[])})}static \u0275fac=function(e){return new(e||i)(_(O),_(V),_(fe),_(R))};static \u0275cmp=D({type:i,selectors:[["lg-recipes-list"]],features:[A([R])],decls:18,vars:14,consts:[[3,"icon","link","size"],["aria-hidden","false","fontIcon","add"],["lgInlineSeparatedGroup",""],[3,"center"],[3,"size"],[3,"selectionTypes"],[3,"sortResult","selectable"],["lgGroupingTail",""],[3,"click","flat","size"],[3,"onDone","label","schema","storeName"],["lgImportRowTpl",""],[3,"routerLink"],[3,"size","link","flat"],["lgPull","",1,"text-muted","text-cursive"]],template:function(e,o){e&1&&(a(0,"lg-controls-bar")(1,"lg-button",0),B(2,"mat-icon",1),p(),a(3,"lg-inline-separated-group"),x(4,Xe,3,7,"ng-template",2)(5,Ue,3,5,"ng-template",2),p()(),a(6,"lg-fade-in")(7,"lg-container")(8,"lg-flex-row",3)(9,"lg-title"),c(10),d(11,"translate"),p()(),B(12,"lg-draft-recipes-list"),a(13,"lg-flex-column",4),B(14,"lg-grouping-sorting")(15,"lg-selection-tools",5),p(),a(16,"lg-grouping-tails",6),x(17,et,12,16,"ng-template",7),p()()()),e&2&&(n(),f("success"),s("icon",!0)("link","/recipes/add")("size","medium"),n(7),s("center",!0),n(2),m(" ",u(11,11,"recipes.list-title")," "),n(3),s("size","medium"),n(2),s("selectionTypes",le(13,We)),n(),s("sortResult",o.recipes())("selectable",!0))},dependencies:[L,w,F,xe,_e,Se,Re,he,ve,be,De,j,ye,I,q,Q,N,J,Ge,Be,Z,Ce],styles:["[_nghost-%COMP%]{display:block}"]})};export{Pe as RecipesListComponent};
