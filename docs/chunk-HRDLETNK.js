import{a as De}from"./chunk-ENB3KY2Q.js";import{a as Oe}from"./chunk-G42TUXVK.js";import{c as K,d as j,f as Ae,i as Me,m as Ie,t as je}from"./chunk-CXKCNMAZ.js";import{a as ee}from"./chunk-ZTZGKGRL.js";import{a as Y}from"./chunk-JXYZKXYP.js";import{b as ve}from"./chunk-L3VKWLRX.js";import{c as he,e as X,f as xe}from"./chunk-O3EHXZ3L.js";import{$ as D,$a as L,$b as $,Ab as C,Ac as J,Bb as w,Bc as N,Cc as G,Eb as fe,Ec as H,Fb as ge,Fc as pe,Gb as l,Hb as s,Ib as W,Lb as E,Mb as b,Pb as _,Qb as d,Rb as S,Sb as T,Sc as Se,T as oe,Tc as Te,V as re,Vb as Ce,Vc as de,Wb as we,Wc as ke,Xb as ye,Yb as q,Za as c,Zb as Z,_b as k,a as me,ac as f,b as ue,bc as be,cb as x,da as ae,ec as A,f as R,fc as M,gc as I,hb as y,jb as Q,jc as le,la as m,m as ie,ma as u,mb as V,nc as se,oc as ce,sa as h,ub as p,vb as _e,wb as P,xb as g}from"./chunk-46OIECST.js";var U=class o{constructor(n){this.templateRef=n}static \u0275fac=function(e){return new(e||o)(x(L))};static \u0275dir=Q({type:o,selectors:[["","lgImportRowTpl",""]]})};var O=class o{constructor(){}readFromCSVFile(n){return new Promise((e,t)=>{let i=new FileReader;i.onload=()=>{let r=i.result,a=this.parseData(r),[Ne,...Ue]=a,ze=this.arrayToObjects(Ue,Ne);e(ze)},i.onerror=()=>{t(i.error)},i.readAsText(n)})}readFromJSONFile(n){return new Promise((e,t)=>{let i=new FileReader;i.onload=()=>{try{let r=i.result,a=JSON.parse(r);e(a)}catch(r){t(r)}},i.onerror=()=>{t(i.error)},i.readAsText(n)})}parseData(n){return n.split(/\r\n|\n/).map(e=>e.split(",")).filter(e=>e.length>1&&e.some(t=>t.length>0))}arrayToObjects(n,e){return n.map(t=>{let i={};return e.forEach((r,a)=>{i[r]=t[a]}),i})}makeCsv(n){let e=Object.keys(n[0]),t=n.map(r=>e.map(a=>r[a]));return[e,...t].map(r=>r.join(",")).join(`\r
`)}saveToCSVFile(n,e){let t=this.makeCsv(n),i=new Blob([t],{type:"text/csv"}),r=URL.createObjectURL(i),a=document.createElement("a");document.body.appendChild(a),a.setAttribute("href",r),a.setAttribute("download",e),a.click(),URL.revokeObjectURL(r)}saveToJSONFile(n,e){let t=JSON.stringify(n,null,2),i=new Blob([t],{type:"application/json"}),r=URL.createObjectURL(i),a=document.createElement("a");document.body.appendChild(a),a.setAttribute("href",r),a.setAttribute("download",e),a.click(),URL.revokeObjectURL(r)}static \u0275fac=function(e){return new(e||o)};static \u0275prov=D({token:o,factory:o.\u0275fac,providedIn:"root"})};var Be=["input"],Le=["*"],F=class o{filesSelected=J();accept=N(".csv");input=G("input");onFileChange(n){let t=n.target.files?.[0];t&&this.filesSelected.emit([t])}clear(){this.input()?.nativeElement&&(this.input().nativeElement.value="",this.input().nativeElement.files=null)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=y({type:o,selectors:[["lg-upload"]],viewQuery:function(e,t){e&1&&Z(t.input,Be,5),e&2&&k()},inputs:{accept:[1,"accept"]},outputs:{filesSelected:"filesSelected"},ngContentSelectors:Le,decls:5,vars:1,consts:[["input",""],[1,"lg-upload",3,"click"],["type","file",3,"change","accept"],[1,"lg-upload__content"]],template:function(e,t){if(e&1){let i=b();S(),l(0,"div",1),_("click",function(){m(i);let a=$(2);return u(a.click())}),l(1,"input",2,0),_("change",function(a){return m(i),u(t.onFileChange(a))}),s(),l(3,"div",3),T(4),s()()}e&2&&(c(),p("accept",t.accept()))},styles:["input[_ngcontent-%COMP%]{display:none}"]})};var Qe=["*"],z=class o{constructor(){}displayed=h(!1);open(){this.displayed.set(!0)}close(){this.displayed.set(!1)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=y({type:o,selectors:[["lg-dialog"]],ngContentSelectors:Qe,decls:6,vars:2,consts:[[1,"dialog"],[1,"dialog__container"],[1,"dialog__wrap"],[1,"dialog__box"]],template:function(e,t){e&1&&(S(),l(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"lg-card"),T(5),s()()()()()),e&2&&_e("display",t.displayed()?"flex":"none")},dependencies:[ve],styles:[".dialog[_ngcontent-%COMP%]{display:flex;position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;justify-content:center;align-items:center;overflow-y:auto}.dialog__container[_ngcontent-%COMP%]{max-width:80%;min-width:300px;width:100%;height:100%}.dialog__wrap[_ngcontent-%COMP%]{padding:96px 32px 32px;display:flex;justify-content:center;align-items:center}"]})};var qe=o=>({$implicit:o,flow:"new"}),Ze=o=>({$implicit:o,flow:"old"}),$e=(o,n)=>n.name+n.uuid;function Je(o,n){if(o&1){let e=b();l(0,"input",11),I("ngModelChange",function(i){m(e);let r=d().$implicit,a=d(3);return M(a.rowsToUpdate[r.name],i)||(a.rowsToUpdate[r.name]=i),u(i)}),s(),f(1," Update ")}if(o&2){let e=d().$implicit,t=d(3);A("ngModel",t.rowsToUpdate[e.name]),p("disabled",t.rowsToSkip[e.name])}}function Ge(o,n){if(o&1){let e=b();l(0,"input",12),I("ngModelChange",function(i){m(e);let r=d().$implicit,a=d(3);return M(a.rowsToAdd[r.name],i)||(a.rowsToAdd[r.name]=i),u(i)}),s(),f(1," Add ")}if(o&2){let e=d().$implicit,t=d(3);A("ngModel",t.rowsToAdd[e.name]),p("disabled",t.rowsToSkip[e.name])}}function He(o,n){o&1&&E(0)}function Xe(o,n){if(o&1&&V(0,He,1,0,"ng-container",13),o&2){let e=d().$implicit,t=d(3);p("ngTemplateOutlet",t.rowTemplate().templateRef)("ngTemplateOutletContext",le(2,qe,e))}}function Ke(o,n){o&1&&E(0)}function Ye(o,n){if(o&1&&V(0,Ke,1,0,"ng-container",13),o&2){let e=d(2).$implicit,t=d(),i=d(2);p("ngTemplateOutlet",i.rowTemplate().templateRef)("ngTemplateOutletContext",le(2,Ze,t[e.uuid]||t[e.name]))}}function et(o,n){if(o&1){let e=b();l(0,"div",14)(1,"input",11),I("ngModelChange",function(i){m(e);let r=d().$implicit,a=d(3);return M(a.rowsToSkip[r.name],i)||(a.rowsToSkip[r.name]=i),u(i)}),s(),l(2,"span"),f(3),s(),C(4,Ye,1,4,"ng-container"),s()}if(o&2){let e=d().$implicit,t=d(3);P("disabled",t.rowsToUpdate[e.name])("skip",t.rowsToUpdate[e.name]),p("ngClass",t.rowsToSkip[e.name]?"skip":"duplicated"),c(),A("ngModel",t.rowsToSkip[e.name]),p("disabled",t.rowsToAdd[e.name]||t.rowsToUpdate[e.name]),c(2),be(t.rowsToSkip[e.name]?"Skip":"Duplicates"),c(),w(t.rowTemplate()?4:-1)}}function tt(o,n){if(o&1&&(l(0,"lg-gap-column",8)(1,"div",9),C(2,Je,2,2)(3,Ge,2,2),C(4,Xe,1,4,"ng-container"),s(),C(5,et,5,9,"div",10),s()),o&2){let e=n.$implicit,t=d(),i=d(2);p("size","small"),c(),P("update",i.rowsToUpdate[e.name])("add",i.rowsToAdd[e.name])("disabled",i.rowsToSkip[e.name]),c(),w(t[e.uuid]||t[e.name]?2:3),c(2),w(i.rowTemplate()?4:-1),c(),w(t[e.uuid]||t[e.name]?5:-1)}}function nt(o,n){if(o&1&&(l(0,"lg-gap-column",8),fe(1,tt,6,10,"lg-gap-column",8,$e),s()),o&2){let e=d();p("size","medium"),c(),ge(e)}}function it(o,n){if(o&1&&(C(0,nt,3,1,"lg-gap-column",8),se(1,"async")),o&2){let e,t=d();w((e=ce(1,1,t.analize$))?0:-1,e)}}var Re=class o{constructor(n,e){this._csvReaderService=n;this._indexDbService=e}rowsToAdd={};rowsToUpdate={};rowsToSkip={};onDone=J();storeName=N(null);schema=N();skipAllDuplicates=pe(!1);replaceAll=pe(!1);rowTemplate=H(U);analizeSubject=new ie;dataSubject=new ie;data$=this.dataSubject.asObservable().pipe(re([]),oe((n,e)=>e==null?[]:[...n,e]));analize$=this.analizeSubject.asObservable().pipe(re([]),oe((n,e)=>e==null?[]:!e.uuid||!e.name?n:ue(me({},n),{[e.uuid]:e,[e.name]:e})));dialog;upload=G(F);parsedData=[];onConfirm(){return R(this,null,function*(){for(let n of this.parsedData)this.rowsToAdd[n.name]?yield this._indexDbService.addData(this.storeName(),n,n.uuid):this.rowsToUpdate[n.name]&&!this.skipAllDuplicates()&&(yield this._indexDbService.replaceData(this.storeName(),n.uuid,n));this.clear(),this.onDone.emit(),this.dialog.close()})}onClose(){this.clear(),this.dialog.close()}clear(){this.upload().clear(),this.rowsToAdd={},this.rowsToUpdate={},this.rowsToSkip={},this.parsedData=[],this.dataSubject.next(null),this.analizeSubject.next(null),this.skipAllDuplicates.set(!1),this.replaceAll.set(!1)}onReplaceAll(){this.replaceAll()?this.parsedData.forEach(n=>{this.rowsToAdd[n.name]||(this.rowsToUpdate[n.name]=!0)}):this.rowsToAdd={}}onSkipAllDuplicates(){this.skipAllDuplicates()?this.parsedData.forEach(n=>{this.rowsToAdd[n.name]||(this.rowsToSkip[n.name]=!0,this.rowsToUpdate[n.name]&&(this.rowsToUpdate[n.name]=!1))}):this.rowsToSkip={}}onFileSelected(n){this.dialog.open(),this._csvReaderService.readFromJSONFile(n[0]).then(e=>R(this,null,function*(){for(let t of e){let i=this.schema()?.safeParse(t);if(!i?.success){console.log("error",i?.error);return}if(!this.storeName()){console.log("storeName is not set");return}this.dataSubject.next(t),this.parsedData.push(i.data),yield this._analyzeDuplicates(i.data).then(r=>{r.duplicate?this.analizeSubject.next(r.data[0]):this.rowsToAdd[t.name]=!0})}}))}_analyzeDuplicates(n){return new Promise((e,t)=>{this._indexDbService.search(this.storeName(),"name",n.name).then(i=>{i.length?e({data:i,duplicate:!0}):e({data:null,duplicate:!1})})})}static \u0275fac=function(e){return new(e||o)(x(O),x(K))};static \u0275cmp=y({type:o,selectors:[["lg-import"]],contentQueries:function(e,t,i){e&1&&q(i,t.rowTemplate,U,5),e&2&&k()},viewQuery:function(e,t){if(e&1&&(Z(t.upload,F,5),Ce(z,5)),e&2){k();let i;we(i=ye())&&(t.dialog=i.first)}},inputs:{storeName:[1,"storeName"],schema:[1,"schema"],skipAllDuplicates:[1,"skipAllDuplicates"],replaceAll:[1,"replaceAll"]},outputs:{onDone:"onDone",skipAllDuplicates:"skipAllDuplicatesChange",replaceAll:"replaceAllChange"},decls:23,vars:25,consts:[["dialog",""],[3,"filesSelected","accept"],[3,"flat","size"],[3,"center","hidden","size"],["type","checkbox",3,"change","ngModelChange","ngModel"],[3,"center"],[3,"click","size"],[3,"appendTarget","targetElement"],[3,"size"],[1,"import-row"],[1,"import-row",2,"margin-left","16px",3,"ngClass","disabled","skip"],["type","checkbox",3,"ngModelChange","ngModel","disabled"],["checked","","type","checkbox",3,"ngModelChange","ngModel","disabled"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"import-row",2,"margin-left","16px",3,"ngClass"]],template:function(e,t){if(e&1){let i=b();l(0,"lg-upload",1),_("filesSelected",function(a){return m(i),u(t.onFileSelected(a))}),l(1,"lg-button",2),f(2," Import "),s()(),l(3,"div",null,0)(5,"lg-dialog")(6,"lg-gap-column"),C(7,it,2,3),se(8,"async"),l(9,"lg-gap-row",3)(10,"input",4),_("change",function(){return m(i),u(t.onSkipAllDuplicates())}),I("ngModelChange",function(a){return m(i),M(t.skipAllDuplicates,a)||(t.skipAllDuplicates=a),u(a)}),s(),l(11,"label"),f(12,"Skip all duplicates"),s()(),l(13,"lg-gap-row",3)(14,"input",4),_("change",function(){return m(i),u(t.onReplaceAll())}),I("ngModelChange",function(a){return m(i),M(t.replaceAll,a)||(t.replaceAll=a),u(a)}),s(),l(15,"label"),f(16,"Replace all with new"),s()(),l(17,"lg-gap-row",5)(18,"lg-button",6),_("click",function(){return m(i),u(t.onClose())}),f(19," Close "),s(),l(20,"lg-button",6),_("click",function(){return m(i),u(t.onConfirm())}),f(21," Confirm "),s()()()()(),W(22,"lg-portal",7)}if(e&2){let i,r=$(4);p("accept",".json"),c(),g("warning"),p("flat",!0)("size","small"),c(6),w((i=ce(8,23,t.data$))?7:-1,i),c(2),p("center",!0)("hidden",t.replaceAll())("size","small"),c(),A("ngModel",t.skipAllDuplicates),c(3),p("center",!0)("hidden",t.skipAllDuplicates())("size","small"),c(),A("ngModel",t.replaceAll),c(3),p("center",!0),c(),g("danger"),p("size","small"),c(2),g("success"),p("size","small"),c(2),p("appendTarget","body")("targetElement",r)}},dependencies:[F,j,z,xe,Y,ee,je,Ae,Me,Ie,he,X,Oe],styles:[".import-row[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:8px;border:1px solid #f5f5f5;border-radius:24px;padding:8px 16px}.import-row.disabled[_ngcontent-%COMP%]{opacity:.5}.import-row.skip[_ngcontent-%COMP%]{border-color:#008ad8;background-color:#dceaff}.import-row.duplicated[_ngcontent-%COMP%]{border-color:#ffbaba;background-color:#fff4f4}.import-row.update[_ngcontent-%COMP%], .import-row.add[_ngcontent-%COMP%]{border-color:#8ca68c;background-color:#e5f4e3}"]})};var B=class o{constructor(n){this.templateRef=n}static \u0275fac=function(e){return new(e||o)(x(L))};static \u0275dir=Q({type:o,selectors:[["","lgQuickActionsTpl",""]]})};var ot=["*"];function rt(o,n){o&1&&E(0)}function at(o,n){if(o&1&&(l(0,"div",4),V(1,rt,1,0,"ng-container",6),s()),o&2){let e,t=d();c(),p("ngTemplateOutlet",(e=t.quickActionsTpl())==null?null:e.templateRef)}}var Ve=class o{opened=h(!1);quickActionsTpl=H(B);toggle(){this.opened.update(n=>!n)}ngOnInit(){console.log("Controls bar mounted")}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=y({type:o,selectors:[["lg-controls-bar"]],contentQueries:function(e,t,i){e&1&&q(i,t.quickActionsTpl,B,5),e&2&&k()},ngContentSelectors:ot,decls:7,vars:7,consts:[[1,"lg-controls-bar"],[1,"lg-controls-bar__inner"],[1,"lg-controls-bar__caret",3,"click","keydown.enter","swipeleft","swiperight","icon"],["aria-hidden","false","fontIcon","design_services"],[1,"lg-controls-bar__quickActions"],[1,"lg-controls-bar__content"],[4,"ngTemplateOutlet"]],template:function(e,t){e&1&&(S(),l(0,"div",0)(1,"div",1)(2,"lg-button",2),_("click",function(){return t.toggle()})("keydown.enter",function(){return t.toggle()})("swipeleft",function(){return t.toggle()})("swiperight",function(){return t.toggle()}),W(3,"mat-icon",3),s(),C(4,at,2,1,"div",4),l(5,"div",5),T(6),s()()()),e&2&&(P("opened",t.opened()),p("@fromLeft",void 0),c(2),g("transcluent"),p("icon",!0),c(2),w(t.quickActionsTpl()?4:-1))},dependencies:[De,X,j],styles:[".lg-controls-bar[_ngcontent-%COMP%]{position:fixed;right:0;top:var(--app-content-top-padding);display:flex;gap:8px;border-radius:4px}.lg-controls-bar__inner[_ngcontent-%COMP%]{display:flex;transform:translate(calc(100% - 16px));position:relative;transition:transform .3s ease-in-out;border-radius:0 0 15px 15px;padding:0 16px}.lg-controls-bar.opened[_ngcontent-%COMP%]   .lg-controls-bar__inner[_ngcontent-%COMP%]{transform:translate(0)}.lg-controls-bar__caret[_ngcontent-%COMP%]{position:absolute;right:100%;top:0;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;scroll-snap-align:center;color:#fff;transition:opacity .3s ease-in-out;scroll-snap-type:both mandatory;overscroll-behavior-x:contain}.lg-controls-bar__quickActions[_ngcontent-%COMP%]{position:absolute;right:100%;top:66px}.lg-controls-bar.opened[_ngcontent-%COMP%]   .lg-controls-bar__caret[_ngcontent-%COMP%]{transform:rotate(180deg)}.lg-controls-bar__content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start;gap:8px;border-radius:16px;padding:16px;min-width:200px;-webkit-backdrop-filter:blur(3px);backdrop-filter:blur(3px);background-color:#ffffffb3}@media (max-width: 768px){.lg-controls-bar__content[_ngcontent-%COMP%]{min-width:100px}}"],data:{animation:[Se("fromLeft",[ke(":enter",[de({transform:"translateX(100%)"}),Te("0.3s ease-in-out",de({transform:"translateX(0)"}))])])]}})};var ne=class o{constructor(){}selectionMode=h("default");selectAll=h(!1);deselectAll=h(!1);selected=h(new Set);onSelection(){this.selectionMode.set(this.selectionMode()==="default"?"selection":"default"),this.selected.set(new Set)}onAllSelection(){this.selectAll.set(!0),this.deselectAll.set(!1)}onDeselectAll(){this.selectAll.set(!1),this.deselectAll.set(!0)}putSelected(n){let[e,t]=n;this.selected.update(i=>(e?i.add(t):i.delete(t),i)),console.log("selected",this.selected())}static \u0275fac=function(e){return new(e||o)};static \u0275prov=D({token:o,factory:o.\u0275fac})};var st=["*"];function ct(o,n){if(o&1){let e=b();l(0,"lg-button",2),_("click",function(){m(e);let i=d();return u(i.selectionZoneService.onSelection())}),f(1," Hide selection "),s(),l(2,"lg-button",2),_("click",function(){m(e);let i=d();return u(i.selectionZoneService.onAllSelection())}),f(3," Select all "),s(),l(4,"lg-button",2),_("click",function(){m(e);let i=d();return u(i.selectionZoneService.onDeselectAll())}),f(5," Deselect all "),s()}o&2&&(g("success"),p("flat",!0)("size","small"),c(2),g("danger"),p("flat",!0)("size","small"),c(2),g("danger"),p("flat",!0)("size","small"))}function pt(o,n){if(o&1){let e=b();l(0,"lg-button",2),_("click",function(){m(e);let i=d();return u(i.selectionZoneService.onSelection())}),f(1," Select many "),s()}o&2&&(g("success"),p("flat",!0)("size","small"))}var Pe=class o{constructor(n){this.selectionZoneService=n}static \u0275fac=function(e){return new(e||o)(x(ne,8))};static \u0275cmp=y({type:o,selectors:[["lg-selection-tools"]],ngContentSelectors:st,decls:5,vars:2,consts:[[3,"center"],[3,"flat","size","style"],[3,"click","flat","size"]],template:function(e,t){e&1&&(S(),l(0,"lg-gap-column")(1,"lg-gap-row",0),C(2,ct,6,12)(3,pt,2,4,"lg-button",1),s(),T(4),s()),e&2&&(c(),p("center",!0),c(),w(t.selectionZoneService.selectionMode()==="selection"?2:3))},dependencies:[j,Y,ee],encapsulation:2})};var Ee=class o{constructor(n,e){this._indexDbService=n;this._csvReaderService=e}exportTable(i){return R(this,arguments,function*(n,e="csv",t={}){let r=[];if(t.selected?.length?r=yield this._indexDbService.getMany(n,t.selected):r=yield this._indexDbService.getAll(n),e==="json"){this._csvReaderService.saveToJSONFile(r,this._getFileName(n,e));return}this._csvReaderService.saveToCSVFile(r,this._getFileName(n,e))})}makeCsv(n){return this._csvReaderService.makeCsv(n)}_getFileName(n,e){let t=new Date().toISOString();return`${n}_export_${t}.${e}`}static \u0275fac=function(e){return new(e||o)(ae(K),ae(O))};static \u0275prov=D({token:o,factory:o.\u0275fac,providedIn:"root"})};var tn=(o,n)=>o.reduce((e,t)=>{let i=t[n]||"unknown";return e[i]||(e[i]=[]),e[i].push(t),e},{});export{U as a,O as b,Re as c,tn as d,B as e,Ve as f,ne as g,Pe as h,Ee as i};
