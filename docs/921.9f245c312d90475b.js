"use strict";(self.webpackChunklasagna=self.webpackChunklasagna||[]).push([[921],{553:(P,g,o)=>{o.d(g,{i:()=>b});var t=o(1007);const h=["*"];let b=(()=>{class a{constructor(){}flat=(0,t.hFB)(!1);static \u0275fac=function(c){return new(c||a)};static \u0275cmp=t.VBU({type:a,selectors:[["lg-card"]],inputs:{flat:[1,"flat"]},ngContentSelectors:h,decls:2,vars:2,consts:[[1,"card"]],template:function(c,i){1&c&&(t.NAR(),t.j41(0,"div",0),t.SdG(1),t.k0s()),2&c&&t.AVh("flat",i.flat())},styles:["[_nghost-%COMP%]{display:flex;width:100%}.card[_ngcontent-%COMP%]{background-color:#fff;padding:24px;border-radius:32px;width:100%}.card.flat[_ngcontent-%COMP%]{padding:0}"]})}return a})()},1086:(P,g,o)=>{o.d(g,{W:()=>b});var t=o(1007);const h=["*"];let b=(()=>{class a{level=(0,t.vPA)(1);static \u0275fac=function(c){return new(c||a)};static \u0275cmp=t.VBU({type:a,selectors:[["lg-title"]],ngContentSelectors:h,decls:2,vars:0,consts:[["role","heading",1,"title"]],template:function(c,i){1&c&&(t.NAR(),t.j41(0,"p",0),t.SdG(1),t.k0s())},styles:[".title[_ngcontent-%COMP%]{font-size:1.5em;font-weight:700;margin:0}"]})}return a})()},1091:(P,g,o)=>{o.r(g),o.d(g,{CalculateRecipeComponent:()=>W});var t=o(1007),h=o(5642),b=o(1086),a=o(553);const D=["*"];let r=(()=>{class l{constructor(){}static \u0275fac=function(n){return new(n||l)};static \u0275cmp=t.VBU({type:l,selectors:[["lg-table-card"]],ngContentSelectors:D,decls:4,vars:1,consts:[[3,"flat"],[1,"table"],[1,"table__scroll"]],template:function(n,_){1&n&&(t.NAR(),t.j41(0,"lg-card",0)(1,"div",1)(2,"div",2),t.SdG(3),t.k0s()()()),2&n&&t.Y8G("flat",!0)},dependencies:[a.i],styles:[":host{display:flex;width:100%}.table__scroll{overflow-x:auto}table{width:100%;border-collapse:collapse;--border-color: #efefef}table thead tr{border-bottom:1px solid var(--border-color)}table thead th{text-align:left;padding:16px 24px}table tbody tr{border-bottom:1px solid var(--border-color)}table tbody tr:last-child{border-bottom:none}td{padding:16px 24px}\n"],encapsulation:2})}return l})();var c=o(177),i=o(1119),m=o(7512),u=o(5554),d=o(467),F=o(9512),S=o(7201);let I=(()=>{class l{_recipeRepository;_productRepository;constructor(e,n){this._recipeRepository=e,this._productRepository=n}calculation;calculateRecipe(e){var n=this;return new Promise(function(){var _=(0,d.A)(function*(f,y){const R=[];let s=0,E=0;yield n._recipeRepository.getOne(e,function(){var j=(0,d.A)(function*(v){const{table:k,totalAmount:x}=yield n._makeIngredientTable(v);s+=x||0,E=v.ingredients.reduce((A,p)=>A+parseInt(p.amount),0),R.push(...k),R.push(n._makeTotal(s,E)),f({recipe:v,result:R,total:s})});return function(v){return j.apply(this,arguments)}}())});return function(f,y){return _.apply(this,arguments)}}())}_makeRecipeSubTable(e){var n=this;return(0,d.A)(function*(){return new Promise(function(){var _=(0,d.A)(function*(f,y){const R=[];let s=0,E=0;const j=e.amount;yield n._recipeRepository.getOne(e.recipe_id,function(){var v=(0,d.A)(function*(k){const x=k.ingredients.reduce((C,M)=>C+parseInt(M.amount),0),A=j/x,p=yield n._makeIngredientTable(k);p.table=p.table.map((C,M)=>({...C,amount:parseFloat((C.amount?C.amount*A:0).toFixed(5)),total:parseFloat((C.total?C.total*A:0).toFixed(5)),indent:C.indent+1}));const T=p.totalAmount/p.totalWeight;R.push(n._makeRecipeCaption({name:k.name,price_per_gram:T,amount:e.amount,total:T*e.amount})),R.push(...p.table),E+=T*e.amount,s+=p.totalWeight,f({table:R,totalAmount:E,totalWeight:s})});return function(k){return v.apply(this,arguments)}}())});return function(f,y){return _.apply(this,arguments)}}())})()}_makeIngredientTable(e){var n=this;const _=[];let f=0,y=0;return Promise.all(e.ingredients.map(function(){var R=(0,d.A)(function*(s,E){const j=s.recipe_id,v=s.product_id,k=s.name;if(j||v||k)if(j){const x=yield n._makeRecipeSubTable(s);_.push(...x.table),y+=x.totalAmount,f+=x.totalWeight}else v?yield n._productRepository.getOne(s.product_id,function(){var A=(0,d.A)(function*(p){if(!p?.price||!p?.amount)return;const T=p.price/p.amount,C=T*s.amount;_.push(n._makeRow({name:p.name,price_per_gram:T,amount:s.amount,total:C})),y+=C,f+=+s.amount});return function(p){return A.apply(this,arguments)}}()):k&&(_.push(n._makeRow({name:s.name,price_per_gram:void 0,amount:s.amount,total:void 0})),f+=+s.amount)});return function(s,E){return R.apply(this,arguments)}}())).then(()=>({table:_,totalAmount:y,totalWeight:f}))}_makeRow(e){return{name:e.name,price_per_gram:parseFloat(e.price_per_gram?.toFixed(5)??"0"),amount:e.amount,total:parseFloat(e.total?.toFixed(5)??"0"),unit:"g",indent:e.indent??0,type:"row"}}_makeCaption(e){return{name:e,unit:void 0,price_per_gram:void 0,amount:void 0,total:void 0,indent:0,type:"caption"}}_makeRecipeCaption(e){return{name:e.name,price_per_gram:parseFloat(e.price_per_gram.toFixed(5)),amount:e.amount,total:parseFloat(e.total.toFixed(2)),unit:"g",indent:0,type:"recipe-row"}}_makeTotal(e,n){return{name:"Total",amount:n,unit:"g",price_per_gram:parseFloat((e/n).toFixed(5)),total:parseFloat(e.toFixed(2)),indent:0,type:"total"}}static \u0275fac=function(n){return new(n||l)(t.KVO(F.m),t.KVO(S.d))};static \u0275prov=t.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();function B(l,O){if(1&l&&(t.j41(0,"tr")(1,"td"),t.EFF(2),t.k0s(),t.j41(3,"td")(4,"span",7),t.EFF(5),t.k0s()(),t.j41(6,"td"),t.EFF(7),t.k0s(),t.j41(8,"td"),t.EFF(9),t.k0s(),t.j41(10,"td"),t.EFF(11),t.k0s(),t.j41(12,"td"),t.EFF(13),t.k0s()()),2&l){const e=O.$implicit,n=O.$index;t.R7$(2),t.JRh(n+1),t.R7$(2),t.Y8G("ngClass","indent-"+e.indent),t.R7$(),t.JRh(e.name),t.R7$(2),t.JRh(e.amount),t.R7$(2),t.JRh(e.unit),t.R7$(2),t.JRh(e.price_per_gram),t.R7$(2),t.JRh(e.total)}}function w(l,O){if(1&l&&(t.j41(0,"table")(1,"colgroup"),t.nrm(2,"col",2)(3,"col",3)(4,"col",4)(5,"col",5)(6,"col",4)(7,"col",6),t.k0s(),t.j41(8,"thead")(9,"tr")(10,"th"),t.EFF(11,"#"),t.k0s(),t.j41(12,"th"),t.EFF(13,"Name"),t.k0s(),t.j41(14,"th"),t.EFF(15,"Amount"),t.k0s(),t.j41(16,"th"),t.EFF(17,"Unit"),t.k0s(),t.j41(18,"th"),t.EFF(19,"Price per gram"),t.k0s(),t.j41(20,"th"),t.EFF(21,"Total"),t.k0s()()(),t.j41(22,"tbody"),t.Z7z(23,B,14,7,"tr",null,t.Vm6),t.k0s()()),2&l){let e;const n=t.XpG();t.R7$(23),t.Dyx(null==(e=n.result())?null:e.result)}}function U(l,O){1&l&&(t.j41(0,"div"),t.EFF(1,"Loading..."),t.k0s())}let W=(()=>{class l{_aRoute;_calculateRecipeService;constructor(e,n){this._aRoute=e,this._calculateRecipeService=n}uuid=(0,t.vPA)("");result=(0,t.vPA)(null);ngOnInit(){this._aRoute.params.subscribe(e=>{this.uuid.set(e.uuid),this._calculateRecipeService.calculateRecipe(e.uuid).then(n=>{this.result.set(n)})})}static \u0275fac=function(n){return new(n||l)(t.rXU(u.nX),t.rXU(I))};static \u0275cmp=t.VBU({type:l,selectors:[["lg-calculate-recipe"]],decls:9,vars:8,consts:[[3,"center"],[3,"flat","link","size"],["span","1",2,"width","1%"],["span","1",2,"width","20%"],["span","1",2,"width","5%"],["span","1",2,"width","3%"],["span","1",2,"width","7%"],[3,"ngClass"]],template:function(n,_){if(1&n&&(t.j41(0,"lg-container")(1,"lg-gap-row",0)(2,"lg-title"),t.EFF(3),t.k0s(),t.j41(4,"lg-button",1),t.EFF(5," Edit "),t.k0s()(),t.j41(6,"lg-table-card"),t.DNE(7,w,25,0,"table")(8,U,2,0,"div"),t.k0s()()),2&n){let f,y;t.R7$(),t.Y8G("center",!0),t.R7$(2),t.SpI(" ",null==(f=_.result())||null==f.recipe?null:f.recipe.name," cost calculation "),t.R7$(),t.Aen("primary"),t.Y8G("flat",!0)("link","/edit-recipe/"+(null==(y=_.result())||null==y.recipe?null:y.recipe.uuid))("size","small"),t.R7$(3),t.vxM(_.result()?7:8)}},dependencies:[h.H,b.W,r,c.YU,i.Q,m.I],encapsulation:2})}return l})()},1119:(P,g,o)=>{o.d(g,{Q:()=>D});var t=o(1007),h=o(177),b=o(5554);const a=["*"];let D=(()=>{class r{constructor(){}onClick=(0,t.CGW)();style=(0,t.hFB)("default");size=(0,t.hFB)("default");icon=(0,t.hFB)(!1);flat=(0,t.hFB)(!1);link=(0,t.hFB)("");static \u0275fac=function(m){return new(m||r)};static \u0275cmp=t.VBU({type:r,selectors:[["lg-button"]],inputs:{style:[1,"style"],size:[1,"size"],icon:[1,"icon"],flat:[1,"flat"],link:[1,"link"]},outputs:{onClick:"onClick"},ngContentSelectors:a,decls:2,vars:6,consts:[[1,"button",3,"click","routerLink","ngClass"]],template:function(m,u){1&m&&(t.NAR(),t.j41(0,"button",0),t.bIt("click",function(F){return u.onClick.emit(F)}),t.SdG(1),t.k0s()),2&m&&(t.AVh("flat",u.flat())("icon",u.icon()),t.Y8G("routerLink",u.link()?u.link():null)("ngClass",u.style()+" "+u.size()))},dependencies:[h.YU,b.Wk],styles:[".button{background-color:#fff;color:var(--text-color);padding:16px 24px;font-size:1rem;font-family:inherit;border:none;border-radius:16px;cursor:pointer;appearance:none;display:flex;align-items:center;justify-content:center}.button.default{background-color:#fab6b6}.button.primary{background-color:#0f7922}.button.primary.flat{color:#0f7922}.button.secondary{background-color:#b6f1fa}.button.secondary.flat{color:#b6f1fa}.button.success{background-color:#1a8c50;color:#fff8fa}.button.success.flat{color:#1a8c50}.button.danger{background-color:#e33;color:#fff8fa}.button.danger.flat{color:#e33}.button.warning,.button.info{background-color:#b6f1fa}.button.small{padding:8px 16px;font-size:.9rem;border-radius:12px}.button.icon{padding:2px;border-radius:50%}.button.icon .mat-icon{font-size:10px;width:16px;height:16px;display:flex;align-items:center;justify-content:center}.button.flat{padding:0;background-color:transparent}\n"],encapsulation:2})}return r})()},5559:(P,g,o)=>{o.d(g,{Q:()=>b});var t=o(467),h=o(1007);let b=(()=>{class a{constructor(){}get _uuid(){return Math.random().toString(36).substring(2)+Date.now().toString(36)}openDb(r){return new Promise(function(){var c=(0,t.A)(function*(i,m){const u=yield window.indexedDB.open("lasagna-db",1);u.onerror=d=>{m(d)},u.onsuccess=d=>{r(d.target?.result)},u.onupgradeneeded=d=>{const F=d.target?.result;F.createObjectStore("productsStore",{keyPath:"uuid",autoIncrement:!0}).createIndex("name","name",{unique:!1}),F.createObjectStore("recipesStore",{keyPath:"uuid",autoIncrement:!0}).createIndex("name","name",{unique:!1}),F.createObjectStore("categoryStore",{keyPath:"uuid",autoIncrement:!0}).createIndex("name","name",{unique:!1})},i()});return function(i,m){return c.apply(this,arguments)}}())}addData(r,c){this.openDb(i=>{i.transaction(r,"readwrite").objectStore(r).add({...c,uuid:this._uuid})})}replaceData(r,c,i){this.openDb(m=>{m.transaction(r,"readwrite").objectStore(r).put({...i,uuid:c})})}getOne(r,c,i){this.openDb(m=>{m.transaction(r,"readonly").objectStore(r).get(c).onsuccess=S=>{i(S.target.result)}})}static \u0275fac=function(c){return new(c||a)};static \u0275prov=h.jDH({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})()},5642:(P,g,o)=>{o.d(g,{H:()=>b});var t=o(1007);const h=["*"];let b=(()=>{class a{static \u0275fac=function(c){return new(c||a)};static \u0275cmp=t.VBU({type:a,selectors:[["lg-container"]],ngContentSelectors:h,decls:2,vars:0,consts:[[1,"container"]],template:function(c,i){1&c&&(t.NAR(),t.j41(0,"section",0),t.SdG(1),t.k0s())},styles:["[_nghost-%COMP%]{display:flex;height:100%;padding:0 32px}.container[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:0 auto;width:100%;max-width:1920px;gap:32px}"]})}return a})()}}]);