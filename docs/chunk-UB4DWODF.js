import{a as ot}from"./chunk-XGYLWNA3.js";import{a as lt}from"./chunk-R5HZ2CHP.js";import{a as nt}from"./chunk-G6Z7HGTP.js";import{a as at}from"./chunk-HXFWMFTO.js";import{c as Y}from"./chunk-AD2SMGJQ.js";import"./chunk-GALYHWJT.js";import{a as Le}from"./chunk-T4SSLVVO.js";import{a as Qe,b as Je}from"./chunk-PAYIJDJT.js";import{a as qe}from"./chunk-3XI5PPZV.js";import{a as Ye}from"./chunk-7TT4R52F.js";import{a as tt}from"./chunk-JYL7MVT6.js";import{a as Ze}from"./chunk-NJWJNDGS.js";import{a as et,c as X,d as it}from"./chunk-4TXWYXFH.js";import{a as Xe,b as K}from"./chunk-GA2WFVWU.js";import"./chunk-CWUUYJTE.js";import"./chunk-FK6H3RFT.js";import{a as Ke}from"./chunk-GFKJ3IXC.js";import{v as He}from"./chunk-LJ5EVNTD.js";import{a as H}from"./chunk-ZL6WWUML.js";import{a as Q}from"./chunk-VQHUADFJ.js";import{a as je}from"./chunk-IVWGGHZS.js";import{a as q}from"./chunk-OIONDWIZ.js";import{c as ze}from"./chunk-BJIJ7REJ.js";import{a as $e}from"./chunk-I27O3RKJ.js";import"./chunk-MPFUNZLY.js";import{a as We}from"./chunk-Q75E6UIP.js";import{G as z,H as L,I as N,K as v,P as j,Q as Ge,R as ke,S as W,T as Me,U as Ve,V as $,X as Oe,Z as Ue,ca as J,f as Ee,n as U,o as Pe,p as De,w as Ne,y as Be}from"./chunk-6JKZXFLI.js";import{m as Re,p as Ie,q as Fe}from"./chunk-3NSY2Z6P.js";import{c as Ae}from"./chunk-CABIONZL.js";import"./chunk-EMIJRNYJ.js";import{f as ye,i as we,m as be,n as Se}from"./chunk-HDEG74LV.js";import{$b as ne,Bc as s,Cb as g,Cc as f,Dc as x,Eb as h,Ec as P,Fb as se,G as pe,Hb as G,Ib as k,Jb as c,Kb as l,Lb as o,Lc as D,Mb as w,Mc as le,Nb as de,Ob as _e,Pb as ee,Pc as oe,Qb as M,Qc as re,Rc as Te,Ub as b,Vb as m,Vc as ce,Wb as xe,Xb as Ce,Zb as te,_a as a,_b as ie,bc as fe,cc as ge,da as me,db as F,dc as ae,fc as V,gc as E,ic as p,jc as C,ka as R,kb as A,kc as _,la as I,lc as O,oa as ue,pb as y,ua as T,vc as he,yc as ve}from"./chunk-NHWKWTII.js";import"./chunk-2RGDSI3Q.js";import"./chunk-C6Q5SG76.js";var ut=["*"],Z=class i{constructor(){}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=A({type:i,selectors:[["lg-table-card"]],ngContentSelectors:ut,decls:4,vars:1,consts:[[3,"flat"],[1,"table"],[1,"table__scroll"]],template:function(e,n){e&1&&(xe(),l(0,"lg-card",0)(1,"div",1)(2,"div",2),Ce(3),o()()()),e&2&&c("flat",!0)},dependencies:[H],styles:[`:host{display:flex;width:100%}.table__scroll{overflow-x:auto}table{width:100%;border-collapse:collapse;--border-color: #efefef}table thead tr{border-bottom:1px solid var(--border-color)}table thead th{text-align:left;padding:16px 24px;opacity:.4;font-size:.8em}table tbody tr{border-bottom:1px solid var(--border-color)}table tbody tr:last-child{border-bottom:none}td{padding:16px 24px}
`],encapsulation:2})};var dt=(i,t)=>t.value.name&&t.value.amount;function _t(i,t){if(i&1){let e=M();l(0,"section",4)(1,"div",5)(2,"lg-gap-row",6)(3,"small"),p(4,"Apply for all"),o(),l(5,"lg-control",7),w(6,"lg-input",8),o(),l(7,"lg-control",7),w(8,"lg-textarea",9),o(),l(9,"lg-control",7)(10,"lg-number-input",10),b("onInputChange",function(){R(e);let r=m().$index,d=m();return I(d.onTaxValueChange(r))}),o()(),l(11,"lg-control",7)(12,"lg-checkbox",11),b("onCheckboxChanged",function(){R(e);let r=m().$index,d=m();return I(d.onTaxValueChange(r))}),o()(),l(13,"lg-control",7),w(14,"lg-number-input",12),o(),l(15,"lg-button",13),b("click",function(){R(e);let r=m().$index,d=m();return I(d.deleteTxRow(r))}),w(16,"mat-icon",14),o()()()()}if(i&2){let e=m().$index;c("formGroupName",e),a(),V("taxes__row--odd",e%2!==0),a(),c("bottom",!0)("fit",!0),a(3),c("label","Name"),a(),c("placeholder","Name"),a(),c("label","Description"),a(),c("rows",3)("placeholder","Description"),a(),c("label","Value"),a(),c("placeholder","Value"),a(),c("label","Use percentage"),a(),c("customMark","%"),a(),c("label","Amount"),a(),c("disable",!0)("placeholder","Amount"),a(),E("danger"),c("size","tiny")("icon",!0)}}function xt(i,t){i&1&&y(0,_t,17,21,"ng-template",2)}var B=class i{constructor(){}totalTaxesChanged=oe();taxesChanged=oe();rows=re([]);total=re(0);taxesForm=new N({rows:new Me([this._getRowGroup()])});rowsEffect=le(()=>{this._rowsFormArray.clear(),this.rows().forEach((t,e)=>{this._rowsFormArray.push(this._getRowGroup(t))}),this.taxesForm.updateValueAndValidity(),this._recalculateTaxes()});totalTaxes=T(0);totalEffect=le(()=>{this._recalculateTaxes()});formValues=this.taxesForm.valueChanges.pipe(U());get _rowsFormArray(){return this.taxesForm.get("rows")}ngOnInit(){this.formValues.subscribe(t=>{this.totalTaxes.set(this._getTotalTaxes()),this.totalTaxesChanged.emit(this.totalTaxes()),this.taxesChanged.emit(this.taxesForm.value.rows)})}onTaxValueChange(t){let e=this._rowsFormArray.at(t),n=this._getAmount(e.value.value,e.value.percentage);e.get("amount")?.patchValue(n.toFixed(2))}deleteTxRow(t){this._rowsFormArray.removeAt(t)}addTxRow(){this._rowsFormArray.push(this._getRowGroup())}_getTotalTaxes(){return this._rowsFormArray.controls.reduce((t,e)=>{let n=parseFloat(e.get("amount")?.value);return t+(isNaN(n)?0:n)},0)}_getAmount(t,e){let n=parseFloat(t.toString());return e?n*this.total():n}_recalculateTaxes(t=!1){this._rowsFormArray.controls.forEach((e,n)=>{let r=this._getAmount(e.get("value")?.value,e.get("percentage")?.value);e.get("amount")?.patchValue(r.toFixed(2),{emitEvent:!t})})}_getRowGroup(t=null){return new N({name:new v(t?.name||""),description:new v(t?.description||""),value:new v(t?.value||0),amount:new v(0),percentage:new v(t?.percentage||!1)})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=A({type:i,selectors:[["lg-taxes-and-fees-list"]],inputs:{rows:[1,"rows"],total:[1,"total"]},outputs:{totalTaxesChanged:"totalTaxesChanged",taxesChanged:"taxesChanged"},decls:7,vars:3,consts:[[3,"formGroup"],["formArrayName","rows"],["lgCardListItem",""],["lgSelfCenter","","lgShrink","",3,"click"],[1,"taxes",3,"formGroupName"],[1,"taxes__row"],[3,"bottom","fit"],[3,"label"],["formControlName","name",3,"placeholder"],["formControlName","description",3,"rows","placeholder"],["lgParseMath","","formControlName","value",3,"onInputChange","placeholder"],["formControlName","percentage",3,"onCheckboxChanged","customMark"],["lgParseMath","","formControlName","amount",3,"disable","placeholder"],["lgSelfCenter","","lgShrink","",3,"click","size","icon"],["aria-hidden","false","aria-label","Example home icon","fontIcon","close"]],template:function(e,n){e&1&&(l(0,"lg-gap-column")(1,"lg-card-list",0),de(2,1),G(3,xt,1,0,null,2,dt),_e(),o(),l(5,"lg-button",3),b("click",function(){return n.addTxRow()}),p(6," Add row "),o()()),e&2&&(a(),c("formGroup",n.taxesForm),a(2),k(n.taxesForm.controls.rows.controls),a(2),E("success"))},dependencies:[Je,Qe,q,$,z,L,j,W,Ge,ke,Ye,K,qe,et,J,He,nt,it,Q,X,Ze],styles:[".taxes__row--odd[_ngcontent-%COMP%]{--control-bg: #fff}"]})};var pt=[{name:"VAT",description:"Value-Added Tax applied to ingredient purchases or product sales",value:.23,percentage:!0},{name:"Delivery Fee",description:"Fee charged for delivery services",value:.1,percentage:!1}];var Ct=["priceChart"],ft=["weightChart"],gt=(i,t)=>[i,t];function ht(i,t){i&1&&ee(0)}function vt(i,t){if(i&1&&y(0,ht,1,0,"ng-container",22),i&2){m(2);let e=ae(16);c("ngTemplateOutlet",e)}}function Tt(i,t){i&1&&ee(0)}function yt(i,t){if(i&1&&y(0,Tt,1,0,"ng-container",22),i&2){m(2);let e=ae(18);c("ngTemplateOutlet",e)}}function wt(i,t){if(i&1&&w(0,"lg-unit-switcher",23),i&2){let e=m(2);c("items",e.additionalPriceAction)}}function bt(i,t){if(i&1&&w(0,"lg-unit-switcher",24),i&2){let e=m(3);c("items",e.additionalPriceUnit)}}function St(i,t){i&1&&y(0,bt,1,1,"ng-template",16)}function Rt(i,t){if(i&1&&(l(0,"b"),p(1),s(2,"currencySymbol"),o()),i&2){let e,n=m(3);a(),O("",f(2,2,n.userSettings().currency)," / ",(e=n.result())==null||e.calculation==null||e.calculation.recipe==null?null:e.calculation.recipe.outcome_unit," ")}}function It(i,t){i&1&&y(0,Rt,3,4,"ng-template",16)}function Ft(i,t){if(i&1&&(l(0,"span",17),p(1),s(2,"userCurrency"),o()),i&2){let e,n=m(2);a(),_(" (+",x(2,1,(e=n.result())==null||e.calculation==null?null:e.calculation.totalPriceDifference,"1.2-2"),") ")}}function At(i,t){if(i&1&&(l(0,"lg-card",10)(1,"lg-gap-row",11)(2,"div"),p(3),s(4,"translate"),o(),l(5,"b"),p(6),s(7,"userCurrency"),o()()()),i&2){let e,n=m(2);a(),c("size","small")("relaxed",!0),a(2),C(f(4,4,"recipe.calculation.total-price-taxes.label")),a(3),_(" ",x(7,6,(((e=n.result())==null||e.calculation==null?null:e.calculation.totalPrice)||0)+n.totalTaxes(),"1.2-2")," ")}}function Et(i,t){if(i&1){let e=M();l(0,"lg-gap-row",8)(1,"lg-gap-column",9)(2,"lg-card",10)(3,"lg-gap-row",11)(4,"div"),p(5),s(6,"translate"),o(),l(7,"b"),p(8),s(9,"number"),o()()(),l(10,"lg-gap-column",12)(11,"lg-card",10)(12,"lg-gap-row",11)(13,"div"),p(14),s(15,"translate"),l(16,"b"),p(17),o()(),l(18,"b"),g(19,vt,1,1,"ng-container")(20,yt,1,1,"ng-container"),o()()(),l(21,"lg-gap-row",13)(22,"lg-input",14),y(23,wt,1,1,"ng-template",15),g(24,St,1,0,null,16),g(25,It,1,0,null,16),o()()(),l(26,"lg-card",10)(27,"lg-gap-row",11)(28,"div"),p(29),s(30,"translate"),o(),l(31,"b"),p(32),s(33,"userCurrency"),g(34,Ft,3,4,"span",17),o()()(),g(35,At,8,9,"lg-card",10),o(),l(36,"lg-card",18)(37,"lg-gap-column",19)(38,"lg-title",20)(39,"div"),p(40),s(41,"translate"),o()(),l(42,"canvas",21,4),b("chartHover",function(r){R(e);let d=m();return I(d.onChartHover("price",r.event,r.active))}),o()()(),l(44,"lg-card",18)(45,"lg-gap-column",19)(46,"lg-title",20)(47,"div"),p(48),s(49,"translate"),o()(),l(50,"canvas",21,5),b("chartHover",function(r){R(e);let d=m();return I(d.onChartHover("weight",r.event,r.active))}),o()()()()}if(i&2){let e,n,r,d,u=m();c("center",!0)("mobileMode",!0),a(),c("position","stretch"),a(2),c("size","small")("relaxed",!0),a(2),C(f(6,37,"recipe.calculation.outcome.label")),a(3),O(" ",x(9,39,u.outcome_amount()||((e=u.result())==null||e.calculation==null?null:e.calculation.totalWeight)||0,"1.0-2")," ",(e=u.result())==null||e.calculation==null||e.calculation.recipe==null?null:e.calculation.recipe.outcome_unit," "),a(2),c("position","stretch"),a(2),c("size","small")("relaxed",!0),a(2),_(" ",f(15,42,"recipe.calculation.one-unit.label")," "),a(3),_(" ",(n=u.result())==null||n.calculation==null||n.calculation.recipe==null?null:n.calculation.recipe.outcome_unit," "),a(2),h(u.notInGrams()?19:20),a(2),c("formGroup",u.recipePriceAdditionsForm)("size","small")("relaxed",!0),a(3),h(u.showPriceAdditionUnits()?24:-1),a(),h(u.roundActionSelected()?25:-1),a(2),c("size","small")("relaxed",!0),a(2),C(f(30,44,"recipe.calculation.total-price.label")),a(3),_(" ",x(33,46,(r=u.result())==null||r.calculation==null?null:r.calculation.totalPriceWithAdditions,"1.2-2")," "),a(2),h(!((d=u.result())==null||d.calculation==null)&&d.calculation.totalPriceDifference?34:-1),a(),h(u.totalTaxes()?35:-1),a(2),c("size","small"),a(),c("level",5),a(2),C(f(41,49,"recipe.calculation.price-chart")),a(2),c("data",u.doughnutChartData().prices)("options",u.doughnutChartOptions)("type",u.doughnutChartType),a(3),c("size","small"),a(),c("level",5),a(2),C(f(49,51,"recipe.calculation.weight-chart")),a(2),c("data",u.doughnutChartData().weight)("options",u.doughnutChartOptions)("type",u.doughnutChartType)}}function Pt(i,t){if(i&1&&(p(0),s(1,"userCurrency")),i&2){let e=m(2);_(" ",x(1,1,e.totalTaxes()/e.showedOutcome(),"1.2-2")," ")}}function Dt(i,t){if(i&1&&(p(0),s(1,"userCurrency")),i&2){let e=m(2);_(" ",x(1,1,e.totalTaxes(),"1.2-2")," ")}}function Nt(i,t){if(i&1&&g(0,Pt,2,4)(1,Dt,2,4),i&2){let e=m();h(e.notInGrams()?0:1)}}function Bt(i,t){if(i&1&&(p(0),s(1,"userCurrency")),i&2){let e,n=m(2);_(" ",x(1,1,(((e=n.result())==null||e.calculation==null?null:e.calculation.totalPrice)||1)/(n.showedOutcome()||1),"1.2-2")," ")}}function Gt(i,t){if(i&1&&(p(0),s(1,"userCurrency")),i&2){let e,n=m(2);_(" ",x(1,1,(e=n.result())==null||e.calculation==null?null:e.calculation.totalPrice,"1.2-2")," ")}}function kt(i,t){if(i&1&&g(0,Bt,2,4)(1,Gt,2,4),i&2){let e=m();h(e.notInGrams()?0:1)}}function Mt(i,t){if(i&1&&(l(0,"span",17),p(1),s(2,"userCurrency"),o()),i&2){let e,n=m(4);a(),_(" (+ ",x(2,1,(e=n.result())==null||e.calculation==null?null:e.calculation.pricePerUnitDifference,"1.2-2"),") ")}}function Vt(i,t){if(i&1&&(l(0,"span",25),p(1),s(2,"userCurrency"),o(),g(3,Mt,3,4,"span",17)),i&2){let e,n=m(3);a(),_(" > ",x(2,2,(e=n.result())==null||e.calculation==null?null:e.calculation.pricePerUnitModified,"1.2-2")," "),a(2),h(n.roundActionSelected()?3:-1)}}function Ot(i,t){if(i&1&&(l(0,"span"),p(1),s(2,"userCurrency"),o(),g(3,Vt,4,5),p(4),s(5,"number")),i&2){let e,n,r,d,u=m(2);V("text-small",(e=u.result())==null||e.calculation==null?null:e.calculation.totalPriceDifference),a(),_(" ",x(2,5,(n=u.result())==null||n.calculation==null?null:n.calculation.pricePerOutcomeUnit,"1.2-2")," "),a(2),h(!((r=u.result())==null||r.calculation==null)&&r.calculation.totalPriceDifference?3:-1),a(),_(" / ",x(5,8,((d=u.result())==null||d.calculation==null||d.calculation.recipe==null?null:d.calculation.recipe.weightForUnit)||1,"1.0-2")," gram ")}}function Ut(i,t){if(i&1&&(p(0),s(1,"userCurrency")),i&2){let e,n=m(2);_(" ",x(1,1,(((e=n.result())==null||e.calculation==null?null:e.calculation.totalPrice)||1)+n.totalTaxes(),"1.2-2")," ")}}function zt(i,t){if(i&1&&g(0,Ot,6,11)(1,Ut,2,4),i&2){let e=m();h(e.notInGrams()?0:1)}}function Lt(i,t){}function jt(i,t){if(i&1&&(p(0),s(1,"userCurrency")),i&2){let e,n=m(2);_(" ",x(1,1,((((e=n.result())==null||e.calculation==null?null:e.calculation.totalPrice)||1)+n.totalTaxes())/(n.outcome_amount()||((e=n.result())==null||e.calculation==null?null:e.calculation.totalWeight)||0),"1.2-5")," ")}}function Wt(i,t){if(i&1&&g(0,Lt,0,0)(1,jt,2,4),i&2){let e=m();h(e.notInGrams()?0:1)}}function $t(i,t){if(i&1&&(l(0,"a",32),p(1),o()),i&2){let e=m().$implicit;c("routerLink",ve(2,gt,e.type==="recipe-row"?"/recipes/edit/":"/products/edit/",e.uuid)),a(),_(" ",e.name," ")}}function Ht(i,t){if(i&1&&(p(0),s(1,"translate")),i&2){let e=m().$implicit;_(" ",f(1,1,e.name)," ")}}function Qt(i,t){if(i&1&&(l(0,"tr",31)(1,"td"),p(2),o(),l(3,"td")(4,"div",31),g(5,$t,2,5,"a",32)(6,Ht,2,3),o()(),l(7,"td"),p(8),s(9,"number"),o(),l(10,"td"),p(11),o(),l(12,"td"),p(13),s(14,"userCurrency"),o(),l(15,"td"),p(16),s(17,"userCurrency"),o()()),i&2){let e=t.$implicit,n=t.$index;c("ngClass",e.type),a(2),C(n+1),a(2),c("ngClass","indent-"+e.indent),a(),h(e.type!=="total"?5:6),a(3),C(x(9,8,e.amount,"1.0-2")),a(3),C(e.unit),a(2),C(x(14,11,e.price_per_gram,"1.2-5")),a(3),C(x(17,14,e.total,"1.0-2"))}}function qt(i,t){if(i&1&&(l(0,"table")(1,"colgroup"),w(2,"col",26)(3,"col",27)(4,"col",28)(5,"col",29)(6,"col",28)(7,"col",30),o(),l(8,"thead")(9,"tr")(10,"th"),p(11,"#"),o(),l(12,"th"),p(13),s(14,"translate"),o(),l(15,"th"),p(16),s(17,"translate"),o(),l(18,"th"),p(19),s(20,"translate"),o(),l(21,"th"),p(22),s(23,"translate"),o(),l(24,"th"),p(25),s(26,"translate"),o()()(),l(27,"tbody"),G(28,Qt,18,17,"tr",31,se),o()()),i&2){let e,n=m();a(13),C(f(14,5,"recipe.calculation.table.name.title")),a(3),C(f(17,7,"recipe.calculation.table.amount.title")),a(3),C(f(20,9,"recipe.calculation.table.unit.title")),a(3),C(f(23,11,"recipe.calculation.table.price.title")),a(3),C(f(26,13,"recipe.calculation.table.total.title")),a(3),k((e=n.result())==null?null:e.table)}}function Jt(i,t){}var mt=class i{constructor(t,e,n,r,d,u){this._aRoute=t;this._calculateRecipeService=e;this._formTemplateService=n;this._injector=r;this._router=d;this._notificationService=u;this._aRoute.data.pipe(U()).subscribe(S=>{this.result.set(S.result),this.outcome_amount.set(this.result()?.calculation?.outcomeAmount||0),this.showedOutcome.set(this.result()?.calculation?.outcomeAmount||0),this.loadRecipeTaxTemplate(),this.recipePriceAdditionsForm.patchValue({action:this.result()?.calculation?.recipe?.perUnitPriceModifier?.action||"add",value:this.result()?.calculation?.recipe?.perUnitPriceModifier?.value||0,unit:this.result()?.calculation?.recipe?.perUnitPriceModifier?.unit||"currency"})})}userSettings=me(Le);additionalPriceUnit=[{label:"$",value:"currency",style:"secondary"},{label:"%",value:"percent",style:"secondary"}];additionalPriceAction=[{label:"Add",value:"add",style:"secondary"},{label:"Round to",value:"round",style:"secondary"}];doughnutChartType="pie";uuid=De("uuid");result=T(null);doughnutChartData=D(()=>{let t=this.result(),{prices:e,weight:n,labels:r,colors:d}=t?.calculation?.ingredients?.reduce((u,S)=>(u.prices.push(S.totalPrice),u.weight.push(S.totalWeightGram),u.labels.push(S.generalName),u.colors.push(S.product_id?.ownColor??S.recipe_id?.ownColor??Ae()),u),{prices:[],weight:[],labels:[],colors:[]})||{prices:[],weight:[],labels:[],colors:[]};return{prices:{labels:r,datasets:[{label:"Cost",data:e,backgroundColor:d,borderWidth:0}]},weight:{labels:r,datasets:[{label:"Amount",data:n,backgroundColor:d,borderWidth:0}]},ingredients:t?.calculation?.ingredients||[]}});doughnutChartOptions={plugins:{legend:{display:!1}},onClick:(t,e,n)=>{}};chartPrices;chartWeight;outcome_amount=ce(0);showedOutcome=T(0);totalTaxes=T(0);notInGrams=D(()=>this.result()?.calculation?.recipe?.outcome_unit&&this.result()?.calculation?.recipe?.outcome_unit!=="gram");taxesComponent=Te(B);taxRows=T([]);taxTemplateToApply=ce();canApplyTemplates=T(!0);canSaveDefaultTemplate=T(!0);recipePriceAdditionsForm=new N({action:new v("add"),value:new v(0),unit:new v("currency")});values=Pe(this.recipePriceAdditionsForm.valueChanges);roundActionSelected=D(()=>this.values()?.action==="round");showPriceAdditionUnits=D(()=>{let t=this.result()?.calculation?.recipe?.perUnitPriceModifier?.action;return console.log({action:t}),t==="add"||!t});ngAfterViewInit(){window.chartPrices=this.chartPrices,window.chartWeight=this.chartWeight,this.recipePriceAdditionsForm.valueChanges.pipe(pe(300)).subscribe(t=>{this.updatePriceAdditions(t)})}onChartHover(t,e,n){if(!n?.length)return;let r=t==="price"?this.chartWeight:this.chartPrices,d=n[0].index;r?.chart?.update()}onTaxTemplateChange(t){this.linkTaxTemplate(t.name)}onOutcomeChange=t=>{this._calculateRecipeService.calculateRecipe(this.uuid(),t).then(e=>{this.result.set(e),this.showedOutcome.set(t)})};saveDefaultTaxTemplate(){this._formTemplateService.saveTemplate("tax",{name:"Default Tax Template",createdAt:new Date().toISOString(),id:new Date().toISOString(),data:this.taxesComponent()?.taxesForm.value.rows?.map(t=>({name:t.name,description:t.description,value:t.value,percentage:t.percentage}))||[]}),this.canSaveDefaultTemplate.set(!1)}loadRecipeTemplate(){return this._formTemplateService.getTemplateByName("tax",this._taxTemplateName(this.result()?.calculation?.recipe))}loadRecipeTaxTemplate(){let t=this.loadRecipeTemplate();if(t){this.taxRows.set(t.data.map(r=>({name:r.name,description:r.description,value:r.value,percentage:r.percentage})));return}let e=this._formTemplateService.getTemplateByName("tax","Default Tax Template");e?this.taxRows.set(e.data.map(r=>({name:r.name,description:r.description,value:r.value,percentage:r.percentage}))):this.taxRows.set(pt);let n=this._taxTemplateName(this.result()?.calculation?.recipe);this.saveTaxTemplate(n,this.taxesComponent()?.taxesForm.value.rows??[]),this.linkTaxTemplate(n)}saveTaxTemplate(t,e){this._formTemplateService.saveTemplate("tax",{name:t,createdAt:new Date().toISOString(),id:new Date().toISOString(),data:e.map(n=>({name:n.name,description:n.description,value:n.value,percentage:n.percentage}))||[]})}loadTaxTemplate(){let t=this.taxTemplateToApply()?.name;if(!t||t===this.result()?.calculation?.recipe?.taxTemplateName)return;let e=this._formTemplateService.getTemplateByName("tax",t);e&&(this.taxRows.set(e.data.map(n=>({name:n.name,description:n.description,value:n.value,percentage:n.percentage}))),this.onTaxTemplateChange(e))}ngOnInit(){}linkTaxTemplate(t){this._calculateRecipeService.linkTaxTemplate(this.uuid(),t).then(()=>{console.log("Tax template linked")})}async updatePriceAdditions(t){try{await this._calculateRecipeService.updateRecipe(this.result()?.calculation?.recipe,{perUnitPriceModifier:{action:t.action,value:parseFloat(t.value)||0,unit:t.unit}});let e=await this._calculateRecipeService.calculateRecipe(this.uuid());this.result.set(e)}catch(e){this._notificationService.error(Ee(e))}}onTotalTaxesChanged=t=>{this.totalTaxes.set(t)};onTaxesChanged=t=>{this.saveTaxTemplate(this._taxTemplateName(this.result()?.calculation?.recipe),t)};_taxTemplateName(t){return t.name+" Tax Template"}static \u0275fac=function(e){return new(e||i)(F(Re),F(Ne),F(Be),F(ue),F(Ie),F(Oe))};static \u0275cmp=A({type:i,selectors:[["lg-calculate-recipe"]],viewQuery:function(e,n){if(e&1&&(fe(n.taxesComponent,B,5),te(Ct,5,Y),te(ft,5,Y)),e&2){ge();let r;ie(r=ne())&&(n.chartPrices=r.first),ie(r=ne())&&(n.chartWeight=r.first)}},inputs:{outcome_amount:[1,"outcome_amount"],taxTemplateToApply:[1,"taxTemplateToApply"]},outputs:{outcome_amount:"outcome_amountChange",taxTemplateToApply:"taxTemplateToApplyChange"},features:[he([Ue,Se])],decls:22,vars:16,consts:[["taxAmount",""],["rawAmount",""],["totalAmount",""],["perGramAmount",""],["priceChart",""],["weightChart",""],[3,"center","mobileMode"],[3,"flat","link","size"],["lgExpand","",2,"max-width","1200px",3,"center","mobileMode"],[3,"position"],["size","small"],[3,"size","relaxed"],["size","small",3,"position"],[2,"--control-bg","#fff","padding","0 16px",3,"formGroup","size","relaxed"],["lgParseMath","","placeholder","extra price","formControlName","value"],["lgExtraTpl","","place","before"],["lgExtraTpl","","place","after"],[1,"text-accent"],["lgWidth","270px","size","small"],[3,"size"],[3,"level"],["baseChart","",3,"chartHover","data","options","type"],[4,"ngTemplateOutlet"],["formControlName","action",3,"items"],["formControlName","unit",3,"items"],[1,"text-active"],["span","1",2,"width","1%"],["span","1",2,"width","20%"],["span","1",2,"width","5%"],["span","1",2,"width","3%"],["span","1",2,"width","7%"],[3,"ngClass"],[3,"routerLink"]],template:function(e,n){if(e&1&&(l(0,"lg-fade-in")(1,"lg-container")(2,"lg-gap-column")(3,"lg-gap-row",6)(4,"lg-title"),p(5),s(6,"translate"),o(),l(7,"lg-button",7),p(8),s(9,"translate"),o()(),g(10,Et,52,53,"lg-gap-row",8),y(11,Nt,2,1,"ng-template",null,0,P)(13,kt,2,1,"ng-template",null,1,P)(15,zt,2,1,"ng-template",null,2,P)(17,Wt,2,1,"ng-template",null,3,P),l(19,"lg-table-card"),g(20,qt,30,15,"table")(21,Jt,0,0),o()()()()),e&2){let r,d,u;a(3),c("center",!0)("mobileMode",!0),a(2),O(" ",(r=n.result())==null||r.calculation==null||r.calculation.recipe==null?null:r.calculation.recipe.name," ",f(6,12,"recipe.calculation.title.after-text")," "),a(2),E("primary"),c("flat",!0)("link","/recipes/edit/"+((d=n.result())==null||d.calculation==null||d.calculation.recipe==null?null:d.calculation.recipe.uuid))("size","small"),a(),_(" ",f(9,14,"edit-label")," "),a(2),h(!((u=n.result())==null||u.calculation==null)&&u.calculation.totalPrice?10:-1),a(10),h(n.result()?20:21)}},dependencies:[je,We,Z,ye,J,q,be,Ve,z,L,Fe,Q,we,$e,Y,H,at,Ke,lt,ze,K,$,j,W,tt,X,Xe,ot],styles:[`lg-number-input .lg-number-input{width:100px}
`],encapsulation:2})};export{mt as CalculateRecipeComponent};
