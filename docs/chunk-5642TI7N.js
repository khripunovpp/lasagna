import {
  TableCardComponent
} from "./chunk-Y47DSHMD.js";
import {
  ReadonlyControlComponent
} from "./chunk-3CU5R2V3.js";
import {
  CurrencySymbolPipe
} from "./chunk-QBTH3SIQ.js";
import {
  EggsWidgetComponent
} from "./chunk-WTBYATTE.js";
import {
  Chart,
  registerables
} from "./chunk-OF66TBL6.js";
import {
  matchMediaSignal,
  mobileBreakpoint
} from "./chunk-JNKATJIU.js";
import {
  ChipsListComponent,
  HtmlEditorComponent
} from "./chunk-RQQNVSG6.js";
import {
  UnitStringPipe
} from "./chunk-G7O37WZ6.js";
import {
  UnitSwitcherComponent
} from "./chunk-DZGBWSEE.js";
import {
  UserCurrencyPipe
} from "./chunk-MSSA67JN.js";
import {
  DeleteConfirmationPopoverComponent,
  DeleteConfirmationService
} from "./chunk-PN5PQSS2.js";
import {
  MultiselectComponent,
  NgLabelTemplateDirective,
  NgOptionTemplateDirective,
  NgSelectComponent,
  NgTagTemplateDirective,
  SelfStartDirective
} from "./chunk-QCDXA5J3.js";
import {
  ControlBoxComponent
} from "./chunk-U3TDYFCF.js";
import {
  WidthDirective
} from "./chunk-LRBNXK2T.js";
import {
  ShrinkDirective
} from "./chunk-V7J77S6Z.js";
import {
  ParseMathDirective,
  smaller
} from "./chunk-5P5OGC4J.js";
import {
  NumberInputComponent
} from "./chunk-X57NSDUU.js";
import {
  ROUTER_MANAGER
} from "./chunk-6TJSNOWD.js";
import {
  AnalyticsService
} from "./chunk-PF6RY5D3.js";
import "./chunk-CR4NZLV7.js";
import {
  ControlComponent,
  ControlLabelTemplateDirective
} from "./chunk-HUXXML4Q.js";
import {
  InputComponent
} from "./chunk-GIEGUCCS.js";
import {
  ControlExtraTemplateDirective
} from "./chunk-WDCOU2SU.js";
import "./chunk-EROQRXO4.js";
import {
  ControlsBarComponent
} from "./chunk-EEM4H4NM.js";
import {
  InlineSeparatedGroupComponent,
  InlineSeparatedGroupDirective
} from "./chunk-VUN3T56G.js";
import "./chunk-IWKECZQN.js";
import {
  DialogComponent
} from "./chunk-SSW253TQ.js";
import {
  ExpandDirective
} from "./chunk-STX6NIUK.js";
import {
  MatIcon
} from "./chunk-MKQIBRI6.js";
import {
  ContainerComponent
} from "./chunk-WON5FF4H.js";
import {
  FlexRowComponent
} from "./chunk-UFJVMPSL.js";
import {
  CardComponent
} from "./chunk-PJDK3IYM.js";
import {
  TimeAgoPipe
} from "./chunk-FDNQMWQM.js";
import {
  ProductFactory,
  ProductsRepository,
  SelectResourcesService
} from "./chunk-WZJWRJIG.js";
import "./chunk-PWIGGAMT.js";
import "./chunk-ETIKHZBE.js";
import "./chunk-IGVRSL6U.js";
import {
  NotificationsService,
  Product,
  SETTINGS,
  SettingsKeysConst,
  SettingsService,
  errorHandler,
  hasMicroPrice,
  productToFormValue
} from "./chunk-JVOZ4YPY.js";
import "./chunk-GRS3SI4M.js";
import {
  UnitValue
} from "./chunk-7REZCGNQ.js";
import "./chunk-T5CRNY7R.js";
import "./chunk-5WJUMO7X.js";
import {
  FadeInComponent
} from "./chunk-YUWU6IJY.js";
import {
  TitleComponent
} from "./chunk-T6NLT234.js";
import "./chunk-GGH4TL4E.js";
import {
  FormControl,
  FormControlName,
  FormGroup,
  FormGroupDirective,
  FormsModule,
  NG_VALUE_ACCESSOR,
  NgControlStatus,
  NgControlStatusGroup,
  NgModel,
  ReactiveFormsModule,
  Validators,
  ɵNgNoValidate
} from "./chunk-4GKKNB6P.js";
import {
  ButtonComponent
} from "./chunk-IHCVSUQN.js";
import {
  TranslateDirective,
  TranslatePipe,
  TranslateService
} from "./chunk-KKROIGFS.js";
import {
  ActivatedRoute,
  Router
} from "./chunk-UUUEGOMT.js";
import "./chunk-CE7BC4LB.js";
import "./chunk-IWOUTMKL.js";
import {
  FlexColumnComponent
} from "./chunk-3KXU4X6J.js";
import {
  CurrencyPipe,
  DatePipe,
  DecimalPipe,
  NgTemplateOutlet
} from "./chunk-KBRICXTE.js";
import {
  Component,
  Input,
  Optional,
  Subject,
  ViewChild,
  ViewEncapsulation,
  combineLatest,
  computed,
  debounceTime,
  effect,
  forwardRef,
  inject,
  input,
  of,
  output,
  setClassMetadata,
  signal,
  switchMap,
  take,
  viewChild,
  ɵsetClassDebugInfo,
  ɵɵNgOnChangesFeature,
  ɵɵProvidersFeature,
  ɵɵadvance,
  ɵɵclassProp,
  ɵɵconditional,
  ɵɵconditionalCreate,
  ɵɵdefineComponent,
  ɵɵdirectiveInject,
  ɵɵdomElement,
  ɵɵdomElementEnd,
  ɵɵdomElementStart,
  ɵɵdomProperty,
  ɵɵelement,
  ɵɵelementContainer,
  ɵɵelementEnd,
  ɵɵelementStart,
  ɵɵgetCurrentView,
  ɵɵlistener,
  ɵɵloadQuery,
  ɵɵnextContext,
  ɵɵpipe,
  ɵɵpipeBind1,
  ɵɵpipeBind2,
  ɵɵproperty,
  ɵɵpureFunction0,
  ɵɵpureFunction1,
  ɵɵqueryAdvance,
  ɵɵqueryRefresh,
  ɵɵreference,
  ɵɵrepeater,
  ɵɵrepeaterCreate,
  ɵɵrepeaterTrackByIdentity,
  ɵɵresetView,
  ɵɵrestoreView,
  ɵɵstyleMap,
  ɵɵtemplate,
  ɵɵtemplateRefExtractor,
  ɵɵtext,
  ɵɵtextInterpolate,
  ɵɵtextInterpolate1,
  ɵɵtextInterpolate2,
  ɵɵviewQuery,
  ɵɵviewQuerySignal
} from "./chunk-Z5TNFCCP.js";
import "./chunk-PZQLIUCM.js";
import "./chunk-7YWLATDR.js";
import "./chunk-46DXP6YY.js";

// src/app/features/widgets/amount-widgets.component.ts
function AmountWidgetsComponent_Conditional_9_Template(rf, ctx) {
  if (rf & 1) {
    const _r2 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 7)(1, "lg-eggs-widget", 8);
    \u0275\u0275listener("changed", function AmountWidgetsComponent_Conditional_9_Template_lg_eggs_widget_changed_1_listener($event) {
      \u0275\u0275restoreView(_r2);
      const ctx_r2 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r2.onEggsChanged($event));
    });
    \u0275\u0275elementEnd()();
  }
}
var AmountWidgetsComponent = class _AmountWidgetsComponent {
  constructor() {
  }
  eggsChanged = output();
  selectedWidget = signal(null, ...ngDevMode ? [{ debugName: "selectedWidget" }] : []);
  dialog = viewChild(DialogComponent, ...ngDevMode ? [{ debugName: "dialog" }] : []);
  onWidgetSelect(event) {
    this.selectedWidget.set(event);
  }
  onEggsChanged(event) {
    if (!event)
      return;
    this.eggsChanged.emit(event);
  }
  onConfirm() {
  }
  onCancel() {
  }
  open() {
    this.dialog()?.open();
  }
  close() {
    this.dialog()?.close();
  }
  static \u0275fac = function AmountWidgetsComponent_Factory(__ngFactoryType__) {
    return new (__ngFactoryType__ || _AmountWidgetsComponent)();
  };
  static \u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _AmountWidgetsComponent, selectors: [["lg-amount-widgets"]], viewQuery: function AmountWidgetsComponent_Query(rf, ctx) {
    if (rf & 1) {
      \u0275\u0275viewQuerySignal(ctx.dialog, DialogComponent, 5);
    }
    if (rf & 2) {
      \u0275\u0275queryAdvance();
    }
  }, outputs: { eggsChanged: "eggsChanged" }, decls: 10, vars: 14, consts: [["dialog", ""], [3, "click", "flat", "icon"], ["aria-hidden", "false", "fontIcon", "add"], [3, "onCancel", "onConfirm", "centerButtons", "showConfirmButton", "displayFooter", "columnButtons"], [1, "amount-widgets"], [1, "amount-widgets__buttons"], [1, "amount-widgets__button", 3, "click"], [1, "amount-widgets__wrapper"], [3, "changed"]], template: function AmountWidgetsComponent_Template(rf, ctx) {
    if (rf & 1) {
      const _r1 = \u0275\u0275getCurrentView();
      \u0275\u0275elementStart(0, "lg-button", 1);
      \u0275\u0275listener("click", function AmountWidgetsComponent_Template_lg_button_click_0_listener() {
        \u0275\u0275restoreView(_r1);
        return \u0275\u0275resetView(ctx.open());
      });
      \u0275\u0275element(1, "mat-icon", 2);
      \u0275\u0275elementEnd();
      \u0275\u0275elementStart(2, "lg-dialog", 3, 0);
      \u0275\u0275listener("onCancel", function AmountWidgetsComponent_Template_lg_dialog_onCancel_2_listener() {
        \u0275\u0275restoreView(_r1);
        return \u0275\u0275resetView(ctx.onCancel());
      })("onConfirm", function AmountWidgetsComponent_Template_lg_dialog_onConfirm_2_listener() {
        \u0275\u0275restoreView(_r1);
        return \u0275\u0275resetView(ctx.onConfirm());
      });
      \u0275\u0275elementStart(4, "div", 4)(5, "div", 5)(6, "button", 6);
      \u0275\u0275listener("click", function AmountWidgetsComponent_Template_button_click_6_listener() {
        \u0275\u0275restoreView(_r1);
        return \u0275\u0275resetView(ctx.onWidgetSelect("eggs"));
      });
      \u0275\u0275text(7);
      \u0275\u0275pipe(8, "translate");
      \u0275\u0275elementEnd()();
      \u0275\u0275conditionalCreate(9, AmountWidgetsComponent_Conditional_9_Template, 2, 0, "div", 7);
      \u0275\u0275elementEnd()();
    }
    if (rf & 2) {
      \u0275\u0275styleMap("success");
      \u0275\u0275property("flat", true)("icon", true);
      \u0275\u0275advance(2);
      \u0275\u0275property("centerButtons", true)("showConfirmButton", false)("displayFooter", false)("columnButtons", false);
      \u0275\u0275advance(2);
      \u0275\u0275classProp("selected", ctx.selectedWidget() != null);
      \u0275\u0275advance(3);
      \u0275\u0275textInterpolate1("", \u0275\u0275pipeBind1(8, 12, "widgets.eggs.title"), " ");
      \u0275\u0275advance(2);
      \u0275\u0275conditional(ctx.selectedWidget() === "eggs" ? 9 : -1);
    }
  }, dependencies: [
    EggsWidgetComponent,
    DialogComponent,
    ButtonComponent,
    MatIcon,
    TranslatePipe
  ], styles: ["\n\n.amount-widgets[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 16px;\n  flex-direction: column;\n}\n.amount-widgets__input[_ngcontent-%COMP%] {\n  flex: 1;\n}\n.amount-widgets__buttons[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 16px;\n  flex-wrap: wrap;\n  padding: 16px;\n  background-color: #fafafa;\n  border-radius: 12px;\n  margin: -16px;\n}\n.amount-widgets.selected[_ngcontent-%COMP%]   .amount-widgets__buttons[_ngcontent-%COMP%] {\n  margin-bottom: 0;\n}\n.amount-widgets__button[_ngcontent-%COMP%] {\n  display: flex;\n  padding: 8px 16px;\n  border-radius: 16px;\n  background-color: #e5de38;\n  appearance: none;\n  border: none;\n  font-family: inherit;\n  font-size: inherit;\n}\n/*# sourceMappingURL=amount-widgets.component.css.map */"] });
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(AmountWidgetsComponent, [{
    type: Component,
    args: [{ selector: "lg-amount-widgets", standalone: true, template: `
    <lg-button (click)="open()"
               [flat]="true"
               [icon]="true"
               [style]="'success'">
      <mat-icon aria-hidden="false" fontIcon="add"></mat-icon>
    </lg-button>

    <lg-dialog #dialog
               (onCancel)="onCancel()"
               (onConfirm)="onConfirm()"
               [centerButtons]="true"
               [showConfirmButton]="false"
               [displayFooter]="false"
               [columnButtons]="false">
      <div [class.selected]="selectedWidget() != null"
           class="amount-widgets">
        <div class="amount-widgets__buttons">
          <button (click)="onWidgetSelect('eggs')"
                  class="amount-widgets__button">{{ 'widgets.eggs.title' | translate }}
          </button>
        </div>
        @if (selectedWidget() === 'eggs') {
          <div class="amount-widgets__wrapper">
            <lg-eggs-widget (changed)="onEggsChanged($event)"></lg-eggs-widget>
          </div>
        }
      </div>
    </lg-dialog>
  `, imports: [
      EggsWidgetComponent,
      TranslatePipe,
      DialogComponent,
      ButtonComponent,
      MatIcon,
      MatIcon
    ], styles: ["/* angular:styles/component:scss;8c3c71c12b5351fce86054c47a3f04356ee3671cb81c8812cb3ea3add97ffeff;/Users/khripunovpavel/Documents/my/lasagna/lasagna/src/app/features/widgets/amount-widgets.component.ts */\n.amount-widgets {\n  display: flex;\n  gap: 16px;\n  flex-direction: column;\n}\n.amount-widgets__input {\n  flex: 1;\n}\n.amount-widgets__buttons {\n  display: flex;\n  gap: 16px;\n  flex-wrap: wrap;\n  padding: 16px;\n  background-color: #fafafa;\n  border-radius: 12px;\n  margin: -16px;\n}\n.amount-widgets.selected .amount-widgets__buttons {\n  margin-bottom: 0;\n}\n.amount-widgets__button {\n  display: flex;\n  padding: 8px 16px;\n  border-radius: 16px;\n  background-color: #e5de38;\n  appearance: none;\n  border: none;\n  font-family: inherit;\n  font-size: inherit;\n}\n/*# sourceMappingURL=amount-widgets.component.css.map */\n"] }]
  }], () => [], null);
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(AmountWidgetsComponent, { className: "AmountWidgetsComponent", filePath: "src/app/features/widgets/amount-widgets.component.ts", lineNumber: 89 });
})();

// src/app/features/controls/form/autocomplete.component.ts
function AutocompleteComponent_ng_template_3_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0);
  }
  if (rf & 2) {
    const item_r1 = ctx.item;
    \u0275\u0275textInterpolate1(" ", (item_r1 == null ? null : item_r1.name) ?? (item_r1 == null ? null : item_r1.value) ?? item_r1, " ");
  }
}
function AutocompleteComponent_ng_template_4_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0);
  }
  if (rf & 2) {
    const item_r2 = ctx.item;
    \u0275\u0275textInterpolate1(" ", (item_r2 == null ? null : item_r2.name) ?? (item_r2 == null ? null : item_r2.value) ?? item_r2, " ");
  }
}
function AutocompleteComponent_ng_template_5_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0);
  }
  if (rf & 2) {
    const searchTerm_r3 = ctx.searchTerm;
    \u0275\u0275textInterpolate1(" ", searchTerm_r3, " ");
  }
}
var AutocompleteComponent = class _AutocompleteComponent {
  _selectResourcesService;
  constructor(_selectResourcesService) {
    this._selectResourcesService = _selectResourcesService;
  }
  placeholder = "";
  noLoad = input(false, ...ngDevMode ? [{ debugName: "noLoad" }] : []);
  resource = input("", ...ngDevMode ? [{ debugName: "resource" }] : []);
  key = input("", ...ngDevMode ? [{ debugName: "key" }] : []);
  appendTo = input("", ...ngDevMode ? [{ debugName: "appendTo" }] : []);
  strict = input(false, ...ngDevMode ? [{ debugName: "strict" }] : []);
  multi = input(false, ...ngDevMode ? [{ debugName: "multi" }] : []);
  loadedList = signal([], ...ngDevMode ? [{ debugName: "loadedList" }] : []);
  onSelected = output();
  selectComponent = viewChild(NgSelectComponent, ...ngDevMode ? [{ debugName: "selectComponent" }] : []);
  value = null;
  initialList = signal([], ...ngDevMode ? [{ debugName: "initialList" }] : []);
  _onSearch$ = new Subject();
  _currentSearchTerm = null;
  onChange = () => {
  };
  onTouched = () => {
  };
  searchFn = (term, item) => {
    const val = item;
    if (typeof val === "string") {
      return val.toLowerCase().includes(term?.toLowerCase() ?? "");
    }
    return val.name?.toLowerCase().includes(term?.toLowerCase() ?? "");
  };
  compareWith = (a, b) => {
    const valA = a;
    const valB = b;
    if (!a || !b) {
      return false;
    }
    if (typeof valA !== "string" && typeof valB !== "string") {
      return valA?.name === valB?.name || valA?.uuid === valB?.uuid;
    }
    if (typeof valA === "string" && typeof valB !== "string") {
      return valA === valB?.name || valA === valB?.uuid;
    }
    if (typeof valA !== "string" && typeof valB === "string") {
      return valA?.name === valB || valA?.uuid === valB;
    }
    return false;
  };
  writeValue(value) {
    this.change(value);
    this.selectComponent().searchTerm = "";
  }
  change(value) {
    this.value = value;
    this.onChange(this.value);
  }
  registerOnChange(fn) {
    this.onChange = fn;
  }
  registerOnTouched(fn) {
    this.onTouched = fn;
  }
  onChangeInput(value) {
    this.change(value);
  }
  onChangeSelect(value) {
    const val = typeof value === "string" ? value : value?.[this.key()];
    this.change(val);
    this.onSelected.emit(val);
  }
  onSearch(event) {
    if (!event.term) {
      this.writeValue("");
      return;
    }
    this._currentSearchTerm = event.term;
    if (!this.noLoad()) {
      this._onSearch$.next(event);
    }
    if (event.items.length === 0) {
      this.loadedList.set([{ name: event.term, value: event.term }]);
    } else {
      this.loadedList.set(event.items);
    }
    this.selectComponent().searchTerm = this._capitalizeFirstLetter(event.term);
  }
  onBlur() {
    const select = this.selectComponent();
    if (select?.searchTerm) {
      const searchValue = select.searchTerm.trim();
      if (searchValue) {
        const tag = { name: searchValue, value: searchValue };
        this.loadedList.set([tag]);
        this.change(searchValue);
        this.onSelected.emit(searchValue);
      }
    }
  }
  ngOnInit() {
    this._selectResourcesService.register(this.resource());
    this._onSearch$.asObservable().pipe(debounceTime(300)).subscribe((event) => {
      this._selectResourcesService.autocomplete(this.resource(), this.key(), event.term);
    });
    this._selectResourcesService.registryStream.pipe(switchMap((registry) => {
      const res = registry.get(this.resource());
      return res?.stream ?? of([]);
    })).subscribe((items) => {
      this.loadedList.set(items);
      if (this.initialList().length)
        return;
      this.initialList.set(items);
    });
  }
  reload() {
  }
  focus() {
    const select = this.selectComponent();
    if (select) {
      select.focus();
    }
  }
  _capitalizeFirstLetter(string) {
    return string.charAt(0).toUpperCase() + string.slice(1);
  }
  static \u0275fac = function AutocompleteComponent_Factory(__ngFactoryType__) {
    return new (__ngFactoryType__ || _AutocompleteComponent)(\u0275\u0275directiveInject(SelectResourcesService, 8));
  };
  static \u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _AutocompleteComponent, selectors: [["lg-autocomplete"]], viewQuery: function AutocompleteComponent_Query(rf, ctx) {
    if (rf & 1) {
      \u0275\u0275viewQuerySignal(ctx.selectComponent, NgSelectComponent, 5);
    }
    if (rf & 2) {
      \u0275\u0275queryAdvance();
    }
  }, inputs: { placeholder: "placeholder", noLoad: [1, "noLoad"], resource: [1, "resource"], key: [1, "key"], appendTo: [1, "appendTo"], strict: [1, "strict"], multi: [1, "multi"] }, outputs: { onSelected: "onSelected" }, features: [\u0275\u0275ProvidersFeature([
    {
      provide: NG_VALUE_ACCESSOR,
      useExisting: forwardRef(() => _AutocompleteComponent),
      multi: true
    }
  ])], decls: 6, vars: 13, consts: [[1, "autocomplete"], ["bindLabel", "name", 3, "blur", "change", "search", "addTag", "bindValue", "appendTo", "compareWith", "editableSearchTerm", "items", "multiple", "ngModel", "placeholder", "searchFn", "notFoundText"], ["ng-label-tmp", ""], ["ng-option-tmp", ""], ["ng-tag-tmp", ""]], template: function AutocompleteComponent_Template(rf, ctx) {
    if (rf & 1) {
      \u0275\u0275elementStart(0, "div", 0)(1, "ng-select", 1);
      \u0275\u0275pipe(2, "translate");
      \u0275\u0275listener("blur", function AutocompleteComponent_Template_ng_select_blur_1_listener() {
        return ctx.onBlur();
      })("change", function AutocompleteComponent_Template_ng_select_change_1_listener($event) {
        return ctx.onChangeSelect($event);
      })("search", function AutocompleteComponent_Template_ng_select_search_1_listener($event) {
        return ctx.onSearch($event);
      });
      \u0275\u0275template(3, AutocompleteComponent_ng_template_3_Template, 1, 1, "ng-template", 2)(4, AutocompleteComponent_ng_template_4_Template, 1, 1, "ng-template", 3)(5, AutocompleteComponent_ng_template_5_Template, 1, 1, "ng-template", 4);
      \u0275\u0275elementEnd()();
    }
    if (rf & 2) {
      \u0275\u0275advance();
      \u0275\u0275property("addTag", true)("bindValue", ctx.key())("appendTo", ctx.appendTo())("compareWith", ctx.compareWith)("editableSearchTerm", true)("items", ctx.loadedList())("multiple", ctx.multi())("ngModel", ctx.value)("placeholder", ctx.placeholder)("searchFn", ctx.searchFn)("notFoundText", \u0275\u0275pipeBind1(2, 11, "search.not-found"));
    }
  }, dependencies: [
    NgSelectComponent,
    FormsModule,
    NgControlStatus,
    NgModel,
    NgOptionTemplateDirective,
    NgLabelTemplateDirective,
    NgTagTemplateDirective,
    TranslatePipe
  ], styles: ["/* angular:styles/component:scss;8db79f2d60abff424e3e33b16f211108e837096ab2ea4478366ed98bbe3daf19;/Users/khripunovpavel/Documents/my/lasagna/lasagna/src/app/features/controls/form/autocomplete.component.ts */\nlg-autocomplete {\n  display: flex;\n  flex: 1;\n  min-width: 150px;\n}\n.autocomplete {\n  flex: 1;\n  width: 100%;\n}\n.autocomplete .ng-select.ng-select-single .ng-select-container {\n  height: 51px;\n}\n.autocomplete .ng-select.ng-select-focused .ng-select-container {\n  outline: none;\n  box-shadow: var(--focus-shadow);\n  border-radius: 12px;\n}\n.autocomplete .ng-select .ng-select-container {\n  border: none;\n  border-radius: 12px;\n  background-color: var(--control-bg);\n}\n.autocomplete .ng-select .ng-select-container .ng-input {\n  top: 16px !important;\n  padding-right: 10px !important;\n}\n.autocomplete .ng-select .ng-select-container .ng-input > input {\n  color: var(--text);\n  font-family: inherit;\n  font-size: inherit;\n}\n.autocomplete .ng-dropdown-panel {\n  border: none;\n  box-shadow: 0 4px 16px 0 rgba(0, 0, 0, 0.1);\n  border-radius: 12px;\n  overflow: hidden;\n}\n.autocomplete .ng-dropdown-panel .ng-option {\n  padding: 16px;\n  border-radius: 12px;\n}\n.autocomplete .ng-arrow-wrapper {\n  display: none;\n}\n.autocomplete .ng-clear-wrapper {\n  display: none;\n}\n/*# sourceMappingURL=autocomplete.component.css.map */\n"], encapsulation: 2 });
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(AutocompleteComponent, [{
    type: Component,
    args: [{ selector: "lg-autocomplete", standalone: true, template: `
    <div class="autocomplete">
      <ng-select (blur)="onBlur()"
                 (change)="onChangeSelect($event)"
                 (search)="onSearch($event)"
                 [addTag]="true"
                 [bindValue]="key()"
                 [appendTo]="appendTo()"
                 [compareWith]="compareWith"
                 [editableSearchTerm]="true"
                 [items]="loadedList()"
                 [multiple]="multi()"
                 [ngModel]="value"
                 [placeholder]="placeholder"
                 [searchFn]="searchFn"
                 bindLabel="name"
                 [notFoundText]="'search.not-found' | translate">
        <ng-template let-item="item" ng-label-tmp>
          {{ item?.name ?? item?.value ?? item }}
        </ng-template>
        <ng-template let-item="item" ng-option-tmp>
          {{ item?.name ?? item?.value ?? item }}
        </ng-template>
        <ng-template let-searchTerm="searchTerm" ng-tag-tmp>
          {{ searchTerm }}
        </ng-template>
      </ng-select>
    </div>
  `, imports: [
      NgSelectComponent,
      FormsModule,
      NgOptionTemplateDirective,
      NgLabelTemplateDirective,
      NgTagTemplateDirective,
      TranslatePipe
    ], providers: [
      {
        provide: NG_VALUE_ACCESSOR,
        useExisting: forwardRef(() => AutocompleteComponent),
        multi: true
      }
    ], encapsulation: ViewEncapsulation.None, styles: ["/* angular:styles/component:scss;8db79f2d60abff424e3e33b16f211108e837096ab2ea4478366ed98bbe3daf19;/Users/khripunovpavel/Documents/my/lasagna/lasagna/src/app/features/controls/form/autocomplete.component.ts */\nlg-autocomplete {\n  display: flex;\n  flex: 1;\n  min-width: 150px;\n}\n.autocomplete {\n  flex: 1;\n  width: 100%;\n}\n.autocomplete .ng-select.ng-select-single .ng-select-container {\n  height: 51px;\n}\n.autocomplete .ng-select.ng-select-focused .ng-select-container {\n  outline: none;\n  box-shadow: var(--focus-shadow);\n  border-radius: 12px;\n}\n.autocomplete .ng-select .ng-select-container {\n  border: none;\n  border-radius: 12px;\n  background-color: var(--control-bg);\n}\n.autocomplete .ng-select .ng-select-container .ng-input {\n  top: 16px !important;\n  padding-right: 10px !important;\n}\n.autocomplete .ng-select .ng-select-container .ng-input > input {\n  color: var(--text);\n  font-family: inherit;\n  font-size: inherit;\n}\n.autocomplete .ng-dropdown-panel {\n  border: none;\n  box-shadow: 0 4px 16px 0 rgba(0, 0, 0, 0.1);\n  border-radius: 12px;\n  overflow: hidden;\n}\n.autocomplete .ng-dropdown-panel .ng-option {\n  padding: 16px;\n  border-radius: 12px;\n}\n.autocomplete .ng-arrow-wrapper {\n  display: none;\n}\n.autocomplete .ng-clear-wrapper {\n  display: none;\n}\n/*# sourceMappingURL=autocomplete.component.css.map */\n"] }]
  }], () => [{ type: SelectResourcesService, decorators: [{
    type: Optional
  }] }], { placeholder: [{
    type: Input
  }] });
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(AutocompleteComponent, { className: "AutocompleteComponent", filePath: "src/app/features/controls/form/autocomplete.component.ts", lineNumber: 141 });
})();

// node_modules/chart.js/auto/auto.js
Chart.register(...registerables);

// src/app/features/products/view/price-chnages-chart.component.ts
var _c0 = ["chartCanvas"];
function ProductChangesChartComponent_Conditional_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275domElementStart(0, "p", 2);
    \u0275\u0275text(1);
    \u0275\u0275pipe(2, "translate");
    \u0275\u0275domElementEnd();
  }
  if (rf & 2) {
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", \u0275\u0275pipeBind1(2, 1, "price-change-history.no-changes"), " ");
  }
}
var ProductChangesChartComponent = class _ProductChangesChartComponent {
  _translateService;
  constructor(_translateService) {
    this._translateService = _translateService;
  }
  changes = [];
  chartCanvas;
  chart = null;
  pipesDigits = "1.0-4";
  _productFactory = inject(ProductFactory);
  _decimalPipe = inject(DecimalPipe);
  _userCurrencyPipe = inject(UserCurrencyPipe);
  _unitStringPipe = inject(UnitStringPipe);
  get _labels() {
    return {
      price: this._translateService.instant("price-change-history.chart.price"),
      amount: this._translateService.instant("price-change-history.chart.amount"),
      pricePerUnit: this._translateService.instant("price-change-history.chart.price-per-unit")
    };
  }
  ngOnChanges(changes) {
    if (changes["changes"]) {
      this.buildChart();
    }
  }
  buildChart() {
    if (!this.chartCanvas)
      return;
    if (this.chart) {
      this.chart.destroy();
    }
    const timestamps = this.changes.map((c) => c.timestamp).toSorted((a, b) => a - b);
    const data = timestamps.reduce((acc, ts) => {
      const entry = this.changes.find((c) => c.timestamp <= ts);
      acc.priceData.push(entry ? Number(entry.newValue.price) : null);
      acc.amountData.push(entry ? Number(entry.newValue.amount) : null);
      acc.pricePerUnitData.push(entry ? this._productFactory.fromRaw(entry.newValue).pricePerUnit : null);
      acc.unitsData.push(entry ? String(entry.newValue.unit) : null);
      return acc;
    }, {
      priceData: [],
      amountData: [],
      pricePerUnitData: [],
      unitsData: []
    });
    const normalizedPrice = this.normalizeArray(data.priceData);
    const normalizedAmount = this.normalizeArray(data.amountData);
    const normalizedPricePerUnit = this.normalizeArray(data.pricePerUnitData);
    const labelPrice = this._labels.price;
    const labelAmount = this._labels.amount;
    const labelPricePerUnit = this._labels.pricePerUnit;
    const datasets = [
      {
        label: labelPrice,
        data: normalizedPrice,
        borderColor: "#ea5454",
        pointStyle: "circle",
        pointRadius: 5,
        pointBackgroundColor: "#ea5454",
        pointBorderColor: "white",
        fill: false,
        tension: 0.4,
        yAxisID: "yPrice"
      },
      {
        label: labelAmount,
        data: normalizedAmount,
        borderColor: "#6874e4",
        pointStyle: "triangle",
        pointRadius: 5,
        pointBackgroundColor: "#6874e4",
        pointBorderColor: "white",
        fill: false,
        tension: 0.4,
        yAxisID: "yAmount"
      },
      {
        label: labelPricePerUnit,
        data: normalizedPricePerUnit,
        borderColor: "#3a9747",
        pointStyle: "rectRot",
        pointRadius: 5,
        pointBackgroundColor: "#3a9747",
        pointBorderColor: "white",
        fill: false,
        tension: 0.4,
        yAxisID: "yPrice"
      }
    ];
    const config = {
      type: "line",
      data: {
        labels: timestamps.map((ts, i) => `#${i + 1} - ${new Date(ts).toLocaleDateString()}`),
        datasets
      },
      options: {
        animation: false,
        responsive: true,
        interaction: {
          intersect: false
        },
        plugins: {
          legend: { display: true },
          tooltip: {
            callbacks: {
              label: (context) => {
                const index = context.dataIndex;
                switch (context.dataset.label) {
                  case labelPrice:
                    return data.priceData[index] ? this._priceTooltipLabel(data.priceData[index]) : "";
                  case labelAmount:
                    return data.amountData[index] ? this._amountTooltipLabel(data.amountData[index], data.unitsData[index]) : "";
                  case labelPricePerUnit:
                    return data.pricePerUnitData[index] ? this._pricePerUnitTooltipLabel(data.pricePerUnitData[index], data.unitsData[index]) : "";
                  default:
                    return "";
                }
              }
            }
          }
        },
        scales: {
          x: {
            title: { display: false },
            ticks: {
              display: false
              // убираем все подписи на оси X
            },
            grid: {
              drawTicks: true,
              // можно оставить только засечки
              tickLength: 8
            }
          },
          yAmount: {
            type: "linear",
            position: "left",
            title: { display: false },
            ticks: {
              display: false
              // убираем все подписи на оси Y
            }
          },
          yPrice: {
            type: "linear",
            ticks: {
              display: false
              // убираем все подписи на оси Y
            },
            position: "right",
            title: { display: false },
            grid: { drawOnChartArea: false }
            // чтобы сетка не мешала
          }
        }
      }
    };
    this.chart = new Chart(this.chartCanvas.nativeElement, config);
  }
  _priceTooltipLabel(value) {
    return `${this._labels.price}: ${this._userCurrencyPipe.transform(value ?? "", this.pipesDigits)}`;
  }
  _amountTooltipLabel(value, unit) {
    return `${this._labels.amount}: ${this._decimalPipe.transform(value, this.pipesDigits)} ${this._unitLabel(unit)}`;
  }
  _pricePerUnitTooltipLabel(value, unit) {
    return `${this._labels.pricePerUnit}: ${this._userCurrencyPipe.transform(value ?? "", this.pipesDigits)}${this._unitLabel(unit)}`;
  }
  _unitLabel(unit) {
    return this._translateService.instant("per-unit.label", {
      unit: this._translateService.instant(this._unitStringPipe.transform(unit) || "")
    });
  }
  // <span [translateParams]="{unit: change.oldProduct.unit | unitString | translate}"
  //                      [translate]="'per-unit.label'"></span>
  normalizeArray(arr) {
    const valid = arr.filter((v) => v !== null);
    if (valid.length === 0)
      return arr.map(() => 0);
    const min = Math.min(...valid);
    const max = Math.max(...valid);
    const range = max - min || 1;
    return arr.map((v) => v === null ? null : (v - min) / range);
  }
  static \u0275fac = function ProductChangesChartComponent_Factory(__ngFactoryType__) {
    return new (__ngFactoryType__ || _ProductChangesChartComponent)(\u0275\u0275directiveInject(TranslateService));
  };
  static \u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _ProductChangesChartComponent, selectors: [["lg-product-changes-chart"]], viewQuery: function ProductChangesChartComponent_Query(rf, ctx) {
    if (rf & 1) {
      \u0275\u0275viewQuery(_c0, 5);
    }
    if (rf & 2) {
      let _t;
      \u0275\u0275queryRefresh(_t = \u0275\u0275loadQuery()) && (ctx.chartCanvas = _t.first);
    }
  }, inputs: { changes: "changes" }, features: [\u0275\u0275ProvidersFeature([
    UserCurrencyPipe,
    DecimalPipe,
    UnitStringPipe
  ]), \u0275\u0275NgOnChangesFeature], decls: 3, vars: 2, consts: [["chartCanvas", ""], [3, "hidden"], [1, "text-muted", "no-margin"]], template: function ProductChangesChartComponent_Template(rf, ctx) {
    if (rf & 1) {
      \u0275\u0275domElement(0, "canvas", 1, 0);
      \u0275\u0275conditionalCreate(2, ProductChangesChartComponent_Conditional_2_Template, 3, 3, "p", 2);
    }
    if (rf & 2) {
      \u0275\u0275domProperty("hidden", !ctx.changes.length);
      \u0275\u0275advance(2);
      \u0275\u0275conditional(!ctx.changes.length ? 2 : -1);
    }
  }, dependencies: [TranslatePipe], styles: ["\n\n/*# sourceMappingURL=price-chnages-chart.component.css.map */"] });
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(ProductChangesChartComponent, [{
    type: Component,
    args: [{ selector: "lg-product-changes-chart", template: `
    <canvas #chartCanvas [hidden]="!changes.length"></canvas>

    @if (!changes.length) {
      <p class="text-muted no-margin">
        {{ 'price-change-history.no-changes' | translate }}
      </p>
    }
  `, imports: [
      TranslatePipe
    ], providers: [
      UserCurrencyPipe,
      DecimalPipe,
      UnitStringPipe
    ], styles: ["/* angular:styles/component:scss;a29703d15fd1f95d05513bcf3738213b764a526f5af9cf466851c9eae5c0e77f;/Users/khripunovpavel/Documents/my/lasagna/lasagna/src/app/features/products/view/price-chnages-chart.component.ts */\n/*# sourceMappingURL=price-chnages-chart.component.css.map */\n"] }]
  }], () => [{ type: TranslateService }], { changes: [{
    type: Input
  }], chartCanvas: [{
    type: ViewChild,
    args: ["chartCanvas"]
  }] });
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(ProductChangesChartComponent, { className: "ProductChangesChartComponent", filePath: "src/app/features/products/view/price-chnages-chart.component.ts", lineNumber: 34 });
})();

// src/app/features/products/view/price-changes.component.ts
var _c02 = (a0) => ({ $implicit: a0 });
var _c1 = (a0) => ({ unit: a0 });
function PriceChangesComponent_Conditional_11_Conditional_0_For_2_ng_container_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementContainer(0);
  }
}
function PriceChangesComponent_Conditional_11_Conditional_0_For_2_ng_container_4_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementContainer(0);
  }
}
function PriceChangesComponent_Conditional_11_Conditional_0_For_2_ng_container_7_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementContainer(0);
  }
}
function PriceChangesComponent_Conditional_11_Conditional_0_For_2_ng_container_11_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementContainer(0);
  }
}
function PriceChangesComponent_Conditional_11_Conditional_0_For_2_Conditional_12_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "hr", 15);
  }
}
function PriceChangesComponent_Conditional_11_Conditional_0_For_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "lg-flex-row", 9)(1, "div", 10);
    \u0275\u0275template(2, PriceChangesComponent_Conditional_11_Conditional_0_For_2_ng_container_2_Template, 1, 0, "ng-container", 11);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "div", 12);
    \u0275\u0275template(4, PriceChangesComponent_Conditional_11_Conditional_0_For_2_ng_container_4_Template, 1, 0, "ng-container", 11);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(5, "lg-flex-row", 5)(6, "div", 13);
    \u0275\u0275template(7, PriceChangesComponent_Conditional_11_Conditional_0_For_2_ng_container_7_Template, 1, 0, "ng-container", 11);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(8, "div", 14);
    \u0275\u0275text(9, "\u2192");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(10, "div", 13);
    \u0275\u0275template(11, PriceChangesComponent_Conditional_11_Conditional_0_For_2_ng_container_11_Template, 1, 0, "ng-container", 11);
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(12, PriceChangesComponent_Conditional_11_Conditional_0_For_2_Conditional_12_Template, 1, 0, "hr", 15);
  }
  if (rf & 2) {
    const change_r1 = ctx.$implicit;
    const \u0275$index_23_r2 = ctx.$index;
    const \u0275$count_23_r3 = ctx.$count;
    \u0275\u0275nextContext(2);
    const dateTpl_r4 = \u0275\u0275reference(3);
    const oldStateTpl_r5 = \u0275\u0275reference(5);
    const newStateTpl_r6 = \u0275\u0275reference(7);
    const pricePerUnitTpl_r7 = \u0275\u0275reference(9);
    \u0275\u0275property("size", "tiny")("noResponsive", true);
    \u0275\u0275advance();
    \u0275\u0275property("noResponsive", true);
    \u0275\u0275advance();
    \u0275\u0275property("ngTemplateOutlet", dateTpl_r4)("ngTemplateOutletContext", \u0275\u0275pureFunction1(14, _c02, change_r1));
    \u0275\u0275advance();
    \u0275\u0275property("noResponsive", true);
    \u0275\u0275advance();
    \u0275\u0275property("ngTemplateOutlet", pricePerUnitTpl_r7)("ngTemplateOutletContext", \u0275\u0275pureFunction1(16, _c02, change_r1));
    \u0275\u0275advance();
    \u0275\u0275property("size", "tiny");
    \u0275\u0275advance(2);
    \u0275\u0275property("ngTemplateOutlet", oldStateTpl_r5)("ngTemplateOutletContext", \u0275\u0275pureFunction1(18, _c02, change_r1));
    \u0275\u0275advance(4);
    \u0275\u0275property("ngTemplateOutlet", newStateTpl_r6)("ngTemplateOutletContext", \u0275\u0275pureFunction1(20, _c02, change_r1));
    \u0275\u0275advance();
    \u0275\u0275conditional(!(\u0275$index_23_r2 === \u0275$count_23_r3 - 1) ? 12 : -1);
  }
}
function PriceChangesComponent_Conditional_11_Conditional_0_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "lg-flex-column", 5);
    \u0275\u0275repeaterCreate(1, PriceChangesComponent_Conditional_11_Conditional_0_For_2_Template, 13, 22, null, null, \u0275\u0275repeaterTrackByIdentity);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r7 = \u0275\u0275nextContext(2);
    \u0275\u0275property("size", "medium");
    \u0275\u0275advance();
    \u0275\u0275repeater(ctx_r7.changes());
  }
}
function PriceChangesComponent_Conditional_11_Conditional_1_For_11_ng_container_4_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementContainer(0);
  }
}
function PriceChangesComponent_Conditional_11_Conditional_1_For_11_ng_container_6_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementContainer(0);
  }
}
function PriceChangesComponent_Conditional_11_Conditional_1_For_11_ng_container_10_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementContainer(0);
  }
}
function PriceChangesComponent_Conditional_11_Conditional_1_For_11_ng_container_12_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementContainer(0);
  }
}
function PriceChangesComponent_Conditional_11_Conditional_1_For_11_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "tr")(1, "td");
    \u0275\u0275text(2);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "td");
    \u0275\u0275template(4, PriceChangesComponent_Conditional_11_Conditional_1_For_11_ng_container_4_Template, 1, 0, "ng-container", 11);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "td", 21);
    \u0275\u0275template(6, PriceChangesComponent_Conditional_11_Conditional_1_For_11_ng_container_6_Template, 1, 0, "ng-container", 11);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "td", 21);
    \u0275\u0275text(8, "\u2192");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(9, "td", 21);
    \u0275\u0275template(10, PriceChangesComponent_Conditional_11_Conditional_1_For_11_ng_container_10_Template, 1, 0, "ng-container", 11);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(11, "td", 21);
    \u0275\u0275template(12, PriceChangesComponent_Conditional_11_Conditional_1_For_11_ng_container_12_Template, 1, 0, "ng-container", 11);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const change_r9 = ctx.$implicit;
    const \u0275$index_79_r10 = ctx.$index;
    const \u0275$count_79_r11 = ctx.$count;
    \u0275\u0275nextContext(2);
    const dateTpl_r4 = \u0275\u0275reference(3);
    const oldStateTpl_r5 = \u0275\u0275reference(5);
    const newStateTpl_r6 = \u0275\u0275reference(7);
    const pricePerUnitTpl_r7 = \u0275\u0275reference(9);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1(" ", \u0275$count_79_r11 - \u0275$index_79_r10, " ");
    \u0275\u0275advance(2);
    \u0275\u0275property("ngTemplateOutlet", dateTpl_r4)("ngTemplateOutletContext", \u0275\u0275pureFunction1(9, _c02, change_r9));
    \u0275\u0275advance(2);
    \u0275\u0275property("ngTemplateOutlet", oldStateTpl_r5)("ngTemplateOutletContext", \u0275\u0275pureFunction1(11, _c02, change_r9));
    \u0275\u0275advance(4);
    \u0275\u0275property("ngTemplateOutlet", newStateTpl_r6)("ngTemplateOutletContext", \u0275\u0275pureFunction1(13, _c02, change_r9));
    \u0275\u0275advance(2);
    \u0275\u0275property("ngTemplateOutlet", pricePerUnitTpl_r7)("ngTemplateOutletContext", \u0275\u0275pureFunction1(15, _c02, change_r9));
  }
}
function PriceChangesComponent_Conditional_11_Conditional_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "lg-table-card", 5)(1, "table", 16)(2, "colgroup");
    \u0275\u0275element(3, "col", 17)(4, "col", 18)(5, "col", 19)(6, "col", 20)(7, "col", 19)(8, "col", 19);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(9, "tbody");
    \u0275\u0275repeaterCreate(10, PriceChangesComponent_Conditional_11_Conditional_1_For_11_Template, 13, 17, "tr", null, \u0275\u0275repeaterTrackByIdentity);
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const ctx_r7 = \u0275\u0275nextContext(2);
    \u0275\u0275property("size", "medium");
    \u0275\u0275advance(10);
    \u0275\u0275repeater(ctx_r7.changes());
  }
}
function PriceChangesComponent_Conditional_11_ng_template_2_Conditional_3_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "br");
  }
}
function PriceChangesComponent_Conditional_11_ng_template_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 22);
    \u0275\u0275text(1);
    \u0275\u0275pipe(2, "date");
    \u0275\u0275conditionalCreate(3, PriceChangesComponent_Conditional_11_ng_template_2_Conditional_3_Template, 1, 0, "br");
    \u0275\u0275text(4);
    \u0275\u0275pipe(5, "date");
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const change_r12 = ctx.$implicit;
    const ctx_r7 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", \u0275\u0275pipeBind1(2, 3, change_r12.timestamp), " ");
    \u0275\u0275advance(2);
    \u0275\u0275conditional(!ctx_r7.isMobile() ? 3 : -1);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", \u0275\u0275pipeBind2(5, 5, change_r12.timestamp, "HH:mm"), " ");
  }
}
function PriceChangesComponent_Conditional_11_ng_template_4_Conditional_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 23);
    \u0275\u0275text(1);
    \u0275\u0275element(2, "span", 24);
    \u0275\u0275pipe(3, "unitString");
    \u0275\u0275pipe(4, "translate");
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const change_r13 = \u0275\u0275nextContext().$implicit;
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", change_r13.oldProduct.amount, " ");
    \u0275\u0275advance();
    \u0275\u0275property("translateParams", \u0275\u0275pureFunction1(7, _c1, \u0275\u0275pipeBind1(4, 5, \u0275\u0275pipeBind1(3, 3, change_r13.oldProduct.unit))))("translate", "per-unit.label");
  }
}
function PriceChangesComponent_Conditional_11_ng_template_4_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0);
    \u0275\u0275pipe(1, "userCurrency");
    \u0275\u0275conditionalCreate(2, PriceChangesComponent_Conditional_11_ng_template_4_Conditional_2_Template, 5, 9, "div", 23);
  }
  if (rf & 2) {
    const change_r13 = ctx.$implicit;
    const ctx_r7 = \u0275\u0275nextContext(2);
    \u0275\u0275textInterpolate1(" ", \u0275\u0275pipeBind2(1, 2, change_r13.oldProduct.price, ctx_r7.pipesDigits()), " ");
    \u0275\u0275advance(2);
    \u0275\u0275conditional(change_r13.isAmountChange ? 2 : -1);
  }
}
function PriceChangesComponent_Conditional_11_ng_template_6_Conditional_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 23);
    \u0275\u0275text(1);
    \u0275\u0275element(2, "span", 24);
    \u0275\u0275pipe(3, "unitString");
    \u0275\u0275pipe(4, "translate");
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const change_r14 = \u0275\u0275nextContext().$implicit;
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", change_r14.newProduct.amount, " ");
    \u0275\u0275advance();
    \u0275\u0275property("translateParams", \u0275\u0275pureFunction1(7, _c1, \u0275\u0275pipeBind1(4, 5, \u0275\u0275pipeBind1(3, 3, change_r14.newProduct.unit))))("translate", "per-unit.label");
  }
}
function PriceChangesComponent_Conditional_11_ng_template_6_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0);
    \u0275\u0275pipe(1, "userCurrency");
    \u0275\u0275conditionalCreate(2, PriceChangesComponent_Conditional_11_ng_template_6_Conditional_2_Template, 5, 9, "div", 23);
  }
  if (rf & 2) {
    const change_r14 = ctx.$implicit;
    const ctx_r7 = \u0275\u0275nextContext(2);
    \u0275\u0275textInterpolate1(" ", \u0275\u0275pipeBind2(1, 2, change_r14.newProduct.price, ctx_r7.pipesDigits()), " ");
    \u0275\u0275advance(2);
    \u0275\u0275conditional(change_r14.isAmountChange ? 2 : -1);
  }
}
function PriceChangesComponent_Conditional_11_ng_template_8_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div");
    \u0275\u0275text(1);
    \u0275\u0275pipe(2, "userCurrency");
    \u0275\u0275element(3, "span", 24);
    \u0275\u0275pipe(4, "unitString");
    \u0275\u0275pipe(5, "translate");
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const change_r15 = ctx.$implicit;
    const ctx_r7 = \u0275\u0275nextContext(2);
    \u0275\u0275classProp("text-danger", change_r15.oldProduct.price && change_r15.isIncrease)("text-success", change_r15.oldProduct.price && !change_r15.isIncrease);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", \u0275\u0275pipeBind2(2, 7, change_r15.newProduct.pricePerUnit, ctx_r7.pipesDigits()), " ");
    \u0275\u0275advance(2);
    \u0275\u0275property("translateParams", \u0275\u0275pureFunction1(14, _c1, \u0275\u0275pipeBind1(5, 12, \u0275\u0275pipeBind1(4, 10, change_r15.newProduct.unit))))("translate", "per-unit.label");
  }
}
function PriceChangesComponent_Conditional_11_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275conditionalCreate(0, PriceChangesComponent_Conditional_11_Conditional_0_Template, 3, 1, "lg-flex-column", 5)(1, PriceChangesComponent_Conditional_11_Conditional_1_Template, 12, 1, "lg-table-card", 5);
    \u0275\u0275template(2, PriceChangesComponent_Conditional_11_ng_template_2_Template, 6, 8, "ng-template", null, 0, \u0275\u0275templateRefExtractor)(4, PriceChangesComponent_Conditional_11_ng_template_4_Template, 3, 5, "ng-template", null, 1, \u0275\u0275templateRefExtractor)(6, PriceChangesComponent_Conditional_11_ng_template_6_Template, 3, 5, "ng-template", null, 2, \u0275\u0275templateRefExtractor)(8, PriceChangesComponent_Conditional_11_ng_template_8_Template, 6, 16, "ng-template", null, 3, \u0275\u0275templateRefExtractor);
  }
  if (rf & 2) {
    const ctx_r7 = \u0275\u0275nextContext();
    \u0275\u0275conditional(ctx_r7.isMobile() ? 0 : 1);
  }
}
var PriceChangesComponent = class _PriceChangesComponent {
  constructor() {
  }
  changes = signal([], ...ngDevMode ? [{ debugName: "changes" }] : []);
  changesEntries = signal([], ...ngDevMode ? [{ debugName: "changesEntries" }] : []);
  uuid = input(...ngDevMode ? [void 0, { debugName: "uuid" }] : []);
  dialog = viewChild(DialogComponent, ...ngDevMode ? [{ debugName: "dialog" }] : []);
  pipesDigits = computed(() => `1.0-4`, ...ngDevMode ? [{ debugName: "pipesDigits" }] : []);
  isMobile = matchMediaSignal(mobileBreakpoint);
  _productsRepository = inject(ProductsRepository);
  _productFactory = inject(ProductFactory);
  _notificationsService = inject(NotificationsService);
  open() {
    if (!this.uuid()) {
      throw new Error("UUID is required to load price changes");
    }
    this._loadChanges(this.uuid());
    this.dialog()?.open();
  }
  close() {
    this.dialog()?.close();
  }
  async _loadChanges(uuid) {
    try {
      const changes = await this._productsRepository.getChanges(uuid);
      this.changesEntries.set(changes);
      this.changes.set(changes.map((change) => {
        const newProduct = this._productFactory.fromRaw(change.newValue);
        const oldProduct = this._productFactory.fromRaw(change.oldValue);
        const isIncrease = change.oldValue && change.newValue ? newProduct.pricePerUnit > oldProduct.pricePerUnit : null;
        const isAmountChange = change.oldValue && change.newValue ? newProduct.amount !== oldProduct.amount || newProduct.unit !== oldProduct.unit : false;
        return {
          timestamp: change.timestamp,
          oldProduct,
          newProduct,
          isIncrease,
          isAmountChange
        };
      }));
    } catch (err) {
      this._notificationsService.error(errorHandler(err));
    }
  }
  static \u0275fac = function PriceChangesComponent_Factory(__ngFactoryType__) {
    return new (__ngFactoryType__ || _PriceChangesComponent)();
  };
  static \u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _PriceChangesComponent, selectors: [["lg-price-changes"]], viewQuery: function PriceChangesComponent_Query(rf, ctx) {
    if (rf & 1) {
      \u0275\u0275viewQuerySignal(ctx.dialog, DialogComponent, 5);
    }
    if (rf & 2) {
      \u0275\u0275queryAdvance();
    }
  }, hostAttrs: [1, "lg-price-changes"], inputs: { uuid: [1, "uuid"] }, decls: 12, vars: 13, consts: [["dateTpl", ""], ["oldStateTpl", ""], ["newStateTpl", ""], ["pricePerUnitTpl", ""], [3, "showCancelButton", "showConfirmButton"], [3, "size"], [3, "level"], [1, "text-muted", "no-margin"], [3, "changes"], [3, "size", "noResponsive"], ["lgWidth", "50%", 3, "noResponsive"], [4, "ngTemplateOutlet", "ngTemplateOutletContext"], ["lgWidth", "50%", 1, "text-right", 3, "noResponsive"], ["lgExpand", "", 1, "text-center"], ["lgShrink", "", 1, "text-center"], ["color", "#fafafa", "lgExpand", "", "size", "2"], [1, "lg-price-changes__table"], ["span", "1", 2, "width", "2%"], ["span", "1", 2, "width", "6%"], ["span", "1", 2, "width", "30%"], ["span", "1", 2, "width", "4%"], [1, "text-center"], [1, "text-small", "text-muted", "text-no-wrap"], [1, "text-small", "text-muted"], [3, "translateParams", "translate"]], template: function PriceChangesComponent_Template(rf, ctx) {
    if (rf & 1) {
      \u0275\u0275elementStart(0, "lg-dialog", 4)(1, "lg-flex-column")(2, "lg-flex-column", 5)(3, "lg-title", 6);
      \u0275\u0275text(4);
      \u0275\u0275pipe(5, "translate");
      \u0275\u0275elementEnd();
      \u0275\u0275elementStart(6, "p", 7);
      \u0275\u0275text(7);
      \u0275\u0275pipe(8, "translate");
      \u0275\u0275elementEnd()();
      \u0275\u0275elementStart(9, "lg-flex-column", 5);
      \u0275\u0275element(10, "lg-product-changes-chart", 8);
      \u0275\u0275conditionalCreate(11, PriceChangesComponent_Conditional_11_Template, 10, 1);
      \u0275\u0275elementEnd()()();
    }
    if (rf & 2) {
      \u0275\u0275property("showCancelButton", false)("showConfirmButton", false);
      \u0275\u0275advance(2);
      \u0275\u0275property("size", "small");
      \u0275\u0275advance();
      \u0275\u0275property("level", 2);
      \u0275\u0275advance();
      \u0275\u0275textInterpolate1(" ", \u0275\u0275pipeBind1(5, 9, "price-change-history.title"), " ");
      \u0275\u0275advance(3);
      \u0275\u0275textInterpolate1(" ", \u0275\u0275pipeBind1(8, 11, "price-change-history.description"), " ");
      \u0275\u0275advance(2);
      \u0275\u0275property("size", "medium");
      \u0275\u0275advance();
      \u0275\u0275property("changes", ctx.changesEntries());
      \u0275\u0275advance();
      \u0275\u0275conditional(ctx.changes().length ? 11 : -1);
    }
  }, dependencies: [
    DialogComponent,
    ProductChangesChartComponent,
    TitleComponent,
    FlexColumnComponent,
    TranslateDirective,
    TableCardComponent,
    NgTemplateOutlet,
    FlexRowComponent,
    WidthDirective,
    ExpandDirective,
    ShrinkDirective,
    DatePipe,
    TranslatePipe,
    UnitStringPipe,
    UserCurrencyPipe
  ], styles: ["\n\n[_nghost-%COMP%] {\n  display: block;\n}\n/*# sourceMappingURL=price-changes.component.css.map */"] });
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(PriceChangesComponent, [{
    type: Component,
    args: [{ selector: "lg-price-changes", host: {
      class: "lg-price-changes"
    }, template: `
    <lg-dialog [showCancelButton]="false"
               [showConfirmButton]="false">
      <lg-flex-column>
        <lg-flex-column [size]="'small'">
          <lg-title [level]="2">
            {{ 'price-change-history.title' | translate }}
          </lg-title>
          <p class="text-muted no-margin">
            {{ 'price-change-history.description' | translate }}
          </p>
        </lg-flex-column>

        <lg-flex-column [size]="'medium'">
          <lg-product-changes-chart [changes]="changesEntries()"></lg-product-changes-chart>

          @if (changes().length) {
            @if (isMobile()) {
              <lg-flex-column [size]="'medium'">
                @for (change of changes(); track change; let last = $last) {
                  <lg-flex-row [size]="'tiny'"
                               [noResponsive]="true">
                    <div lgWidth="50%"
                         [noResponsive]="true">
                      <ng-container *ngTemplateOutlet="dateTpl; context: {$implicit: change}"></ng-container>
                    </div>

                    <div lgWidth="50%"
                         [noResponsive]="true"
                         class="text-right">
                      <ng-container
                        *ngTemplateOutlet="pricePerUnitTpl; context: {$implicit: change}"></ng-container>
                    </div>
                  </lg-flex-row>
                  <lg-flex-row [size]="'tiny'">
                    <div class="text-center" lgExpand>
                      <ng-container *ngTemplateOutlet="oldStateTpl; context: {$implicit: change}"></ng-container>
                    </div>
                    <div class="text-center" lgShrink>\u2192</div>
                    <div class="text-center" lgExpand>
                      <ng-container *ngTemplateOutlet="newStateTpl; context: {$implicit: change}"></ng-container>
                    </div>
                  </lg-flex-row>
                  @if (!last) {
                    <hr color="#fafafa" lgExpand size="2"/>
                  }
                }
              </lg-flex-column>
            } @else {
              <lg-table-card [size]="'medium'">
                <table class="lg-price-changes__table">
                  <colgroup>
                    <col span="1" style="width: 2%;">
                    <col span="1" style="width: 6%;">
                    <col span="1" style="width: 30%;">
                    <col span="1" style="width: 4%;">
                    <col span="1" style="width: 30%;">
                    <col span="1" style="width: 30%;">
                  </colgroup>
                  <tbody>
                    @for (change of changes(); track change; let i = $index, count = $count) {
                      <tr>
                        <td>
                          {{ count - i }}
                        </td>
                        <td>
                          <ng-container *ngTemplateOutlet="dateTpl; context: {$implicit: change}"></ng-container>
                        </td>
                        <td class="text-center">
                          <ng-container *ngTemplateOutlet="oldStateTpl; context: {$implicit: change}"></ng-container>
                        </td>
                        <td class="text-center">\u2192</td>
                        <td class="text-center">
                          <ng-container *ngTemplateOutlet="newStateTpl; context: {$implicit: change}"></ng-container>
                        </td>
                        <td class="text-center">
                          <ng-container
                            *ngTemplateOutlet="pricePerUnitTpl; context: {$implicit: change}"></ng-container>
                        </td>
                      </tr>
                    }
                  </tbody>
                </table>
              </lg-table-card>
            }

            <ng-template #dateTpl let-change>
              <span class="text-small text-muted text-no-wrap">
                {{ change.timestamp | date }}
                @if (!isMobile()) {
                  <br>
                }
                {{ change.timestamp | date:'HH:mm' }}
              </span>
            </ng-template>

            <ng-template #oldStateTpl let-change>
              {{ change.oldProduct.price  | userCurrency: pipesDigits() }}

              @if (change.isAmountChange) {
                <div class="text-small text-muted">
                  {{ change.oldProduct.amount }}

                  <span [translateParams]="{unit: change.oldProduct.unit | unitString | translate}"
                        [translate]="'per-unit.label'"></span>
                </div>
              }
            </ng-template>

            <ng-template #newStateTpl let-change>
              {{ change.newProduct.price  | userCurrency: pipesDigits() }}

              @if (change.isAmountChange) {
                <div class="text-small text-muted">
                  {{ change.newProduct.amount }}

                  <span [translateParams]="{unit: change.newProduct.unit | unitString | translate}"
                        [translate]="'per-unit.label'"></span>
                </div>
              }
            </ng-template>

            <ng-template #pricePerUnitTpl let-change>
              <div [class.text-danger]="change.oldProduct.price && change.isIncrease"
                   [class.text-success]="change.oldProduct.price && !change.isIncrease">
                {{ change.newProduct.pricePerUnit | userCurrency: pipesDigits() }}

                <span [translateParams]="{unit: change.newProduct.unit | unitString | translate}"
                      [translate]="'per-unit.label'"></span>
              </div>
            </ng-template>
          }
        </lg-flex-column>
      </lg-flex-column>
    </lg-dialog>
  `, imports: [
      DialogComponent,
      DatePipe,
      ProductChangesChartComponent,
      TitleComponent,
      FlexColumnComponent,
      TranslatePipe,
      UnitStringPipe,
      UserCurrencyPipe,
      TranslateDirective,
      TableCardComponent,
      NgTemplateOutlet,
      FlexRowComponent,
      WidthDirective,
      ExpandDirective,
      ShrinkDirective
    ], styles: ["/* angular:styles/component:scss;219558ef63f119a92210704329b58a3cdceaa4fb296db559e672f74512827dc7;/Users/khripunovpavel/Documents/my/lasagna/lasagna/src/app/features/products/view/price-changes.component.ts */\n:host {\n  display: block;\n}\n/*# sourceMappingURL=price-changes.component.css.map */\n"] }]
  }], () => [], null);
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(PriceChangesComponent, { className: "PriceChangesComponent", filePath: "src/app/features/products/view/price-changes.component.ts", lineNumber: 196 });
})();

// src/app/features/products/view/add-product-form/add-product-form.component.ts
var _c03 = ["nameField"];
var _c12 = ["amountField"];
var _c2 = ["priceField"];
var _c3 = (a0) => ({ unit: a0 });
var _c4 = () => ({ currency: "EUR" });
function AddProductFormComponent_ng_template_14_Template(rf, ctx) {
  if (rf & 1) {
    const _r3 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "lg-flex-row", 33)(1, "lg-amount-widgets", 34);
    \u0275\u0275listener("eggsChanged", function AddProductFormComponent_ng_template_14_Template_lg_amount_widgets_eggsChanged_1_listener($event) {
      \u0275\u0275restoreView(_r3);
      const ctx_r3 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r3.eggsChanged($event));
    });
    \u0275\u0275elementEnd();
    \u0275\u0275element(2, "lg-unit-switcher", 35);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    \u0275\u0275property("center", true)("size", "small");
  }
}
function AddProductFormComponent_ng_template_19_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span");
    \u0275\u0275text(1);
    \u0275\u0275pipe(2, "currencySymbol");
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r3 = \u0275\u0275nextContext();
    \u0275\u0275advance();
    \u0275\u0275textInterpolate(\u0275\u0275pipeBind1(2, 1, ctx_r3.userSettings()["currency"]));
  }
}
function AddProductFormComponent_ng_template_21_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span");
    \u0275\u0275text(1);
    \u0275\u0275pipe(2, "currencySymbol");
    \u0275\u0275elementEnd();
    \u0275\u0275element(3, "span", 36);
    \u0275\u0275pipe(4, "unitString");
    \u0275\u0275pipe(5, "translate");
  }
  if (rf & 2) {
    let tmp_11_0;
    const ctx_r3 = \u0275\u0275nextContext();
    \u0275\u0275advance();
    \u0275\u0275textInterpolate(\u0275\u0275pipeBind1(2, 3, ctx_r3.userSettings()["currency"]));
    \u0275\u0275advance(2);
    \u0275\u0275property("translateParams", \u0275\u0275pureFunction1(9, _c3, \u0275\u0275pipeBind1(5, 7, \u0275\u0275pipeBind1(4, 5, (tmp_11_0 = ctx_r3.product()) == null ? null : tmp_11_0.unit))))("translate", "per-unit.label");
  }
}
function AddProductFormComponent_Conditional_55_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "lg-chips-list", 29);
  }
  if (rf & 2) {
    const ctx_r3 = \u0275\u0275nextContext();
    const categorySelect_r8 = \u0275\u0275reference(54);
    \u0275\u0275property("control", categorySelect_r8)("items", ctx_r3.topCategories());
  }
}
var AddProductFormComponent = class _AddProductFormComponent {
  _productsRepository;
  _selectResourcesService;
  _router;
  _notificationsService;
  _settingsService;
  constructor(_productsRepository, _selectResourcesService, _router, _notificationsService, _settingsService) {
    this._productsRepository = _productsRepository;
    this._selectResourcesService = _selectResourcesService;
    this._router = _router;
    this._notificationsService = _notificationsService;
    this._settingsService = _settingsService;
  }
  precisions = computed(() => this._settingsService.settingsSignal()?.getSetting(SettingsKeysConst.pricePrecision)?.data ?? 2, ...ngDevMode ? [{ debugName: "precisions" }] : []);
  pipesDigits = computed(() => `1.0-${this.precisions()}`, ...ngDevMode ? [{ debugName: "pipesDigits" }] : []);
  form = new FormGroup({
    name: new FormControl(null, Validators.required),
    amount: new FormControl(null, Validators.required),
    price: new FormControl(null, Validators.required),
    unit: new FormControl("gram"),
    source: new FormControl(null),
    brand: new FormControl(null),
    notes: new FormControl(null),
    category_id: new FormControl(null)
  });
  userSettings = inject(SETTINGS);
  product = input(null, ...ngDevMode ? [{ debugName: "product" }] : []);
  hasMicroPrice = computed(() => {
    return hasMicroPrice(this.product()?.pricePerUnit ?? 0);
  }, ...ngDevMode ? [{ debugName: "hasMicroPrice" }] : []);
  editMode = input(false, ...ngDevMode ? [{ debugName: "editMode" }] : []);
  topCategories = signal([], ...ngDevMode ? [{ debugName: "topCategories" }] : []);
  topSources = signal([], ...ngDevMode ? [{ debugName: "topSources" }] : []);
  topBrands = signal([], ...ngDevMode ? [{ debugName: "topBrands" }] : []);
  nameField = viewChild("nameField", ...ngDevMode ? [{ debugName: "nameField" }] : []);
  amountField = viewChild("amountField", ...ngDevMode ? [{ debugName: "amountField" }] : []);
  priceField = viewChild("priceField", ...ngDevMode ? [{ debugName: "priceField" }] : []);
  smaller = smaller;
  UnitValue = UnitValue;
  productEffect = effect(() => {
    if (!this.product() || this.form.dirty) {
      return;
    }
    this.form.reset(productToFormValue(this.product()));
    this.form.markAsPristine();
  }, ...ngDevMode ? [{ debugName: "productEffect" }] : []);
  get _defFormValue() {
    return {
      name: null,
      amount: null,
      price: null,
      source: null,
      brand: null,
      notes: null,
      category_id: null,
      unit: "gram"
    };
  }
  get _formValid() {
    return this.form.valid;
  }
  eggsChanged(event) {
    this.form.patchValue({
      amount: event
    });
  }
  ngOnInit() {
    this._loadUsingHistory();
    this.form.valueChanges.pipe(debounceTime(100)).subscribe((values) => {
      if (!this.form.dirty) {
        return;
      }
      this.product()?.update(values);
    });
  }
  resetForm(value) {
    this.form.reset(value ? productToFormValue(value) : this._defFormValue);
    this.form.markAsPristine();
    this._loadUsingHistory();
  }
  validateForm() {
    if (!this._formValid) {
      this._notificationsService.error(this._notificationsService.parseFormErrors(this.form).join(", "));
      return false;
    }
    return true;
  }
  ngAfterViewInit() {
    this._selectResourcesService.load().then((resources) => {
      this._focusFirstEmptyControl();
      this.form.markAsPristine();
    }).catch((err) => {
      this._notificationsService.error(errorHandler(err));
    });
  }
  _focusFirstEmptyControl() {
    if (this.editMode()) {
      return;
    }
    if (!this.form.value.name?.length) {
      this.nameField().focus();
    } else if (!this.form.value.amount) {
      this.amountField().focus();
    } else if (!this.form.value.price) {
      this.priceField().focus();
    } else {
      this.nameField().focus();
    }
  }
  _loadUsingHistory() {
    this._productsRepository.getTopCategories().then((categories) => {
      this.topCategories.set(categories.map((category) => ({
        label: category.name,
        value: category.uuid ?? "",
        color: category.ownColor
      })));
    });
    this._productsRepository.getTopSources().then((sources) => {
      this.topSources.set(sources.map((source) => ({
        label: source,
        value: source
      })));
    });
    this._productsRepository.getTopBrands().then((brands) => {
      this.topBrands.set(brands.map((brand) => ({
        label: brand,
        value: brand
      })));
    });
  }
  static \u0275fac = function AddProductFormComponent_Factory(__ngFactoryType__) {
    return new (__ngFactoryType__ || _AddProductFormComponent)(\u0275\u0275directiveInject(ProductsRepository), \u0275\u0275directiveInject(SelectResourcesService), \u0275\u0275directiveInject(Router), \u0275\u0275directiveInject(NotificationsService), \u0275\u0275directiveInject(SettingsService));
  };
  static \u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _AddProductFormComponent, selectors: [["lg-add-product-form"]], viewQuery: function AddProductFormComponent_Query(rf, ctx) {
    if (rf & 1) {
      \u0275\u0275viewQuerySignal(ctx.nameField, _c03, 5);
      \u0275\u0275viewQuerySignal(ctx.amountField, _c12, 5);
      \u0275\u0275viewQuerySignal(ctx.priceField, _c2, 5);
    }
    if (rf & 2) {
      \u0275\u0275queryAdvance(3);
    }
  }, inputs: { product: [1, "product"], editMode: [1, "editMode"] }, decls: 58, vars: 59, consts: [["nameField", ""], ["amountField", ""], ["priceField", ""], ["sourceInput", ""], ["sourceChips", ""], ["brandInput", ""], ["brandChips", ""], ["categorySelect", ""], ["priceChangesComponent", ""], [3, "formGroup"], [3, "label"], ["formControlName", "name", "placeholder", ""], [3, "center", "mobileMode"], ["lgExpand", "", 3, "label"], ["formControlName", "amount", "lgParseMath", "", "placeholder", "", 3, "onInputChange"], ["lgExtraTpl", "", "place", "after"], ["lgWidth", "40%", 3, "label"], ["formControlName", "price", "lgParseMath", "", "placeholder", ""], ["lgWidth", "40%"], ["lgControlLabelTemplate", ""], [3, "placeholder", "value"], ["ngProjectAs", "after", 5, ["after"], 3, "click", "flat", "icon"], ["aria-hidden", "false", "fontIcon", "bar_chart"], [2, "--control-bg", "var(--hr-bg-strong)", 3, "equal", "mobileMode", "top"], ["lgExpand", "", 2, "--control-box-bg", "var(--control-bg)"], ["formControlName", "notes", 3, "placeholder"], ["size", "small"], ["appendTo", "body", "formControlName", "source", "placeholder", "", 3, "onSelected", "noLoad", "resource"], [3, "hidden"], [3, "control", "items"], ["appendTo", "body", "formControlName", "brand", "placeholder", "", 3, "onSelected", "noLoad", "resource"], ["appendTo", "body", "formControlName", "category_id", "placeholder", "", 3, "resource"], [3, "uuid"], [3, "center", "size"], [3, "eggsChanged"], ["formControlName", "unit"], [3, "translateParams", "translate"]], template: function AddProductFormComponent_Template(rf, ctx) {
    if (rf & 1) {
      const _r1 = \u0275\u0275getCurrentView();
      \u0275\u0275elementStart(0, "form", 9)(1, "lg-flex-column")(2, "lg-card")(3, "lg-flex-column")(4, "lg-control", 10);
      \u0275\u0275pipe(5, "translate");
      \u0275\u0275element(6, "lg-input", 11, 0);
      \u0275\u0275elementEnd();
      \u0275\u0275elementStart(8, "lg-flex-row", 12)(9, "lg-control", 13);
      \u0275\u0275pipe(10, "translate");
      \u0275\u0275pipe(11, "translate");
      \u0275\u0275elementStart(12, "lg-number-input", 14, 1);
      \u0275\u0275listener("onInputChange", function AddProductFormComponent_Template_lg_number_input_onInputChange_12_listener() {
        \u0275\u0275restoreView(_r1);
        const priceField_r2 = \u0275\u0275reference(18);
        return \u0275\u0275resetView(priceField_r2.focus());
      });
      \u0275\u0275template(14, AddProductFormComponent_ng_template_14_Template, 3, 2, "ng-template", 15);
      \u0275\u0275elementEnd()();
      \u0275\u0275elementStart(15, "lg-control", 16);
      \u0275\u0275pipe(16, "translate");
      \u0275\u0275elementStart(17, "lg-number-input", 17, 2);
      \u0275\u0275template(19, AddProductFormComponent_ng_template_19_Template, 3, 3, "ng-template", 15);
      \u0275\u0275elementEnd()();
      \u0275\u0275elementStart(20, "lg-control", 18);
      \u0275\u0275template(21, AddProductFormComponent_ng_template_21_Template, 6, 11, "ng-template", 19);
      \u0275\u0275elementStart(22, "lg-readonly-control", 20);
      \u0275\u0275pipe(23, "translate");
      \u0275\u0275pipe(24, "number");
      \u0275\u0275elementStart(25, "lg-button", 21);
      \u0275\u0275listener("click", function AddProductFormComponent_Template_lg_button_click_25_listener() {
        \u0275\u0275restoreView(_r1);
        const priceChangesComponent_r5 = \u0275\u0275reference(57);
        return \u0275\u0275resetView(priceChangesComponent_r5.open());
      });
      \u0275\u0275element(26, "mat-icon", 22);
      \u0275\u0275elementEnd()()()()()();
      \u0275\u0275elementStart(27, "lg-flex-row", 23)(28, "lg-flex-column")(29, "lg-control", 10);
      \u0275\u0275pipe(30, "translate");
      \u0275\u0275elementStart(31, "lg-control-box", 24);
      \u0275\u0275element(32, "lg-html-editor", 25);
      \u0275\u0275elementEnd()()();
      \u0275\u0275elementStart(33, "lg-flex-column")(34, "lg-control", 10);
      \u0275\u0275pipe(35, "translate");
      \u0275\u0275elementStart(36, "lg-flex-column", 26)(37, "lg-autocomplete", 27, 3);
      \u0275\u0275listener("onSelected", function AddProductFormComponent_Template_lg_autocomplete_onSelected_37_listener() {
        \u0275\u0275restoreView(_r1);
        const sourceChips_r6 = \u0275\u0275reference(41);
        return \u0275\u0275resetView(sourceChips_r6.clearSelected());
      });
      \u0275\u0275elementEnd();
      \u0275\u0275elementStart(39, "div", 28);
      \u0275\u0275element(40, "lg-chips-list", 29, 4);
      \u0275\u0275elementEnd()()();
      \u0275\u0275elementStart(42, "lg-control", 10);
      \u0275\u0275pipe(43, "translate");
      \u0275\u0275elementStart(44, "lg-flex-column", 26)(45, "lg-autocomplete", 30, 5);
      \u0275\u0275listener("onSelected", function AddProductFormComponent_Template_lg_autocomplete_onSelected_45_listener() {
        \u0275\u0275restoreView(_r1);
        const brandChips_r7 = \u0275\u0275reference(49);
        return \u0275\u0275resetView(brandChips_r7.clearSelected());
      });
      \u0275\u0275elementEnd();
      \u0275\u0275elementStart(47, "div", 28);
      \u0275\u0275element(48, "lg-chips-list", 29, 6);
      \u0275\u0275elementEnd()()();
      \u0275\u0275elementStart(50, "lg-control", 10);
      \u0275\u0275pipe(51, "translate");
      \u0275\u0275elementStart(52, "lg-flex-column", 26);
      \u0275\u0275element(53, "lg-multiselect", 31, 7);
      \u0275\u0275conditionalCreate(55, AddProductFormComponent_Conditional_55_Template, 1, 2, "lg-chips-list", 29);
      \u0275\u0275elementEnd()()()()()();
      \u0275\u0275element(56, "lg-price-changes", 32, 8);
    }
    if (rf & 2) {
      let tmp_16_0;
      let tmp_40_0;
      const sourceInput_r9 = \u0275\u0275reference(38);
      const brandInput_r10 = \u0275\u0275reference(46);
      \u0275\u0275property("formGroup", ctx.form);
      \u0275\u0275advance(4);
      \u0275\u0275property("label", \u0275\u0275pipeBind1(5, 33, "product.form.name.placeholder"));
      \u0275\u0275advance(4);
      \u0275\u0275property("center", true)("mobileMode", true);
      \u0275\u0275advance();
      \u0275\u0275property("label", \u0275\u0275pipeBind2(11, 37, "product.form.amount.placeholder", \u0275\u0275pureFunction1(56, _c3, \u0275\u0275pipeBind1(10, 35, "unit.long." + (ctx.form.value.unit || ctx.UnitValue.GRAM)))));
      \u0275\u0275advance(6);
      \u0275\u0275property("label", \u0275\u0275pipeBind2(16, 40, "product.form.price.placeholder", \u0275\u0275pureFunction0(58, _c4)));
      \u0275\u0275advance(7);
      \u0275\u0275property("placeholder", "")("value", ctx.hasMicroPrice() ? \u0275\u0275pipeBind1(23, 43, "micro-amount") : \u0275\u0275pipeBind2(24, 45, (tmp_16_0 = ctx.product()) == null ? null : tmp_16_0.pricePerUnit, ctx.pipesDigits()));
      \u0275\u0275advance(3);
      \u0275\u0275styleMap("success");
      \u0275\u0275property("flat", true)("icon", true);
      \u0275\u0275advance(2);
      \u0275\u0275property("equal", true)("mobileMode", true)("top", true);
      \u0275\u0275advance(2);
      \u0275\u0275property("label", \u0275\u0275pipeBind1(30, 48, "product.form.notes.placeholder"));
      \u0275\u0275advance(3);
      \u0275\u0275property("placeholder", "");
      \u0275\u0275advance(2);
      \u0275\u0275property("label", \u0275\u0275pipeBind1(35, 50, "product.form.source.placeholder"));
      \u0275\u0275advance(3);
      \u0275\u0275property("noLoad", true)("resource", "sources");
      \u0275\u0275advance(2);
      \u0275\u0275property("hidden", !ctx.topSources().length);
      \u0275\u0275advance();
      \u0275\u0275property("control", sourceInput_r9)("items", ctx.topSources());
      \u0275\u0275advance(2);
      \u0275\u0275property("label", \u0275\u0275pipeBind1(43, 52, "product.form.brand.placeholder"));
      \u0275\u0275advance(3);
      \u0275\u0275property("noLoad", true)("resource", "brands");
      \u0275\u0275advance(2);
      \u0275\u0275property("hidden", !ctx.topBrands().length);
      \u0275\u0275advance();
      \u0275\u0275property("control", brandInput_r10)("items", ctx.topBrands());
      \u0275\u0275advance(2);
      \u0275\u0275property("label", \u0275\u0275pipeBind1(51, 54, "product.form.category_id.placeholder"));
      \u0275\u0275advance(3);
      \u0275\u0275property("resource", "product-categories");
      \u0275\u0275advance(2);
      \u0275\u0275conditional(ctx.topCategories().length ? 55 : -1);
      \u0275\u0275advance();
      \u0275\u0275property("uuid", (tmp_40_0 = ctx.product()) == null ? null : tmp_40_0.uuid);
    }
  }, dependencies: [
    ReactiveFormsModule,
    \u0275NgNoValidate,
    NgControlStatus,
    NgControlStatusGroup,
    FormGroupDirective,
    FormControlName,
    FlexColumnComponent,
    MultiselectComponent,
    NumberInputComponent,
    AmountWidgetsComponent,
    ParseMathDirective,
    FlexRowComponent,
    ExpandDirective,
    ChipsListComponent,
    AutocompleteComponent,
    CardComponent,
    WidthDirective,
    UnitSwitcherComponent,
    InputComponent,
    ControlExtraTemplateDirective,
    ControlComponent,
    ReadonlyControlComponent,
    ControlLabelTemplateDirective,
    TranslateDirective,
    PriceChangesComponent,
    ControlBoxComponent,
    HtmlEditorComponent,
    ButtonComponent,
    MatIcon,
    TranslatePipe,
    CurrencySymbolPipe,
    UnitStringPipe,
    DecimalPipe
  ], styles: ["/* angular:styles/component:scss;e479f686f9038c11f5e097ca886a471be12ee124d83d30d03e810e678247c71f;/Users/khripunovpavel/Documents/my/lasagna/lasagna/src/app/features/products/view/add-product-form/add-product-form.component.ts */\nlg-eggs-widget {\n  min-width: 300px;\n}\n/*# sourceMappingURL=add-product-form.component.css.map */\n"], encapsulation: 2 });
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(AddProductFormComponent, [{
    type: Component,
    args: [{ selector: "lg-add-product-form", imports: [
      ReactiveFormsModule,
      FlexColumnComponent,
      MultiselectComponent,
      NumberInputComponent,
      AmountWidgetsComponent,
      ParseMathDirective,
      FlexRowComponent,
      ExpandDirective,
      ChipsListComponent,
      AutocompleteComponent,
      TranslatePipe,
      CardComponent,
      WidthDirective,
      UnitSwitcherComponent,
      CurrencySymbolPipe,
      InputComponent,
      ControlExtraTemplateDirective,
      ControlComponent,
      ReadonlyControlComponent,
      UnitStringPipe,
      ControlLabelTemplateDirective,
      TranslateDirective,
      DecimalPipe,
      PriceChangesComponent,
      ControlBoxComponent,
      HtmlEditorComponent,
      ButtonComponent,
      MatIcon
    ], encapsulation: ViewEncapsulation.None, template: `<form [formGroup]="form">
  <lg-flex-column>
    <lg-card>
      <lg-flex-column>
        <lg-control [label]="'product.form.name.placeholder'|translate">
          <lg-input #nameField
                    formControlName="name"
                    placeholder=""></lg-input>
        </lg-control>

        <lg-flex-row [center]="true" [mobileMode]="true">
          <lg-control
            [label]="'product.form.amount.placeholder'|translate:{unit:('unit.long.'+(form.value.unit || UnitValue.GRAM)|translate)}"
            lgExpand>
            <lg-number-input #amountField
                             (onInputChange)="priceField.focus()"
                             formControlName="amount"
                             lgParseMath
                             placeholder="">
              <ng-template lgExtraTpl place="after">
                <lg-flex-row [center]="true" [size]="'small'">
                  <lg-amount-widgets (eggsChanged)="eggsChanged($event)"></lg-amount-widgets>

                  <lg-unit-switcher formControlName="unit">
                  </lg-unit-switcher>
                </lg-flex-row>
              </ng-template>
            </lg-number-input>
          </lg-control>

          <lg-control [label]="'product.form.price.placeholder'|translate:{currency:'EUR'}"
                      lgWidth="40%">
            <lg-number-input #priceField
                             formControlName="price"
                             lgParseMath
                             placeholder="">
              <ng-template lgExtraTpl place="after">
                <span>{{ userSettings()['currency']|currencySymbol }}</span>
              </ng-template>
            </lg-number-input>
          </lg-control>

          <lg-control lgWidth="40%">
            <ng-template lgControlLabelTemplate>
              <span>{{ userSettings()['currency']|currencySymbol }}</span>
              <span [translateParams]="{unit:product()?.unit | unitString | translate}"
                    [translate]="'per-unit.label'"></span>
            </ng-template>

            <lg-readonly-control [placeholder]="''"
                                 [value]="hasMicroPrice() ? ('micro-amount'|translate) : (product()?.pricePerUnit | number:pipesDigits())">
              <lg-button (click)="priceChangesComponent.open()"
                         [flat]="true"
                         [icon]="true"
                         [style]="'success'"
                         ngProjectAs="after">
                <mat-icon aria-hidden="false" fontIcon="bar_chart"></mat-icon>
              </lg-button>
            </lg-readonly-control>
          </lg-control>
        </lg-flex-row>
      </lg-flex-column>
    </lg-card>

    <lg-flex-row [equal]="true" [mobileMode]="true" [top]="true" style="--control-bg: var(--hr-bg-strong)">
      <lg-flex-column>
        <lg-control [label]="'product.form.notes.placeholder'|translate">
          <lg-control-box lgExpand
                          style="--control-box-bg: var(--control-bg)">
            <lg-html-editor [placeholder]="''"
                            formControlName="notes"></lg-html-editor>
          </lg-control-box>
        </lg-control>
      </lg-flex-column>

      <lg-flex-column>
        <lg-control [label]="'product.form.source.placeholder'|translate">
          <lg-flex-column size="small">
            <lg-autocomplete #sourceInput
                             (onSelected)="sourceChips.clearSelected()"
                             [noLoad]="true"
                             [resource]="'sources'"
                             appendTo="body"
                             formControlName="source"
                             placeholder=""></lg-autocomplete>
            <div [hidden]="!topSources().length">
              <lg-chips-list #sourceChips [control]="sourceInput" [items]="topSources()"></lg-chips-list>
            </div>
          </lg-flex-column>
        </lg-control>

        <lg-control [label]="'product.form.brand.placeholder'|translate">
          <lg-flex-column size="small">
            <lg-autocomplete #brandInput
                             (onSelected)="brandChips.clearSelected()"
                             [noLoad]="true"
                             [resource]="'brands'"
                             appendTo="body"
                             formControlName="brand"
                             placeholder=""></lg-autocomplete>
            <div [hidden]="!topBrands().length">
              <lg-chips-list #brandChips [control]="brandInput" [items]="topBrands()"></lg-chips-list>
            </div>
          </lg-flex-column>
        </lg-control>

        <lg-control [label]="'product.form.category_id.placeholder'|translate">
          <lg-flex-column size="small">
            <lg-multiselect #categorySelect
                            [resource]="'product-categories'"
                            appendTo="body"
                            formControlName="category_id"
                            placeholder="">
            </lg-multiselect>

            @if (topCategories().length) {
              <lg-chips-list [control]="categorySelect" [items]="topCategories()"></lg-chips-list>
            }
          </lg-flex-column>
        </lg-control>
      </lg-flex-column>
    </lg-flex-row>
  </lg-flex-column>
</form>

<lg-price-changes #priceChangesComponent [uuid]="product()?.uuid"></lg-price-changes>
`, styles: ["/* angular:styles/component:scss;e479f686f9038c11f5e097ca886a471be12ee124d83d30d03e810e678247c71f;/Users/khripunovpavel/Documents/my/lasagna/lasagna/src/app/features/products/view/add-product-form/add-product-form.component.ts */\nlg-eggs-widget {\n  min-width: 300px;\n}\n/*# sourceMappingURL=add-product-form.component.css.map */\n"] }]
  }], () => [{ type: ProductsRepository }, { type: SelectResourcesService }, { type: Router }, { type: NotificationsService }, { type: SettingsService }], null);
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(AddProductFormComponent, { className: "AddProductFormComponent", filePath: "src/app/features/products/view/add-product-form/add-product-form.component.ts", lineNumber: 97 });
})();

// src/app/features/products/view/add-product/add-product.component.ts
function AddProductComponent_Conditional_0_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "lg-controls-bar", 0)(1, "lg-button", 11);
    \u0275\u0275pipe(2, "translate");
    \u0275\u0275element(3, "mat-icon", 12);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    \u0275\u0275advance();
    \u0275\u0275styleMap("primary");
    \u0275\u0275property("icon", true)("link", "/products/add")("size", "small")("label", \u0275\u0275pipeBind1(2, 6, "product.form.add-new-btn"));
  }
}
function AddProductComponent_Conditional_5_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "lg-title", 3);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    let tmp_1_0;
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", (tmp_1_0 = ctx_r0.product()) == null ? null : tmp_1_0.name, " ");
  }
}
function AddProductComponent_Conditional_6_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "lg-title", 3);
    \u0275\u0275text(1);
    \u0275\u0275pipe(2, "translate");
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", \u0275\u0275pipeBind1(2, 1, "product.form.title"), " ");
  }
}
function AddProductComponent_Conditional_8_ng_template_0_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "lg-fade-in")(1, "span", 13);
    \u0275\u0275text(2);
    \u0275\u0275pipe(3, "translate");
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(\u0275\u0275pipeBind1(3, 1, "saved-draft-label"));
  }
}
function AddProductComponent_Conditional_8_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275template(0, AddProductComponent_Conditional_8_ng_template_0_Template, 4, 3, "ng-template", 4);
  }
}
function AddProductComponent_Conditional_9_ng_template_0_Template(rf, ctx) {
  if (rf & 1) {
    const _r2 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "lg-button", 14);
    \u0275\u0275listener("click", function AddProductComponent_Conditional_9_ng_template_0_Template_lg_button_click_0_listener() {
      \u0275\u0275restoreView(_r2);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.onRemoveDraft());
    });
    \u0275\u0275text(1);
    \u0275\u0275pipe(2, "translate");
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    \u0275\u0275styleMap("danger");
    \u0275\u0275property("flat", true);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", \u0275\u0275pipeBind1(2, 4, "product.form.delete-draft-btn"), " ");
  }
}
function AddProductComponent_Conditional_9_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275template(0, AddProductComponent_Conditional_9_ng_template_0_Template, 3, 6, "ng-template", 4);
  }
}
function AddProductComponent_Conditional_10_ng_template_0_Template(rf, ctx) {
  if (rf & 1) {
    const _r3 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "lg-button", 14);
    \u0275\u0275listener("click", function AddProductComponent_Conditional_10_ng_template_0_Template_lg_button_click_0_listener() {
      \u0275\u0275restoreView(_r3);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.onDeleteProduct());
    });
    \u0275\u0275text(1);
    \u0275\u0275pipe(2, "translate");
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    \u0275\u0275styleMap("danger");
    \u0275\u0275property("flat", true);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", \u0275\u0275pipeBind1(2, 4, "product.form.delete-btn"), " ");
  }
}
function AddProductComponent_Conditional_10_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275template(0, AddProductComponent_Conditional_10_ng_template_0_Template, 3, 6, "ng-template", 4);
  }
}
function AddProductComponent_Conditional_11_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "small", 5);
    \u0275\u0275text(1);
    \u0275\u0275pipe(2, "translate");
    \u0275\u0275pipe(3, "timeAgo");
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    let tmp_1_0;
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance();
    \u0275\u0275textInterpolate2(" ", \u0275\u0275pipeBind1(2, 2, "edited-at-label"), " ", \u0275\u0275pipeBind1(3, 4, (tmp_1_0 = ctx_r0.product()) == null ? null : tmp_1_0.updatedAt), " ");
  }
}
function AddProductComponent_Conditional_14_Conditional_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0);
    \u0275\u0275pipe(1, "translate");
  }
  if (rf & 2) {
    \u0275\u0275textInterpolate1(" ", \u0275\u0275pipeBind1(1, 1, "product.form.save-btn.edit.active"), " ");
  }
}
function AddProductComponent_Conditional_14_Conditional_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0);
    \u0275\u0275pipe(1, "translate");
  }
  if (rf & 2) {
    \u0275\u0275textInterpolate1(" ", \u0275\u0275pipeBind1(1, 1, "product.form.save-btn.edit.disabled"), " ");
  }
}
function AddProductComponent_Conditional_14_Template(rf, ctx) {
  if (rf & 1) {
    const _r4 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "lg-button", 15);
    \u0275\u0275listener("click", function AddProductComponent_Conditional_14_Template_lg_button_click_0_listener() {
      \u0275\u0275restoreView(_r4);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.onEditProduct());
    });
    \u0275\u0275conditionalCreate(1, AddProductComponent_Conditional_14_Conditional_1_Template, 2, 3)(2, AddProductComponent_Conditional_14_Conditional_2_Template, 2, 3);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    let tmp_2_0;
    let tmp_3_0;
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275styleMap("primary");
    \u0275\u0275property("disabled", !((tmp_2_0 = ctx_r0.formComponent()) == null ? null : tmp_2_0.form == null ? null : tmp_2_0.form.dirty) && !ctx_r0.draftRef());
    \u0275\u0275advance();
    \u0275\u0275conditional(((tmp_3_0 = ctx_r0.formComponent()) == null ? null : tmp_3_0.form == null ? null : tmp_3_0.form.dirty) || ctx_r0.draftRef() ? 1 : 2);
  }
}
function AddProductComponent_Conditional_15_Conditional_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0);
    \u0275\u0275pipe(1, "translate");
  }
  if (rf & 2) {
    \u0275\u0275textInterpolate1(" ", \u0275\u0275pipeBind1(1, 1, "product.form.save-btn.add.active"), " ");
  }
}
function AddProductComponent_Conditional_15_Conditional_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0);
    \u0275\u0275pipe(1, "translate");
  }
  if (rf & 2) {
    \u0275\u0275textInterpolate1(" ", \u0275\u0275pipeBind1(1, 1, "product.form.save-btn.add.disabled"), " ");
  }
}
function AddProductComponent_Conditional_15_Template(rf, ctx) {
  if (rf & 1) {
    const _r5 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "lg-button", 15);
    \u0275\u0275listener("click", function AddProductComponent_Conditional_15_Template_lg_button_click_0_listener() {
      \u0275\u0275restoreView(_r5);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.onAddProduct());
    });
    \u0275\u0275conditionalCreate(1, AddProductComponent_Conditional_15_Conditional_1_Template, 2, 3)(2, AddProductComponent_Conditional_15_Conditional_2_Template, 2, 3);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    let tmp_2_0;
    let tmp_3_0;
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275styleMap("primary");
    \u0275\u0275property("disabled", !((tmp_2_0 = ctx_r0.formComponent()) == null ? null : tmp_2_0.form == null ? null : tmp_2_0.form.dirty) && !ctx_r0.draftRef());
    \u0275\u0275advance();
    \u0275\u0275conditional(((tmp_3_0 = ctx_r0.formComponent()) == null ? null : tmp_3_0.form == null ? null : tmp_3_0.form.dirty) || ctx_r0.draftRef() ? 1 : 2);
  }
}
function AddProductComponent_Conditional_16_Template(rf, ctx) {
  if (rf & 1) {
    const _r6 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "lg-button", 16);
    \u0275\u0275listener("click", function AddProductComponent_Conditional_16_Template_lg_button_click_0_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.onResetForm());
    });
    \u0275\u0275text(1);
    \u0275\u0275pipe(2, "translate");
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    \u0275\u0275styleMap("primary");
    \u0275\u0275property("outlined", true);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", \u0275\u0275pipeBind1(2, 4, "product.form.reset-btn.edit.active"), " ");
  }
}
var AddProductComponent = class _AddProductComponent {
  _router;
  _aRoute;
  _productsRepository;
  _notificationsService;
  _analyticsService;
  _translateService;
  constructor(_router, _aRoute, _productsRepository, _notificationsService, _analyticsService, _translateService) {
    this._router = _router;
    this._aRoute = _aRoute;
    this._productsRepository = _productsRepository;
    this._notificationsService = _notificationsService;
    this._analyticsService = _analyticsService;
    this._translateService = _translateService;
  }
  deleteConfirmationService = inject(DeleteConfirmationService);
  draftOrProductUUID = signal(void 0, ...ngDevMode ? [{ debugName: "draftOrProductUUID" }] : []);
  product = signal(null, ...ngDevMode ? [{ debugName: "product" }] : []);
  formComponent = viewChild(AddProductFormComponent, ...ngDevMode ? [{ debugName: "formComponent" }] : []);
  draftRef = signal(null, ...ngDevMode ? [{ debugName: "draftRef" }] : []);
  draftByExistingProduct = computed(() => {
    return this.draftRef().meta?.["uuid"];
  }, ...ngDevMode ? [{ debugName: "draftByExistingProduct" }] : []);
  isDraftRoute = signal(false, ...ngDevMode ? [{ debugName: "isDraftRoute" }] : []);
  editMode = computed(() => {
    return Boolean(this.product()?.uuid && !this.draftRef() || this.draftRef() && this.draftByExistingProduct());
  }, ...ngDevMode ? [{ debugName: "editMode" }] : []);
  firstState;
  _routerManager = inject(ROUTER_MANAGER);
  ngOnDestroy() {
  }
  ngOnInit() {
    combineLatest([
      this._aRoute.params,
      this._aRoute.data
    ]).pipe(take(1)).subscribe(([params, data]) => {
      this.draftOrProductUUID.set(params["uuid"]);
      if (data["draft"]) {
        this.draftRef.set(data["draft"]);
        this.product.set(Product.fromRaw(data["draft"].data));
      } else if (this.draftOrProductUUID()) {
        this._loadProduct(this.draftOrProductUUID());
      } else {
        this.product.set(Product.empty());
      }
      this.isDraftRoute.set(!!data["draftRoute"]);
    });
  }
  ngAfterViewInit() {
    this.formComponent()?.form.valueChanges.pipe(debounceTime(500)).subscribe((value) => {
      if (!this.formComponent().form.dirty || !this.product()) {
        return;
      }
      if (this.draftRef()?.uuid) {
        this._productsRepository.updateDraftProduct(this.draftRef().uuid, this.product(), this.draftRef().meta?.["uuid"]);
      } else if (this.product()) {
        this.draftRef.set(this._productsRepository.saveDraftProduct(this.product(), this.draftOrProductUUID() ?? ""));
      }
    });
  }
  onResetForm() {
    this._removeDraft();
    window.location.reload();
  }
  onAddProduct() {
    if (!this.formComponent()?.validateForm() || !this.product()) {
      return;
    }
    this._addProduct(this.product());
  }
  onEditProduct() {
    if (!this.formComponent()?.validateForm() || !this.product()) {
      return;
    }
    this._editProduct(this.product());
  }
  onRemoveDraft() {
    this._removeDraft();
    this._routerManager.navigate(["products"]);
  }
  onDeleteProduct() {
    if (!this.product()?.uuid) {
      return;
    }
    this.deleteConfirmationService.configure({
      message: this._translateService.instant("product.form.delete-confirm-message"),
      onSuccess: () => {
        this._productsRepository.deleteProduct(this.product().uuid).then(() => {
          this._notificationsService.success("notifications.product.deleted");
          this._routerManager.navigate(["products"]);
        }).catch((error) => {
          this._notificationsService.error(errorHandler(error));
        });
      },
      onCancel: () => {
      }
    });
  }
  _addProduct(product) {
    this._productsRepository.addOne(product).then((newUUID) => {
      this._analyticsService.trackProductCreated(product.name, {
        product_uuid: newUUID,
        price_per_unit: product.pricePerUnit,
        unit: product.unit,
        category: product.category_id?.name
      });
      this.formComponent()?.resetForm();
      this._notificationsService.success("notifications.product.added");
      this.product.set(null);
      if (this.draftRef()) {
        this._removeDraft();
      }
      this._routerManager.replace(["products/edit/" + newUUID]);
    }).catch((error) => {
      this._notificationsService.error(errorHandler(error));
    });
  }
  _editProduct(product) {
    if (!this.draftOrProductUUID()) {
      return;
    }
    let productUUID = this.draftRef()?.meta?.["uuid"] ?? this.draftOrProductUUID();
    this._productsRepository.updateOne(productUUID, product).then(() => {
      this.formComponent()?.resetForm(product);
      this._notificationsService.success("notifications.product.edited");
      if (this.draftRef()) {
        this._removeDraft();
      }
      this._routerManager.replace(["products", "edit", productUUID]);
    }).catch((error) => {
      this._notificationsService.error(errorHandler(error));
    });
  }
  _removeDraft() {
    if (!this.draftRef()) {
      return;
    }
    this._productsRepository.removeDraftProduct(this.draftRef().uuid);
    this.draftRef.set(null);
  }
  _loadProduct(uuid) {
    if (!uuid) {
      return;
    }
    this._productsRepository.getOne(uuid, true).then((product) => {
      if (!product) {
        return;
      }
      this.product.set(product);
    }).catch((error) => {
      this._notificationsService.error(errorHandler(error));
    });
  }
  static \u0275fac = function AddProductComponent_Factory(__ngFactoryType__) {
    return new (__ngFactoryType__ || _AddProductComponent)(\u0275\u0275directiveInject(Router), \u0275\u0275directiveInject(ActivatedRoute), \u0275\u0275directiveInject(ProductsRepository), \u0275\u0275directiveInject(NotificationsService), \u0275\u0275directiveInject(AnalyticsService), \u0275\u0275directiveInject(TranslateService));
  };
  static \u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _AddProductComponent, selectors: [["lg-add-product"]], viewQuery: function AddProductComponent_Query(rf, ctx) {
    if (rf & 1) {
      \u0275\u0275viewQuerySignal(ctx.formComponent, AddProductFormComponent, 5);
    }
    if (rf & 2) {
      \u0275\u0275queryAdvance();
    }
  }, features: [\u0275\u0275ProvidersFeature([
    CurrencyPipe,
    DeleteConfirmationService
  ])], decls: 18, vars: 13, consts: [["size", "small"], ["size", "medium"], [3, "center", "mobileMode"], ["lgSelfStart", ""], ["lgInlineSeparatedGroup", ""], [1, "text-muted", "text-cursive"], [3, "editMode", "product"], [3, "mobileMode", "relaxed"], ["lgShrink", "", 3, "disabled", "style"], ["lgShrink", "", 3, "style", "disabled"], ["lgShrink", "", 3, "outlined", "style"], [3, "icon", "link", "size", "label"], ["aria-hidden", "false", "fontIcon", "add"], [1, "text-success"], ["lgShrink", "", 3, "click", "flat"], ["lgShrink", "", 3, "click", "disabled"], ["lgShrink", "", 3, "click", "outlined"]], template: function AddProductComponent_Template(rf, ctx) {
    if (rf & 1) {
      \u0275\u0275conditionalCreate(0, AddProductComponent_Conditional_0_Template, 4, 8, "lg-controls-bar", 0);
      \u0275\u0275elementStart(1, "lg-fade-in")(2, "lg-container")(3, "lg-flex-column", 1)(4, "lg-flex-row", 2);
      \u0275\u0275conditionalCreate(5, AddProductComponent_Conditional_5_Template, 2, 1, "lg-title", 3)(6, AddProductComponent_Conditional_6_Template, 3, 3, "lg-title", 3);
      \u0275\u0275elementEnd();
      \u0275\u0275elementStart(7, "lg-inline-separated-group");
      \u0275\u0275conditionalCreate(8, AddProductComponent_Conditional_8_Template, 1, 0, null, 4);
      \u0275\u0275conditionalCreate(9, AddProductComponent_Conditional_9_Template, 1, 0, null, 4)(10, AddProductComponent_Conditional_10_Template, 1, 0, null, 4);
      \u0275\u0275elementEnd();
      \u0275\u0275conditionalCreate(11, AddProductComponent_Conditional_11_Template, 4, 6, "small", 5);
      \u0275\u0275elementEnd();
      \u0275\u0275element(12, "lg-add-product-form", 6);
      \u0275\u0275elementStart(13, "lg-flex-row", 7);
      \u0275\u0275conditionalCreate(14, AddProductComponent_Conditional_14_Template, 3, 4, "lg-button", 8)(15, AddProductComponent_Conditional_15_Template, 3, 4, "lg-button", 9);
      \u0275\u0275conditionalCreate(16, AddProductComponent_Conditional_16_Template, 3, 6, "lg-button", 10);
      \u0275\u0275elementEnd()()();
      \u0275\u0275element(17, "lg-delete-confirmation-popover");
    }
    if (rf & 2) {
      let tmp_3_0;
      let tmp_4_0;
      let tmp_5_0;
      let tmp_6_0;
      let tmp_12_0;
      \u0275\u0275conditional(ctx.editMode() ? 0 : -1);
      \u0275\u0275advance(4);
      \u0275\u0275property("center", true)("mobileMode", true);
      \u0275\u0275advance();
      \u0275\u0275conditional(((tmp_3_0 = ctx.product()) == null ? null : tmp_3_0.uuid) && !ctx.draftRef() || ctx.draftRef() && ctx.draftByExistingProduct() ? 5 : 6);
      \u0275\u0275advance(3);
      \u0275\u0275conditional(ctx.draftRef() && ((tmp_4_0 = ctx.formComponent()) == null ? null : tmp_4_0.form == null ? null : tmp_4_0.form.dirty) ? 8 : -1);
      \u0275\u0275advance();
      \u0275\u0275conditional(ctx.isDraftRoute() ? 9 : ((tmp_5_0 = ctx.product()) == null ? null : tmp_5_0.uuid) ? 10 : -1);
      \u0275\u0275advance(2);
      \u0275\u0275conditional(ctx.editMode() && ((tmp_6_0 = ctx.product()) == null ? null : tmp_6_0.updatedAt) ? 11 : -1);
      \u0275\u0275advance();
      \u0275\u0275property("editMode", ctx.editMode())("product", ctx.product());
      \u0275\u0275advance();
      \u0275\u0275property("mobileMode", true)("relaxed", true);
      \u0275\u0275advance();
      \u0275\u0275conditional(ctx.product() && !ctx.draftRef() || ctx.draftRef() && ctx.draftByExistingProduct() ? 14 : 15);
      \u0275\u0275advance(2);
      \u0275\u0275conditional(((tmp_12_0 = ctx.formComponent()) == null ? null : tmp_12_0.form == null ? null : tmp_12_0.form.dirty) ? 16 : -1);
    }
  }, dependencies: [
    ContainerComponent,
    TitleComponent,
    AddProductFormComponent,
    FlexRowComponent,
    FadeInComponent,
    ButtonComponent,
    ShrinkDirective,
    FlexColumnComponent,
    InlineSeparatedGroupComponent,
    InlineSeparatedGroupDirective,
    SelfStartDirective,
    ControlsBarComponent,
    MatIcon,
    DeleteConfirmationPopoverComponent,
    TimeAgoPipe,
    TranslatePipe
  ], encapsulation: 2 });
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(AddProductComponent, [{
    type: Component,
    args: [{ selector: "lg-add-product", standalone: true, imports: [
      ContainerComponent,
      TitleComponent,
      AddProductFormComponent,
      FlexRowComponent,
      FadeInComponent,
      ButtonComponent,
      ShrinkDirective,
      TimeAgoPipe,
      TranslatePipe,
      FlexColumnComponent,
      InlineSeparatedGroupComponent,
      InlineSeparatedGroupDirective,
      SelfStartDirective,
      ControlsBarComponent,
      MatIcon,
      DeleteConfirmationPopoverComponent
    ], providers: [
      CurrencyPipe,
      DeleteConfirmationService
    ], template: `@if (editMode()) {
  <lg-controls-bar size="small">
    <lg-button [icon]="true"
               [link]="'/products/add'"
               [size]="'small'"
               [label]=" 'product.form.add-new-btn'|translate"
               [style]="'primary'">
      <mat-icon aria-hidden="false" fontIcon="add"></mat-icon>
    </lg-button>
  </lg-controls-bar>
}

<lg-fade-in>
  <lg-container>
    <lg-flex-column size="medium">
      <lg-flex-row [center]="true" [mobileMode]="true">
        @if ((product()?.uuid && !draftRef()) || (draftRef() && draftByExistingProduct())) {
          <lg-title lgSelfStart>
            {{ product()?.name }}
          </lg-title>
        } @else {
          <lg-title lgSelfStart>
            {{ 'product.form.title'|translate }}
          </lg-title>
        }
      </lg-flex-row>

      <lg-inline-separated-group>
        @if (draftRef() && formComponent()?.form?.dirty) {
          <ng-template lgInlineSeparatedGroup>
            <lg-fade-in>
              <span class="text-success">{{ 'saved-draft-label'|translate }}</span>
            </lg-fade-in>
          </ng-template>
        }

        @if (isDraftRoute()) {
          <ng-template lgInlineSeparatedGroup>
            <lg-button lgShrink [style]="'danger'"
                       [flat]="true"
                       (click)="onRemoveDraft()">
              {{ 'product.form.delete-draft-btn'|translate }}
            </lg-button>
          </ng-template>
        } @else if (product()?.uuid) {
          <ng-template lgInlineSeparatedGroup>
            <lg-button lgShrink [style]="'danger'"
                       [flat]="true"
                       (click)="onDeleteProduct()">
              {{ 'product.form.delete-btn'|translate }}
            </lg-button>
          </ng-template>
        }
      </lg-inline-separated-group>

      @if (editMode() && product()?.updatedAt) {
        <small class="text-muted text-cursive">
          {{ 'edited-at-label'|translate }} {{ product()?.updatedAt | timeAgo }}
        </small>
      }

    </lg-flex-column>

    <lg-add-product-form [editMode]="editMode()"
                         [product]="product()"></lg-add-product-form>

    <lg-flex-row [mobileMode]="true" [relaxed]="true">
      @if ((product() && !draftRef()) || (draftRef() && draftByExistingProduct())) {
        <lg-button [disabled]="!formComponent()?.form?.dirty && !draftRef()"
                   lgShrink
                   [style]="'primary'"
                   (click)="onEditProduct()">
          @if (formComponent()?.form?.dirty || draftRef()) {
            {{ 'product.form.save-btn.edit.active'|translate }}
          } @else {
            {{ 'product.form.save-btn.edit.disabled'|translate }}
          }
        </lg-button>
      } @else {
        <lg-button lgShrink
                   [style]="'primary'"
                   [disabled]="!formComponent()?.form?.dirty && !draftRef()"
                   (click)="onAddProduct()">
          @if (formComponent()?.form?.dirty || draftRef()) {
            {{ 'product.form.save-btn.add.active'|translate }}
          } @else {
            {{ 'product.form.save-btn.add.disabled'|translate }}
          }
        </lg-button>
      }

      @if (formComponent()?.form?.dirty) {
        <lg-button (click)="onResetForm()"
                   [outlined]="true"
                   [style]="'primary'"
                   lgShrink>
          {{ 'product.form.reset-btn.edit.active'|translate }}
        </lg-button>
      }
    </lg-flex-row>
  </lg-container>
</lg-fade-in>

<lg-delete-confirmation-popover></lg-delete-confirmation-popover>
` }]
  }], () => [{ type: Router }, { type: ActivatedRoute }, { type: ProductsRepository }, { type: NotificationsService }, { type: AnalyticsService }, { type: TranslateService }], null);
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(AddProductComponent, { className: "AddProductComponent", filePath: "src/app/features/products/view/add-product/add-product.component.ts", lineNumber: 65 });
})();
export {
  AddProductComponent
};
//# sourceMappingURL=chunk-5642TI7N.js.map
