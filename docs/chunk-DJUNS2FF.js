import{a as me,b as de,c as _e,d as fe,e as ge,f as n,g as Re,h as ye}from"./chunk-YPG2RROI.js";import"./chunk-Y23UHYZT.js";import{a as ue}from"./chunk-PRC2TUST.js";import{a as oe}from"./chunk-STBDAJWN.js";import{a as ae,c as ce}from"./chunk-BYY4DCB2.js";import{b as se}from"./chunk-YTMDE3SE.js";import{a as le}from"./chunk-NDMR6PFL.js";import"./chunk-P5G62LPO.js";import{a as ne}from"./chunk-MWAKLIDH.js";import{a as xe}from"./chunk-OBLGAKJH.js";import{a as pe}from"./chunk-OSCZMZ3H.js";import"./chunk-QUDHFSLL.js";import{a as ee,c as re}from"./chunk-U3ZGTCNR.js";import{a as ie}from"./chunk-PCXGHPCF.js";import{a as te}from"./chunk-R3YS3RQB.js";import"./chunk-SNDQO5FA.js";import{e as J,l as W,p as L,q as Y,s as w}from"./chunk-D27BCGO7.js";import"./chunk-BF6WJXXA.js";import"./chunk-BSQF24A4.js";import{b as K}from"./chunk-XBLVHOT4.js";import{u as X}from"./chunk-TZJHT7D3.js";import"./chunk-EEUNPNNP.js";import{s as q,w as H}from"./chunk-I5MUGXQZ.js";import"./chunk-E4OWUINI.js";import{$ as y,Ab as b,Bb as l,Cb as a,Db as v,Hb as E,Kb as R,Lb as _,R as N,Ua as o,Xb as s,Yb as z,Z as V,Za as x,Zb as f,_b as P,cb as G,cc as U,ga as I,ha as D,hb as C,ic as m,jc as d,k as Z,na as $,pb as c,q as T,s as j,sb as g,vb as F,wb as O,xb as Q,zb as h}from"./chunk-OZXQ5JHJ.js";import"./chunk-DELOOZDJ.js";import{f as M}from"./chunk-2WH2EVR6.js";var Ce=new V("CategorizedRecipesList",{factory:()=>{let t=y(w),i=y(K);return Z(t.loadRecipes()).pipe(N(()=>t.recipes$),T(r=>r.map(p=>p.toDTO()))).pipe(T(r=>r.toSorted((p,u)=>p.name.localeCompare(u.name))),T(r=>ue(r,"category_id")),j(r=>M(void 0,null,function*(){let p=[];for(let S in r){let A=r[S],Te=yield i.getOne(S);p.push({category:Te?.name,recipes:A.map(Ie=>J.fromRaw(Ie))})}if(!p.length)return[];let[u,...B]=p.toSorted((S,A)=>S.category>A.category?1:-1);return u?.category?[u].concat(B):B.concat([u])})))}});var ve=n.object({name:n.string(),amount:n.number().or(n.string()),uuid:n.string().optional(),product_id:ye,recipe_id:n.lazy(()=>k),unit:n.enum(["gram","portion","piece"])});var k=n.object({name:n.string(),uuid:n.string().optional(),description:n.string(),ingredients:n.array(n.lazy(()=>ve)),outcome_unit:Re,outcome_amount:n.number().or(n.string()),taxTemplateName:n.string().optional(),category_id:n.string().nullable().optional(),createdAt:n.union([n.string(),n.number()]).optional(),updatedAt:n.union([n.string(),n.number()]).optional(),tags:n.array(n.string()).optional()});var De=(t,i)=>i==null?null:i.category,he=(t,i)=>i==null?null:i.createdAt;function be(t,i){t&1&&(l(0,"lg-button",6),v(1,"mat-icon",7),a()),t&2&&(g("success"),c("icon",!0)("link","/recipes/add")("size","medium"))}function Ee(t,i){if(t&1&&(l(0,"span"),s(1),a()),t&2){let e=i.$implicit;o(),z(e==null?null:e.name)}}function Le(t,i){t&1&&(s(0),m(1,"translate")),t&2&&f(" ",d(1,1,"draft.list-prefix.existing")," ")}function we(t,i){t&1&&(s(0),m(1,"translate")),t&2&&f(" ",d(1,1,"draft.list-prefix.new")," ")}function ke(t,i){if(t&1){let e=E();l(0,"lg-gap-row",4)(1,"a",9),F(2,Le,2,3)(3,we,2,3),s(4),a(),l(5,"small",10),s(6),m(7,"translate"),m(8,"timeAgo"),a(),l(9,"lg-button",11),R("click",function(){I(e);let p=_().$implicit,u=_(2);return D(u.deleteDraft(p))}),v(10,"mat-icon",12),a()()}if(t&2){let e=_().$implicit;c("center",!0),o(),c("routerLink","/recipes/draft/"+(e==null?null:e.uuid)),o(),O(!(e==null||e.meta==null)&&e.meta.uuid?2:3),o(2),f(" ",(e==null||e.data==null?null:e.data.name)??""," "),o(2),P(" ",d(7,10,"edited-at-label")," ",d(8,12,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," "),o(3),g("danger"),c("size","tiny")("icon",!0)}}function Ae(t,i){t&1&&C(0,ke,11,14,"ng-template",8)}function Fe(t,i){if(t&1&&(l(0,"lg-card-list",5),h(1,Ae,1,0,null,8,he),a()),t&2){let e=_();o(),b(e.draft())}}function Oe(t,i){if(t&1){let e=E();l(0,"lg-gap-row",4)(1,"a",16),s(2),a(),l(3,"lg-button",17),s(4),m(5,"translate"),a(),l(6,"small",18),s(7),m(8,"translate"),m(9,"timeAgo"),a(),l(10,"lg-button",11),R("click",function(){I(e);let p=_().$implicit,u=_(2);return D(u.deleteRecipe(p))}),v(11,"mat-icon",12),a()()}if(t&2){let e=_().$implicit;c("center",!0),o(),c("routerLink","/recipes/edit/"+e.uuid),o(),z(e.name),o(),g("primary"),c("size","small")("link","/recipes/calculate/"+e.uuid)("flat",!0),o(),f(" ",d(5,15,"recipes.calculate-btn")," "),o(3),P(" ",d(8,17,"edited-at-label")," ",d(9,19,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," "),o(3),g("danger"),c("size","tiny")("icon",!0)}}function ze(t,i){if(t&1&&C(0,Oe,12,21,"ng-template",15),t&2){let e=i.$implicit;c("uuid",e.uuid)}}function Pe(t,i){if(t&1){let e=E();l(0,"lg-title",13),s(1),m(2,"translate"),a(),l(3,"lg-card-list",14),R("onSelected",function(p){I(e);let u=_();return D(u.selectionZoneService.putSelected(p))}),h(4,ze,1,1,null,15,Q),a()}if(t&2){let e=i.$implicit,r=_();c("level",3),o(),f(" ",(e==null?null:e.category)||d(2,5,"without-category-label")," "),o(2),c("mode",r.selectionZoneService.selectionMode())("selectAll",r.selectionZoneService.selectAll())("deselectAll",r.selectionZoneService.deselectAll()),o(),b(e.recipes)}}function Be(t,i){t&1&&(l(0,"lg-gap-row",4)(1,"lg-title",13),s(2),m(3,"translate"),a()()),t&2&&(c("center",!0),o(),c("level",5),o(),f(" ",d(3,3,"no-recipes")," "))}var Se=class t{constructor(i,e,r,p){this._recipesRepository=i;this._notificationsService=e;this._transferDataService=r;this.selectionZoneService=p}draft=$([]);recipes=se(y(Ce));Stores=H;ngOnInit(){this.loadRecipes();let i=this._recipesRepository.getDraftRecipe();i&&this.draft.set(i)}deleteRecipe(i){return i.uuid?this._recipesRepository.deleteRecipe(i.uuid).then(()=>{this.loadRecipes(),this._notificationsService.success("Recipe deleted")}):Promise.resolve()}loadRecipes(){this._recipesRepository.loadRecipes()}exportRecipes(i){this._transferDataService.exportTable("recipesStore","json",{selected:Array.from(i)})}deleteDraft(i){this._recipesRepository.removeDraftRecipe(i.uuid),this.draft.update(e=>e.filter(r=>r?.uuid!==i.uuid))}RecipeScheme=k;static \u0275fac=function(e){return new(e||t)(x(w),x(X),x(Y),x(L))};static \u0275cmp=G({type:t,selectors:[["lg-recipes-list"]],features:[U([L])],decls:18,vars:15,consts:[["lgQuickActionsTpl",""],[3,"click","flat","size"],[3,"onDone","schema","storeName"],["lgImportRowTpl",""],[3,"center"],[2,"--card-bg","#bee5ff"],[3,"icon","link","size"],["aria-hidden","false","fontIcon","add"],["lgCardListItem",""],["lgExpand","",3,"routerLink"],[1,"text-muted","text-cursive"],[3,"click","size","icon"],["aria-hidden","false","fontIcon","close"],[3,"level"],[3,"onSelected","mode","selectAll","deselectAll"],["lgCardListItem","",3,"uuid"],[3,"routerLink"],[3,"size","link","flat"],["lgPull","",1,"text-muted","text-cursive"]],template:function(e,r){if(e&1&&(l(0,"lg-controls-bar"),C(1,be,2,5,"ng-template",0),v(2,"lg-selection-tools"),l(3,"lg-button",1),R("click",function(){return r.exportRecipes(r.selectionZoneService.selected())}),s(4),m(5,"translate"),a(),l(6,"lg-import",2),R("onDone",function(){return r.loadRecipes()}),C(7,Ee,2,1,"ng-template",3),a()(),l(8,"lg-fade-in")(9,"lg-container")(10,"lg-gap-row",4)(11,"lg-title"),s(12),m(13,"translate"),a()(),F(14,Fe,3,0,"lg-card-list",5),h(15,Pe,6,7,null,null,De,!1,Be,4,5,"lg-gap-row",4),a()()),e&2){let p;o(3),g("info"),c("flat",!0)("size","small"),o(),f(" ",d(5,11,"export-label")," "),o(2),c("schema",r.RecipeScheme)("storeName",r.Stores.RECIPES),o(4),c("center",!0),o(2),f(" ",d(13,13,"recipes.list-title")," "),o(2),O((p=r.draft())!=null&&p.length?14:-1),o(),b(r.recipes())}},dependencies:[re,pe,q,le,ee,te,ce,ae,de,me,ie,fe,_e,ge,ne,xe,oe,W],styles:["[_nghost-%COMP%]{display:block}"]})};export{Se as RecipesListComponent};
