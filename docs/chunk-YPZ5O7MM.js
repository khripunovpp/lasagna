import{a as et}from"./chunk-RMZDGAMA.js";import{a as Ze}from"./chunk-7D52QNW5.js";import{a as O}from"./chunk-5LVT5CIW.js";import{a as Ye}from"./chunk-YUP5JDQH.js";import{c as U}from"./chunk-OYLIQE4M.js";import{a as Xe}from"./chunk-VQVMM7PF.js";import{a as Je}from"./chunk-XOPEZG6I.js";import{a as Ke}from"./chunk-PQED3G77.js";import{a as $e,c as qe}from"./chunk-OJVUNIUU.js";import{a as Le}from"./chunk-XJ4QFZPO.js";import"./chunk-CWUUYJTE.js";import{a as Qe}from"./chunk-T6WLNLQD.js";import{a as D}from"./chunk-UKFGKW5Z.js";import{a as ke}from"./chunk-XYWRALA2.js";import{a as N}from"./chunk-FZG57PQR.js";import{a as Ve}from"./chunk-J2RZLNZG.js";import{a as je}from"./chunk-FMODVMJQ.js";import"./chunk-MPFUNZLY.js";import{a as We}from"./chunk-UEOYHVW7.js";import{e as Re,g as Ee,j as Ge}from"./chunk-YHID353M.js";import"./chunk-NIXUCLGK.js";import{C as Fe,I as A,J as Me,K as Ae,M as P,Q as Be,R as De,U as Ne,X as Ue,Y as B,d as lt,g as Se,ha as Oe,ma as ze,o as we,oa as He,q as M,r as Pe,v as Ie,z as Te}from"./chunk-JCWE4SYV.js";import{m as xe,p as ge,q as ye}from"./chunk-JNPSWS74.js";import{c as be}from"./chunk-CABIONZL.js";import"./chunk-EMIJRNYJ.js";import{f as fe,i as _e,m as ve,n as he}from"./chunk-FO7Q5A2R.js";import{$a as i,$b as L,Bc as u,Cc as m,Db as v,Dc as f,Eb as h,Ec as ue,Fb as Z,H as q,Hb as ee,Ib as te,Jb as p,Kb as l,Lb as o,Lc as g,Mb as w,Mc as se,Pb as ie,Pc as de,Qb as ne,Qc as me,Ub as V,Vb as d,Vc as Ce,Wb as ae,Xb as oe,Zb as H,_ as J,_b as Q,dc as le,ea as K,eb as y,ec as re,gc as ce,ic as r,jc as C,kc as _,la as W,lb as T,lc as b,ma as j,pa as X,qb as S,va as Y,vc as F,yc as pe}from"./chunk-7BND6AGV.js";import"./chunk-2RGDSI3Q.js";import"./chunk-FK6H3RFT.js";import{e as ot}from"./chunk-C6Q5SG76.js";var rt=["*"],z=class t{constructor(){}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=T({type:t,selectors:[["lg-table-card"]],ngContentSelectors:rt,decls:4,vars:1,consts:[[3,"flat"],[1,"table"],[1,"table__scroll"]],template:function(e,a){e&1&&(ae(),l(0,"lg-card",0)(1,"div",1)(2,"div",2),oe(3),o()()()),e&2&&p("flat",!0)},dependencies:[D],styles:[`:host{display:flex;width:100%}.table__scroll{overflow-x:auto}table{width:100%;border-collapse:collapse;--border-color: #efefef}table thead tr{border-bottom:1px solid var(--border-color)}table thead th{text-align:left;padding:16px 24px;opacity:.4;font-size:.8em}table tbody tr{border-bottom:1px solid var(--border-color)}table tbody tr:last-child{border-bottom:none}td{padding:16px 24px}
`],encapsulation:2})};var at=ot(lt());function pt(t,n){if(t&1&&w(0,"lg-unit-switcher",4)(1,"lg-unit-switcher",5),t&2){let e=d();p("items",e.additionalPriceType),i(),p("items",e.additionalPriceAction)}}function ut(t,n){if(t&1&&w(0,"lg-unit-switcher",6),t&2){let e=d(2);p("items",e.additionalPriceUnit)}}function st(t,n){t&1&&S(0,ut,1,1,"ng-template",3)}function dt(t,n){if(t&1&&(l(0,"b"),r(1),u(2,"currencySymbol"),o()),t&2){let e,a=d(2);i(),b("",m(2,2,a.userSettings().currency)," / ",(e=a.recipeCost())==null?null:e.outcomeUnit," ")}}function mt(t,n){t&1&&S(0,dt,3,4,"ng-template",3)}var G=class t{recipePriceAdditionsForm=new Ae({action:new P("add"),value:new P(0),unit:new P("currency"),type:new P("per_unit")});recipeCost=me();values=M(this.recipePriceAdditionsForm.valueChanges);userSettings=K(Oe);additionalPriceUnit=[{label:"$",value:"currency",style:"secondary"},{label:"%",value:"percent",style:"secondary"}];additionalPriceAction=[{label:"Add",value:"add",style:"secondary"},{label:"Round to",value:"round",style:"secondary"}];additionalPriceType=[{label:"Per unit",value:"per_unit",style:"secondary"},{label:"Total",value:"total",style:"secondary"}];onChanged=de();isMobile=O(768);showPriceAdditionUnits=g(()=>!0);roundActionSelected=g(()=>this.values()?.action==="round");onChangeFn=()=>{};changesEffect=se(()=>{this.onChangeFn(this.values())});registerOnChange(n){this.onChangeFn=n}registerOnTouched(n){}writeValue(n){this.recipePriceAdditionsForm.patchValue({action:n?.action||"add",value:n?.value||0,unit:n?.unit||"currency",type:n?.type||"per_unit"},{emitEvent:!1})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=T({type:t,selectors:[["lg-calculation-price-modifiers"]],inputs:{recipeCost:[1,"recipeCost"]},outputs:{onChanged:"onChanged"},features:[F([{provide:Fe,useExisting:J(()=>t),multi:!0}])],decls:5,vars:4,consts:[[3,"formGroup"],["formControlName","value","lgParseMath","","placeholder","extra price",3,"moveBeforeAbove"],["lgExtraTpl","","place","before"],["lgExtraTpl","","place","after"],["formControlName","type",3,"items"],["formControlName","action",3,"items"],["formControlName","unit",3,"items"]],template:function(e,a){e&1&&(l(0,"lg-flex-row",0)(1,"lg-number-input",1),S(2,pt,2,2,"ng-template",2),v(3,st,1,0,null,3),v(4,mt,1,0,null,3),o()()),e&2&&(p("formGroup",a.recipePriceAdditionsForm),i(),p("moveBeforeAbove",a.isMobile()),i(2),h(a.showPriceAdditionUnits()?3:-1),i(),h(a.roundActionSelected()?4:-1))},dependencies:[$e,qe,B,A,Me,De,Ne,Je,Le,et,N],styles:["[_nghost-%COMP%]{width:100%}"]})};var Ct=["priceChart"],ft=["weightChart"],_t=(t,n)=>[t,n];function vt(t,n){t&1&&ie(0)}function ht(t,n){if(t&1&&S(0,vt,1,0,"ng-container",17),t&2){d(2);let e=le(12);p("ngTemplateOutlet",e)}}function xt(t,n){if(t&1&&(r(0),u(1,"userCurrency")),t&2){let e,a=d(2);_(" ",f(1,1,(e=a.result())==null||e.calculation==null?null:e.calculation.pricePerUnit,"1.2-5")," ")}}function gt(t,n){if(t&1&&(r(0," > "),l(1,"span",18),r(2),u(3,"userCurrency"),o(),l(4,"span",19),r(5),u(6,"userCurrency"),o()),t&2){let e=d(2),a=e.totalPriceDifference();i(2),_(" ",f(3,4,e.totalPriceWithAdditions(),"1.2-2")," "),i(2),p("ngClass",a>0?"text-success":"text-danger"),i(),b(" (",a>0?"+":""," ",f(6,7,a,"1.2-2"),") ")}}function yt(t,n){if(t&1){let e=ne();l(0,"lg-flex-row",5)(1,"lg-flex-column",6)(2,"lg-card",7)(3,"lg-flex-row",8)(4,"div"),r(5),u(6,"translate"),o(),l(7,"b"),r(8),u(9,"number"),o()()(),l(10,"lg-flex-column",9)(11,"lg-card",7)(12,"lg-flex-row",8)(13,"div"),r(14),u(15,"translate"),l(16,"b"),r(17),o()(),l(18,"b"),v(19,ht,1,1,"ng-container")(20,xt,2,4),o()()(),w(21,"lg-flex-row",10),o(),l(22,"lg-flex-column",9)(23,"lg-card",7)(24,"lg-flex-row",8)(25,"div"),r(26),u(27,"translate"),o(),l(28,"b"),r(29),u(30,"userCurrency"),v(31,gt,7,10),o()()(),l(32,"lg-flex-column",11)(33,"div"),r(34),u(35,"translate"),o(),w(36,"lg-calculation-price-modifiers",12),o()()(),l(37,"lg-card",13)(38,"lg-flex-column",14)(39,"lg-title",15)(40,"div"),r(41),u(42,"translate"),o()(),l(43,"canvas",16,1),V("chartHover",function(s){W(e);let c=d();return j(c.onChartHover("price",s.event,s.active))}),o()()(),l(45,"lg-card",13)(46,"lg-flex-column",14)(47,"lg-title",15)(48,"div"),r(49),u(50,"translate"),o()(),l(51,"canvas",16,2),V("chartHover",function(s){W(e);let c=d();return j(c.onChartHover("weight",s.event,s.active))}),o()()()()}if(t&2){let e,a,s,c=d();p("center",!0)("mobileMode",!0),i(),p("position","stretch"),i(2),p("size","small")("relaxed",!0),i(2),C(m(6,40,"recipe.calculation.outcome.label")),i(3),b(" ",f(9,42,(e=c.result())==null||e.calculation==null?null:e.calculation.outcomeAmount,"1.0-2")," ",(e=c.result())==null||e.calculation==null?null:e.calculation.outcomeUnit," "),i(2),p("position","stretch"),i(2),p("size","small")("relaxed",!0),i(2),_(" ",m(15,45,"recipe.calculation.one-unit.label")," "),i(3),_(" ",(a=c.result())==null||a.calculation==null?null:a.calculation.outcomeUnit," "),i(2),h(c.notInGrams()?19:20),i(2),p("size","small")("relaxed",!0),i(),p("position","stretch"),i(2),p("size","small")("relaxed",!0),i(2),C(m(27,47,"recipe.calculation.total-price.label")),i(3),_(" ",f(30,49,c.totalPrice(),"1.2-2")," "),i(2),h(c.totalPriceDifference()?31:-1),i(),re("padding",c.isMobile()?"0":"0 16px"),p("position","stretch"),i(2),_(" ",m(35,52,"recipe.calculation.price-modifiers.title")," "),i(2),p("formControl",c.recipePriceAdditionsForm)("recipeCost",(s=c.result())==null?null:s.calculation),i(2),p("size","small"),i(),p("level",5),i(2),C(m(42,54,"recipe.calculation.price-chart")),i(2),p("data",c.doughnutChartData().prices)("options",c.doughnutChartOptions)("type",c.doughnutChartType),i(3),p("size","small"),i(),p("level",5),i(2),C(m(50,56,"recipe.calculation.weight-chart")),i(2),p("data",c.doughnutChartData().weight)("options",c.doughnutChartOptions)("type",c.doughnutChartType)}}function bt(t,n){if(t&1&&(r(0," > "),l(1,"span",18),r(2),u(3,"userCurrency"),o(),l(4,"span",19),r(5),u(6,"userCurrency"),o()),t&2){let e,a,s=d(3),c=((e=s.result())==null||e.calculation==null?null:e.calculation.pricePerUnitFromTotalDifference)??0;i(2),_(" ",f(3,4,(a=s.result())==null||a.calculation==null?null:a.calculation.pricePerUnitFromTotal,"1.2-2")," "),i(2),p("ngClass",c>0?"text-success":"text-danger"),i(),b(" (",c>0?"+":""," ",f(6,7,c,"1.2-2"),") ")}}function St(t,n){if(t&1&&(r(0),u(1,"userCurrency"),v(2,bt,7,10),r(3),u(4,"number"),u(5,"translate")),t&2){let e,a,s,c=d(2);_(" ",f(1,4,(e=c.result())==null||e.calculation==null?null:e.calculation.pricePerOutcomeUnit,"1.2-2")," "),i(2),h(!((a=c.result())==null||a.calculation==null)&&a.calculation.hasPriceDifference?2:-1),i(),b(" / ",f(4,7,(s=c.result())==null||s.calculation==null?null:s.calculation.weightForUnit,"1.0-2")," ",m(5,10,"recipe.calculation.gram")," ")}}function wt(t,n){if(t&1&&(r(0),u(1,"userCurrency")),t&2){let e,a=d(2);_(" ",f(1,1,(e=a.result())==null||e.calculation==null?null:e.calculation.totalPrice,"1.2-2")," ")}}function Pt(t,n){if(t&1&&v(0,St,6,12)(1,wt,2,4),t&2){let e=d();h(e.notInGrams()?0:1)}}function It(t,n){if(t&1&&(l(0,"a",26),r(1),o()),t&2){let e=d().$implicit;p("routerLink",pe(2,_t,e.type==="recipe-row"?"/recipes/edit/":"/products/edit/",e.uuid)),i(),_(" ",e.name," ")}}function Tt(t,n){if(t&1&&(r(0),u(1,"translate")),t&2){let e=d().$implicit;_(" ",m(1,1,e.name)," ")}}function Rt(t,n){if(t&1&&(l(0,"tr",19)(1,"td"),r(2),o(),l(3,"td",25)(4,"div",19),v(5,It,2,5,"a",26)(6,Tt,2,3),o()(),l(7,"td"),r(8),u(9,"number"),o(),l(10,"td"),r(11),o(),l(12,"td"),r(13),u(14,"userCurrency"),o(),l(15,"td"),r(16),u(17,"userCurrency"),o()()),t&2){let e=n.$implicit,a=n.$index;p("ngClass",e.type),i(2),C(a+1),i(2),p("ngClass","indent-"+e.indent),i(),h(e.type!=="total"?5:6),i(3),C(f(9,8,e.amount,"1.0-2")),i(3),C(e.unit),i(2),C(f(14,11,e.price_per_gram,"1.2-5")),i(3),C(f(17,14,e.total,"1.0-2"))}}function Et(t,n){if(t&1&&(l(0,"table")(1,"colgroup"),w(2,"col",20)(3,"col",21)(4,"col",22)(5,"col",23)(6,"col",22)(7,"col",24),o(),l(8,"thead")(9,"tr")(10,"th"),r(11,"#"),o(),l(12,"th"),r(13),u(14,"translate"),o(),l(15,"th"),r(16),u(17,"translate"),o(),l(18,"th"),r(19),u(20,"translate"),o(),l(21,"th"),r(22),u(23,"translate"),o(),l(24,"th"),r(25),u(26,"translate"),o()()(),l(27,"tbody"),ee(28,Rt,18,17,"tr",19,Z),o()()),t&2){let e,a=d();i(13),C(m(14,5,"recipe.calculation.table.name.title")),i(3),C(m(17,7,"recipe.calculation.table.amount.title")),i(3),C(m(20,9,"recipe.calculation.table.unit.title")),i(3),C(m(23,11,"recipe.calculation.table.price.title")),i(3),C(m(26,13,"recipe.calculation.table.total.title")),i(3),te((e=a.result())==null?null:e.table)}}function Ft(t,n){}var nt=class t{constructor(n,e,a,s,c,x,I){this._aRoute=n;this._calculateRecipeService=e;this._formTemplateService=a;this._injector=s;this._router=c;this._notificationService=x;this._analyticsService=I;this._aRoute.data.pipe(we()).subscribe(k=>{if(this.result.set(k.result),k.result){let R=k.result;this._analyticsService.trackRecipeCalculated(R.calculation?.recipe?.name,R.calculation?.outcomeAmount,{recipe_uuid:this.uuid(),total_price:R.calculation?.totalPrice,ingredients_count:R.calculation?.ingredients?.length||0,outcome_unit:R.calculation?.outcomeUnit})}let[E]=this.result()?.calculation?.recipe?.priceModifiers||[];this.recipePriceAdditionsForm.patchValue({action:E?.action||"add",unit:E?.unit||"gram",value:E?.value||0,type:E?.type||"per_unit"})})}doughnutChartType="pie";uuid=Pe("uuid");result=Y(null);doughnutChartData=g(()=>{let n=this.result(),{prices:e,weight:a,labels:s,colors:c}=n?.calculation?.ingredients?.reduce((x,I)=>(x.prices.push(I.totalPrice),x.weight.push(I.totalWeightGram),x.labels.push(I.generalName),x.colors.push(I.product_id?.ownColor??I.recipe_id?.ownColor??be()),x),{prices:[],weight:[],labels:[],colors:[]})||{prices:[],weight:[],labels:[],colors:[]};return{prices:{labels:s,datasets:[{label:"Cost",data:e,backgroundColor:c,borderWidth:0}]},weight:{labels:s,datasets:[{label:"Amount",data:a,backgroundColor:c,borderWidth:0}]},ingredients:n?.calculation?.ingredients||[]}});doughnutChartOptions={plugins:{legend:{display:!1}},onClick:(n,e,a)=>{}};chartPrices;chartWeight;recalculateTotalsModel=Ce(0);notInGrams=g(()=>this.result()?.calculation?.outcomeUnit&&this.result()?.calculation?.outcomeUnit!=="gram");recipePriceAdditionsForm=new P;values=M(this.recipePriceAdditionsForm.valueChanges);isMobile=O(768);totalScaleFactor=g(()=>this.recalculateTotalsModel()?this.recalculateTotalsModel()/(this.result()?.calculation?.outcomeAmount||1):1);totalPrice=g(()=>(this.result()?.calculation?.totalPrice||0)*this.totalScaleFactor());totalPriceDifference=g(()=>(this.result()?.calculation?.totalPriceDifference||0)*this.totalScaleFactor());totalPriceWithAdditions=g(()=>(this.result()?.calculation?.totalPriceWithAdditions||0)*this.totalScaleFactor());difference=at.difference;ngOnInit(){}ngAfterViewInit(){window.chartPrices=this.chartPrices,window.chartWeight=this.chartWeight,this.recipePriceAdditionsForm.valueChanges.pipe(q(300)).subscribe(n=>{this.updatePriceAdditions(n)})}onChartHover(n,e,a){if(!a?.length)return;let s=n==="price"?this.chartWeight:this.chartPrices,c=a[0].index;s?.chart?.update()}async updatePriceAdditions(n){try{await this._calculateRecipeService.updateRecipe({priceModifiers:[new Ie(n.action,n.unit,parseFloat(n.value)||0,n.type||"per_unit")]});let e=await this._calculateRecipeService.calculateRecipe(this.uuid());this.result.set(e)}catch(e){this._notificationService.error(Se(e))}}static \u0275fac=function(e){return new(e||t)(y(xe),y(Re),y(Ee),y(X),y(ge),y(ze),y(Xe))};static \u0275cmp=T({type:t,selectors:[["lg-calculate-recipe"]],viewQuery:function(e,a){if(e&1&&(H(Ct,5,U),H(ft,5,U)),e&2){let s;Q(s=L())&&(a.chartPrices=s.first),Q(s=L())&&(a.chartWeight=s.first)}},inputs:{recalculateTotalsModel:[1,"recalculateTotalsModel"]},outputs:{recalculateTotalsModel:"recalculateTotalsModelChange"},features:[F([Ge,he])],decls:16,vars:16,consts:[["totalAmount",""],["priceChart",""],["weightChart",""],[3,"center","mobileMode"],["lgSelfStart","",3,"flat","link","size"],["lgExpand","",2,"max-width","1200px",3,"center","mobileMode"],[3,"position"],["size","small"],[3,"size","relaxed"],["size","small",3,"position"],[2,"--control-bg","var(--hr-bg-strong)","padding","0 16px",3,"size","relaxed"],["size","small",2,"--control-bg","var(--hr-bg-strong)",3,"position"],[3,"formControl","recipeCost"],["lgWidth","270px","size","small"],[3,"size"],[3,"level"],["baseChart","",3,"chartHover","data","options","type"],[4,"ngTemplateOutlet"],[1,"text-underlined"],[3,"ngClass"],["span","1",2,"width","1%"],["span","1",2,"width","20%"],["span","1",2,"width","5%"],["span","1",2,"width","3%"],["span","1",2,"width","7%"],["width","200"],[3,"routerLink"]],template:function(e,a){if(e&1&&(l(0,"lg-fade-in")(1,"lg-container")(2,"lg-flex-column")(3,"lg-flex-row",3)(4,"lg-title"),r(5),u(6,"translate"),o(),l(7,"lg-button",4),r(8),u(9,"translate"),o()(),v(10,yt,53,58,"lg-flex-row",5),S(11,Pt,2,1,"ng-template",null,0,ue),l(13,"lg-table-card"),v(14,Et,30,15,"table")(15,Ft,0,0),o()()()()),e&2){let s,c,x;i(3),p("center",!0)("mobileMode",!0),i(2),b(" ",(s=a.result())==null||s.calculation==null?null:s.calculation.recipeName," ",m(6,12,"recipe.calculation.title.after-text")," "),i(2),ce("primary"),p("flat",!0)("link","/recipes/edit/"+((c=a.result())==null||c.calculation==null?null:c.calculation.recipeUuid))("size","small"),i(),_(" ",m(9,14,"edit-label")," "),i(2),h(!((x=a.result())==null||x.calculation==null)&&x.calculation.totalPrice?10:-1),i(4),h(a.result()?14:15)}},dependencies:[ke,We,z,fe,He,N,ve,Ue,A,ye,Ve,_e,je,U,D,Ye,Qe,Ze,Te,B,Be,G,Ke],styles:[`lg-number-input .lg-number-input{width:100px}
`],encapsulation:2})};export{nt as CalculateRecipeComponent};
