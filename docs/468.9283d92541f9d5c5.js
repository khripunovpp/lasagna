"use strict";(self.webpackChunklasagna=self.webpackChunklasagna||[]).push([[468],{3468:(q,p,c)=>{c.r(p),c.d(p,{AddRecipeComponent:()=>Z});var e=c(1007),f=c(5642),h=c(553),v=c(1086),l=c(9417),C=c(3333),x=c(7504);const R=["*"];function F(i,s){if(1&i&&(e.j41(0,"p",1),e.EFF(1),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.SpI(" ",t.label()," ")}}let j=(()=>{class i{constructor(){}label=(0,e.hFB)("");static \u0275fac=function(n){return new(n||i)};static \u0275cmp=e.VBU({type:i,selectors:[["lg-control-group"]],inputs:{label:[1,"label"]},ngContentSelectors:R,decls:4,vars:1,consts:[[1,"control-group"],[1,"control-group__label"],[1,"control-group__content"]],template:function(n,o){1&n&&(e.NAR(),e.j41(0,"div",0),e.DNE(1,F,2,1,"p",1),e.j41(2,"div",2),e.SdG(3),e.k0s()()),2&n&&(e.R7$(),e.vxM(o.label()?1:-1))},styles:["[_nghost-%COMP%]{display:flex;flex:1}.control-group[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:16px}.control-group__label[_ngcontent-%COMP%]{font-size:1.2rem;margin:0}.control-group__content[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:flex-end}.control-group__content[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{flex:1}"]})}return i})();var G=c(7782),m=c(1119);const b=["input"];let y=(()=>{class i{constructor(){}input;value="";placeholder=(0,e.hFB)("Enter text here");onChange=()=>{};onTouched=()=>{};writeValue(t){this.changeValue(t)}registerOnChange(t){this.onChange=t}focus(){this.input?.nativeElement.focus()}registerOnTouched(t){this.onTouched=t}changeValue(t){this.value=t,this.onChange(this.value)}onChangeInput(t){this.changeValue(t.target.value)}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=e.VBU({type:i,selectors:[["lg-textarea"]],viewQuery:function(n,o){if(1&n&&e.GBs(b,7),2&n){let r;e.mGM(r=e.lsd())&&(o.input=r.first)}},inputs:{placeholder:[1,"placeholder"]},features:[e.Jv_([{provide:l.kq,useExisting:i,multi:!0}])],decls:2,vars:2,consts:[["input",""],["rows","5",1,"textarea",3,"input","placeholder","value"]],template:function(n,o){if(1&n){const r=e.RV6();e.j41(0,"textarea",1,0),e.bIt("input",function(u){return e.eBV(r),e.Njj(o.onChangeInput(u))}),e.k0s()}2&n&&e.Y8G("placeholder",o.placeholder())("value",o.value)},dependencies:[l.YN],styles:["[_nghost-%COMP%]{display:flex;flex:1}.textarea[_ngcontent-%COMP%]{flex:1;border:none;border-radius:12px;padding:16px;background-color:var(--control-bg);font-family:inherit;font-size:inherit}.textarea[_ngcontent-%COMP%]::placeholder{color:var(--placeholder)}.textarea[_ngcontent-%COMP%]:focus{outline:none;box-shadow:var(--focus-shadow)}"]})}return i})();var A=c(152),I=c(8456),d=c(416),T=c(177),_=c(8536),k=c(9895);const V=["*",[["rowActions"]]],$=["*","rowActions"];let S=(()=>{class i{constructor(){}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=e.VBU({type:i,selectors:[["lg-controls-row"]],ngContentSelectors:$,decls:5,vars:0,consts:[[1,"controls-row"],[1,"controls-row__controls"],[1,"controls-row__actions"]],template:function(n,o){1&n&&(e.NAR(V),e.j41(0,"div",0)(1,"div",1),e.SdG(2),e.k0s(),e.j41(3,"div",2),e.SdG(4,1),e.k0s()())},styles:[":host{display:flex;gap:16px}.controls-row{width:100%;display:flex;align-items:flex-end;gap:16px;flex:1}.controls-row__controls,.controls-row__actions{display:flex;align-items:flex-end;gap:16px}.controls-row__controls{flex:1}.controls-row__actions{flex:0;white-space:nowrap}.controls-row__controls>*,.controls-row__actions>*{flex:1}\n"],encapsulation:2})}return i})();var w=c(9170),N=c(7480),E=c(5130),X=c(9512),g=c(1636),Y=c(2038);let B=(()=>{class i{_toast;constructor(t){this._toast=t}success(t){this._toast.success(t)}error(t){this._toast.error(t)}warning(t){this._toast.warning(t)}info(t){this._toast.info(t)}show(t){this._toast.show(t)}loading(t){this._toast.loading(t)}parseFormErrors(t){const n=[];for(const o in t.controls){const r=t.controls[o];(r instanceof l.gE||r instanceof l.Yp)&&n.push(...this.parseFormErrors(r)),r.errors&&n.push(...Object.entries(r.errors).map(([a,u])=>`${o}: ${a}`))}return n}static \u0275fac=function(n){return new(n||i)(e.KVO(Y.U_))};static \u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();const M=(i,s)=>(null==s.value.product_id?null:s.value.product_id.id)||s.value.name||s.value.amount;function P(i,s){if(1&i){const t=e.RV6();e.j41(0,"lg-gap-column",16)(1,"lg-control",21),e.qex(2,22),e.j41(3,"span",23),e.bIt("click",function(){e.eBV(t);const o=e.XpG().$index,r=e.XpG();return e.Njj(r.closeTextField(o))}),e.EFF(4,"Hide"),e.k0s(),e.bVm(),e.j41(5,"lg-input",5),e.bIt("onInputChanged",function(){e.eBV(t);const o=e.XpG().$index,r=e.sdS(6),a=e.XpG();return e.Njj(a.onIngredientSelected(r,o,["product_id","recipe_id"]))}),e.k0s()()()}2&i&&(e.Y8G("size","small"),e.R7$(5),e.Y8G("placeholder","Here you can write the name of the ingredient"))}function O(i,s){if(1&i){const t=e.RV6();e.j41(0,"lg-multiselect",29),e.bIt("onSelected",function(){e.eBV(t);const o=e.XpG(2).$index,r=e.sdS(6),a=e.XpG();return e.Njj(a.onIngredientSelected(r,o,["product_id","name"]))}),e.k0s()}2&i&&e.Y8G("resource","recipes")("autoLoad",!0)}function z(i,s){if(1&i){const t=e.RV6();e.j41(0,"lg-multiselect",30),e.bIt("onSelected",function(){e.eBV(t);const o=e.XpG(2).$index,r=e.sdS(6),a=e.XpG();return e.Njj(a.onIngredientSelected(r,o,["recipe_id","name"]))}),e.k0s()}2&i&&e.Y8G("resource","products")("autoLoad",!0)}function J(i,s){if(1&i){const t=e.RV6();e.j41(0,"lg-gap-column",16)(1,"lg-control"),e.qex(2,24),e.j41(3,"span",25),e.bIt("click",function(){e.eBV(t);const o=e.XpG().$index,r=e.XpG();return e.Njj(r.closeRecipeField(o))}),e.EFF(4," Product "),e.k0s(),e.bVm(),e.qex(5,26),e.j41(6,"span",25),e.bIt("click",function(){e.eBV(t);const o=e.XpG().$index,r=e.XpG();return e.Njj(r.openRecipeField(o))}),e.EFF(7,"Recipe"),e.k0s(),e.bVm(),e.qex(8,22),e.j41(9,"span",23),e.bIt("click",function(){e.eBV(t);const o=e.XpG().$index,r=e.XpG();return e.Njj(r.openTextField(o))}),e.EFF(10,"As text"),e.k0s(),e.bVm(),e.DNE(11,O,1,2,"lg-multiselect",27)(12,z,1,2,"lg-multiselect",28),e.k0s()()}if(2&i){const t=e.XpG().$index,n=e.XpG();e.Y8G("size","small"),e.R7$(3),e.Y8G("ngClass",n.recipeFieldState()[t]?"":"text-active text-bold"),e.R7$(3),e.Y8G("ngClass",n.recipeFieldState()[t]?"text-active text-bold":""),e.R7$(5),e.vxM(n.recipeFieldState()[t]?11:12)}}function L(i,s){if(1&i){const t=e.RV6();e.qex(0,14),e.j41(1,"lg-controls-row"),e.DNE(2,P,6,2,"lg-gap-column",16)(3,J,13,4,"lg-gap-column",16),e.j41(4,"lg-control",17)(5,"lg-number-input",18,1),e.bIt("onKeydown",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.addLast())}),e.k0s()(),e.nrm(7,"lg-buttons-group",19),e.qex(8,20),e.j41(9,"lg-button",15),e.bIt("click",function(){const o=e.eBV(t).$index,r=e.XpG();return e.Njj(r.deleteIngredient(o))}),e.EFF(10," Delete Ingredient "),e.k0s(),e.bVm(),e.k0s(),e.bVm()}if(2&i){const t=s.$index,n=e.XpG();e.Y8G("formGroupName",t),e.R7$(2),e.vxM(n.textFieldState()[t]?2:3),e.R7$(3),e.Y8G("placeholder","In "+((null==n.form.value.ingredients||null==n.form.value.ingredients[t]?null:n.form.value.ingredients[t].unit)||"gram")),e.R7$(2),e.Y8G("items",n.buttons),e.R7$(2),e.Aen("danger"),e.Y8G("size","small")}}function U(i,s){if(1&i){const t=e.RV6();e.j41(0,"lg-button",23),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.editRecipe(o.value))}),e.EFF(1," Edit Recipe "),e.k0s()}}function D(i,s){if(1&i){const t=e.RV6();e.j41(0,"lg-button",23),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.addRecipe(o.value))}),e.EFF(1," Add Recipe "),e.k0s()}}let K=(()=>{class i{_recipesRepository;_selectResourcesService;_router;_notificationsService;constructor(t,n,o,r){this._recipesRepository=t,this._selectResourcesService=n,this._router=o,this._notificationsService=r}form=new l.gE({name:new l.MJ(null,l.k0.required),description:new l.MJ(""),outcome_amount:new l.MJ(null),outcome_unit:new l.MJ(""),ingredients:new l.Yp([this._getIngredientGroup()])});uuid=(0,e.hFB)("");textFieldState=(0,e.vPA)({});recipeFieldState=(0,e.vPA)({});buttons=[{label:"Grams",value:"gram",style:"secondary",onClick:()=>{console.log("Grams")}},{label:"Pieces",value:"piece",style:"secondary",onClick:()=>{console.log("Piece")}}];uuidEffect=(0,e.QZP)(()=>{this.uuid()&&this._recipesRepository.getOne(this.uuid()).then(t=>{this.form.reset({...t,ingredients:[]}),this.form.get("ingredients").clear(),t?.ingredients.forEach((n,o)=>{this.ingredients.push(this._getIngredientGroup(n)),n.recipe_id&&this.openRecipeField(o),n.name&&this.openTextField(o)}),this.form.updateValueAndValidity()})});get ingredients(){return this.form.get("ingredients")}get value(){return this.form.value}get _values(){return(0,_.rY)((0,_.rh)(this.form.value))}get _formValid(){return this.form.valid&&!this.checkCycleRecipe(this.form.value.ingredients,this.uuid())}addLast(){const t=this.ingredients.at(this.ingredients.length-1);(t.value.name||t.value.amount||t.value.product_id)&&this.addIngredient()}ngOnInit(){this.form.valueChanges.pipe((0,A.B)(100)).subscribe({next:t=>{this.checkCycleRecipe(t.ingredients,this.uuid())&&this._notificationsService.error("You cannot add a recipe to itself"),console.log(t)}})}ngAfterViewInit(){this._selectResourcesService.load().then(t=>{})}addIngredient(){this.ingredients.push(this._getIngredientGroup())}deleteIngredient(t){this.ingredients.removeAt(t)}addRecipe(t){this._formValid?this._recipesRepository.addRecipe(this._values).then(()=>{this._router.navigate(["/recipes"])}):this._notificationsService.error(this._notificationsService.parseFormErrors(this.form).join(", "))}editRecipe(t){this._formValid?this._recipesRepository.editRecipe(this.uuid(),this._values).then(()=>{this._router.navigate(["/recipes"])}).catch(n=>{console.error(n)}):this._notificationsService.error(this._notificationsService.parseFormErrors(this.form).join(", "))}onIngredientSelected(t,n,o){t.focus();const r=this.ingredients.at(n).value;console.log({value:r}),this.ingredients.at(n).patchValue({...Array.isArray(o)?o.reduce((u,W)=>({...u,[W]:null}),{}):{[o]:null},unit:r.product_id?.unit||r.recipe_id?.unit||"gram"})}openTextField(t){this.textFieldState.update(n=>({...n,[t]:!0}))}closeTextField(t){this.textFieldState.update(n=>({...n,[t]:!1}))}openRecipeField(t){this.recipeFieldState.update(n=>({...n,[t]:!0}))}closeRecipeField(t){this.recipeFieldState.update(n=>({...n,[t]:!1}))}checkCycleRecipe(t,n){let o=!1;for(const r of t){const a=r.recipe_id?.uuid;if(a&&a===n){o=!0;break}}return o}_getIngredientGroup(t){return new l.gE({name:new l.MJ(t?.name),amount:new l.MJ(t?.amount?.toString()??null),product_id:new l.MJ(t?.product_id?{uuid:t.product_id}:null),recipe_id:new l.MJ(t?.recipe_id?{uuid:t.recipe_id}:null),unit:new l.MJ(t?.unit??"gram")},n=>{if(!(n.value.product_id||n.value.name||n.value.recipe_id||parseInt(n.value.amount)))return null;if((n.value.product_id||n.value.name||n.value.recipe_id)&&!parseInt(n.value.amount))return{ingredientAmountRequired:!0};if(!this.uuid)return null;const o=this.uuid();return this.checkCycleRecipe([n.value],o)?{cycleRecipe:!0}:n.value.product_id||n.value.name||n.value.recipe_id?null:{ingredientRequired:!0}})}static \u0275fac=function(n){return new(n||i)(e.rXU(X.m),e.rXU(d.n),e.rXU(g.Ix),e.rXU(B))};static \u0275cmp=e.VBU({type:i,selectors:[["lg-add-recipe-form"]],inputs:{uuid:[1,"uuid"]},features:[e.Jv_([{provide:d.n,useClass:d.n}])],decls:21,vars:11,consts:[["desc",""],["amount",""],[3,"formGroup"],[3,"position"],["label","Name","lgExpand",""],["formControlName","name",3,"onInputChanged","placeholder"],["label","Description","lgExpand",""],["formControlName","description",3,"placeholder"],["lgExpand",""],["label","Amount of the outcome","lgExpand",""],["formControlName","outcome_amount",3,"placeholder"],["formControlName","outcome_unit",3,"items"],["label","Ingredients","lgExpand",""],["formArrayName","ingredients","lgExpand",""],[3,"formGroupName"],[3,"click","size"],[3,"size"],["label","Amount"],["lsParseMath","","formControlName","amount",3,"onKeydown","placeholder"],["formControlName","unit",3,"items"],["ngProjectAs","rowActions",5,["rowActions"]],["label","Name"],["ngProjectAs","endLabelTpl",5,["endLabelTpl"]],[3,"click"],["ngProjectAs","labelTpl",5,["labelTpl"]],[3,"click","ngClass"],["ngProjectAs","afterLabelTpl",5,["afterLabelTpl"]],["formControlName","recipe_id",3,"resource","autoLoad"],["formControlName","product_id",3,"resource","autoLoad"],["formControlName","recipe_id",3,"onSelected","resource","autoLoad"],["formControlName","product_id",3,"onSelected","resource","autoLoad"]],template:function(n,o){if(1&n){const r=e.RV6();e.j41(0,"form",2)(1,"lg-gap-column",3)(2,"lg-control",4)(3,"lg-input",5),e.bIt("onInputChanged",function(){e.eBV(r);const u=e.sdS(6);return e.Njj(u.focus())}),e.k0s()(),e.j41(4,"lg-control",6),e.nrm(5,"lg-textarea",7,0),e.k0s(),e.j41(7,"lg-controls-row",8)(8,"lg-control",9),e.nrm(9,"lg-number-input",10,1),e.k0s(),e.nrm(11,"lg-buttons-group",11),e.k0s(),e.j41(12,"lg-control-group",12)(13,"lg-gap-column",3)(14,"lg-gap-column",13),e.Z7z(15,L,11,7,"ng-container",14,M),e.k0s(),e.j41(17,"lg-button",15),e.bIt("click",function(){return e.eBV(r),e.Njj(o.addIngredient())}),e.EFF(18," Add Ingredient "),e.k0s()()(),e.DNE(19,U,2,0,"lg-button")(20,D,2,0,"lg-button"),e.k0s()()}2&n&&(e.Y8G("formGroup",o.form),e.R7$(),e.Y8G("position","start"),e.R7$(2),e.Y8G("placeholder","Your recipe name"),e.R7$(2),e.Y8G("placeholder","Describe your recipe, how to make it, what to pay attention to, etc."),e.R7$(4),e.Y8G("placeholder",o.form.value.outcome_unit||"Here you can write the amount of the outcome (e.g. 100, 12, etc.)"),e.R7$(2),e.Y8G("items",o.buttons),e.R7$(2),e.Y8G("position","start"),e.R7$(2),e.Dyx(o.ingredients.controls),e.R7$(2),e.Aen("success"),e.Y8G("size","small"),e.R7$(2),e.vxM(o.uuid()?19:20))},dependencies:[l.X1,l.qT,l.BC,l.cb,l.j4,l.JD,l.$R,l.v8,C.S,x.X,j,G.K,m.Q,y,I.$,k.N,S,w.A,T.YU,N.t,E.i],encapsulation:2})}return i})();var H=c(7512);function Q(i,s){if(1&i&&(e.j41(0,"lg-button",2),e.EFF(1," Calculate "),e.k0s()),2&i){const t=e.XpG();e.Aen("primary"),e.Y8G("flat",!0)("link","/calc-recipe/"+t.uuid())("size","small")}}let Z=(()=>{class i{_aRoute;constructor(t){this._aRoute=t}uuid=(0,e.vPA)("");ngOnInit(){this._aRoute.params.subscribe(t=>{this.uuid.set(t.uuid)})}static \u0275fac=function(n){return new(n||i)(e.rXU(g.nX))};static \u0275cmp=e.VBU({type:i,selectors:[["app-add-recipe"]],decls:9,vars:9,consts:[[3,"center"],[3,"flat","link","size","style"],[3,"flat","link","size"],[3,"uuid"]],template:function(n,o){1&n&&(e.j41(0,"lg-container")(1,"lg-gap-row",0)(2,"lg-title"),e.EFF(3),e.k0s(),e.DNE(4,Q,2,5,"lg-button",1),e.j41(5,"lg-button",2),e.EFF(6," Back to list "),e.k0s()(),e.j41(7,"lg-card"),e.nrm(8,"lg-add-recipe-form",3),e.k0s()()),2&n&&(e.R7$(),e.Y8G("center",!0),e.R7$(2),e.SpI("",o.uuid()?"Edit":"Add"," Recipe"),e.R7$(),e.vxM(o.uuid()?4:-1),e.R7$(),e.Aen("warning"),e.Y8G("flat",!0)("link","/recipes")("size","small"),e.R7$(3),e.Y8G("uuid",o.uuid()))},dependencies:[f.H,h.i,v.W,K,m.Q,H.I],encapsulation:2})}return i})()}}]);