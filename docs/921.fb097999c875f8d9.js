"use strict";(self.webpackChunklasagna=self.webpackChunklasagna||[]).push([[921],{553:(A,p,o)=>{o.d(p,{i:()=>g});var t=o(1007);const _=["*"];let g=(()=>{class c{constructor(){}flat=(0,t.hFB)(!1);static \u0275fac=function(a){return new(a||c)};static \u0275cmp=t.VBU({type:c,selectors:[["lg-card"]],inputs:{flat:[1,"flat"]},ngContentSelectors:_,decls:2,vars:2,consts:[[1,"card"]],template:function(a,i){1&a&&(t.NAR(),t.j41(0,"div",0),t.SdG(1),t.k0s()),2&a&&t.AVh("flat",i.flat())},styles:["[_nghost-%COMP%]{display:flex;width:100%}.card[_ngcontent-%COMP%]{background-color:#fff;padding:24px;border-radius:32px;margin:10px;width:100%}.card.flat[_ngcontent-%COMP%]{padding:0}"]})}return c})()},1086:(A,p,o)=>{o.d(p,{W:()=>g});var t=o(1007);const _=["*"];let g=(()=>{class c{level=(0,t.vPA)(1);static \u0275fac=function(a){return new(a||c)};static \u0275cmp=t.VBU({type:c,selectors:[["lg-title"]],ngContentSelectors:_,decls:2,vars:0,consts:[["role","heading",1,"title"]],template:function(a,i){1&a&&(t.NAR(),t.j41(0,"p",0),t.SdG(1),t.k0s())},styles:[".title[_ngcontent-%COMP%]{font-size:1.5em;font-weight:700;margin:0}"]})}return c})()},1091:(A,p,o)=>{o.r(p),o.d(p,{CalculateRecipeComponent:()=>E});var t=o(1007),_=o(5642),g=o(1086),c=o(553);const w=["*"];let s=(()=>{class r{constructor(){}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=t.VBU({type:r,selectors:[["lg-table-card"]],ngContentSelectors:w,decls:2,vars:1,consts:[[3,"flat"]],template:function(n,d){1&n&&(t.NAR(),t.j41(0,"lg-card",0),t.SdG(1),t.k0s()),2&n&&t.Y8G("flat",!0)},dependencies:[c.i],styles:[":host{display:flex;width:100%}table{width:100%;border-collapse:collapse;--border-color: #efefef}table thead tr{border-bottom:1px solid var(--border-color)}table thead th{text-align:left;padding:16px 24px}table tbody tr{border-bottom:1px solid var(--border-color)}table tbody tr:last-child{border-bottom:none}td{padding:16px 24px}\n"],encapsulation:2})}return r})();var a=o(5554),i=o(467),h=o(9512),C=o(7201);let y=(()=>{class r{_recipeRepository;_productRepository;constructor(e,n){this._recipeRepository=e,this._productRepository=n}calculation;calculateRecipe(e){var n=this;return new Promise(function(){var d=(0,i.A)(function*(m,F){const R=[];let l=0,v=0;yield n._recipeRepository.getOne(e,function(){var k=(0,i.A)(function*(f){const{table:u,totalAmount:j,totalWeight:b}=yield n._makeIngredientTable(f);l+=j||0,v+=b||0,R.push(...u),R.push(n._makeTotal(l,v)),m({recipe:f,result:R,total:l})});return function(f){return k.apply(this,arguments)}}())});return function(m,F){return d.apply(this,arguments)}}())}_makeRecipeSubTable(e){var n=this;return(0,i.A)(function*(){return new Promise(function(){var d=(0,i.A)(function*(m,F){const R=[];let l=0,v=0;yield n._recipeRepository.getOne(e.recipe_id,function(){var k=(0,i.A)(function*(f){const u=yield n._makeIngredientTable(f);R.push(n._makeRecipeCaption({name:f.name,quantity:u.totalWeight,price_per_gram:u.totalAmount/u.totalWeight,amount:u.totalWeight,total:u.totalAmount})),R.push(...u.table),v+=u.totalAmount,l+=u.totalWeight,m({table:R,totalAmount:v,totalWeight:l})});return function(f){return k.apply(this,arguments)}}())});return function(m,F){return d.apply(this,arguments)}}())})()}_makeIngredientTable(e){var n=this;const d=[];let m=0,F=0;return Promise.all(e.ingredients.map(function(){var R=(0,i.A)(function*(l){const v=l.recipe_id,k=l.product_id,f=l.name;if(v||k||f)if(v){const u=yield n._makeRecipeSubTable(l);d.push(...u.table),F+=u.totalAmount,m+=u.totalWeight}else k?yield n._productRepository.getOne(l.product_id,function(){var j=(0,i.A)(function*(b){if(!b?.price||!b?.amount)return;const O=b.price/b.amount,D=O*l.amount;d.push(n._makeRow({name:b.name,quantity:b.amount,price_per_gram:O,amount:l.amount,total:D})),F+=D,m+=+l.amount});return function(b){return j.apply(this,arguments)}}()):f&&(d.push(n._makeRow({name:l.name,quantity:void 0,price_per_gram:void 0,amount:l.amount,total:void 0})),m+=+l.amount)});return function(l){return R.apply(this,arguments)}}())).then(()=>({table:d,totalAmount:F,totalWeight:m}))}_makeRow(e){return{name:e.name,quantity:e.quantity,price_per_gram:parseFloat(e.price_per_gram?.toFixed(5)??"0"),amount:e.amount,total:parseFloat(e.total?.toFixed(5)??"0"),unit:"g"}}_makeCaption(e){return{name:e,quantity:void 0,unit:void 0,price_per_gram:void 0,amount:void 0,total:void 0}}_makeRecipeCaption(e){return{name:e.name,quantity:e.quantity,price_per_gram:parseFloat(e.price_per_gram.toFixed(5)),amount:e.amount,total:parseFloat(e.total.toFixed(2)),unit:"g"}}_makeTotal(e,n){return{name:"Total",amount:n,unit:"g",price_per_gram:parseFloat((e/n).toFixed(5)),quantity:void 0,total:parseFloat(e.toFixed(2))}}static \u0275fac=function(n){return new(n||r)(t.KVO(h.m),t.KVO(C.d))};static \u0275prov=t.jDH({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function x(r,T){if(1&r&&(t.j41(0,"tr")(1,"td"),t.EFF(2),t.k0s(),t.j41(3,"td"),t.EFF(4),t.k0s(),t.j41(5,"td"),t.EFF(6),t.k0s(),t.j41(7,"td"),t.EFF(8),t.k0s(),t.j41(9,"td"),t.EFF(10),t.k0s()()),2&r){const e=T.$implicit;t.R7$(2),t.JRh(e.name),t.R7$(2),t.JRh(e.amount),t.R7$(2),t.JRh(e.unit),t.R7$(2),t.JRh(e.price_per_gram),t.R7$(2),t.JRh(e.total)}}function S(r,T){if(1&r&&(t.j41(0,"table")(1,"thead")(2,"tr")(3,"th"),t.EFF(4,"Name"),t.k0s(),t.j41(5,"th"),t.EFF(6,"Amount"),t.k0s(),t.j41(7,"th"),t.EFF(8,"Unit"),t.k0s(),t.j41(9,"th"),t.EFF(10,"Price per gram"),t.k0s(),t.j41(11,"th"),t.EFF(12,"Total"),t.k0s()()(),t.j41(13,"tbody"),t.Z7z(14,x,11,5,"tr",null,t.Vm6),t.k0s()()),2&r){let e;const n=t.XpG();t.R7$(14),t.Dyx(null==(e=n.result())?null:e.result)}}function P(r,T){1&r&&(t.j41(0,"div"),t.EFF(1,"Loading..."),t.k0s())}let E=(()=>{class r{_aRoute;_calculateRecipeService;constructor(e,n){this._aRoute=e,this._calculateRecipeService=n}uuid=(0,t.vPA)("");result=(0,t.vPA)(null);ngOnInit(){this._aRoute.params.subscribe(e=>{this.uuid.set(e.uuid),this._calculateRecipeService.calculateRecipe(e.uuid).then(n=>{this.result.set(n)})})}static \u0275fac=function(n){return new(n||r)(t.rXU(a.nX),t.rXU(y))};static \u0275cmp=t.VBU({type:r,selectors:[["lg-calculate-recipe"]],decls:6,vars:1,template:function(n,d){1&n&&(t.j41(0,"lg-container")(1,"lg-title"),t.EFF(2,"Calculate Recipe"),t.k0s(),t.j41(3,"lg-table-card"),t.DNE(4,S,16,0,"table")(5,P,2,0,"div"),t.k0s()()),2&n&&(t.R7$(4),t.vxM(d.result()?4:5))},dependencies:[_.H,g.W,s],encapsulation:2})}return r})()},5559:(A,p,o)=>{o.d(p,{Q:()=>g});var t=o(467),_=o(1007);let g=(()=>{class c{constructor(){}get _uuid(){return Math.random().toString(36).substring(2)+Date.now().toString(36)}openDb(s){return new Promise(function(){var a=(0,t.A)(function*(i,h){const C=yield window.indexedDB.open("lasagna-db",1);C.onerror=y=>{h(y)},C.onsuccess=y=>{s(y.target?.result)},C.onupgradeneeded=y=>{const x=y.target?.result;x.createObjectStore("productsStore",{keyPath:"uuid",autoIncrement:!0}).createIndex("name","name",{unique:!1}),x.createObjectStore("recipesStore",{keyPath:"uuid",autoIncrement:!0}).createIndex("name","name",{unique:!1}),x.createObjectStore("categoryStore",{keyPath:"uuid",autoIncrement:!0}).createIndex("name","name",{unique:!1})},i()});return function(i,h){return a.apply(this,arguments)}}())}addData(s,a){this.openDb(i=>{i.transaction(s,"readwrite").objectStore(s).add({...a,uuid:this._uuid})})}replaceData(s,a,i){this.openDb(h=>{h.transaction(s,"readwrite").objectStore(s).put({...i,uuid:a})})}getOne(s,a,i){this.openDb(h=>{h.transaction(s,"readonly").objectStore(s).get(a).onsuccess=S=>{i(S.target.result)}})}static \u0275fac=function(a){return new(a||c)};static \u0275prov=_.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}return c})()},5642:(A,p,o)=>{o.d(p,{H:()=>g});var t=o(1007);const _=["*"];let g=(()=>{class c{static \u0275fac=function(a){return new(a||c)};static \u0275cmp=t.VBU({type:c,selectors:[["lg-container"]],ngContentSelectors:_,decls:2,vars:0,consts:[[1,"container"]],template:function(a,i){1&a&&(t.NAR(),t.j41(0,"section",0),t.SdG(1),t.k0s())},styles:["[_nghost-%COMP%]{display:flex;height:100%;padding:0 32px}.container[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:0 auto;width:100vw;max-width:1920px;gap:16px}"]})}return c})()}}]);