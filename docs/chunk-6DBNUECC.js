import{a as at,b as pt,c as mt,d as st,e as ut,f as D,g as _t,h as Ct}from"./chunk-CVEEDAJ2.js";import{a as dt}from"./chunk-PRC2TUST.js";import{a as rt,c as ct}from"./chunk-ILBTCWXJ.js";import{a as nt}from"./chunk-KBNI6SUZ.js";import{b as lt}from"./chunk-KVV4HYGD.js";import"./chunk-KSHXEBR5.js";import{b as ft}from"./chunk-SIPVOCOP.js";import{a as et}from"./chunk-AVXGYE4I.js";import{a as A,b as K,c as L}from"./chunk-WIBKF556.js";import{a as W}from"./chunk-W227WBY4.js";import"./chunk-BBWM53XJ.js";import{a as ot}from"./chunk-AHEQBTWV.js";import"./chunk-4KMY27TT.js";import{a as X,c as it}from"./chunk-CPI3FXNZ.js";import"./chunk-2DQNHQVY.js";import{a as tt}from"./chunk-HL6AWMYV.js";import{a as Y}from"./chunk-GFLX5G5M.js";import"./chunk-SNDQO5FA.js";import{a as J}from"./chunk-LN6FDTLB.js";import{s as H}from"./chunk-WGXVQ5TO.js";import{j as q}from"./chunk-CPBCMYDO.js";import{Ab as c,Bb as T,Fb as F,Ib as x,Jb as m,P as N,Sa as o,Vb as l,Wb as I,X as j,Xa as f,Xb as s,Yb as h,Z as C,ab as z,ac as U,ea as w,fa as b,fb as g,gc as k,hc as G,ic as Q,k as $,la as V,nb as p,q as E,qb as P,s as M,tb as u,ub as _,vb as B,xb as S,yb as y,zb as r}from"./chunk-KOVCW6OE.js";import"./chunk-DELOOZDJ.js";import{f as Z}from"./chunk-2WH2EVR6.js";var gt=new j("CategorizedProductsList",{factory:()=>{let e=C(L),i=C(W);return $(e.loadRecipes()).pipe(N(()=>e.products$)).pipe(E(n=>n.toSorted((a,d)=>a.name.localeCompare(d.name))),E(n=>dt(n,"category_id")),M(n=>Z(void 0,null,function*(){let a=[];for(let v in n){let R=n[v],vt=yield i.getOne(v);a.push({category:vt?.name,products:R})}if(!a.length)return[];let[d,...O]=a.toSorted((v,R)=>v.category>R.category?1:-1);return d?.category?[d].concat(O):O.concat([d])})))}});var Pt=(e,i)=>i==null?null:i.category,St=(e,i)=>i==null?null:i.createdAt;function yt(e,i){e&1&&(r(0,"lg-button",6),T(1,"mat-icon",7),c()),e&2&&(P("success"),p("icon",!0)("link","/products/add")("size","medium"))}function Tt(e,i){if(e&1&&(r(0,"span"),l(1),c()),e&2){let t=m(2).$implicit;o(),s("from ",t.source)}}function It(e,i){if(e&1&&(r(0,"span"),l(1),c(),r(2,"span"),l(3),c(),u(4,Tt,2,1,"span")),e&2){let t=m().$implicit;o(),I(t.name),o(2),h("",t.amount,"gr for ",t.price),o(),_(t.source?4:-1)}}function Lt(e,i){if(e&1&&(r(0,"span"),l(1),c()),e&2){let t=m(2).$implicit;o(),s("from ",t==null?null:t.source)}}function Dt(e,i){if(e&1&&(r(0,"span"),l(1),c(),r(2,"span"),l(3),c(),u(4,Lt,2,1,"span")),e&2){let t=m().$implicit;o(),I(t==null?null:t.name),o(2),h("",t==null?null:t.amount," gr for ",t==null?null:t.price),o(),_(t!=null&&t.source?4:-1)}}function Rt(e,i){if(e&1&&u(0,It,5,4)(1,Dt,5,4),e&2){let t=i.flow;_(t==="new"?0:1)}}function Et(e,i){e&1&&l(0," Unsaved existing product: ")}function wt(e,i){e&1&&l(0," Draft product: ")}function bt(e,i){if(e&1&&(r(0,"a",9)(1,"lg-gap-row",5)(2,"div"),u(3,Et,1,0)(4,wt,1,0),l(5),c(),r(6,"div"),l(7),k(8,"timeAgo"),c()()()),e&2){let t=m().$implicit;p("routerLink","/products/draft/"+(t==null?null:t.uuid)),o(),p("center",!0),o(2),_(!(t==null||t.meta==null)&&t.meta.uuid?3:4),o(2),s(" ",(t==null||t.data==null?null:t.data.name)??""," "),o(2),s("Created at: ",G(8,5,t==null?null:t.createdAt))}}function Ft(e,i){e&1&&g(0,bt,9,7,"ng-template",8)}function ht(e,i){if(e&1&&(r(0,"lg-card-list",4),S(1,Ft,1,0,null,8,St),c()),e&2){let t=m();o(),y(t.draft())}}function kt(e,i){e&1&&l(0," per gram ")}function At(e,i){if(e&1&&l(0),e&2){let t=m(2).$implicit;s(" per ",t.unit," ")}}function Ot(e,i){if(e&1){let t=F();r(0,"lg-gap-row",5)(1,"div",13)(2,"lg-gap-row",5)(3,"div",14)(4,"a",9),l(5),c()(),r(6,"div",15),l(7),c(),r(8,"div",16),l(9),k(10,"number"),u(11,kt,1,0)(12,At,1,1),c()()(),r(13,"lg-button",17),x("click",function(){w(t);let a=m().$implicit,d=m(2);return b(d.deleteProduct(a))}),T(14,"mat-icon",18),c()()}if(e&2){let t=m().$implicit,n=m(2);p("center",!0),o(2),p("center",!0),o(2),p("routerLink","/products/edit/"+t.uuid),o(),I(t.name),o(2),s(" ",t.source??""),o(2),s(" ",Q(10,11,n.getPricePerGram(t),"1.2-5")," "),o(2),_(!t.unit||t.unit==="gram"?11:12),o(2),P("danger"),p("size","tiny")("icon",!0)}}function Zt(e,i){if(e&1&&g(0,Ot,15,14,"ng-template",12),e&2){let t=i.$implicit;p("uuid",t.uuid)}}function $t(e,i){if(e&1){let t=F();r(0,"lg-title",10),l(1),c(),r(2,"lg-card-list",11),x("onSelected",function(a){w(t);let d=m();return b(d.selectionZoneService.putSelected(a))}),S(3,Zt,1,1,null,12,B),c()}if(e&2){let t=i.$implicit,n=m();p("level",3),o(),s(" ",(t==null?null:t.category)||"Uncategorized"," "),o(),p("mode",n.selectionZoneService.selectionMode())("selectAll",n.selectionZoneService.selectAll())("deselectAll",n.selectionZoneService.deselectAll()),o(),y(t.products)}}function Mt(e,i){e&1&&(r(0,"lg-gap-row",5)(1,"lg-title",10),l(2," No products found "),c()()),e&2&&(p("center",!0),o(),p("level",5))}var xt=class e{constructor(i,t,n,a,d){this._productsRepository=i;this._csvReaderService=t;this._transferDataService=n;this._notificationsService=a;this.selectionZoneService=d}products=lt(C(gt));draft=V([]);ProductDbInputScheme=K;Stores=J;getPricePerGram(i){return(A(i.price)||1)/(A(i.amount)||1)}exportProducts(i){this._transferDataService.exportTable("productsStore","json",{selected:Array.from(i)})}deleteProduct(i){i.uuid&&this._productsRepository.deleteProduct(i.uuid).then(()=>{this._notificationsService.success("Product deleted"),this.loadProducts()})}ngOnInit(){this.loadProducts();let i=this._productsRepository.getDraftProducts();i&&this.draft.set(i)}loadProducts(){this._productsRepository.loadRecipes()}static \u0275fac=function(t){return new(t||e)(f(L),f(pt),f(Ct),f(ft),f(D))};static \u0275cmp=z({type:e,selectors:[["lg-product-list"]],features:[U([D])],decls:15,vars:8,consts:[["lgQuickActionsTpl",""],[3,"click","flat","size"],[3,"onDone","schema","storeName"],["lgImportRowTpl",""],[2,"--card-bg","#bee5ff"],[3,"center"],[3,"icon","link","size"],["aria-hidden","false","fontIcon","add"],["lgCardListItem",""],[3,"routerLink"],[3,"level"],[3,"onSelected","mode","selectAll","deselectAll"],["lgCardListItem","",3,"uuid"],[1,"expand"],[2,"flex","20%"],[2,"flex","10%"],[2,"flex","70%"],[3,"click","size","icon"],["aria-hidden","false","aria-label","Example home icon","fontIcon","close"]],template:function(t,n){if(t&1&&(r(0,"lg-controls-bar"),g(1,yt,2,5,"ng-template",0),T(2,"lg-selection-tools"),r(3,"lg-button",1),x("click",function(){return n.exportProducts(n.selectionZoneService.selected())}),l(4," Export "),c(),r(5,"lg-import",2),x("onDone",function(){return n.loadProducts()}),g(6,Rt,2,1,"ng-template",3),c()(),r(7,"lg-fade-in")(8,"lg-container")(9,"lg-title"),l(10," Products "),c(),u(11,ht,3,0,"lg-card-list",4),S(12,$t,5,5,null,null,Pt,!1,Mt,3,2,"lg-gap-row",5),c()()),t&2){let a;o(3),P("info"),p("flat",!0)("size","small"),o(2),p("schema",n.ProductDbInputScheme)("storeName",n.Stores.PRODUCTS),o(6),_((a=n.draft())!=null&&a.length?11:-1),o(),y(n.products())}},dependencies:[it,ot,nt,X,Y,q,ct,rt,mt,H,at,tt,ut,st,_t,et],styles:["[_nghost-%COMP%]{display:block}"]})};export{xt as ProductListComponent};
