import{a as te}from"./chunk-Q6WCP435.js";import{a as Z,b as $,c as ee}from"./chunk-4JTWFCUF.js";import{a as Y}from"./chunk-MSELENGE.js";import{a as X}from"./chunk-O7EDKFI5.js";import{a as Q}from"./chunk-JXHZXNSN.js";import{a as K}from"./chunk-BWGYIJEG.js";import{a as J}from"./chunk-C737TW6Q.js";import{a as U}from"./chunk-7P2DAV6F.js";import{a as G,b}from"./chunk-CBPIWMMR.js";import{a as H}from"./chunk-4EGTEAFI.js";import{a as v}from"./chunk-72REWZLE.js";import"./chunk-SNDQO5FA.js";import{a as D,d as N,m as O,p as z}from"./chunk-AGDD4VEX.js";import"./chunk-33U52G7J.js";import"./chunk-5KSZNU56.js";import"./chunk-KAGJE7I3.js";import"./chunk-XVI445TZ.js";import{f as A,j as q,r as L,u as j}from"./chunk-XFMMXZ22.js";import"./chunk-LOPFG4AH.js";import"./chunk-D66Q4FT5.js";import"./chunk-652DFWNF.js";import"./chunk-JDBIU23B.js";import{Cb as n,Db as i,Eb as _,Ib as x,Lb as f,Mb as l,Va as r,Zb as u,_a as g,_b as F,bc as C,cc as h,db as y,dc as w,ec as I,ga as p,ha as m,na as S,qb as d,uc as V,wb as W,wc as E,xb as B,yc as T,zc as P}from"./chunk-CG2HRCOU.js";import"./chunk-DELOOZDJ.js";import{a as M,f as R}from"./chunk-2WH2EVR6.js";function re(a,t){if(a&1){let e=x();n(0,"lg-gap-column",0)(1,"lg-control",6)(2,"lg-input",4),w("ngModelChange",function(o){p(e);let s=l(2);return h(s.product.name,o)||(s.product.name=o),m(o)}),i()(),n(3,"lg-control",6)(4,"lg-number-input",4),w("ngModelChange",function(o){p(e);let s=l(2);return h(s.product.amount,o)||(s.product.amount=o),m(o)}),i()(),n(5,"lg-control",6)(6,"lg-number-input",4),w("ngModelChange",function(o){p(e);let s=l(2);return h(s.product.price,o)||(s.product.price=o),m(o)}),i(),n(7,"div"),u(8),i()(),n(9,"lg-button",7),f("click",function(){p(e);let o=l(2);return m(o.addProduct())}),u(10,"Add product"),i()()}if(a&2){let e=l(2);d("size","medium"),r(),d("label","Name"),r(),C("ngModel",e.product.name),d("placeholder","Name"),r(),d("label","Amount"),r(),C("ngModel",e.product.amount),d("placeholder","Amount"),r(),d("label","Price"),r(),C("ngModel",e.product.price),d("placeholder","Price"),r(2),F(e.product.unit)}}function ae(a,t){if(a&1){let e=x();_(0,"video",2),n(1,"lg-gap-column")(2,"lg-gap-row",3)(3,"lg-input",4),w("ngModelChange",function(o){p(e);let s=l();return h(s.barcode,o)||(s.barcode=o),m(o)}),i(),n(4,"lg-button",5),f("click",function(){p(e);let o=l();return m(o.onBarcodeManualInput())}),u(5,"Search"),i(),n(6,"lg-button",5),f("click",function(){p(e);let o=l();return m(o.clear())}),u(7,"Clear"),i()(),W(8,re,11,11,"lg-gap-column",0),i()}if(a&2){let e=l();r(3),C("ngModel",e.barcode),d("placeholder","Barcode"),r(5),B(e.showProductForm()&&e.productResult()?8:-1)}}function ce(a,t){if(a&1){let e=x();n(0,"lg-button",5),f("click",function(){p(e);let o=l();return m(o.openScanner())}),u(1,"Scan"),i()}}var k=class a{constructor(t,e,c,o){this._openFoodFactsService=t;this._arcodeReaderService=e;this._productRepository=c;this._notificationService=o}productAdded=T();barcode=S("");product={name:"",price:0,amount:0,unit:"gram"};lockRequest=!1;showFormInitially=P(!1);showScanerInitially=P(!1);showScanner=S(!1);showProductForm=S(!1);userResource=E({request:()=>({id:this.barcode()}),loader:({request:t,abortSignal:e})=>this.lockRequest||!t.id?Promise.resolve(null):(this._notificationService.info("Barcode detected: "+t.id),this.lockRequest=!0,this._openFoodFactsService.getProductByBarcode(t.id).then(c=>(this.showProductForm.set(!0),c)))});productResult=V(()=>{let t=this.userResource.value();if(t?.status===1){let e=t.product;return this.product.name=(e.product_name||"")+" ("+(e.brands||"")+")",this.product.amount=this.extractAmount(e),this.product.unit=this.detectUnit(e),M({},this.product)}return null});onBarcodeManualInput(){this.lockRequest=!1}openScanner(){this.showScanner.set(!0),this.startCamera()}clear(){this.barcode.set(""),this.product={name:"",price:0,amount:0,unit:"gram"},this.showProductForm.set(!1),this.lockRequest=!1}closeScanner(){this.showScanner.set(!1),this.stopCamera()}extractAmount(t){if(t.quantity){let e=t.quantity.match(/\d+/);return e?+e[0]:0}return 0}stopCamera(){this._arcodeReaderService.stopCamera()}detectUnit(t){let e=(t.serving_quantity_unit||"").toLowerCase();return e.includes("g")||e.includes("ml")?"gram":e.includes("pc")||e.includes("\u0448\u0442")?"piece":"gram"}addProduct(){this._productRepository.addOne(D.fromRaw({name:this.product.name,price:this.product.price,amount:this.product.amount,unit:this.product.unit,source:"openfoodfacts",category_id:"",tags:[],createdAt:Date.now()})).then(t=>{this.productAdded.emit({uuid:t,name:this.product.name}),this.product={name:"",price:0,amount:0,unit:"gram"},this.barcode.set(""),this.lockRequest=!1})}startCamera(){return this._arcodeReaderService.startCamera("video",t=>{t&&this.barcode.set(t)})}ngAfterViewInit(){return R(this,null,function*(){this.showScanerInitially()&&(this.showScanner.set(!0),yield this.startCamera())})}static \u0275fac=function(e){return new(e||a)(g(O),g(N),g(z),g(j))};static \u0275cmp=y({type:a,selectors:[["lg-barcode-add-product-widget"]],inputs:{showFormInitially:[1,"showFormInitially"],showScanerInitially:[1,"showScanerInitially"]},outputs:{productAdded:"productAdded"},features:[I([])],decls:6,vars:4,consts:[[3,"size"],[3,"top","mobileMode"],["id","video"],["lgExpand",""],["lgExpand","","lgParseMath","",3,"ngModelChange","ngModel","placeholder"],[3,"click"],[3,"label"],["lgShrink","",3,"click"]],template:function(e,c){e&1&&(n(0,"lg-gap-column",0)(1,"lg-title"),u(2," \u{1F4F7} Scan barcode or enter manually "),i(),n(3,"lg-gap-row",1),W(4,ae,9,3)(5,ce,2,0,"lg-button"),i()()),e&2&&(d("size","medium"),r(3),d("top",!0)("mobileMode",!0),r(),B(c.showScanner()?4:5))},dependencies:[L,A,q,J,X,v,K,Q,$,b,Z,Y,ee],encapsulation:2})};var oe=class a{static \u0275fac=function(e){return new(e||a)};static \u0275cmp=y({type:a,selectors:[["lg-widgets-page"]],decls:9,vars:1,consts:[[3,"center"]],template:function(e,c){e&1&&(n(0,"lg-fade-in")(1,"lg-container")(2,"lg-gap-row",0)(3,"lg-title"),u(4," Widgets "),i()(),n(5,"lg-card"),_(6,"lg-barcode-add-product-widget"),i(),n(7,"lg-card"),_(8,"lg-eggs-widget"),i()()()),e&2&&(r(2),d("center",!0))},dependencies:[te,G,b,v,U,k,H],encapsulation:2})};export{oe as WidgetsPageComponent};
