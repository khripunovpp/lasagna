import{a as xe,b as Se,c as ve,d as Q,e as U,f as ye,g as l,h as De,i as Te,j as he}from"./chunk-LF3B4HND.js";import"./chunk-4UP3VRXZ.js";import{a as Re}from"./chunk-UOPYIIM6.js";import{a as ge}from"./chunk-C7Y4XD5I.js";import{a as $,c as H}from"./chunk-UKASGQDE.js";import{b as Ce}from"./chunk-UL2AXCZQ.js";import"./chunk-6B5WCZG7.js";import{a as P}from"./chunk-STTED64W.js";import{a as Ie}from"./chunk-S5HI73SL.js";import{a as G}from"./chunk-V2E2AQQX.js";import{a as j}from"./chunk-MQJWIQ3W.js";import"./chunk-KNGN5IJR.js";import"./chunk-XIO6VEU6.js";import{a as _e,b as N}from"./chunk-E6C4JVEO.js";import{a as ue}from"./chunk-6IJ5CQKN.js";import{a as fe}from"./chunk-3KK5VW3S.js";import"./chunk-SNDQO5FA.js";import{c as se,j as Z,o as D,p as de,r as I}from"./chunk-3CKL574A.js";import"./chunk-WAPO4JPN.js";import"./chunk-5KSZNU56.js";import"./chunk-LXGI5QAA.js";import{b as me}from"./chunk-TWZFER64.js";import{u as M}from"./chunk-BEK46ZVO.js";import"./chunk-2SENDHZQ.js";import{s as z,w as B}from"./chunk-4S3SNKRC.js";import"./chunk-652DFWNF.js";import"./chunk-O377EGFO.js";import{$ as h,$b as F,Ab as b,Bb as L,Cb as a,Db as c,Eb as T,Ib as C,Lb as x,Mb as s,R as ie,Va as r,Yb as m,Z as ne,Zb as W,_a as v,_b as S,db as k,dc as O,ec as pe,fc as ae,ga as u,ha as g,ib as y,jc as d,k as ee,kc as _,lc as ce,na as oe,pb as re,q as E,qb as p,s as te,tb as R,wb as A,xb as V,yb as le}from"./chunk-TBUBSNFD.js";import"./chunk-DELOOZDJ.js";import{f as Y}from"./chunk-2WH2EVR6.js";var be=new ne("CategorizedRecipesList",{factory:()=>{let t=h(I),i=h(me);return ee(t.loadRecipes()).pipe(ie(()=>t.recipes$),E(o=>o.map(n=>n.toDTO()))).pipe(E(o=>o.toSorted((n,f)=>n.name.localeCompare(f.name))),E(o=>Re(o,"category_id")),te(o=>Y(void 0,null,function*(){let n=[];for(let w in o){let K=o[w],Ee=yield i.getOne(w);n.push({category:Ee?.toString(),recipes:K.map(ke=>se.fromRaw(ke))})}if(!n.length)return[];let[f,...X]=n.toSorted((w,K)=>w.category>K.category?1:-1);return f?.category?[f].concat(X):X.concat([f])})))}});var Le=l.object({name:l.string(),amount:l.number().or(l.string()),uuid:l.string().optional(),product_id:Te,recipe_id:l.lazy(()=>q),unit:l.enum(["gram","portion","piece"])});var q=l.object({name:l.string(),uuid:l.string().optional(),description:l.string(),ingredients:l.array(l.lazy(()=>Le)),outcome_unit:De,outcome_amount:l.number().or(l.string()),taxTemplateName:l.string().optional(),category_id:l.string().nullable().optional(),createdAt:l.union([l.string(),l.number()]).optional(),updatedAt:l.union([l.string(),l.number()]).optional(),tags:l.array(l.string()).optional(),color:l.string().optional()});var Fe=t=>({length:t}),Oe=(t,i)=>i.uuid;function ze(t,i){if(t&1){let e=C();a(0,"lg-button",4),x("click",function(){u(e);let n=s(2);return g(n.selectionZoneService.onSelection())}),m(1),d(2,"translate"),c()}t&2&&(R("success"),p("flat",!0)("size","small"),r(),S(" ",_(2,5,"select-many-label")," "))}function Be(t,i){if(t&1){let e=C();a(0,"lg-button",4),x("click",function(){u(e);let n=s(2);return g(n.deleteAllDrafts())}),m(1," Delete all "),c()}t&2&&(R("danger"),p("flat",!0)("size","small"))}function Ze(t,i){if(t&1){let e=C();a(0,"lg-button",5),x("click",function(){u(e);let n=s(3);return g(n.deletedSelectedDrafts())}),m(1," Delete selected "),c()}if(t&2){let e=s();R("danger"),p("flat",!0)("disabled",!(e.draft!=null&&e.draft.size))("size","small")}}function Me(t,i){t&1&&y(0,Ze,2,5,"ng-template",1)}function Pe(t,i){t&1&&(m(0),d(1,"translate")),t&2&&S(" ",_(1,1,"draft.list-prefix.existing")," ")}function Ne(t,i){t&1&&(m(0),d(1,"translate")),t&2&&S(" ",_(1,1,"draft.list-prefix.new")," ")}function je(t,i){if(t&1){let e=C();a(0,"lg-gap-row",6)(1,"a",7),A(2,Pe,2,3)(3,Ne,2,3),m(4),c(),a(5,"small",8),m(6),d(7,"translate"),d(8,"timeAgo"),c(),a(9,"lg-button",9),x("click",function(){u(e);let n=s().$implicit,f=s(2);return g(f.deleteDraft(n))}),T(10,"mat-icon",10),c()()}if(t&2){let e=s().$implicit;p("center",!0),r(),p("routerLink","/recipes/draft/"+(e==null?null:e.uuid)),r(),V(!(e==null||e.meta==null)&&e.meta.uuid?2:3),r(2),S(" ",(e==null||e.data==null?null:e.data.name)??""," "),r(2),F(" ",_(7,10,"edited-at-label")," ",_(8,12,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," "),r(3),R("danger"),p("size","tiny")("icon",!0)}}function Ge(t,i){if(t&1&&y(0,je,11,14,"ng-template",3),t&2){let e=i.$implicit;p("uuid",e.uuid)}}function $e(t,i){if(t&1){let e=C();a(0,"lg-expander",0),d(1,"translate"),d(2,"translate"),a(3,"lg-inline-separated-group"),y(4,ze,3,7,"ng-template",1)(5,Be,2,4,"ng-template",1),A(6,Me,1,0,null,1),c(),a(7,"lg-card-list",2),x("onSelected",function(n){u(e);let f=s();return g(f.selectionZoneService.putSelected(n))}),b(8,Ge,1,1,null,3,Oe),c()()}if(t&2){let e,o,n=s();p("closeLabel",_(1,6,"drafts-close-label"))("openLabel",ce(2,8,"drafts-label",ae(11,Fe,(e=n.drafts())==null?null:e.length))),r(6),V((o=n.selectionZoneService.selected())?6:-1,o),r(),p("mode",n.selectionZoneService.selectionMode())("selectAll",n.selectionZoneService.selectAll().draft)("deselectAll",n.selectionZoneService.deselectAll().draft),r(),L(n.drafts())}}var J=class t{constructor(i,e,o){this._recipesRepository=i;this._notificationsService=e;this.selectionZoneService=o}drafts=oe([]);Stores=B;get hidden(){return this.drafts()?.length===0?!0:null}ngOnInit(){let i=this._recipesRepository.getDraftRecipe();i&&this.drafts.set(i)}deleteAllDrafts(){this._recipesRepository.removeDraftMany(this.drafts().map(i=>i.uuid)).then(()=>{this.drafts.set([]),this._notificationsService.success("Drafts deleted")})}deletedSelectedDrafts(){let i=this.selectionZoneService.selected().draft;i&&this._recipesRepository.removeDraftMany(Array.from(i)).then(()=>{this.drafts.update(e=>e.filter(o=>!i.has(o.uuid))),this._notificationsService.success("Drafts deleted")})}deleteDraft(i){this._recipesRepository.removeDraftRecipe(i.uuid),this.drafts.update(e=>e.filter(o=>o?.uuid!==i.uuid))}static \u0275fac=function(e){return new(e||t)(v(I),v(M),v(D))};static \u0275cmp=k({type:t,selectors:[["lg-draft-recipes-list"]],hostVars:1,hostBindings:function(e,o){e&2&&re("hidden",o.hidden)},features:[O([D])],decls:1,vars:1,consts:[[3,"closeLabel","openLabel"],["lgInlineSeparatedGroup",""],[2,"--card-bg","#bee5ff",3,"onSelected","mode","selectAll","deselectAll"],["lgCardListItem","","type","draft",3,"uuid"],[3,"click","flat","size"],[3,"click","flat","disabled","size"],[3,"center"],["lgExpand","",3,"routerLink"],[1,"text-muted","text-cursive"],[3,"click","size","icon"],["aria-hidden","false","fontIcon","close"]],template:function(e,o){if(e&1&&A(0,$e,10,13,"lg-expander",0),e&2){let n;V((n=o.drafts())!=null&&n.length?0:-1)}},dependencies:[N,j,G,H,$,z,P,Ie,Z,he,U,Q],encapsulation:2})};var He=()=>["recipe"],Qe=(t,i)=>i==null?null:i.category;function Ue(t,i){if(t&1){let e=C();a(0,"lg-button",5),x("click",function(){u(e);let n=s();return g(n.exportRecipes(n.selectionZoneService.selected().recipe))}),m(1),d(2,"translate"),c()}t&2&&(R("info"),p("flat",!0)("size","small"),r(),S(" ",_(2,5,"export-label")," recipes "))}function qe(t,i){if(t&1&&(a(0,"span"),m(1),c()),t&2){let e=i.$implicit;r(),W(e==null?null:e.name)}}function Je(t,i){if(t&1){let e=C();a(0,"lg-import",6),d(1,"translate"),x("onDone",function(){u(e);let n=s();return g(n.loadRecipes())}),y(2,qe,2,1,"ng-template",7),c()}if(t&2){let e=s();p("label",_(1,3,"import-label")+" products")("schema",e.RecipeScheme)("storeName",e.Stores.RECIPES)}}function Ke(t,i){if(t&1){let e=C();a(0,"lg-gap-row",3)(1,"a",11),m(2),c(),a(3,"lg-button",12),m(4),d(5,"translate"),c(),a(6,"small",13),m(7),d(8,"translate"),d(9,"timeAgo"),c(),a(10,"lg-button",14),x("click",function(){u(e);let n=s().$implicit,f=s(2);return g(f.deleteRecipe(n))}),T(11,"mat-icon",15),c()()}if(t&2){let e=s().$implicit;p("center",!0),r(),p("routerLink","/recipes/edit/"+e.uuid),r(),W(e.name),r(),R("primary"),p("size","small")("link","/recipes/calculate/"+e.uuid)("flat",!0),r(),S(" ",_(5,15,"recipes.calculate-btn")," "),r(3),F(" ",_(8,17,"edited-at-label")," ",_(9,19,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," "),r(3),R("danger"),p("size","tiny")("icon",!0)}}function We(t,i){if(t&1&&y(0,Ke,12,21,"ng-template",10),t&2){let e=i.$implicit;p("uuid",e.uuid)}}function Xe(t,i){if(t&1){let e=C();a(0,"lg-title",8),m(1),d(2,"translate"),c(),a(3,"lg-card-list",9),x("onSelected",function(n){u(e);let f=s();return g(f.selectionZoneService.putSelected(n))}),b(4,We,1,1,null,10,le),c()}if(t&2){let e=i.$implicit,o=s();p("level",3),r(),S(" ",(e==null?null:e.category)||_(2,5,"without-category-label")," "),r(2),p("mode",o.selectionZoneService.selectionMode())("selectAll",o.selectionZoneService.selectAll().recipe)("deselectAll",o.selectionZoneService.deselectAll().recipe),r(),L(e.recipes)}}function Ye(t,i){t&1&&(a(0,"lg-gap-row",3)(1,"lg-title",8),m(2),d(3,"translate"),c()()),t&2&&(p("center",!0),r(),p("level",5),r(),S(" ",_(3,3,"no-recipes")," "))}var we=class t{constructor(i,e,o,n){this._recipesRepository=i;this._notificationsService=e;this._transferDataService=o;this.selectionZoneService=n}recipes=Ce(h(be));Stores=B;RecipeScheme=q;ngOnInit(){this.loadRecipes()}deleteRecipe(i){return i.uuid?this._recipesRepository.deleteOne(i.uuid).then(()=>{this.loadRecipes(),this._notificationsService.success("Recipe deleted")}):Promise.resolve()}loadRecipes(){this._recipesRepository.loadRecipes()}exportRecipes(i){this._transferDataService.exportTable("recipesStore","json",{selected:Array.from(i||[])})}static \u0275fac=function(e){return new(e||t)(v(I),v(M),v(de),v(D))};static \u0275cmp=k({type:t,selectors:[["lg-recipes-list"]],features:[O([D])],decls:17,vars:12,consts:[[3,"icon","link","size"],["aria-hidden","false","fontIcon","add"],["lgInlineSeparatedGroup",""],[3,"center"],[3,"selectionTypes"],[3,"click","flat","size"],[3,"onDone","label","schema","storeName"],["lgImportRowTpl",""],[3,"level"],[3,"onSelected","mode","selectAll","deselectAll"],["lgCardListItem","","type","recipe",3,"uuid"],[3,"routerLink"],[3,"size","link","flat"],["lgPull","",1,"text-muted","text-cursive"],[3,"click","size","icon"],["aria-hidden","false","fontIcon","close"]],template:function(e,o){e&1&&(a(0,"lg-controls-bar")(1,"lg-button",0),T(2,"mat-icon",1),c(),a(3,"lg-inline-separated-group"),y(4,Ue,3,7,"ng-template",2)(5,Je,3,5,"ng-template",2),c()(),a(6,"lg-fade-in")(7,"lg-container")(8,"lg-gap-row",3)(9,"lg-title"),m(10),d(11,"translate"),c()(),T(12,"lg-draft-recipes-list")(13,"lg-selection-tools",4),b(14,Xe,6,7,null,null,Qe,!1,Ye,4,5,"lg-gap-row",3),c()()),e&2&&(r(),R("success"),p("icon",!0)("link","/recipes/add")("size","medium"),r(7),p("center",!0),r(2),S(" ",_(11,9,"recipes.list-title")," "),r(3),p("selectionTypes",pe(11,He)),r(),L(o.recipes()))},dependencies:[N,j,z,G,_e,fe,H,$,Se,xe,ue,ve,ye,P,ge,Z,J,U,Q],styles:["[_nghost-%COMP%]{display:block}"]})};export{we as RecipesListComponent};
