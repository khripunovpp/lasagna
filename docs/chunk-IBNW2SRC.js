import{b as g}from"./chunk-234JSS2H.js";import{M as s,P as n,f as d,k as m}from"./chunk-7BPNVVWP.js";var f={products:{name:"products",loaderConfig:{name:"indexDb",storeName:"productsStore"}},categories:{name:"categories",loaderConfig:{name:"indexDb",storeName:"categoryStore"}},recipes:{name:"recipes",loaderConfig:{name:"indexDb",storeName:"recipesStore"}},taxTemplates:{name:"taxTemplates",loaderConfig:{name:"localStorage",key:"template-tax"},transform:t=>t||[]}};var c=class t{constructor(e){this._indexDb=e}load(e){return this._indexDb.getAll(e)}static \u0275fac=function(r){return new(r||t)(n(g))};static \u0275prov=s({token:t,factory:t.\u0275fac,providedIn:"root"})};var l=class t{constructor(){}load(e){if(!e)throw new Error("Localstorage name is required");return new Promise((r,i)=>{let o=localStorage.getItem(e);if(o)try{let a=JSON.parse(o);r(a)}catch(a){i(a)}else r([])})}static \u0275fac=function(r){return new(r||t)};static \u0275prov=s({token:t,factory:t.\u0275fac,providedIn:"root"})};var p=class t{constructor(e,r){this._indexDbSelectLoaderService=e;this._localstorageSelectLoaderService=r}_registry=new Map;_registry$=new m(new Map);register(e){if(this._registry.has(e))return;let r=f[e];if(!r)throw new Error(`SelectResource ${e} not found`);this._registry.set(r.name,{name:r.name,list:[],lists:{},loader:{load:()=>r.loaderConfig?.name==="localStorage"?this._localstorageSelectLoaderService.load(r.loaderConfig?.key):this._indexDbSelectLoaderService.load(r.loaderConfig?.storeName)}})}get(e){return this._registry.get(e)}load(e){let r=e||Array.from(this._registry.keys());return Promise.all(r.map(i=>d(this,null,function*(){let o=this.get(i),a=yield o.loader.load(o.name);Array.isArray(a)?o.list=a:o.lists=a}))).then(()=>r.reduce((i,o)=>(i[o]=this.get(o),i),{})).then(()=>{console.log("SelectResourcesService loaded",this._registry),this._registry$.next(this._registry)})}subscribe(e){return this._registry$.subscribe(e)}static \u0275fac=function(r){return new(r||t)(n(c,8),n(l,8))};static \u0275prov=s({token:t,factory:t.\u0275fac})};export{p as a};
