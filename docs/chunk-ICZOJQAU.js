import{a as Ve}from"./chunk-XGYLWNA3.js";import{a as ke}from"./chunk-R5HZ2CHP.js";import{a as Oe}from"./chunk-HXFWMFTO.js";import{c as B}from"./chunk-AD2SMGJQ.js";import"./chunk-GALYHWJT.js";import{a as Ee}from"./chunk-T4SSLVVO.js";import{a as je}from"./chunk-GFQWPUAR.js";import{a as Ge,c as We}from"./chunk-FCRDCL5R.js";import{a as ze}from"./chunk-B4BPCK6P.js";import"./chunk-CWUUYJTE.js";import"./chunk-FK6H3RFT.js";import{a as Ne}from"./chunk-GFKJ3IXC.js";import{a as M}from"./chunk-ZL6WWUML.js";import{a as Fe}from"./chunk-VQHUADFJ.js";import{a as Me}from"./chunk-IVWGGHZS.js";import{a as Ae}from"./chunk-OIONDWIZ.js";import{c as Re}from"./chunk-BJIJ7REJ.js";import{a as De}from"./chunk-I27O3RKJ.js";import"./chunk-MPFUNZLY.js";import{a as Be}from"./chunk-Q75E6UIP.js";import{G as he,H as ge,I as ve,K as E,L as ye,P as be,S as Se,U as we,V as Te,X as Ie,Z as Pe,ca as Ue,f as se,n as me,o as Ce,p as _e,w as fe,y as xe}from"./chunk-7ZBWBQCU.js";import{m as ce,p as pe,q as ue}from"./chunk-3NSY2Z6P.js";import{c as de}from"./chunk-CABIONZL.js";import"./chunk-EMIJRNYJ.js";import{f as ae,i as le,m as oe,n as re}from"./chunk-HDEG74LV.js";import{$b as N,Bc as p,Cb as h,Cc as f,Dc as x,Eb as g,Ec as ie,Fb as O,G as z,Hb as k,Ib as V,Jb as u,Kb as o,Lb as r,Lc as v,Mb as P,Pb as H,Qb as Q,Ub as F,Vb as s,Vc as ne,Wb as L,Xb as q,Zb as A,_a as i,_b as U,da as G,db as S,dc as $,fc as J,gc as K,ic as c,jc as _,ka as w,kb as I,kc as m,la as T,lc as R,nc as X,oa as W,oc as Y,pb as y,pc as Z,ua as j,vc as ee,yc as te}from"./chunk-NHWKWTII.js";import"./chunk-2RGDSI3Q.js";import"./chunk-C6Q5SG76.js";var qe=["*"],D=class t{constructor(){}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=I({type:t,selectors:[["lg-table-card"]],ngContentSelectors:qe,decls:4,vars:1,consts:[[3,"flat"],[1,"table"],[1,"table__scroll"]],template:function(e,l){e&1&&(L(),o(0,"lg-card",0)(1,"div",1)(2,"div",2),q(3),r()()()),e&2&&u("flat",!0)},dependencies:[M],styles:[`:host{display:flex;width:100%}.table__scroll{overflow-x:auto}table{width:100%;border-collapse:collapse;--border-color: #efefef}table thead tr{border-bottom:1px solid var(--border-color)}table thead th{text-align:left;padding:16px 24px;opacity:.4;font-size:.8em}table tbody tr{border-bottom:1px solid var(--border-color)}table tbody tr:last-child{border-bottom:none}td{padding:16px 24px}
`],encapsulation:2})};var $e=["priceChart"],Je=["weightChart"],Ke=(t,a)=>[t,a];function Xe(t,a){t&1&&H(0)}function Ye(t,a){if(t&1&&y(0,Xe,1,0,"ng-container",20),t&2){s(2);let e=$(12);u("ngTemplateOutlet",e)}}function Ze(t,a){if(t&1&&(c(0),p(1,"userCurrency")),t&2){let e,l=s(2);m(" ",x(1,1,(e=l.result())==null||e.calculation==null?null:e.calculation.pricePerUnit,"1.2-5")," ")}}function et(t,a){if(t&1&&P(0,"lg-unit-switcher",21),t&2){let e=s(2);u("items",e.additionalPriceAction)}}function tt(t,a){if(t&1&&P(0,"lg-unit-switcher",22),t&2){let e=s(3);u("items",e.additionalPriceUnit)}}function it(t,a){t&1&&y(0,tt,1,1,"ng-template",13)}function nt(t,a){if(t&1&&(o(0,"b"),c(1),p(2,"currencySymbol"),r()),t&2){let e,l=s(3);i(),R("",f(2,2,l.userSettings().currency)," / ",(e=l.result())==null||e.calculation==null?null:e.calculation.outcomeUnit," ")}}function at(t,a){t&1&&y(0,nt,3,4,"ng-template",13)}function lt(t,a){if(t&1&&(o(0,"span",23),c(1),p(2,"userCurrency"),r(),o(3,"span",24),c(4),p(5,"userCurrency"),r()),t&2){let e=s(2);i(),m(" > ",x(2,2,e.totalPriceWithAdditions(),"1.2-2")," "),i(3),m(" (+ ",x(5,5,e.totalPriceDifference(),"1.2-2"),") ")}}function ot(t,a){t&1&&c(0," Recalculate for ")}function rt(t,a){if(t&1&&(o(0,"b"),c(1),r()),t&2){let e,l=s(3);i(),m(" ",(e=l.result())==null||e.calculation==null?null:e.calculation.outcomeUnit," ")}}function ct(t,a){t&1&&y(0,rt,2,1,"ng-template",13)}function pt(t,a){if(t&1){let e=Q();o(0,"lg-gap-row",5)(1,"lg-gap-column",6)(2,"lg-card",7)(3,"lg-gap-row",8)(4,"div"),c(5),p(6,"translate"),r(),o(7,"b"),c(8),p(9,"number"),r()()(),o(10,"lg-gap-column",9)(11,"lg-card",7)(12,"lg-gap-row",8)(13,"div"),c(14),p(15,"translate"),o(16,"b"),c(17),r()(),o(18,"b"),h(19,Ye,1,1,"ng-container")(20,Ze,2,4),r()()(),o(21,"lg-gap-row",10)(22,"lg-number-input",11),y(23,et,1,1,"ng-template",12),h(24,it,1,0,null,13),h(25,at,1,0,null,13),r()()(),o(26,"lg-gap-column",9)(27,"lg-card",7)(28,"lg-gap-row",8)(29,"div"),c(30),p(31,"translate"),r(),o(32,"b"),c(33),p(34,"userCurrency"),h(35,lt,6,8),r()()(),o(36,"lg-gap-row",14)(37,"lg-number-input",15),Z("ngModelChange",function(n){w(e);let d=s();return Y(d.recalculateTotalsModel,n)||(d.recalculateTotalsModel=n),T(n)}),y(38,ot,1,0,"ng-template",12),h(39,ct,1,0,null,13),r()()()(),o(40,"lg-card",16)(41,"lg-gap-column",17)(42,"lg-title",18)(43,"div"),c(44),p(45,"translate"),r()(),o(46,"canvas",19,1),F("chartHover",function(n){w(e);let d=s();return T(d.onChartHover("price",n.event,n.active))}),r()()(),o(48,"lg-card",16)(49,"lg-gap-column",17)(50,"lg-title",18)(51,"div"),c(52),p(53,"translate"),r()(),o(54,"canvas",19,2),F("chartHover",function(n){w(e);let d=s();return T(d.onChartHover("weight",n.event,n.active))}),r()()()()}if(t&2){let e,l,n=s();u("center",!0)("mobileMode",!0),i(),u("position","stretch"),i(2),u("size","small")("relaxed",!0),i(2),_(f(6,41,"recipe.calculation.outcome.label")),i(3),R(" ",x(9,43,(e=n.result())==null||e.calculation==null?null:e.calculation.outcomeAmount,"1.0-2")," ",(e=n.result())==null||e.calculation==null?null:e.calculation.outcomeUnit," "),i(2),u("position","stretch"),i(2),u("size","small")("relaxed",!0),i(2),m(" ",f(15,46,"recipe.calculation.one-unit.label")," "),i(3),m(" ",(l=n.result())==null||l.calculation==null?null:l.calculation.outcomeUnit," "),i(2),g(n.notInGrams()?19:20),i(2),u("formGroup",n.recipePriceAdditionsForm)("size","small")("relaxed",!0),i(3),g(n.showPriceAdditionUnits()?24:-1),i(),g(n.roundActionSelected()?25:-1),i(),u("position","stretch"),i(2),u("size","small")("relaxed",!0),i(2),_(f(31,48,"recipe.calculation.total-price.label")),i(3),m(" ",x(34,50,n.totalPrice(),"1.2-2")," "),i(2),g(n.totalPriceDifference()?35:-1),i(),u("size","small")("relaxed",!0),i(),X("ngModel",n.recalculateTotalsModel),i(2),g(n.roundActionSelected()?39:-1),i(2),u("size","small"),i(),u("level",5),i(2),_(f(45,53,"recipe.calculation.price-chart")),i(2),u("data",n.doughnutChartData().prices)("options",n.doughnutChartOptions)("type",n.doughnutChartType),i(3),u("size","small"),i(),u("level",5),i(2),_(f(53,55,"recipe.calculation.weight-chart")),i(2),u("data",n.doughnutChartData().weight)("options",n.doughnutChartOptions)("type",n.doughnutChartType)}}function ut(t,a){if(t&1&&(o(0,"span",23),c(1),p(2,"userCurrency"),r(),o(3,"span",24),c(4),p(5,"userCurrency"),r()),t&2){let e,l,n=s(3);i(),m(" > ",x(2,2,(e=n.result())==null||e.calculation==null?null:e.calculation.pricePerUnitModified,"1.2-2")," "),i(3),m(" (+ ",x(5,5,(l=n.result())==null||l.calculation==null?null:l.calculation.pricePerUnitDifference,"1.2-2"),") ")}}function dt(t,a){if(t&1&&(o(0,"span"),c(1),p(2,"userCurrency"),r(),h(3,ut,6,8),c(4),p(5,"number")),t&2){let e,l,n,d,C=s(2);J("text-small",(e=C.result())==null||e.calculation==null?null:e.calculation.totalPriceDifference),i(),m(" ",x(2,5,(l=C.result())==null||l.calculation==null?null:l.calculation.pricePerOutcomeUnit,"1.2-2")," "),i(2),g(!((n=C.result())==null||n.calculation==null)&&n.calculation.totalPriceDifference?3:-1),i(),m(" / ",x(5,8,(d=C.result())==null||d.calculation==null?null:d.calculation.weightForUnit,"1.0-2")," gram ")}}function st(t,a){if(t&1&&(c(0),p(1,"userCurrency")),t&2){let e,l=s(2);m(" ",x(1,1,(e=l.result())==null||e.calculation==null?null:e.calculation.totalPrice,"1.2-2")," ")}}function mt(t,a){if(t&1&&h(0,dt,6,11)(1,st,2,4),t&2){let e=s();g(e.notInGrams()?0:1)}}function Ct(t,a){if(t&1&&(o(0,"a",31),c(1),r()),t&2){let e=s().$implicit;u("routerLink",te(2,Ke,e.type==="recipe-row"?"/recipes/edit/":"/products/edit/",e.uuid)),i(),m(" ",e.name," ")}}function _t(t,a){if(t&1&&(c(0),p(1,"translate")),t&2){let e=s().$implicit;m(" ",f(1,1,e.name)," ")}}function ft(t,a){if(t&1&&(o(0,"tr",30)(1,"td"),c(2),r(),o(3,"td")(4,"div",30),h(5,Ct,2,5,"a",31)(6,_t,2,3),r()(),o(7,"td"),c(8),p(9,"number"),r(),o(10,"td"),c(11),r(),o(12,"td"),c(13),p(14,"userCurrency"),r(),o(15,"td"),c(16),p(17,"userCurrency"),r()()),t&2){let e=a.$implicit,l=a.$index;u("ngClass",e.type),i(2),_(l+1),i(2),u("ngClass","indent-"+e.indent),i(),g(e.type!=="total"?5:6),i(3),_(x(9,8,e.amount,"1.0-2")),i(3),_(e.unit),i(2),_(x(14,11,e.price_per_gram,"1.2-5")),i(3),_(x(17,14,e.total,"1.0-2"))}}function xt(t,a){if(t&1&&(o(0,"table")(1,"colgroup"),P(2,"col",25)(3,"col",26)(4,"col",27)(5,"col",28)(6,"col",27)(7,"col",29),r(),o(8,"thead")(9,"tr")(10,"th"),c(11,"#"),r(),o(12,"th"),c(13),p(14,"translate"),r(),o(15,"th"),c(16),p(17,"translate"),r(),o(18,"th"),c(19),p(20,"translate"),r(),o(21,"th"),c(22),p(23,"translate"),r(),o(24,"th"),c(25),p(26,"translate"),r()()(),o(27,"tbody"),k(28,ft,18,17,"tr",30,O),r()()),t&2){let e,l=s();i(13),_(f(14,5,"recipe.calculation.table.name.title")),i(3),_(f(17,7,"recipe.calculation.table.amount.title")),i(3),_(f(20,9,"recipe.calculation.table.unit.title")),i(3),_(f(23,11,"recipe.calculation.table.price.title")),i(3),_(f(26,13,"recipe.calculation.table.total.title")),i(3),V((e=l.result())==null?null:e.table)}}function ht(t,a){}var He=class t{constructor(a,e,l,n,d,C){this._aRoute=a;this._calculateRecipeService=e;this._formTemplateService=l;this._injector=n;this._router=d;this._notificationService=C;this._aRoute.data.pipe(me()).subscribe(b=>{this.result.set(b.result),this.recipePriceAdditionsForm.patchValue({action:this.result()?.calculation?.perUnitPriceModifier?.action||"add",value:this.result()?.calculation?.perUnitPriceModifier?.value||0,unit:this.result()?.calculation?.perUnitPriceModifier?.unit||"currency"})})}userSettings=G(Ee);additionalPriceUnit=[{label:"$",value:"currency",style:"secondary"},{label:"%",value:"percent",style:"secondary"}];additionalPriceAction=[{label:"Add",value:"add",style:"secondary"},{label:"Round to",value:"round",style:"secondary"}];doughnutChartType="pie";uuid=_e("uuid");result=j(null);doughnutChartData=v(()=>{let a=this.result(),{prices:e,weight:l,labels:n,colors:d}=a?.calculation?.ingredients?.reduce((C,b)=>(C.prices.push(b.totalPrice),C.weight.push(b.totalWeightGram),C.labels.push(b.generalName),C.colors.push(b.product_id?.ownColor??b.recipe_id?.ownColor??de()),C),{prices:[],weight:[],labels:[],colors:[]})||{prices:[],weight:[],labels:[],colors:[]};return{prices:{labels:n,datasets:[{label:"Cost",data:e,backgroundColor:d,borderWidth:0}]},weight:{labels:n,datasets:[{label:"Amount",data:l,backgroundColor:d,borderWidth:0}]},ingredients:a?.calculation?.ingredients||[]}});doughnutChartOptions={plugins:{legend:{display:!1}},onClick:(a,e,l)=>{}};chartPrices;chartWeight;recalculateTotalsModel=ne(0);notInGrams=v(()=>this.result()?.calculation?.outcomeUnit&&this.result()?.calculation?.outcomeUnit!=="gram");recipePriceAdditionsForm=new ve({action:new E("add"),value:new E(0),unit:new E("currency")});values=Ce(this.recipePriceAdditionsForm.valueChanges);roundActionSelected=v(()=>this.values()?.action==="round");showPriceAdditionUnits=v(()=>{let a=this.result()?.calculation?.perUnitPriceModifier?.action;return a==="add"||!a});totalScaleFactor=v(()=>this.recalculateTotalsModel()?this.recalculateTotalsModel()/(this.result()?.calculation?.outcomeAmount||1):1);totalPrice=v(()=>(this.result()?.calculation?.totalPrice||0)*this.totalScaleFactor());totalPriceDifference=v(()=>(this.result()?.calculation?.totalPriceDifference||0)*this.totalScaleFactor());totalPriceWithAdditions=v(()=>(this.result()?.calculation?.totalPriceWithAdditions||0)*this.totalScaleFactor());ngOnInit(){}ngAfterViewInit(){window.chartPrices=this.chartPrices,window.chartWeight=this.chartWeight,this.recipePriceAdditionsForm.valueChanges.pipe(z(300)).subscribe(a=>{this.updatePriceAdditions(a)})}onChartHover(a,e,l){if(!l?.length)return;let n=a==="price"?this.chartWeight:this.chartPrices,d=l[0].index;n?.chart?.update()}async updatePriceAdditions(a){try{await this._calculateRecipeService.updateRecipe({perUnitPriceModifier:{action:a.action,value:parseFloat(a.value)||0,unit:a.unit}});let e=await this._calculateRecipeService.calculateRecipe(this.uuid());this.result.set(e)}catch(e){this._notificationService.error(se(e))}}static \u0275fac=function(e){return new(e||t)(S(ce),S(fe),S(xe),S(W),S(pe),S(Ie))};static \u0275cmp=I({type:t,selectors:[["lg-calculate-recipe"]],viewQuery:function(e,l){if(e&1&&(A($e,5,B),A(Je,5,B)),e&2){let n;U(n=N())&&(l.chartPrices=n.first),U(n=N())&&(l.chartWeight=n.first)}},inputs:{recalculateTotalsModel:[1,"recalculateTotalsModel"]},outputs:{recalculateTotalsModel:"recalculateTotalsModelChange"},features:[ee([Pe,re])],decls:16,vars:16,consts:[["totalAmount",""],["priceChart",""],["weightChart",""],[3,"center","mobileMode"],[3,"flat","link","size"],["lgExpand","",2,"max-width","1200px",3,"center","mobileMode"],[3,"position"],["size","small"],[3,"size","relaxed"],["size","small",3,"position"],[2,"--control-bg","#fff","padding","0 16px",3,"formGroup","size","relaxed"],["lgParseMath","","placeholder","extra price","formControlName","value"],["lgExtraTpl","","place","before"],["lgExtraTpl","","place","after"],[2,"--control-bg","#fff","padding","0 16px",3,"size","relaxed"],["lgParseMath","","placeholder","amount",3,"ngModelChange","ngModel"],["lgWidth","270px","size","small"],[3,"size"],[3,"level"],["baseChart","",3,"chartHover","data","options","type"],[4,"ngTemplateOutlet"],["formControlName","action",3,"items"],["formControlName","unit",3,"items"],[1,"text-active"],[1,"text-accent"],["span","1",2,"width","1%"],["span","1",2,"width","20%"],["span","1",2,"width","5%"],["span","1",2,"width","3%"],["span","1",2,"width","7%"],[3,"ngClass"],[3,"routerLink"]],template:function(e,l){if(e&1&&(o(0,"lg-fade-in")(1,"lg-container")(2,"lg-gap-column")(3,"lg-gap-row",3)(4,"lg-title"),c(5),p(6,"translate"),r(),o(7,"lg-button",4),c(8),p(9,"translate"),r()(),h(10,pt,56,57,"lg-gap-row",5),y(11,mt,2,1,"ng-template",null,0,ie),o(13,"lg-table-card"),h(14,xt,30,15,"table")(15,ht,0,0),r()()()()),e&2){let n,d,C;i(3),u("center",!0)("mobileMode",!0),i(2),R(" ",(n=l.result())==null||n.calculation==null?null:n.calculation.recipeName," ",f(6,12,"recipe.calculation.title.after-text")," "),i(2),K("primary"),u("flat",!0)("link","/recipes/edit/"+((d=l.result())==null||d.calculation==null?null:d.calculation.recipeUuid))("size","small"),i(),m(" ",f(9,14,"edit-label")," "),i(2),g(!((C=l.result())==null||C.calculation==null)&&C.calculation.totalPrice?10:-1),i(4),g(l.result()?14:15)}},dependencies:[Me,Be,D,ae,Ue,Ae,oe,we,he,ge,ye,ue,Fe,le,De,B,M,Oe,Ne,ke,Re,Te,be,Se,je,We,ze,Ve,Ge],styles:[`lg-number-input .lg-number-input{width:100px}
`],encapsulation:2})};export{He as CalculateRecipeComponent};
