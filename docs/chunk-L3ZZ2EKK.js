import{a as ce}from"./chunk-EJK6JA4S.js";import{a as pe}from"./chunk-IQGSUA4J.js";import{a as me}from"./chunk-2PXFNS3H.js";import{a as ne}from"./chunk-MGUYQA7S.js";import{a as oe}from"./chunk-J5IRJC5E.js";import{a as le}from"./chunk-5SETSLBD.js";import{a as se}from"./chunk-YQVS65SW.js";import{a as re,c as ae}from"./chunk-JIX6S6OM.js";import{v as ie}from"./chunk-VUJEMPM4.js";import{a as ee}from"./chunk-BW6KPQFF.js";import{a as Z}from"./chunk-XTIJKHFS.js";import{I as z,J as W,K as b,M as c,R as J,S as U,T as q,U as K,W as L,X as Q,Y as X,da as k,g as $,ma as Y,o as H,oa as te,t as O,z as j}from"./chunk-S7GYMRNG.js";import{$a as o,Bc as l,Cc as p,Db as S,Eb as T,Hb as R,Ib as N,Jb as a,Kb as s,Lb as m,Lc as E,Mb as C,Mc as P,Nb as D,Ob as V,Qb as B,Ub as d,Vb as g,eb as y,ec as G,fc as M,gc as v,ic as x,kc as u,la as _,lb as A,ma as h,nb as I,va as F}from"./chunk-7BND6AGV.js";var w=class n{constructor(){}selfAlign="center";static \u0275fac=function(t){return new(t||n)};static \u0275dir=I({type:n,selectors:[["","lgSelfCenter",""]],hostVars:2,hostBindings:function(t,i){t&2&&G("align-self",i.selfAlign)}})};var ue=(n,e)=>e.name+e.uuid+n;function fe(n,e){n&1&&(x(0),l(1,"translate")),n&2&&u(" ",p(1,1,"settings.taxes.fees")," ")}function ge(n,e){if(n&1){let t=B();S(0,fe,2,3),s(1,"section",4)(2,"div",5)(3,"lg-flex-row",6)(4,"lg-control",7),l(5,"translate"),C(6,"lg-input",8),m(),s(7,"lg-control",7),l(8,"translate"),C(9,"lg-textarea",9),m(),s(10,"lg-control",10),l(11,"translate"),s(12,"lg-checkbox",11),d("onCheckboxChanged",function(){let r=_(t).$index,f=g();return h(f.onTaxValueChange(r))}),m()(),s(13,"lg-control",12),l(14,"translate"),s(15,"lg-number-input",13),d("onInputChange",function(){let r=_(t).$index,f=g();return h(f.onTaxValueChange(r))}),m()(),s(16,"lg-button",14),d("click",function(){let r=_(t).$index,f=g();return h(f.deleteTxRow(r))}),C(17,"mat-icon",15),m()()()()}if(n&2){let t=e.$implicit,i=e.$index,r=g();r.taxesForm.controls.rows.controls[i],T(r.feesIndex()===i?0:-1),o(),a("formGroupName",i),o(),M("taxes__row--odd",i%2!==0),o(),a("fit",!0)("top",!0),o(),a("label",p(5,17,"settings.taxes.name")),o(3),a("label",p(8,19,"settings.taxes.description")),o(2),a("rows",3),o(),a("label",p(11,21,"settings.taxes.percentage")),o(2),a("customMark","%")("name",t.name+i),o(),a("label",p(14,23,"settings.taxes.value")),o(3),v("danger"),a("icon",!0)("size","tiny")}}function _e(n,e){n&1&&(x(0),l(1,"translate")),n&2&&u(" ",p(1,1,"settings.taxes.save-changes")," ")}function he(n,e){n&1&&(x(0),l(1,"translate")),n&2&&u(" ",p(1,1,"settings.taxes.no-changes")," ")}var de=class n{constructor(e,t){this._taxesRepository=e;this._notificationService=t}taxesAndFees=F([]);feesIndex=E(()=>this.taxesAndFees().findIndex(e=>!e.percentage));taxesForm=new b({rows:new L([this._getRowGroup()])});rowsEffect=P(()=>{this._rowsFormArray.clear(),this.taxesAndFees().forEach((e,t)=>{this._rowsFormArray.push(this._getRowGroup(e))}),this.taxesForm.updateValueAndValidity(),this.taxesForm.markAsPristine()});totalTaxes=F(0);formValues=this.taxesForm.valueChanges.pipe(H());get _rowsFormArray(){return this.taxesForm.get("rows")}ngOnInit(){this._taxesRepository.getAll().then(e=>{this.taxesAndFees.set(e.toSorted((t,i)=>t.name.localeCompare(i.name)&&+i.percentage-+t.percentage))})}onTaxValueChange(e){}deleteTxRow(e){let t=this.taxesForm.value.rows?.[e]?.uuid;this._rowsFormArray.removeAt(e),this.taxesAndFees.update(i=>i.filter(r=>r.uuid!==t)),this.taxesForm.markAsDirty(),t&&this._taxesRepository.deleteOne(t)}addTaxRow(){let e=k.empty();this._rowsFormArray.push(this._getRowGroup(e)),this.taxesAndFees.update(t=>[...t,e]),this.taxesForm.markAsDirty()}async saveTaxes(){try{let e=this.taxesForm.value.rows?.map(t=>k.fromRaw(O(t)))??[];await this._taxesRepository.addMany(e),this._notificationService.success("settings.taxes.saved-success"),this.taxesForm.markAsPristine()}catch(e){this._notificationService.error($(e))}}_getRowGroup(e){return new b({name:new c(e?.name||""),description:new c(e?.description||""),value:new c(e?.amount||0),amount:new c(0),percentage:new c(e?.percentage||!1),uuid:new c(e?.uuid||"")})}static \u0275fac=function(t){return new(t||n)(y(ce),y(Y))};static \u0275cmp=A({type:n,selectors:[["lg-taxes-settings"]],decls:14,vars:13,consts:[[3,"formGroup"],["formArrayName","rows"],["lgSelfCenter","","lgShrink","",3,"click","disabled"],["lgSelfCenter","","lgShrink","",3,"click"],[1,"taxes",3,"formGroupName"],[1,"taxes__row"],[3,"fit","top"],["lgWidth","35%",3,"label"],["placeholder","","formControlName","name"],["placeholder","","formControlName","description",3,"rows"],["lgShrink","",3,"label"],["formControlName","percentage",3,"onCheckboxChanged","customMark","name"],[3,"label"],["placeholder","","formControlName","value","lgParseMath","",3,"onInputChange"],["lgShrink","",3,"click","icon","size"],["aria-hidden","false","aria-label","Example home icon","fontIcon","close"]],template:function(t,i){t&1&&(s(0,"lg-flex-column"),D(1,0)(2,1),x(3),l(4,"translate"),R(5,ge,18,25,null,null,ue),V()(),s(7,"lg-flex-row")(8,"lg-button",2),d("click",function(){return i.saveTaxes()}),S(9,_e,2,3)(10,he,2,3),m(),s(11,"lg-button",3),d("click",function(){return i.addTaxRow()}),x(12),l(13,"translate"),m()()()),t&2&&(o(),a("formGroup",i.taxesForm),o(2),u(" ",p(4,9,"settings.taxes.title")," "),o(2),N(i.taxesAndFees()),o(3),v("success"),a("disabled",!i.taxesForm.dirty),o(),T(i.taxesForm.dirty?9:10),o(2),v("warning"),o(),u(" ",p(13,11,"settings.taxes.add-tax")," "))},dependencies:[ee,ne,Q,z,W,te,me,ie,re,ae,X,J,K,U,q,w,le,oe,pe,Z,j,se],encapsulation:2})};export{w as a,de as b};
