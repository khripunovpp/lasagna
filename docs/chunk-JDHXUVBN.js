import{a as me,b as de,c as _e,d as fe,e as ge,f as n,g as Re,h as ye}from"./chunk-23ZI4CQJ.js";import"./chunk-DIQ4RGBD.js";import{a as ue}from"./chunk-PRC2TUST.js";import{a as re}from"./chunk-PK5DH7CM.js";import{a as ce,c as ae}from"./chunk-QSVWUNKY.js";import{b as se}from"./chunk-3QIAGCJF.js";import{a as le}from"./chunk-PHGQT4GW.js";import"./chunk-6BVDG3RH.js";import{a as Ce}from"./chunk-UZ4ZOUQK.js";import{a as ne}from"./chunk-OXB5GTVD.js";import{d as ee,g as k,h as ie}from"./chunk-BDK6RPQ7.js";import"./chunk-I4TJ6JFG.js";import{b as te}from"./chunk-CBJ5O2TR.js";import"./chunk-SCYWH7FS.js";import{a as pe}from"./chunk-YSX2TPIK.js";import"./chunk-C3YIVVSQ.js";import{a as W,c as oe}from"./chunk-UYEJDPNH.js";import{b as J,c as b}from"./chunk-JQ7DWKTJ.js";import"./chunk-DKKRBT3L.js";import{b as K}from"./chunk-P7L2C53Q.js";import{a as Y}from"./chunk-LVIA722N.js";import{a as X}from"./chunk-2ZEJWSE3.js";import"./chunk-SNDQO5FA.js";import"./chunk-5ZHT4QO7.js";import"./chunk-Z2KUFMIF.js";import"./chunk-TYLDJUNJ.js";import{s as q,v as H}from"./chunk-K7R7MOA3.js";import"./chunk-IZT3LVRQ.js";import{Ab as l,Bb as c,Cb as v,Gb as h,Jb as _,Kb as d,Q as N,Ta as r,Wb as s,Xb as z,Y as V,Ya as y,Yb as L,Zb as P,_ as R,bb as G,bc as Q,fa as T,ga as D,gb as C,hc as f,ic as g,k as j,ma as $,ob as a,q as x,rb as u,s as B,ub as F,vb as O,wb as U,yb as I,zb as E}from"./chunk-PNZYYIKS.js";import"./chunk-DELOOZDJ.js";import{f as Z}from"./chunk-2WH2EVR6.js";var ve=new V("CategorizedRecipesList",{factory:()=>{let t=R(b),i=R(K);return j(t.loadRecipes()).pipe(N(()=>t.recipes$),x(o=>o.map(p=>p.toDTO()))).pipe(x(o=>o.toSorted((p,m)=>p.name.localeCompare(m.name))),x(o=>ue(o,"category_id")),B(o=>Z(void 0,null,function*(){let p=[];for(let S in o){let A=o[S],Te=yield i.getOne(S);p.push({category:Te?.name,recipes:A.map(De=>J.fromRaw(De))})}if(!p.length)return[];let[m,...M]=p.toSorted((S,A)=>S.category>A.category?1:-1);return m?.category?[m].concat(M):M.concat([m])})))}});var Se=n.object({name:n.string(),amount:n.number().or(n.string()),uuid:n.string().optional(),product_id:ye,recipe_id:n.lazy(()=>w),unit:n.enum(["gram","portion","piece"])});var w=n.object({name:n.string(),uuid:n.string().optional(),description:n.string(),ingredients:n.array(n.lazy(()=>Se)),outcome_unit:Re,outcome_amount:n.number().or(n.string()),taxTemplateName:n.string().optional(),category_id:n.string().nullable().optional(),createdAt:n.union([n.string(),n.number()]).optional(),updatedAt:n.union([n.string(),n.number()]).optional(),tags:n.array(n.string()).optional()});var Ie=(t,i)=>i==null?null:i.category,Ee=(t,i)=>i==null?null:i.createdAt;function he(t,i){t&1&&(l(0,"lg-button",6),v(1,"mat-icon",7),c()),t&2&&(u("success"),a("icon",!0)("link","/recipes/add")("size","medium"))}function Le(t,i){if(t&1&&(l(0,"span"),s(1),c()),t&2){let e=i.$implicit;r(),z(e==null?null:e.name)}}function be(t,i){t&1&&s(0," Unsaved existing recipe: ")}function ke(t,i){t&1&&s(0," Draft recipe: ")}function we(t,i){if(t&1){let e=h();l(0,"lg-gap-row",4)(1,"a",9),F(2,be,1,0)(3,ke,1,0),s(4),c(),l(5,"small",10),s(6),f(7,"translate"),f(8,"timeAgo"),c(),l(9,"lg-button",11),_("click",function(){T(e);let p=d().$implicit,m=d(2);return D(m.deleteDraft(p))}),v(10,"mat-icon",12),c()()}if(t&2){let e=d().$implicit;a("center",!0),r(),a("routerLink","/recipes/draft/"+(e==null?null:e.uuid)),r(),O(!(e==null||e.meta==null)&&e.meta.uuid?2:3),r(2),L(" ",(e==null||e.data==null?null:e.data.name)??""," "),r(2),P(" ",g(7,10,"edited-at-label")," ",g(8,12,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," "),r(3),u("danger"),a("size","tiny")("icon",!0)}}function Ae(t,i){t&1&&C(0,we,11,14,"ng-template",8)}function Fe(t,i){if(t&1&&(l(0,"lg-card-list",5),I(1,Ae,1,0,null,8,Ee),c()),t&2){let e=d();r(),E(e.draft())}}function Oe(t,i){if(t&1){let e=h();l(0,"lg-gap-row",4)(1,"a",16),s(2),c(),l(3,"lg-button",17),s(4," Calculate "),c(),l(5,"small",18),s(6),f(7,"translate"),f(8,"timeAgo"),c(),l(9,"lg-button",11),_("click",function(){T(e);let p=d().$implicit,m=d(2);return D(m.deleteRecipe(p))}),v(10,"mat-icon",12),c()()}if(t&2){let e=d().$implicit;a("center",!0),r(),a("routerLink","/recipes/edit/"+e.uuid),r(),z(e.name),r(),u("primary"),a("size","small")("link","/recipes/calculate/"+e.uuid)("flat",!0),r(3),P(" ",g(7,14,"edited-at-label")," ",g(8,16,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," "),r(3),u("danger"),a("size","tiny")("icon",!0)}}function ze(t,i){if(t&1&&C(0,Oe,11,18,"ng-template",15),t&2){let e=i.$implicit;a("uuid",e.uuid)}}function Pe(t,i){if(t&1){let e=h();l(0,"lg-title",13),s(1),c(),l(2,"lg-card-list",14),_("onSelected",function(p){T(e);let m=d();return D(m.selectionZoneService.putSelected(p))}),I(3,ze,1,1,null,15,U),c()}if(t&2){let e=i.$implicit,o=d();a("level",3),r(),L(" ",(e==null?null:e.category)||"Uncategorized"," "),r(),a("mode",o.selectionZoneService.selectionMode())("selectAll",o.selectionZoneService.selectAll())("deselectAll",o.selectionZoneService.deselectAll()),r(),E(e.recipes)}}function Me(t,i){t&1&&(l(0,"lg-gap-row",4)(1,"lg-title",13),s(2),f(3,"translate"),c()()),t&2&&(a("center",!0),r(),a("level",5),r(),L(" ",g(3,3,"no-recipes")," "))}var xe=class t{constructor(i,e,o,p){this._recipesRepository=i;this._notificationsService=e;this._transferDataService=o;this.selectionZoneService=p}draft=$([]);recipes=se(R(ve));Stores=H;ngOnInit(){this.loadRecipes();let i=this._recipesRepository.getDraftRecipe();i&&this.draft.set(i)}deleteRecipe(i){return i.uuid?this._recipesRepository.deleteRecipe(i.uuid).then(()=>{this.loadRecipes(),this._notificationsService.success("Recipe deleted")}):Promise.resolve()}loadRecipes(){this._recipesRepository.loadRecipes()}exportRecipes(i){this._transferDataService.exportTable("recipesStore","json",{selected:Array.from(i)})}deleteDraft(i){this._recipesRepository.removeDraftRecipe(i.uuid),this.draft.update(e=>e.filter(o=>o?.uuid!==i.uuid))}RecipeScheme=w;static \u0275fac=function(e){return new(e||t)(y(b),y(te),y(ie),y(k))};static \u0275cmp=G({type:t,selectors:[["lg-recipes-list"]],features:[Q([k])],decls:16,vars:9,consts:[["lgQuickActionsTpl",""],[3,"click","flat","size"],[3,"onDone","schema","storeName"],["lgImportRowTpl",""],[3,"center"],[2,"--card-bg","#bee5ff"],[3,"icon","link","size"],["aria-hidden","false","fontIcon","add"],["lgCardListItem",""],["lgExpand","",3,"routerLink"],[1,"text-muted","text-cursive"],[3,"click","size","icon"],["aria-hidden","false","fontIcon","close"],[3,"level"],[3,"onSelected","mode","selectAll","deselectAll"],["lgCardListItem","",3,"uuid"],[3,"routerLink"],[3,"size","link","flat"],["lgPull","",1,"text-muted","text-cursive"]],template:function(e,o){if(e&1&&(l(0,"lg-controls-bar"),C(1,he,2,5,"ng-template",0),v(2,"lg-selection-tools"),l(3,"lg-button",1),_("click",function(){return o.exportRecipes(o.selectionZoneService.selected())}),s(4," Export "),c(),l(5,"lg-import",2),_("onDone",function(){return o.loadRecipes()}),C(6,Le,2,1,"ng-template",3),c()(),l(7,"lg-fade-in")(8,"lg-container")(9,"lg-gap-row",4)(10,"lg-title"),s(11," Recipes "),c()(),F(12,Fe,3,0,"lg-card-list",5),I(13,Pe,5,5,null,null,Ie,!1,Me,4,5,"lg-gap-row",4),c()()),e&2){let p;r(3),u("info"),a("flat",!0)("size","small"),r(2),a("schema",o.RecipeScheme)("storeName",o.Stores.RECIPES),r(4),a("center",!0),r(3),O((p=o.draft())!=null&&p.length?12:-1),r(),E(o.recipes())}},dependencies:[oe,pe,q,le,W,X,ae,ce,de,me,Y,fe,_e,ge,ne,Ce,re,ee],styles:["[_nghost-%COMP%]{display:block}"]})};export{xe as RecipesListComponent};
