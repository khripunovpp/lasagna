"use strict";(self.webpackChunklasagna=self.webpackChunklasagna||[]).push([[91],{1091:(z,C,i)=>{i.r(C),i.d(C,{CalculateRecipeComponent:()=>O});var t=i(1007),x=i(5642),j=i(1086),E=i(553);const T=["*"];let A=(()=>{class o{constructor(){}static \u0275fac=function(n){return new(n||o)};static \u0275cmp=t.VBU({type:o,selectors:[["lg-table-card"]],ngContentSelectors:T,decls:4,vars:1,consts:[[3,"flat"],[1,"table"],[1,"table__scroll"]],template:function(n,a){1&n&&(t.NAR(),t.j41(0,"lg-card",0)(1,"div",1)(2,"div",2),t.SdG(3),t.k0s()()()),2&n&&t.Y8G("flat",!0)},dependencies:[E.i],styles:[":host{display:flex;width:100%}.table__scroll{overflow-x:auto}table{width:100%;border-collapse:collapse;--border-color: #efefef}table thead tr{border-bottom:1px solid var(--border-color)}table thead th{text-align:left;padding:16px 24px;opacity:.4;font-size:.8em}table tbody tr{border-bottom:1px solid var(--border-color)}table tbody tr:last-child{border-bottom:none}td{padding:16px 24px}\n"],encapsulation:2})}return o})();var b=i(177),$=i(1119),G=i(7512),w=i(1636),h=i(467),y=i(4625),I=i(9512),N=i(7201);let S=(()=>{class o{_recipeRepository;_productRepository;constructor(e,n){this._recipeRepository=e,this._productRepository=n}calculation;calculateRecipe(e){var n=this;return new Promise(function(){var a=(0,h.A)(function*(u,s){const c=[];let l=0,_=0;yield n._recipeRepository.getOne(e).then(function(){var F=(0,h.A)(function*(m){const{table:d,totalAmount:f}=yield n._makeIngredientTable(m);l+=f||0,_=m?.ingredients.reduce((g,r)=>g+((0,y.N)(r.amount)||0),0)??0,c.push(...d),c.push(n._makeTotal(l,_)),u({recipe:m,result:c,total:l,totalWeight:_})});return function(m){return F.apply(this,arguments)}}())});return function(u,s){return a.apply(this,arguments)}}())}_makeRecipeSubTable(e){var n=this;return(0,h.A)(function*(){return new Promise(function(){var a=(0,h.A)(function*(u,s){const c=[];let l=0,_=0;const F=e.amount;yield n._recipeRepository.getOne(e.recipe_id).then(function(){var m=(0,h.A)(function*(d){const f=d?.ingredients.reduce((p,k)=>p+((0,y.N)(k.amount)||0),0)??0,g=F/f,r=yield n._makeIngredientTable(d);r.table=r.table.map((p,k)=>({...p,amount:parseFloat((p.amount?p.amount*g:0).toFixed(5)),total:parseFloat((p.total?p.total*g:0).toFixed(5)),indent:p.indent+1}));const v=r.totalAmount?r.totalAmount/r.totalWeight:0;c.push(n._makeRecipeCaption({name:d?.name||"Unknown recipe",price_per_gram:v,amount:e.amount,total:v*e.amount})),c.push(...r.table),_+=v*e.amount,l+=r.totalWeight,u({table:c,totalAmount:_,totalWeight:l})});return function(d){return m.apply(this,arguments)}}())});return function(u,s){return a.apply(this,arguments)}}())})()}_makeIngredientTable(e){var n=this;const a=[];let u=0,s=0;return Promise.all(e?.ingredients.map(function(){var c=(0,h.A)(function*(l,_){const F=l.recipe_id,m=l.product_id,d=l.name;if(F||m||d)if(F){const f=yield n._makeRecipeSubTable(l);a.push(...f.table),s+=f.totalAmount,u+=f.totalWeight}else m?yield n._productRepository.getOne(l.product_id).then(function(){var g=(0,h.A)(function*(r){if(!r)return void a.push(n._makeRow({name:"Unknown product",price_per_gram:void 0,amount:l.amount,total:void 0}));if(!r?.price)return void a.push(n._makeRow({name:r.name,price_per_gram:0,amount:l.amount,total:0}));if(!r?.amount)return void a.push(n._makeRow({name:r.name,price_per_gram:0,amount:l.amount,total:0}));const v=((0,y.N)(r.price)||1)/((0,y.N)(r.amount)||1),p=v*((0,y.N)(l.amount)||1);a.push(n._makeRow({name:r.name,price_per_gram:v,amount:l.amount,total:p})),s+=p,u+=+l.amount});return function(r){return g.apply(this,arguments)}}()):d&&(a.push(n._makeRow({name:l.name,price_per_gram:void 0,amount:l.amount,total:void 0})),u+=+l.amount)});return function(l,_){return c.apply(this,arguments)}}())??[]).then(()=>({table:a,totalAmount:s,totalWeight:u}))}_makeRow(e){return{name:e.name,price_per_gram:parseFloat(e.price_per_gram?.toFixed(5)??"0"),amount:e.amount,total:parseFloat(e.total?.toFixed(5)??"0"),unit:"g",indent:e.indent??0,type:"row"}}_makeCaption(e){return{name:e,unit:void 0,price_per_gram:void 0,amount:void 0,total:void 0,indent:0,type:"caption"}}_makeRecipeCaption(e){return{name:e.name,price_per_gram:parseFloat(e.price_per_gram.toFixed(5)),amount:e.amount,total:parseFloat(e.total.toFixed(2)),unit:"g",indent:0,type:"recipe-row"}}_makeTotal(e,n){return{name:"Total",amount:n,unit:"g",price_per_gram:parseFloat((e/n).toFixed(5)),total:parseFloat(e.toFixed(2)),indent:0,type:"total"}}static \u0275fac=function(n){return new(n||o)(t.KVO(I.m),t.KVO(N.d))};static \u0275prov=t.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();function U(o,R){if(1&o&&(t.j41(0,"div"),t.EFF(1),t.k0s(),t.j41(2,"div"),t.EFF(3),t.nI1(4,"number"),t.k0s()),2&o){let e,n;const a=t.XpG(2);t.R7$(),t.Lme("Calculation outcome: ",null==(e=a.result())||null==e.recipe?null:e.recipe.outcome_amount," ",null==(e=a.result())||null==e.recipe?null:e.recipe.outcome_unit," "),t.R7$(2),t.SpI("one portion costs: ",t.i5U(4,3,((null==(n=a.result())?null:n.total)||1)/((null==(n=a.result())||null==n.recipe?null:n.recipe.outcome_amount)||1),"1.2-2")," ")}}function P(o,R){if(1&o&&(t.j41(0,"div"),t.EFF(1),t.k0s(),t.j41(2,"div"),t.EFF(3),t.nI1(4,"number"),t.k0s()),2&o){let e,n;const a=t.XpG(2);t.R7$(),t.SpI("Calculation outcome: ",null==(e=a.result())?null:e.totalWeight," grams"),t.R7$(2),t.SpI("costs: ",t.i5U(4,2,null==(n=a.result())?null:n.total,"1.2-2"),"")}}function W(o,R){if(1&o&&(t.j41(0,"lg-gap-row",0),t.DNE(1,U,5,6)(2,P,5,5),t.k0s()),2&o){let e;const n=t.XpG();t.Y8G("center",!0),t.R7$(),t.vxM(null!=(e=n.result())&&null!=e.recipe&&e.recipe.outcome_unit?1:2)}}function X(o,R){if(1&o&&(t.j41(0,"tr",7)(1,"td"),t.EFF(2),t.k0s(),t.j41(3,"td")(4,"span",7),t.EFF(5),t.k0s()(),t.j41(6,"td"),t.EFF(7),t.k0s(),t.j41(8,"td"),t.EFF(9),t.k0s(),t.j41(10,"td"),t.EFF(11),t.k0s(),t.j41(12,"td"),t.EFF(13),t.k0s()()),2&o){const e=R.$implicit,n=R.$index;t.Y8G("ngClass",e.type),t.R7$(2),t.JRh(n+1),t.R7$(2),t.Y8G("ngClass","indent-"+e.indent),t.R7$(),t.JRh(e.name),t.R7$(2),t.JRh(e.amount),t.R7$(2),t.JRh(e.unit),t.R7$(2),t.JRh(e.price_per_gram),t.R7$(2),t.JRh(e.total)}}function Y(o,R){if(1&o&&(t.j41(0,"table")(1,"colgroup"),t.nrm(2,"col",2)(3,"col",3)(4,"col",4)(5,"col",5)(6,"col",4)(7,"col",6),t.k0s(),t.j41(8,"thead")(9,"tr")(10,"th"),t.EFF(11,"#"),t.k0s(),t.j41(12,"th"),t.EFF(13,"Name"),t.k0s(),t.j41(14,"th"),t.EFF(15,"Amount"),t.k0s(),t.j41(16,"th"),t.EFF(17,"Unit"),t.k0s(),t.j41(18,"th"),t.EFF(19,"Price per gram"),t.k0s(),t.j41(20,"th"),t.EFF(21,"Total"),t.k0s()()(),t.j41(22,"tbody"),t.Z7z(23,X,14,8,"tr",7,t.Vm6),t.k0s()()),2&o){let e;const n=t.XpG();t.R7$(23),t.Dyx(null==(e=n.result())?null:e.result)}}function J(o,R){1&o&&(t.j41(0,"div"),t.EFF(1,"Loading..."),t.k0s())}let O=(()=>{class o{_aRoute;_calculateRecipeService;constructor(e,n){this._aRoute=e,this._calculateRecipeService=n}uuid=(0,t.vPA)("");result=(0,t.vPA)(null);ngOnInit(){this._aRoute.params.subscribe(e=>{this.uuid.set(e.uuid),this._calculateRecipeService.calculateRecipe(e.uuid).then(n=>{this.result.set(n)})})}static \u0275fac=function(n){return new(n||o)(t.rXU(w.nX),t.rXU(S))};static \u0275cmp=t.VBU({type:o,selectors:[["lg-calculate-recipe"]],decls:12,vars:14,consts:[[3,"center"],[3,"flat","link","size"],["span","1",2,"width","1%"],["span","1",2,"width","20%"],["span","1",2,"width","5%"],["span","1",2,"width","3%"],["span","1",2,"width","7%"],[3,"ngClass"]],template:function(n,a){if(1&n&&(t.j41(0,"lg-container")(1,"lg-gap-row",0)(2,"lg-title"),t.EFF(3),t.k0s(),t.j41(4,"lg-button",1),t.EFF(5," Edit "),t.k0s(),t.j41(6,"lg-button",1),t.EFF(7," Back to list "),t.k0s()(),t.DNE(8,W,3,2,"lg-gap-row",0),t.j41(9,"lg-table-card"),t.DNE(10,Y,25,0,"table")(11,J,2,0,"div"),t.k0s()()),2&n){let u,s,c;t.R7$(),t.Y8G("center",!0),t.R7$(2),t.SpI(" ",null==(u=a.result())||null==u.recipe?null:u.recipe.name," cost calculation "),t.R7$(),t.Aen("primary"),t.Y8G("flat",!0)("link","/edit-recipe/"+(null==(s=a.result())||null==s.recipe?null:s.recipe.uuid))("size","small"),t.R7$(2),t.Aen("warning"),t.Y8G("flat",!0)("link","/recipes")("size","small"),t.R7$(2),t.vxM(null!=(c=a.result())&&c.total?8:-1),t.R7$(2),t.vxM(a.result()?10:11)}},dependencies:[x.H,j.W,A,b.YU,$.Q,G.I,b.QX],encapsulation:2})}return o})()}}]);