import{A as p,x as S}from"./chunk-DQ7XQQU4.js";import{W as c,_ as d,g as f,l as u}from"./chunk-P6BGRGC2.js";import{f as l}from"./chunk-2WH2EVR6.js";var y={products:{name:"products",loaderConfig:{name:"indexDb",storeName:"productsStore"}},categories:{name:"categories",loaderConfig:{name:"indexDb",storeName:"categoryProductsStore"}},"recipes-categories":{name:"recipes-categories",loaderConfig:{name:"indexDb",storeName:"categoryRecipesStore"}},recipes:{name:"recipes",loaderConfig:{name:"indexDb",storeName:"recipesStore"}},"recipes-names":{name:"recipes-names",loaderConfig:{name:"indexDb",storeName:"recipesStore"}},"products-names":{name:"products-names",loaderConfig:{name:"indexDb",storeName:"productsStore"}},sources:{name:"sources",loaderConfig:{name:"indexDb",storeName:"productsStore",selectUniqueKey:"source"}},tags:{name:"tags",loaderConfig:{name:"indexDb",storeName:"tags"}},taxTemplates:{name:"taxTemplates",loaderConfig:{name:"localStorage",key:"template-tax"},transform:s=>s||[]}};var m=class s{constructor(e){this._indexDb=e}load(e){return this._indexDb.getAll(e)}live(e){return S(()=>this._indexDb.getAll(e))}search(e,r="name",i=""){return this._indexDb.filter(e,r,i)}uniqueKeys(e,r="name"){return this._indexDb.uniqueKeys(e,r)}static \u0275fac=function(r){return new(r||s)(d(p))};static \u0275prov=c({token:s,factory:s.\u0275fac,providedIn:"root"})};var g=class s{constructor(){}load(e){if(!e)throw new Error("Localstorage name is required");return new Promise((r,i)=>{let o=localStorage.getItem(e);if(o)try{let t=JSON.parse(o);r(t)}catch(t){i(t)}else r([])})}search(e){return u([])}uniqueKeys(e,r){return Promise.resolve([])}static \u0275fac=function(r){return new(r||s)};static \u0275prov=c({token:s,factory:s.\u0275fac,providedIn:"root"})};var x=class s{constructor(e,r){this._indexDbSelectLoaderService=e;this._localstorageSelectLoaderService=r}_registry=new Map;_registry$=new f(new Map);get registryStream(){return this._registry$}register(e){if(this._registry.has(e))return;let r=y[e];if(!r)throw new Error(`SelectResource ${e} not found`);let i=new f([]);this._registry.set(r.name,{cfg:r,name:r.name,list:[],lists:{},loader:{load:()=>l(this,null,function*(){if(r.loaderConfig?.name==="localStorage")return this._localstorageSelectLoaderService.load(r.loaderConfig?.key);let o=r.loaderConfig;return this._indexDbSelectLoaderService.load(o?.storeName)}),search:(o,t)=>l(this,null,function*(){let n=r.loaderConfig;return this._indexDbSelectLoaderService.search(n?.storeName,o,t).then(a=>(i.next(a),a))}),uniqueKeys:(o,t)=>l(this,null,function*(){return this._indexDbSelectLoaderService.uniqueKeys(o,t).then(n=>{let a=n.filter(Boolean);return i.next(a),a})})},stream:i.asObservable()})}get(e){return this._registry.get(e)}autocomplete(e,r,i){let o=this._registry.get(e);if(!o)throw new Error(`SelectResource ${e} not found`);return o.loader.search(r,i).then(t=>(this._registry$.next(this._registry),t))}load(e,r=!1){let i=e||Array.from(this._registry.keys());return Promise.all(i.map(o=>l(this,null,function*(){let t=this.get(o),n,a=t.cfg.loaderConfig;a?.selectUniqueKey?.length?n=yield t.loader.uniqueKeys(a.storeName,a.selectUniqueKey):n=yield t.loader.load(t.name),Array.isArray(n)?t.list=n:t.lists=n,t.updatedAt=Date.now()}))).then(()=>i.reduce((o,t)=>(o[t]=this.get(t),o),{})).then(()=>{this._registry$.next(this._registry)})}subscribe(e){return this._registry$.subscribe(e)}static \u0275fac=function(r){return new(r||s)(d(m,8),d(g,8))};static \u0275prov=c({token:s,factory:s.\u0275fac,providedIn:"root"})};export{x as a};
