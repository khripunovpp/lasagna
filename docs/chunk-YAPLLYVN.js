import{a as It}from"./chunk-ALWYGEFA.js";import{a as Dt,b as Et,c as Vt}from"./chunk-ZAFKSHKE.js";import{a as St}from"./chunk-XZXT4SRM.js";import{e as Rt}from"./chunk-IZRRRE7R.js";import{a as bt}from"./chunk-ZN7PQMQI.js";import{a as xt,c as At,d as Ft}from"./chunk-KSKI6EVB.js";import{a as wt}from"./chunk-EPO23GDK.js";import"./chunk-5MCIXAOV.js";import{a as yt}from"./chunk-67XZZGJY.js";import{b as W}from"./chunk-AXQKNJQU.js";import{c as O}from"./chunk-QRIF72IR.js";import"./chunk-ZG5DSIBK.js";import"./chunk-BBWM53XJ.js";import{a as mt,d as I,f as ft,g as gt,h as _t,i as x,k as Ct,m as ht,p as vt,s as Pt}from"./chunk-SVQANG7A.js";import{a as ut}from"./chunk-4J6QSXGQ.js";import{a as st,b as dt,c as N}from"./chunk-OPLK3PQA.js";import"./chunk-IPKCCBOY.js";import{c as F}from"./chunk-LT4T7YA7.js";import{A as pt,c as rt,g as at,s as lt,v as k,z as ct}from"./chunk-UAPQ4Z4N.js";import{Ab as r,Bb as _,F as J,Fb as b,Ib as d,Jb as f,Kb as $,Lb as L,Ra as Q,Sa as n,Sb as S,Tb as A,Ub as R,Vb as g,Xa as v,Xb as tt,ab as w,ea as C,fa as h,gc as et,ic as ot,la as p,nb as s,ob as q,pb as M,pc as it,qb as Z,qc as nt,tb as u,tc as T,ub as m,uc as D,vc as E,zb as a}from"./chunk-SYQBEC7E.js";import"./chunk-DELOOZDJ.js";import"./chunk-2WH2EVR6.js";var Tt=["element"],kt=["*",[["content"]]],Ot=["*","content"];function Nt(i,e){if(i&1&&(a(0,"div",4,0),L(2,1),r(),_(3,"lg-portal",5)),i&2){let t=R(1),o=f();q("left",o.coordinates().x,"px")("top",o.coordinates().y,"px"),n(3),s("appendTarget","body")("targetElement",t)("wrapClass","tooltip")}}var U=class i{constructor(){}gap=D(16);displayed=p(!1);full=D(!1);position=D("top");element=E("element");onClose=T();coordinates=p({x:0,y:0});toggle(e){if(this.displayed.set(!this.displayed()),this.displayed()||this.onClose.emit(),e){e.stopPropagation();let[t,o]=[e.clientX,e.clientY];setTimeout(()=>{let c=(this.element()?.nativeElement).getBoundingClientRect(),P=c.width,B=c.height,K=window.innerWidth,X=window.innerHeight,y=16,G=t,H=o;t+P+y>K&&(G=K-P-y),o+B+y>X&&(H=X-B-y),t-P-y<0&&(G=y),o-B-y<0&&(H=y),this.coordinates.set({x:G,y:H})})}}close(){this.displayed.set(!1),this.onClose.emit()}onClick(e){e.target instanceof HTMLElement&&(e.target.closest(".tooltip")||(this.displayed.set(!1),this.onClose.emit()))}onKeydown(e){e.key==="Escape"&&(this.displayed.set(!1),this.onClose.emit())}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=w({type:i,selectors:[["lg-tooltip"]],viewQuery:function(t,o){t&1&&S(o.element,Tt,5),t&2&&A()},hostBindings:function(t,o){t&1&&d("click",function(c){return o.onClick(c)},Q)("keydown",function(c){return o.onKeydown(c)},Q)},inputs:{gap:[1,"gap"],full:[1,"full"],position:[1,"position"]},outputs:{onClose:"onClose"},ngContentSelectors:Ot,decls:5,vars:6,consts:[["element",""],[1,"tooltip",3,"ngClass"],[1,"tooltip__anchor"],[3,"click"],[1,"tooltip__content"],[3,"appendTarget","targetElement","wrapClass"]],template:function(t,o){t&1&&($(kt),a(0,"div",1)(1,"div",2)(2,"div",3),d("click",function(c){return o.toggle(c)}),L(3),r(),u(4,Nt,4,7),r()()),t&2&&(q("--gap",o.gap(),"px"),M("fullscreen",o.full()),s("ngClass",o.position()),n(4),m(o.displayed()?4:-1))},dependencies:[rt,yt],styles:[".tooltip[_ngcontent-%COMP%]{position:relative;display:inline-block}.tooltip__anchor[_ngcontent-%COMP%]{position:relative}.tooltip__content[_ngcontent-%COMP%]{position:absolute;background-color:#fff;border-radius:16px;padding:16px;box-shadow:0 4px 8px #0000001a;z-index:100}.tooltip.top[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%], .tooltip.bottom[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%]{bottom:calc(100% + var(--gap));right:50%;transform:translate(50%)}.tooltip.left[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%]{bottom:50%;right:calc(100% + var(--gap));transform:translateY(50%)}.tooltip.right[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%]{bottom:50%;left:calc(100% + var(--gap));transform:translateY(-50%)}.tooltip.fullscreen[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#fff;border-radius:0;padding:32px;transform:none;overflow-y:auto}"]})};function Wt(i,e){if(i&1){let t=b();a(0,"div",3)(1,"lg-eggs-widget",4),d("changed",function(l){C(t);let c=f();return h(c.onEggsChanged(l))}),r()()}}var j=class i{constructor(){}eggsChanged=T();selectedWidget=p(null);onWidgetSelect(e){this.selectedWidget.set(e)}onEggsChanged(e){e&&this.eggsChanged.emit(e)}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=w({type:i,selectors:[["lg-amount-widgets"]],outputs:{eggsChanged:"eggsChanged"},decls:5,vars:3,consts:[[1,"amount-widgets"],[1,"amount-widgets__buttons"],[1,"amount-widgets__button",3,"click"],[1,"amount-widgets__wrapper"],[3,"changed"]],template:function(t,o){t&1&&(a(0,"div",0)(1,"div",1)(2,"button",2),d("click",function(){return o.onWidgetSelect("eggs")}),g(3,"Eggs "),r()(),u(4,Wt,2,0,"div",3),r()),t&2&&(M("selected",o.selectedWidget()!=null),n(4),m(o.selectedWidget()==="eggs"?4:-1))},dependencies:[It],styles:[".amount-widgets[_ngcontent-%COMP%]{display:flex;gap:16px;flex-direction:column}.amount-widgets__input[_ngcontent-%COMP%]{flex:1}.amount-widgets__buttons[_ngcontent-%COMP%]{display:flex;gap:16px;flex-wrap:wrap;padding:16px;background-color:#fafafa;border-radius:12px;margin:-16px}.amount-widgets.selected[_ngcontent-%COMP%]   .amount-widgets__buttons[_ngcontent-%COMP%]{margin-bottom:0}.amount-widgets__button[_ngcontent-%COMP%]{display:flex;padding:8px 16px;border-radius:16px;background-color:#e5de38;appearance:none;border:none;font-family:inherit;font-size:inherit}"]})};var Gt=["nameField"];function Ht(i,e){if(i&1&&_(0,"lg-chips-list",21),i&2){let t=f(),o=R(27);s("control",o)("items",t.topCategories())}}var V=class i{constructor(e,t,o,l){this._productsRepository=e;this._selectResourcesService=t;this._router=o;this._notificationsService=l}form=new _t({name:new x(null,I.required),amount:new x(null,I.required),price:new x(null,I.required),unit:new x("gram"),source:new x(null),category_id:new x(null,I.required)});buttons=[{label:"Grams",value:"gram",style:"secondary",onClick:()=>{console.log("Grams")}},{label:"Pieces",value:"piece",style:"secondary",onClick:()=>{console.log("Piece")}}];product=D(null);topCategories=p([]);topSources=p([]);nameField=E("nameField");productEffect=nt(()=>{this.product()&&(this.form.reset(this.product()),this.form.markAsPristine())});get value(){return this.form.value}get _defFormValue(){return{name:null,amount:null,price:null,source:null,category_id:null,unit:"gram"}}get _formValid(){return this.form.valid}get _productModel(){return F(this.value)}eggsChanged(e){this.form.patchValue({amount:e})}ngOnInit(){this._loadUsingHistory()}resetForm(e){this.form.reset(e??this._defFormValue),this.form.markAsPristine(),this._loadUsingHistory()}validateForm(){return this._formValid?!0:(this._notificationsService.error(this._notificationsService.parseFormErrors(this.form).join(", ")),!1)}ngAfterViewInit(){this._selectResourcesService.load().then(e=>{}),this.form.markAsPristine()}_loadUsingHistory(){this._productsRepository.getTopCategories().then(e=>{this.topCategories.set(e.map(t=>({label:t.name,value:t.uuid})))}),this._productsRepository.getTopSources().then(e=>{this.topSources.set(e.map(t=>({label:t,value:t})))})}static \u0275fac=function(t){return new(t||i)(v(O),v(bt),v(k),v(W))};static \u0275cmp=w({type:i,selectors:[["lg-add-product-form"]],viewQuery:function(t,o){t&1&&S(o.nameField,Gt,5),t&2&&A()},inputs:{product:[1,"product"]},decls:29,vars:16,consts:[["nameField",""],["priceInput",""],["sourceInput",""],["sourceChips",""],["categorySelect",""],[3,"formGroup"],["label","Name"],["formControlName","name",3,"key","resource"],[3,"bottom","mobileMode"],["label","Amount","lgExpand",""],["formControlName","amount","lgParseMath","",3,"onInputChange","placeholder"],["ngProjectAs","after",5,["after"]],[3,"position"],["ngProjectAs","content",5,["content"]],[3,"eggsChanged"],["formControlName","unit",3,"items"],["label","Price"],["formControlName","price","lgParseMath","",3,"placeholder"],["label","Source"],["formControlName","source",3,"onSelected","noLoad","resource"],[3,"hidden"],[3,"control","items"],["label","Category"],["formControlName","category_id",3,"resource"]],template:function(t,o){if(t&1){let l=b();a(0,"form",5)(1,"lg-gap-column")(2,"lg-control",6),_(3,"lg-autocomplete",7,0),r(),a(5,"lg-gap-row",8)(6,"lg-control",9)(7,"lg-number-input",10),d("onInputChange",function(){C(l);let P=R(16);return h(P.focus())}),a(8,"div",11)(9,"lg-tooltip",12),g(10," Widgets "),a(11,"div",13)(12,"lg-amount-widgets",14),d("eggsChanged",function(P){return C(l),h(o.eggsChanged(P))}),r()()()()()(),_(13,"lg-buttons-group",15),r(),a(14,"lg-control",16),_(15,"lg-number-input",17,1),r(),a(17,"lg-gap-column")(18,"lg-control",18)(19,"lg-autocomplete",19,2),d("onSelected",function(){C(l);let P=R(23);return h(P.clearSelected())}),r()(),a(21,"div",20),_(22,"lg-chips-list",21,3),r()(),a(24,"lg-gap-column")(25,"lg-control",22),_(26,"lg-multiselect",23,4),r(),u(28,Ht,1,2,"lg-chips-list",21),r()()()}if(t&2){let l=R(20);s("formGroup",o.form),n(3),s("key","name")("resource","products-names"),n(2),s("bottom",!0)("mobileMode",!0),n(2),s("placeholder","In "+o.form.value.unit),n(2),s("position","left"),n(4),s("items",o.buttons),n(2),s("placeholder","For the entire product in your currency"),n(4),s("noLoad",!0)("resource","sources"),n(2),s("hidden",!o.topSources().length),n(),s("control",l)("items",o.topSources()),n(4),s("resource","categories"),n(2),m(o.topCategories().length?28:-1)}},dependencies:[Pt,Ct,ft,gt,ht,vt,wt,ut,Rt,xt,U,j,At,N,Dt,St,Et,Vt],styles:[`lg-eggs-widget{min-width:300px}
`],encapsulation:2})};function Qt(i,e){if(i&1&&(g(0),et(1,"date")),i&2){let t,o=f(2);tt(" (last edited ",ot(1,1,(t=o.product())==null?null:t.updatedAt,"short"),") ")}}function qt(i,e){if(i&1&&(a(0,"lg-title"),g(1,"Edit Product"),r(),u(2,Qt,2,4)),i&2){let t,o=f();n(2),m((t=o.product())!=null&&t.updatedAt?2:-1)}}function Lt(i,e){i&1&&(a(0,"lg-title"),g(1,"Add Product"),r())}function zt(i,e){i&1&&g(0," (saved as draft) ")}function Yt(i,e){if(i&1){let t=b();a(0,"lg-button",5),d("click",function(){C(t);let l=f();return h(l.onEditProduct())}),g(1," Edit Product "),r()}}function Kt(i,e){if(i&1){let t=b();a(0,"lg-button",5),d("click",function(){C(t);let l=f();return h(l.onAddProduct())}),g(1," Add Product "),r()}}function Xt(i,e){if(i&1){let t=b();a(0,"lg-button",5),d("click",function(){C(t);let l=f();return h(l.onRemoveDraft())}),g(1," Delete this draft "),r()}i&2&&Z("danger")}var Mt=class i{constructor(e,t,o,l){this._router=e;this._aRoute=t;this._productsRepository=o;this._notificationsService=l}draftOrProductUUID=p(void 0);product=p(null);formComponent=E(V);draftRef=p(null);draftByExistingProduct=it(()=>this.draftRef().meta?.uuid);isDraftRoute=p(!1);ngOnInit(){this._aRoute.params.subscribe(e=>{this.draftOrProductUUID.set(e.uuid),this._loadProduct(this.draftOrProductUUID())}),this._aRoute.data.subscribe(e=>{e.draft&&(this.draftRef.set(e.draft),this.product.set(e.draft.data)),this.isDraftRoute.set(!!e.draftRoute)})}ngAfterViewInit(){this.formComponent()?.form.valueChanges.pipe(J(500)).subscribe(e=>{this.formComponent().form.dirty&&(this.draftRef()?.uuid?this._productsRepository.updateDraftProduct(this.draftRef().uuid,e,this.draftRef().meta?.uuid):this.draftRef.set(this._productsRepository.saveDraftProduct(e,this.draftOrProductUUID()??"")))})}onAddProduct(){this.formComponent()?.validateForm()&&this._addProduct(this.formComponent().value)}onEditProduct(){this.formComponent()?.validateForm()&&this._editProduct(this.formComponent().value)}onRemoveDraft(){this._removeDraft(),this._router.navigate(["products"])}_addProduct(e){this._productsRepository.addProduct(F(e)).then(()=>{this.formComponent()?.resetForm(),this._notificationsService.success("Product added"),this.draftRef()&&this._removeDraft(),this.isDraftRoute()&&this._router.navigate(["products"])})}_editProduct(e){if(!this.draftOrProductUUID())return;let t=this.draftRef()?.meta?.uuid??this.draftOrProductUUID();this._productsRepository.editProduct(t,F(e)).then(()=>{this.formComponent()?.resetForm(e),this._notificationsService.success("Product edited"),this.draftRef()&&this._removeDraft(),this.isDraftRoute()&&this._router.navigate(["products","edit",t])})}_removeDraft(){this.draftRef()&&(this._productsRepository.removeDraftProduct(this.draftRef().uuid),this.draftRef.set(null))}_loadProduct(e){e&&this._productsRepository.getOne(e).then(t=>{t&&this.product.set(t)})}static \u0275fac=function(t){return new(t||i)(v(k),v(lt),v(O),v(W))};static \u0275cmp=w({type:i,selectors:[["app-add-recipe"]],viewQuery:function(t,o){t&1&&S(o.formComponent,V,5),t&2&&A()},decls:12,vars:8,consts:[[3,"center"],[3,"product"],[3,"mobileMode","relaxed"],["lgShrink",""],["lgShrink","",3,"style"],["lgShrink","",3,"click"]],template:function(t,o){t&1&&(a(0,"lg-fade-in")(1,"lg-container")(2,"lg-gap-row",0),u(3,qt,3,1)(4,Lt,2,0,"lg-title"),u(5,zt,1,0),r(),a(6,"lg-card"),_(7,"lg-add-product-form",1),r(),a(8,"lg-gap-row",2),u(9,Yt,2,0,"lg-button",3)(10,Kt,2,0,"lg-button",3),u(11,Xt,2,2,"lg-button",4),r()()()),t&2&&(n(2),s("center",!0),n(),m(o.product()&&!o.draftRef()||o.draftRef()&&o.draftByExistingProduct()?3:4),n(2),m(o.draftRef()?5:-1),n(2),s("product",o.product()),n(),s("mobileMode",!0)("relaxed",!0),n(),m(o.product()&&!o.draftRef()||o.draftRef()&&o.draftByExistingProduct()?9:10),n(2),m(o.isDraftRoute()?11:-1))},dependencies:[st,dt,ct,V,N,pt,mt,Ft,at],encapsulation:2})};export{Mt as AddProductComponent};
