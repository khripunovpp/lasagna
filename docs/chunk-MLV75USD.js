import{a as pt}from"./chunk-PZ6Z5BDB.js";import{a as ie}from"./chunk-QYTKUNDN.js";import{a as zt,b as $t,c as Xt,d as Jt}from"./chunk-DY5WXTZC.js";import{a as te}from"./chunk-Q56LPNQI.js";import{a as Lt,b as Yt,c as Kt,d as Zt}from"./chunk-43NZQBGQ.js";import{a as qt}from"./chunk-BREASPLR.js";import"./chunk-OFWTFEIU.js";import{a as Wt}from"./chunk-NCPTV64V.js";import{a as Ht,b as Gt}from"./chunk-LLOITE6A.js";import{a as Ot}from"./chunk-65NIFZWP.js";import{a as oe}from"./chunk-NFJS7NYG.js";import{a as ee}from"./chunk-KTPZYF43.js";import{a as Qt}from"./chunk-MTKE3TKK.js";import{a as jt}from"./chunk-VNTOICFK.js";import{a as $}from"./chunk-KB5VWG36.js";import{a as Nt}from"./chunk-ACHQGNI7.js";import{a as Mt,b as X}from"./chunk-4GMAHVOM.js";import{a as Ut}from"./chunk-2AG3W6NR.js";import{a as Bt}from"./chunk-6OA5NOZV.js";import"./chunk-SNDQO5FA.js";import{a as dt,j as z,p as K}from"./chunk-KHHX4XAO.js";import"./chunk-PPZB7COH.js";import"./chunk-5KSZNU56.js";import{a as Vt}from"./chunk-TCTFHDUI.js";import"./chunk-H5OOR6F4.js";import{d as L,f as At,g as Tt,h as It,i as A,k as Et,m as Dt,p as Ft,s as kt,u as Y,v as J}from"./chunk-3I72GHQM.js";import"./chunk-6D4L3YT6.js";import{o as Rt,r as q}from"./chunk-2UE5YCBQ.js";import"./chunk-652DFWNF.js";import{f as wt,l as St}from"./chunk-GM4BKM5X.js";import{$ as O,$b as H,Cc as Q,Db as a,Dc as k,Eb as l,Ec as V,F as U,Fb as b,H as ft,Jb as x,Mb as g,Nb as _,Ob as vt,Pb as at,T as gt,Ta as _t,Ua as rt,Va as n,Xb as E,Yb as D,Za as j,Zb as T,_a as P,_b as u,ac as R,bc as G,db as S,ga as v,gb as Ct,ha as y,ib as lt,ic as yt,jc as Pt,kc as bt,na as h,oc as p,pc as c,qb as d,qc as B,r as mt,rb as ht,sb as W,tb as N,wb as m,yb as f,yc as xt,zc as F}from"./chunk-ESI6QU3H.js";import"./chunk-DELOOZDJ.js";import"./chunk-2WH2EVR6.js";var re=["element"],le=["*",[["content"]]],ae=["*","content"];function de(i,e){if(i&1&&(a(0,"div",4,0),at(2,1),l(),b(3,"lg-portal",5)),i&2){let t=T(1);n(3),d("appendTarget","body")("targetElement",t)("wrapClass","tooltip tooltip--ejected")}}var Z=class i{constructor(){}renderer=O(j);gap=k(16);displayed=h(!1);full=k(!1);position=k("top");element=V("element");onClose=Q();coordinates=h({x:0,y:0});coordinatesEffect=F(()=>{this.renderer.setProperty(document.body,"style",`--tooltip-x: ${this.coordinates().x}px;--tooltip-y: ${this.coordinates().y}px;`)});toggle(e){if(this.displayed.set(!this.displayed()),this.displayed()||this.onClose.emit(),e){e.stopPropagation();let[t,o]=[e.clientX,e.clientY];console.log("x",t,"y",o),setTimeout(()=>{let s=this.element()?.nativeElement?.getBoundingClientRect(),C=s?.width,I=s?.height,ct=window.innerWidth,ut=window.innerHeight,w=16,it=t,nt=o;t+C+w>ct&&(it=ct-C-w),o+I+w>ut&&(nt=ut-I-w),t-C-w<0&&(it=w),o-I-w<0&&(nt=w),this.coordinates.set({x:it,y:nt})})}}close(){this.displayed.set(!1),this.onClose.emit()}onClick(e){e.target instanceof HTMLElement&&(e.target.closest(".tooltip")||(this.displayed.set(!1),this.onClose.emit()))}onKeydown(e){e.key==="Escape"&&(this.displayed.set(!1),this.onClose.emit())}onScroll(e){this.displayed.set(!1),this.onClose.emit()}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=S({type:i,selectors:[["lg-tooltip"]],viewQuery:function(t,o){t&1&&E(o.element,re,5),t&2&&D()},hostBindings:function(t,o){t&1&&g("click",function(s){return o.onClick(s)},rt)("keydown",function(s){return o.onKeydown(s)},rt)("scroll",function(s){return o.onScroll(s)},_t)},inputs:{gap:[1,"gap"],full:[1,"full"],position:[1,"position"]},outputs:{onClose:"onClose"},ngContentSelectors:ae,decls:5,vars:6,consts:[["element",""],[1,"tooltip",3,"ngClass"],[1,"tooltip__anchor"],[3,"click"],[1,"tooltip__content"],[3,"appendTarget","targetElement","wrapClass"]],template:function(t,o){t&1&&(vt(le),a(0,"div",1)(1,"div",2)(2,"div",3),g("click",function(s){return o.toggle(s)}),at(3),l(),m(4,de,4,3),l()()),t&2&&(ht("--gap",o.gap(),"px"),W("fullscreen",o.full()),d("ngClass",o.position()),n(4),f(o.displayed()?4:-1))},dependencies:[wt,Wt],styles:[`lg-tooltip{flex:1;display:flex}.tooltip{display:inline-block}.tooltip--ejected{position:fixed;z-index:6;inset:0}.tooltip--ejected .tooltip__content{inset:0;position:fixed;display:flex;align-items:center;justify-content:center;padding-top:calc(var(--header-height) + 12px + 16px + 16px)}.tooltip__anchor{position:relative}.tooltip__content{position:absolute;background-color:#fff;border-radius:16px;padding:16px;box-shadow:0 4px 8px #0000001a;z-index:100}.tooltip.top .tooltip__content,.tooltip.bottom .tooltip__content{bottom:calc(100% + var(--gap));right:50%;transform:translate(50%)}.tooltip.left .tooltip__content{bottom:50%;right:calc(100% + var(--gap));transform:translateY(50%)}.tooltip.right .tooltip__content{bottom:50%;left:calc(100% + var(--gap));transform:translateY(-50%)}.tooltip.fullscreen .tooltip__content{position:fixed;inset:0;background-color:#fff;border-radius:0;padding:32px;transform:none;overflow-y:auto}
`],encapsulation:2})};function pe(i,e){if(i&1){let t=x();a(0,"div",3)(1,"lg-eggs-widget",4),g("changed",function(r){v(t);let s=_();return y(s.onEggsChanged(r))}),l()()}}var et=class i{constructor(){}eggsChanged=Q();selectedWidget=h(null);onWidgetSelect(e){this.selectedWidget.set(e)}onEggsChanged(e){e&&this.eggsChanged.emit(e)}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=S({type:i,selectors:[["lg-amount-widgets"]],outputs:{eggsChanged:"eggsChanged"},decls:5,vars:3,consts:[[1,"amount-widgets"],[1,"amount-widgets__buttons"],[1,"amount-widgets__button",3,"click"],[1,"amount-widgets__wrapper"],[3,"changed"]],template:function(t,o){t&1&&(a(0,"div",0)(1,"div",1)(2,"button",2),g("click",function(){return o.onWidgetSelect("eggs")}),u(3,"Eggs "),l()(),m(4,pe,2,0,"div",3),l()),t&2&&(W("selected",o.selectedWidget()!=null),n(4),f(o.selectedWidget()==="eggs"?4:-1))},dependencies:[ie],styles:[".amount-widgets[_ngcontent-%COMP%]{display:flex;gap:16px;flex-direction:column}.amount-widgets__input[_ngcontent-%COMP%]{flex:1}.amount-widgets__buttons[_ngcontent-%COMP%]{display:flex;gap:16px;flex-wrap:wrap;padding:16px;background-color:#fafafa;border-radius:12px;margin:-16px}.amount-widgets.selected[_ngcontent-%COMP%]   .amount-widgets__buttons[_ngcontent-%COMP%]{margin-bottom:0}.amount-widgets__button[_ngcontent-%COMP%]{display:flex;padding:8px 16px;border-radius:16px;background-color:#e5de38;appearance:none;border:none;font-family:inherit;font-size:inherit}"]})};var ot=class i{transform(e){try{return Intl.NumberFormat("en",{style:"currency",currency:e}).formatToParts().find(t=>t.type==="currency")?.value??""}catch{return e}}static \u0275fac=function(t){return new(t||i)};static \u0275pipe=Ct({name:"currencySymbol",type:i,pure:!0})};var me=["nameField"],fe=i=>({unit:i}),ge=()=>({currency:"EUR"});function _e(i,e){if(i&1&&b(0,"lg-chips-list",24),i&2){let t=_(),o=T(41);d("control",o)("items",t.topCategories())}}var M=class i{constructor(e,t,o,r){this._productsRepository=e;this._selectResourcesService=t;this._router=o;this._notificationsService=r}form=new It({name:new A(null,L.required),amount:new A(null,L.required),price:new A(null,L.required),unit:new A("gram"),source:new A(null),category_id:new A(null),tags:new A([])});userSettings=O(ee);product=k(null);topCategories=h([]);topSources=h([]);nameField=V("nameField");productEffect=F(()=>{!this.product()||this.form.dirty||(console.log("Product effect",this.product()),this.form.reset(pt(this.product())),this.form.markAsPristine())});get _defFormValue(){return{name:null,amount:null,price:null,source:null,category_id:null,unit:"gram",tags:[]}}get _formValid(){return this.form.valid}eggsChanged(e){this.form.patchValue({amount:e})}ngOnInit(){this._loadUsingHistory(),this.form.valueChanges.pipe(gt(e=>console.log("Form value changed",e)),U(100)).subscribe(e=>{this.form.dirty&&this.product()?.update(e)})}resetForm(e){console.log("Reset form",e),this.form.reset(e?pt(e):this._defFormValue),this.form.markAsPristine(),this._loadUsingHistory()}validateForm(){return this._formValid?!0:(this._notificationsService.error(this._notificationsService.parseFormErrors(this.form).join(", ")),!1)}ngAfterViewInit(){this._selectResourcesService.load().then(e=>{}),this.product()?.uuid||this.nameField().focus(),this.form.markAsPristine()}_loadUsingHistory(){this._productsRepository.getTopCategories().then(e=>{this.topCategories.set(e.map(t=>({label:t.name,value:t.uuid??"",color:t.ownColor})))}),this._productsRepository.getTopSources().then(e=>{this.topSources.set(e.map(t=>({label:t,value:t})))})}smaller=Yt;static \u0275fac=function(t){return new(t||i)(P(K),P(Vt),P(q),P(Y))};static \u0275cmp=S({type:i,selectors:[["lg-add-product-form"]],viewQuery:function(t,o){t&1&&E(o.nameField,me,5),t&2&&D()},inputs:{product:[1,"product"]},decls:44,vars:48,consts:[["nameField",""],["priceInput",""],["sourceInput",""],["sourceChips",""],["categorySelect",""],[3,"formGroup"],["formControlName","name",3,"key","placeholder","resource"],[3,"center","mobileMode"],["lgExpand","",3,"center","mobileMode","size"],["lgExpand",""],["formControlName","amount","lgParseMath","",3,"onInputChange","placeholder"],["ngProjectAs","after",5,["after"]],[3,"center","size"],[3,"position"],[3,"flat","icon"],["aria-hidden","false","fontIcon","add"],["ngProjectAs","content",5,["content"]],[3,"eggsChanged"],["formControlName","unit"],["lgWidth","40%"],["formControlName","price","lgParseMath","",3,"placeholder"],[2,"--control-bg","#ffffff",3,"equal","mobileMode","top"],["formControlName","source",3,"onSelected","noLoad","placeholder","resource"],[3,"hidden"],[3,"control","items"],["formControlName","category_id",3,"placeholder","resource"]],template:function(t,o){if(t&1){let r=x();a(0,"form",5)(1,"lg-gap-column")(2,"lg-card")(3,"lg-gap-column")(4,"lg-control"),b(5,"lg-autocomplete",6,0),p(7,"translate"),l(),a(8,"lg-gap-row",7)(9,"lg-gap-row",8)(10,"lg-control",9)(11,"lg-number-input",10),p(12,"translate"),g("onInputChange",function(){v(r);let C=T(23);return y(C.focus())}),a(13,"div",11)(14,"lg-gap-row",12)(15,"lg-tooltip",13)(16,"lg-button",14),b(17,"mat-icon",15),l(),a(18,"div",16)(19,"lg-amount-widgets",17),g("eggsChanged",function(C){return v(r),y(o.eggsChanged(C))}),l()()(),b(20,"lg-unit-switcher",18),l()()()()(),a(21,"lg-control",19)(22,"lg-number-input",20,1),p(24,"translate"),a(25,"div",11)(26,"span"),u(27),p(28,"currencySymbol"),l()()()()()()(),a(29,"lg-gap-row",21)(30,"lg-gap-column")(31,"lg-control")(32,"lg-autocomplete",22,2),p(34,"translate"),g("onSelected",function(){v(r);let C=T(37);return y(C.clearSelected())}),l()(),a(35,"div",23),b(36,"lg-chips-list",24,3),l()(),a(38,"lg-gap-column")(39,"lg-control"),b(40,"lg-multiselect",25,4),p(42,"translate"),l(),m(43,_e,1,2,"lg-chips-list",24),l()()()()}if(t&2){let r=T(33);d("formGroup",o.form),n(5),d("key","name")("placeholder",c(7,31,"product.form.name.placeholder"))("resource","products-names"),n(3),d("center",!0)("mobileMode",!0),n(),d("center",!0)("mobileMode",!0)("size","small"),n(2),d("placeholder",B(12,33,"product.form.amount.placeholder",bt(45,fe,o.form.value.unit))),n(3),d("center",!0)("size","small"),n(),d("position","left"),n(),N("success"),d("flat",!0)("icon",!0),n(6),d("placeholder",B(24,36,"product.form.price.placeholder",Pt(47,ge))),n(5),H(c(28,39,o.userSettings().currency)),n(2),d("equal",!0)("mobileMode",!0)("top",!0),n(3),d("noLoad",!0)("placeholder",c(34,41,"product.form.source.placeholder"))("resource","sources"),n(3),d("hidden",!o.topSources().length),n(),d("control",r)("items",o.topSources()),n(4),d("placeholder",c(42,43,"product.form.category_id.placeholder"))("resource","categories"),n(3),f(o.topCategories().length?43:-1)}},dependencies:[kt,Et,At,Tt,Dt,Ft,qt,$,zt,Lt,Z,et,Kt,X,Qt,$t,Xt,z,Nt,jt,J,te,Jt,ot],styles:[`lg-eggs-widget{min-width:300px}
`],encapsulation:2})};function Ce(i,e){if(i&1&&(a(0,"lg-title"),u(1),p(2,"translate"),l()),i&2){let t,o=_();n(),G(" ",c(2,2,"edit-label")," ",(t=o.product())==null?null:t.name," ")}}function he(i,e){i&1&&(a(0,"lg-title"),u(1),p(2,"translate"),l()),i&2&&(n(),R(" ",c(2,1,"product.form.title")," "))}function ve(i,e){if(i&1&&(u(0),p(1,"userCurrency")),i&2){let t,o=_();G(" (",(t=o.product())==null?null:t.perUnitLabel," ",B(1,2,(t=o.product())==null?null:t.pricePerUnit,"1.0-5"),") ")}}function ye(i,e){i&1&&(a(0,"span"),u(1),p(2,"translate"),l()),i&2&&(n(),H(c(2,1,"saved-draft-label")))}function Pe(i,e){i&1&&lt(0,ye,3,3,"ng-template",2)}function be(i,e){if(i&1){let t=x();a(0,"lg-button",8),g("click",function(){v(t);let r=_(2);return y(r.onRemoveDraft())}),u(1),p(2,"translate"),l()}i&2&&(N("danger"),d("flat",!0),n(),R(" ",c(2,4,"product.form.delete-draft-btn")," "))}function xe(i,e){if(i&1){let t=x();a(0,"lg-button",8),g("click",function(){v(t);let r=_(2);return y(r.onDeleteProduct())}),u(1),p(2,"translate"),l()}i&2&&(N("danger"),d("flat",!0),n(),R(" ",c(2,4,"product.form.delete-btn")," "))}function we(i,e){if(i&1&&m(0,be,3,6,"lg-button",7)(1,xe,3,6,"lg-button",7),i&2){let t,o=_();f(o.isDraftRoute()?0:(t=o.product())!=null&&t.uuid?1:-1)}}function Se(i,e){if(i&1&&(a(0,"small",3),u(1),p(2,"translate"),p(3,"timeAgo"),l()),i&2){let t,o=_();n(),G(" ",c(2,2,"edited-at-label")," ",c(3,4,(t=o.product())==null?null:t.updatedAt)," ")}}function Re(i,e){i&1&&(u(0),p(1,"translate")),i&2&&R(" ",c(1,1,"product.form.save-btn.edit.active")," ")}function Ae(i,e){i&1&&(u(0),p(1,"translate")),i&2&&R(" ",c(1,1,"product.form.save-btn.edit.disabled")," ")}function Te(i,e){if(i&1){let t=x();a(0,"lg-button",9),g("click",function(){v(t);let r=_();return y(r.onEditProduct())}),m(1,Re,2,3)(2,Ae,2,3),l()}if(i&2){let t,o,r=_();d("disabled",!(!((t=r.formComponent())==null||t.form==null)&&t.form.dirty)&&!r.draftRef()),n(),f(!((o=r.formComponent())==null||o.form==null)&&o.form.dirty||r.draftRef()?1:2)}}function Ie(i,e){i&1&&(u(0),p(1,"translate")),i&2&&R(" ",c(1,1,"product.form.save-btn.add.active")," ")}function Ee(i,e){i&1&&(u(0),p(1,"translate")),i&2&&R(" ",c(1,1,"product.form.save-btn.add.disabled")," ")}function De(i,e){if(i&1){let t=x();a(0,"lg-button",9),g("click",function(){v(t);let r=_();return y(r.onAddProduct())}),m(1,Ie,2,3)(2,Ee,2,3),l()}if(i&2){let t,o,r=_();d("disabled",!(!((t=r.formComponent())==null||t.form==null)&&t.form.dirty)&&!r.draftRef()),n(),f(!((o=r.formComponent())==null||o.form==null)&&o.form.dirty||r.draftRef()?1:2)}}var ne=class i{constructor(e,t,o,r,s){this._router=e;this._aRoute=t;this._productsRepository=o;this._notificationsService=r;this._renderer=s}draftOrProductUUID=h(void 0);product=h(null);formComponent=V(M);draftRef=h(null);draftByExistingProduct=xt(()=>this.draftRef().meta?.uuid);isDraftRoute=h(!1);productEffect=F(()=>{this.product()?this._renderer.setProperty(document.body,"style",`--background-color: ${this.product().ownColor}`):this._renderer.removeAttribute(document.body,"style")});ngOnDestroy(){this._renderer.removeAttribute(document.body,"style")}ngOnInit(){mt([this._aRoute.params,this._aRoute.data]).pipe(ft(1)).subscribe(([e,t])=>{this.draftOrProductUUID.set(e.uuid),t.draft?(this.draftRef.set(t.draft),this.product.set(dt.fromRaw(t.draft.data))):this.draftOrProductUUID()?this._loadProduct(this.draftOrProductUUID()):this.product.set(dt.empty()),this.isDraftRoute.set(!!t.draftRoute)})}ngAfterViewInit(){this.formComponent()?.form.valueChanges.pipe(U(500)).subscribe(e=>{!this.formComponent().form.dirty||!this.product()||(this.draftRef()?.uuid?this._productsRepository.updateDraftProduct(this.draftRef().uuid,this.product(),this.draftRef().meta?.uuid):this.product()&&(this.draftRef.set(this._productsRepository.saveDraftProduct(this.product(),this.draftOrProductUUID()??"")),this.isDraftRoute()||window.history.replaceState({},"",this._router.createUrlTree(["products/draft/"+this.draftRef().uuid]).toString())))})}onAddProduct(){!this.formComponent()?.validateForm()||!this.product()||this._addProduct(this.product())}onEditProduct(){!this.formComponent()?.validateForm()||!this.product()||this._editProduct(this.product())}onRemoveDraft(){this._removeDraft(),this._router.navigate(["products"])}onDeleteProduct(){this.product()?.uuid&&this._productsRepository.deleteProduct(this.product().uuid).then(()=>{this._notificationsService.success("Product deleted"),this._router.navigate(["products"])})}_addProduct(e){this._productsRepository.addOne(e).then(t=>{this.formComponent()?.resetForm(),this._notificationsService.success("Product added"),this.product.set(null),this.draftRef()&&this._removeDraft(),this._router.navigate(["products","edit",t])})}_editProduct(e){if(!this.draftOrProductUUID())return;let t=this.draftRef()?.meta?.uuid??this.draftOrProductUUID();this._productsRepository.updateOne(t,e).then(()=>{this.formComponent()?.resetForm(e),this._notificationsService.success("Product edited"),this.draftRef()&&this._removeDraft(),this._router.navigate(["products","edit",t])})}_removeDraft(){this.draftRef()&&(this._productsRepository.removeDraftProduct(this.draftRef().uuid),this.draftRef.set(null))}_loadProduct(e){e&&this._productsRepository.getOne(e,!0).then(t=>{t&&this.product.set(t)})}static \u0275fac=function(t){return new(t||i)(P(q),P(Rt),P(K),P(Y),P(j))};static \u0275cmp=S({type:i,selectors:[["app-add-recipe"]],viewQuery:function(t,o){t&1&&E(o.formComponent,M,5),t&2&&D()},features:[yt([St])],decls:15,vars:10,consts:[["size","medium"],[3,"center","mobileMode"],["lgInlineSeparatedGroup",""],[1,"text-muted","text-cursive"],[3,"product"],[3,"mobileMode","relaxed"],["lgShrink","",3,"disabled"],["lgShrink","",3,"style","flat"],["lgShrink","",3,"click","flat"],["lgShrink","",3,"click","disabled"]],template:function(t,o){if(t&1&&(a(0,"lg-fade-in")(1,"lg-container")(2,"lg-gap-column",0)(3,"lg-gap-row",1),m(4,Ce,3,4,"lg-title")(5,he,3,3,"lg-title"),m(6,ve,2,5),l(),a(7,"lg-inline-separated-group"),m(8,Pe,1,0,null,2),lt(9,we,2,1,"ng-template",2),l(),m(10,Se,4,6,"small",3),l(),b(11,"lg-add-product-form",4),a(12,"lg-gap-row",5),m(13,Te,3,2,"lg-button",6)(14,De,3,2,"lg-button",6),l()()()),t&2){let r,s,C,I;n(3),d("center",!0)("mobileMode",!0),n(),f((r=o.product())!=null&&r.uuid&&!o.draftRef()||o.draftRef()&&o.draftByExistingProduct()?4:5),n(2),f((s=o.product())!=null&&s.pricePerUnit?6:-1),n(2),f(o.draftRef()&&(!((C=o.formComponent())==null||C.form==null)&&C.form.dirty)?8:-1),n(2),f((I=o.product())!=null&&I.updatedAt?10:-1),n(),d("product",o.product()),n(),d("mobileMode",!0)("relaxed",!0),n(),f(o.product()&&!o.draftRef()||o.draftRef()&&o.draftByExistingProduct()?13:14)}},dependencies:[Mt,Bt,M,X,Ut,J,Zt,Ot,z,$,oe,Gt,Ht],encapsulation:2})};export{ne as AddProductComponent};
