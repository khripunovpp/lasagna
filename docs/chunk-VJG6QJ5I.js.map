{
  "version": 3,
  "sources": ["src/app/features/home/view/pwa-install.component.ts"],
  "sourcesContent": ["import {ChangeDetectionStrategy, Component, inject, OnInit, signal} from '@angular/core';\nimport {TranslatePipe} from '@ngx-translate/core';\nimport {AnalyticsService} from '../../../shared/service/services/analytics.service';\nimport {IS_PWA} from '../../../shared/helpers/match-media.helper';\nimport {NotificationsService} from '../../../shared/service/services';\nimport {errorHandler} from '../../../shared/helpers';\nimport {WINDOW} from '../../../shared/service/tokens/window.token';\n\n@Component({\n  selector: 'lg-pwa-install',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  template: `\n    @if (showButton()) {\n      <button (click)=\"installPWA()\">\n        {{ 'pwa.install' | translate }}\n      </button>\n    }\n  `,\n  styles: [`\n    :host {\n      display: contents;\n    }\n\n    button {\n      background-image: linear-gradient(45deg, #3F51B5, #9C27B0);\n      color: white;\n      border: none;\n      padding: 10px 20px;\n      cursor: pointer;\n      box-shadow: -15px 6px 8px 0px #eed2f0;\n      border-radius: 0 16px 16px 0;\n      background-size: calc(100% + 70px) 100%;\n      transition: background-position 0.3s ease;\n      text-decoration: none;\n      white-space: nowrap;\n    }\n\n    button:hover {\n      background-position: -70px 0;\n    }\n  `],\n  imports: [\n    TranslatePipe,\n  ]\n})\nexport class PwaInstallComponent implements OnInit {\n  readonly showButton = signal(false);\n  readonly isPwa = inject(IS_PWA);\n  private readonly analyticsService = inject(AnalyticsService);\n  private readonly _notificationsService = inject(NotificationsService);\n  private _deferredPrompt: any = null;\n  private readonly _window = inject(WINDOW);\n\n  ngOnInit(): void {\n    if (this._alreadyDeclined()) {\n      return;\n    }\n    if (!this._window) {\n      return;\n    }\n    this._window.addEventListener('beforeinstallprompt', (e: Event) => {\n      if (this._alreadyDeclined()) {\n        return;\n      }\n      this._deferredPrompt = e;\n      this.showButton.set(true);\n    });\n\n    this._window.addEventListener('appinstalled', () => {\n      this._onSuccess();\n    });\n  }\n\n  async installPWA(): Promise<void> {\n    try {\n      if (!this._deferredPrompt) return;\n      this._deferredPrompt.preventDefault();\n\n      this._deferredPrompt.prompt();\n\n      const {outcome} = await this._deferredPrompt.userChoice;\n      if (outcome === 'accepted') {\n        this._onSuccess();\n      } else {\n        this._onDecline();\n      }\n\n      this._deferredPrompt = null;\n      this.showButton.set(false);\n    } catch (error) {\n      this._notificationsService.error(errorHandler(error));\n    }\n  }\n\n  private _alreadyDeclined(): boolean {\n    try {\n      return this._window?.localStorage.getItem('pwa-install-declined') === 'true';\n    } catch {\n      return false;\n    }\n  }\n\n  private _setDeclinedStatus(value: boolean): void {\n    try {\n      this._window?.localStorage.setItem('pwa-install-declined', value ? 'true' : 'false');\n    } catch {\n      // ignore\n    }\n  }\n\n  private _onSuccess() {\n    console.log('PWA installed!');\n    this.showButton.set(false);\n    this.analyticsService.trackPwaInstallAccepted();\n  }\n\n  private _onDecline() {\n    console.log('User declined installation');\n    this.showButton.set(false);\n    this._setDeclinedStatus(true);\n    this.analyticsService.trackPwaInstallDeclined();\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
