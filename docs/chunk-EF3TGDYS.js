import{a as He}from"./chunk-MMV6CZNQ.js";import{a as Ze,b as Pe,c as p,d as Ve,e as je,f as qe}from"./chunk-BCVJ4CJP.js";import{a as Ae,b as Be}from"./chunk-BL3WXPIO.js";import"./chunk-56JP2GL7.js";import"./chunk-KQ5QEUS5.js";import{a as oe,b as Qe}from"./chunk-2WW3R3RU.js";import{a as Ne}from"./chunk-CH264JVT.js";import{a as Je}from"./chunk-EOJINCHP.js";import"./chunk-YAO3K425.js";import"./chunk-B7X622D5.js";import{a as Oe}from"./chunk-O43MYOCU.js";import{a as ie,b as ne}from"./chunk-HCUERNTX.js";import{a as $e}from"./chunk-C5H2I4FC.js";import{v as te}from"./chunk-H7EJM524.js";import"./chunk-EIVKJBV7.js";import{a as Fe}from"./chunk-TBBEROLX.js";import{a as G}from"./chunk-U5RG623K.js";import{a as ee}from"./chunk-65PBFSJ6.js";import{a as Y}from"./chunk-7C3OD2VZ.js";import"./chunk-4U4Z3QUR.js";import{a as Ge}from"./chunk-VPY63KRA.js";import"./chunk-MPFUNZLY.js";import{a as X}from"./chunk-O2QGAP6D.js";import{k as ze,m as W}from"./chunk-N7V5TNMA.js";import"./chunk-3KIH2YCB.js";import{E as we,I as ke,M as Le,U as Ee,ba as Me,ca as F,la as U,ma as x,na as D,o as Te,q as Ie,s as K}from"./chunk-4GDVHNJM.js";import{m as be,p as Re,q as H,u as J}from"./chunk-I72ENH6O.js";import"./chunk-CABIONZL.js";import{a as De}from"./chunk-EMIJRNYJ.js";import{i as he}from"./chunk-ZA7VU5CB.js";import{$a as o,$b as E,Bb as ge,Cc as u,Db as T,Dc as _,Ec as ye,Fb as I,Hb as fe,Ib as P,Jb as A,Kb as s,Lb as l,Mb as a,Nb as k,Nc as B,Qb as _e,Rb as h,Rc as xe,Vb as C,Wb as f,Xb as Ce,Yb as Se,Zb as L,ac as M,bb as j,ea as w,eb as g,hc as S,jc as c,kc as z,la as v,lb as b,lc as m,ma as y,mc as Q,nb as N,qb as R,ra as de,sb as ue,va as V,wc as $,xc as ve,yc as q}from"./chunk-X5WXA3YI.js";import"./chunk-2RGDSI3Q.js";import"./chunk-FK6H3RFT.js";import"./chunk-C6Q5SG76.js";var Ke=p.object({name:p.string(),amount:p.number().or(p.string()),uuid:p.string().optional(),product_id:je,recipe_id:p.lazy(()=>re),unit:p.enum(["gram","portion","piece"])});var re=p.object({name:p.string(),uuid:p.string().optional(),description:p.string(),ingredients:p.array(p.lazy(()=>Ke)),outcome_unit:Ve,outcome_amount:p.number().or(p.string()),taxTemplateName:p.string().optional(),category_id:p.string().nullable().optional(),createdAt:p.union([p.string(),p.number()]).optional(),updatedAt:p.union([p.string(),p.number()]).optional(),tags:p.array(p.string()).optional(),color:p.string().optional(),priceModifiers:p.array(p.object({action:p.enum(["add","subtract","round"]),value:p.number().or(p.string()),unit:p.enum(["currency","percent"])})).optional()});var Xe=i=>({length:i}),Ye=(i,t)=>t.uuid;function et(i,t){if(i&1){let e=h();l(0,"lg-button",4),C("click",function(){v(e);let r=f(2);return y(r.selectionZoneService.onSelection())}),c(1),u(2,"translate"),a()}i&2&&(S("success"),s("flat",!0)("size","small"),o(),m(" ",_(2,5,"select-many-label")," "))}function tt(i,t){if(i&1){let e=h();l(0,"lg-button",4),C("click",function(){v(e);let r=f(2);return y(r.deleteAllDrafts())}),c(1),u(2,"translate"),a()}i&2&&(S("danger"),s("flat",!0)("size","small"),o(),m(" ",_(2,5,"delete-all-label")," "))}function it(i,t){if(i&1){let e=h();l(0,"lg-button",5),C("click",function(){v(e);let r=f(3);return y(r.deletedSelectedDrafts())}),c(1),u(2,"translate"),a()}if(i&2){let e=f();S("danger"),s("flat",!0)("disabled",!(e!=null&&e.size))("size","small"),o(),m(" ",_(2,6,"delete-selected-label")," ")}}function nt(i,t){i&1&&R(0,it,3,8,"ng-template",1)}function ot(i,t){i&1&&(c(0),u(1,"translate")),i&2&&m(" ",_(1,1,"draft.list-prefix.existing")," ")}function rt(i,t){i&1&&(c(0),u(1,"translate")),i&2&&m(" ",_(1,1,"draft.list-prefix.new")," ")}function lt(i,t){if(i&1&&(l(0,"lg-flex-row",6)(1,"a",7),T(2,ot,2,3)(3,rt,2,3),c(4),a(),l(5,"small",8),c(6),u(7,"translate"),u(8,"timeAgo"),a()()),i&2){let e=f().$implicit;s("center",!0),o(),s("routerLink","/recipes/draft/"+(e==null?null:e.uuid)),o(),I(!(e==null||e.meta==null)&&e.meta.uuid?2:3),o(2),m(" ",(e==null||e.data==null?null:e.data.name)??""," "),o(2),Q(" ",_(7,6,"edited-at-label")," ",_(8,8,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," ")}}function at(i,t){if(i&1&&R(0,lt,9,10,"ng-template",3),i&2){let e=t.$implicit;s("uuid",e.uuid)}}function st(i,t){if(i&1){let e=h();l(0,"lg-expander",0),u(1,"translate"),u(2,"translate"),l(3,"lg-inline-separated-group"),R(4,et,3,7,"ng-template",1)(5,tt,3,7,"ng-template",1),T(6,nt,1,0,null,1),a(),l(7,"lg-card-list",2),C("onDeleteOne",function(r){v(e);let d=f();return y(d.deleteDraft(r==null?null:r.uuid))})("onSelected",function(r){v(e);let d=f();return y(d.selectionZoneService.putSelected(r))}),P(8,at,1,1,null,3,Ye),a()()}if(i&2){let e,n,r=f();s("closeLabel",_(1,6,"drafts-close-label"))("openLabel",ye(2,8,"drafts-label",q(11,Xe,(e=r.drafts())==null?null:e.length))),o(6),I((n=r.selectionZoneService.selected())?6:-1,n),o(),s("mode",r.selectionZoneService.selectionMode())("selectAll",r.selectionZoneService.selectAll())("deselectAll",r.selectionZoneService.deselectAll()),o(),A(r.drafts())}}var le=class i{constructor(t,e,n){this._recipesRepository=t;this._notificationsService=e;this.selectionZoneService=n}drafts=V([]);Stores=J;get hidden(){return this.drafts()?.length===0?!0:null}ngOnInit(){let t=this._recipesRepository.getDraftRecipe();t&&this.drafts.set(t)}deleteAllDrafts(){this._recipesRepository.removeDraftMany(this.drafts().map(t=>t.uuid)).then(()=>{this.drafts.set([]),this._notificationsService.success("Drafts deleted")})}deletedSelectedDrafts(){let t=this.selectionZoneService.selected();t&&this._recipesRepository.removeDraftMany(Array.from(t)).then(()=>{this.drafts.update(e=>e.filter(n=>!t.has(n.uuid))),this._notificationsService.success("Drafts deleted")})}deleteDraft(t){t&&(this._recipesRepository.removeDraftRecipe(t),this.drafts.update(e=>e.filter(n=>n?.uuid!==t)))}static \u0275fac=function(e){return new(e||i)(g(W),g(U),g(x))};static \u0275cmp=b({type:i,selectors:[["lg-draft-recipes-list"]],hostVars:1,hostBindings:function(e,n){e&2&&ge("hidden",n.hidden)},features:[$([x])],decls:1,vars:1,consts:[[3,"closeLabel","openLabel"],["lgInlineSeparatedGroup",""],[2,"--card-bg","#bee5ff",3,"onDeleteOne","onSelected","mode","selectAll","deselectAll"],["lgCardListItem","","type","draft",3,"uuid"],[3,"click","flat","size"],[3,"click","flat","disabled","size"],[3,"center"],["lgExpand","",3,"routerLink"],[1,"text-muted","text-cursive"]],template:function(e,n){if(e&1&&T(0,st,10,13,"lg-expander",0),e&2){let r;I((r=n.drafts())!=null&&r.length?0:-1)}},dependencies:[G,D,Qe,oe,H,ee,$e,F,qe,ne,ie],encapsulation:2})};var se=class i{constructor(t){this.templateRef=t}static \u0275fac=function(e){return new(e||i)(g(j))};static \u0275dir=N({type:i,selectors:[["","lgGroupingSortingContainer",""]]})};var pe=class i{constructor(t){this.translateService=t}groupingToLabel={category:"grouping.by-category",tag:"grouping.by-tag",createdAt:"grouping.by-creation-date",alphabetical:"grouping.by-first-letter"};groupingDirectionToLabel={asc:"grouping.direction.asc",desc:"grouping.direction.desc"};router=w(Re);aRouter=w(be);context;sortChange=new ue;groupChange=new ue;groupingParam=K("groupBy");sortDirection=K("sortDirection");sortField=K("sortField");defaultDirection="asc";sorting=V({field:"name",direction:this.defaultDirection,group:"category"});sortingEffect=B(()=>{let t=this.sorting();this.sortChange.emit(t)});ngOnInit(){let t=this.aRouter.snapshot.queryParams,e=this.groupingParam(),n=this.sortDirection(),r=this.sortField();this.sorting.set({field:r?.toString()||"name",direction:n?n==="asc"?"asc":"desc":this.defaultDirection,group:e?.toString()||"category"})}onSortChange(t){this.sorting.set({field:t.field||this.sorting().field,direction:t.direction||this.sorting().direction,group:t.group||this.sorting().group}),this.sortChange.emit(this.sorting()),this.router.navigate([],{queryParams:{sortField:t.field||this.sorting().field,sortDirection:t.direction||this.sorting().direction,groupBy:t.group||this.sorting().group},relativeTo:this.aRouter}).then(()=>{window.location.reload()})}getGroupingLabel(t){let e=this.groupingToLabel[t];return e?this.translateService.instant(e):t}getGroupingDirectionLabel(t){let e=this.groupingDirectionToLabel[t];return e?this.translateService.instant(e):t}static \u0275fac=function(e){return new(e||i)(g(Me))};static \u0275cmp=b({type:i,selectors:[["lg-grouping-sorting"]],contentQueries:function(e,n,r){if(e&1&&L(r,se,5),e&2){let d;E(d=M())&&(n.context=d.first)}},outputs:{sortChange:"sortChange",groupChange:"groupChange"},decls:27,vars:42,consts:[["lgDropdownAnchor","",3,"size"],[3,"size"],[3,"click","flat","size"]],template:function(e,n){e&1&&(l(0,"lg-flex-row")(1,"lg-dropdown")(2,"lg-button",0),c(3),a(),l(4,"lg-flex-column",1)(5,"span"),c(6),u(7,"translate"),a(),l(8,"lg-button",2),C("click",function(){return n.onSortChange({group:"category"})}),c(9),a(),l(10,"lg-button",2),C("click",function(){return n.onSortChange({group:"tag"})}),c(11),a(),l(12,"lg-button",2),C("click",function(){return n.onSortChange({group:"createdAt"})}),c(13),a(),l(14,"lg-button",2),C("click",function(){return n.onSortChange({group:"alphabetical"})}),c(15),a()()(),l(16,"lg-dropdown")(17,"lg-button",0),c(18),a(),l(19,"lg-flex-column",1)(20,"span"),c(21),u(22,"translate"),a(),l(23,"lg-button",2),C("click",function(){return n.onSortChange({direction:"asc"})}),c(24),a(),l(25,"lg-button",2),C("click",function(){return n.onSortChange({direction:"desc"})}),c(26),a()()()()),e&2&&(o(2),s("size","small"),o(),m(" ",n.getGroupingLabel(n.sorting().group)," "),o(),s("size","small"),o(2),z(_(7,38,"grouping.title")),o(2),S("warning"),s("flat",!0)("size","small"),o(),m(" ",n.groupingToLabel.category," "),o(),S("warning"),s("flat",!0)("size","small"),o(),m(" ",n.groupingToLabel.tag," "),o(),S("warning"),s("flat",!0)("size","small"),o(),m(" ",n.groupingToLabel.createdAt," "),o(),S("warning"),s("flat",!0)("size","small"),o(),m(" ",n.groupingToLabel.alphabetical," "),o(2),s("size","small"),o(),m(" ",n.getGroupingDirectionLabel(n.sorting().direction)," "),o(),s("size","small"),o(2),z(_(22,40,"grouping.direction.title")),o(2),S("warning"),s("flat",!0)("size","small"),o(),m(" ",n.groupingDirectionToLabel.asc," "),o(),S("warning"),s("flat",!0)("size","small"),o(),m(" ",n.groupingDirectionToLabel.desc," "))},dependencies:[G,D,He,Y,F],encapsulation:2})};var Z=class i{constructor(t){this.templateRef=t}static \u0275fac=function(e){return new(e||i)(g(j))};static \u0275dir=N({type:i,selectors:[["","lgGroupingTail",""]]})};var pt=["*"];function ct(i,t){if(i&1){let e=h();l(0,"lg-checkbox",4),C("onCheckboxChanged",function(r){v(e);let d=f();return y(d.onChanges(r))}),a()}if(i&2){let e=f();s("size","medium")("formControl",e.selected)("value",e.key())}}function mt(i,t){if(i&1){let e=h();l(0,"lg-button",5),C("click",function(){v(e);let r=f();return y(r.selectionZoneService.putDelete(r.key()))}),k(1,"mat-icon",6),a()}i&2&&(S("danger"),s("size","tiny")("icon",!0))}var ce=class i{constructor(t){this.selectionZoneService=t}key=xe(De());items;selected=new ke;effectMode=B(()=>{this.selectionZoneService.selectionMode()&&this.selected.reset()});effectSelectAll=B(()=>{this.selectionZoneService.selectAll()?this.selected.setValue(!0):this.selectionZoneService.deselectAll()&&this.selected.setValue(!1)});onChanges(t){this.selectionZoneService.putSelected([!!t,this.key()])}static \u0275fac=function(e){return new(e||i)(g(x,12))};static \u0275cmp=b({type:i,selectors:[["lg-selectable-section"]],contentQueries:function(e,n,r){if(e&1&&L(r,oe,4),e&2){let d;E(d=M())&&(n.items=d)}},inputs:{key:[1,"key"]},ngContentSelectors:pt,decls:5,vars:2,consts:[[1,"lg-selectable-section"],[3,"size","formControl","value"],[1,"lg-selectable-section__inner"],[3,"style","size","icon"],[3,"onCheckboxChanged","size","formControl","value"],[3,"click","size","icon"],["aria-hidden","false","fontIcon","close"]],template:function(e,n){e&1&&(Ce(),l(0,"section",0),T(1,ct,1,3,"lg-checkbox",1),l(2,"div",2),Se(3),a(),T(4,mt,2,4,"lg-button",3),a()),e&2&&(o(),I(n.selectionZoneService.selectionMode()==="selection"?1:-1),o(3),I(n.selectionZoneService.selectionMode()==="selection"?4:-1))},dependencies:[Ee,we,Le,Ne,D,te],styles:[".lg-checkbox[_ngcontent-%COMP%]{--control-bg: #abc2ff;--control-bg-selected: #abc2ff}.lg-selectable-section[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}"]})};var ut=i=>({$implicit:i}),dt=(i,t)=>t==null?null:t.field;function gt(i,t){if(i&1&&(l(0,"div",5)(1,"lg-selectable-section",6)(2,"div",7),_e(3,8),a()()()),i&2){let e=t.$implicit,n=f(2);o(),s("key",e.uuid),o(2),s("ngTemplateOutlet",n.groupingTailDirective.templateRef)("ngTemplateOutletContext",q(3,ut,e))}}function ft(i,t){if(i&1&&(l(0,"section",1)(1,"header",2)(2,"lg-title",3),c(3),a()(),l(4,"div",4),P(5,gt,4,5,"div",5,fe),a()()),i&2){let e=t.$implicit;o(2),s("level",3),o(),m(" ",(e==null?null:e.field)||"Unknown"," "),o(2),A(e==null?null:e.items)}}var me=class i{constructor(t){this.selectionZoneService=t}sortResult;groupingTailDirective;static \u0275fac=function(e){return new(e||i)(g(x,8))};static \u0275cmp=b({type:i,selectors:[["lg-grouping-tails"]],contentQueries:function(e,n,r){if(e&1&&L(r,Z,5),e&2){let d;E(d=M())&&(n.groupingTailDirective=d.first)}},inputs:{sortResult:"sortResult"},decls:3,vars:0,consts:[[1,"grouping-tails"],[1,"grouping-tails__section"],[1,"grouping-tails__header"],[3,"level"],[1,"grouping-tails__content"],[1,"grouping-tails__item"],[3,"key"],[1,"grouping-tails__item-inner"],[3,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(e,n){e&1&&(l(0,"section",0),P(1,ft,7,2,"section",1,dt),a()),e&2&&(o(),A(n.sortResult==null?null:n.sortResult.groups))},dependencies:[X,he,ce],styles:[".grouping-tails[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:32px}.grouping-tails__section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}.grouping-tails__content[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:16px}.grouping-tails__item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.grouping-tails__item-inner[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;padding:16px;border-radius:32px;background-color:#fff}"]})};var _t=()=>["recipe"];function Ct(i,t){if(i&1){let e=h();l(0,"lg-button",8),C("click",function(){v(e);let r=f();return y(r.exportRecipes(r.selectionZoneService.selected()))}),c(1),u(2,"translate"),a()}i&2&&(S("info"),s("flat",!0)("size","small"),o(),m(" ",_(2,5,"export-label")," recipes "))}function St(i,t){if(i&1&&(l(0,"span"),c(1),a()),i&2){let e=t.$implicit;o(),z(e==null?null:e.name)}}function vt(i,t){if(i&1){let e=h();l(0,"lg-import",9),u(1,"translate"),C("onDone",function(){v(e);let r=f();return y(r.loadRecipes())}),R(2,St,2,1,"ng-template",10),a()}if(i&2){let e=f();s("label",_(1,3,"import-label")+" products")("schema",e.RecipeScheme)("storeName",e.Stores.RECIPES)}}function yt(i,t){if(i&1&&(l(0,"lg-flex-column")(1,"a",11),c(2),a(),l(3,"lg-flex-row")(4,"lg-button",12),c(5),u(6,"translate"),a(),l(7,"small",13),c(8),u(9,"translate"),u(10,"timeAgo"),a()()()),i&2){let e=t.$implicit;o(),s("routerLink","/recipes/edit/"+e.uuid),o(),z(e.name),o(2),S("primary"),s("size","small")("link","/recipes/calculate/"+e.uuid)("flat",!0),o(),m(" ",_(6,10,"recipes.calculate-btn")," "),o(3),Q(" ",_(9,12,"edited-at-label")," ",_(10,14,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," ")}}var We=class i{constructor(t,e,n,r){this._recipesRepository=t;this._notificationsService=e;this._transferDataService=n;this.selectionZoneService=r;this._recipesRepository.recipes$.subscribe({next:d=>{console.log("recipes loaded",d)},error:d=>{}}),this.selectionZoneService.onDelete.pipe(Te(this.destroyRef)).subscribe(d=>{this.deleteRecipe(d)})}destroyRef=w(de);recipes=Ie(w(Je));Stores=J;RecipeScheme=re;ngOnInit(){this.loadRecipes()}deleteRecipe(t){t&&this._recipesRepository.deleteOne(t).then(()=>{this._notificationsService.success("Recipe deleted"),this.loadRecipes()})}loadRecipes(){return this._recipesRepository.loadRecipes()}exportRecipes(t){return this._transferDataService.exportTable("recipesStore","json",{selected:Array.from(t||[])})}static \u0275fac=function(e){return new(e||i)(g(W),g(U),g(ze),g(x))};static \u0275cmp=b({type:i,selectors:[["lg-recipes-list"]],features:[$([x])],decls:18,vars:13,consts:[[3,"icon","link","size"],["aria-hidden","false","fontIcon","add"],["lgInlineSeparatedGroup",""],[3,"center"],[3,"size"],[3,"selectionTypes"],[3,"sortResult"],["lgGroupingTail",""],[3,"click","flat","size"],[3,"onDone","label","schema","storeName"],["lgImportRowTpl",""],[3,"routerLink"],[3,"size","link","flat"],["lgPull","",1,"text-muted","text-cursive"]],template:function(e,n){e&1&&(l(0,"lg-controls-bar")(1,"lg-button",0),k(2,"mat-icon",1),a(),l(3,"lg-inline-separated-group"),R(4,Ct,3,7,"ng-template",2)(5,vt,3,5,"ng-template",2),a()(),l(6,"lg-fade-in")(7,"lg-container")(8,"lg-flex-row",3)(9,"lg-title"),c(10),u(11,"translate"),a()(),k(12,"lg-draft-recipes-list"),l(13,"lg-flex-column",4),k(14,"lg-grouping-sorting")(15,"lg-selection-tools",5),a(),l(16,"lg-grouping-tails",6),R(17,yt,11,16,"ng-template",7),a()()()),e&2&&(o(),S("success"),s("icon",!0)("link","/recipes/add")("size","medium"),o(7),s("center",!0),o(2),m(" ",_(11,10,"recipes.list-title")," "),o(3),s("size","medium"),o(2),s("selectionTypes",ve(12,_t)),o(),s("sortResult",n.recipes()))},dependencies:[G,D,H,te,Fe,X,Pe,Ze,Ge,Ae,Be,ee,Oe,F,le,ne,ie,pe,me,Z,Y],styles:["[_nghost-%COMP%]{display:block}"]})};export{We as RecipesListComponent};
