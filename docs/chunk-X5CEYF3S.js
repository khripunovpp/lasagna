import{a as ne}from"./chunk-G66WNF3G.js";import{a as ie}from"./chunk-5YSFYO7X.js";import{a as ee}from"./chunk-4X6Q6VAH.js";import{a as te}from"./chunk-GDPAARXP.js";import{a as oe}from"./chunk-IFILGF77.js";import{a as Ot}from"./chunk-YAO3K425.js";import{a as Yt,b as Kt}from"./chunk-YFKCZIXM.js";import{a as Zt}from"./chunk-X5S4KSZY.js";import{f as Gt}from"./chunk-C7U7ZQMF.js";import{a as Xt}from"./chunk-TVPE2FOR.js";import{a as $t}from"./chunk-ORO2D6DT.js";import{a as qt,b as Lt,c as zt}from"./chunk-77FLK76L.js";import{a as Jt}from"./chunk-7QDAUFFL.js";import{a as Qt}from"./chunk-CEPNEZXV.js";import"./chunk-CWUUYJTE.js";import{a as Wt,b as jt}from"./chunk-HCUERNTX.js";import{a as Ht}from"./chunk-C5H2I4FC.js";import{v as Ut}from"./chunk-VLSBBD43.js";import{a as Vt}from"./chunk-EIVKJBV7.js";import{a as Mt}from"./chunk-TBBEROLX.js";import{a as X}from"./chunk-U5RG623K.js";import{a as Bt}from"./chunk-MUGSSU5U.js";import{a as K}from"./chunk-7C3OD2VZ.js";import{a as Nt}from"./chunk-VPY63KRA.js";import"./chunk-MPFUNZLY.js";import{a as kt}from"./chunk-O2QGAP6D.js";import{j as Ft,l as Y}from"./chunk-F7IPTZBX.js";import"./chunk-JIYA5WDW.js";import{G as L,I as wt,J as St,K as Rt,M as T,O as At,R as Tt,U as Et,Y as It,c as rt,ha as Dt,i as lt,ma as z,oa as $,z as N}from"./chunk-SCGAETAM.js";import{m as bt,p as q}from"./chunk-J6CDYHKM.js";import"./chunk-CABIONZL.js";import"./chunk-EMIJRNYJ.js";import{f as xt,n as Pt}from"./chunk-ZA7VU5CB.js";import{$a as r,Cc as p,Db as f,Dc as c,Ec as O,Fb as _,H as W,J as mt,Kb as d,Lb as a,Mb as l,Mc as yt,Nb as P,Nc as G,Qc as Q,Rb as w,Rc as V,Sc as k,Vb as g,Wb as m,Xb as _t,Yb as ot,Za as ut,_a as it,cc as F,db as ft,dc as M,ea as I,eb as x,ec as A,fc as gt,gc as j,hc as U,jc as u,kc as H,la as v,lb as R,lc as b,ma as y,mc as nt,qb as D,s as ct,va as C,wc as Ct,xc as ht,yc as vt}from"./chunk-X5WXA3YI.js";import"./chunk-2RGDSI3Q.js";import"./chunk-FK6H3RFT.js";import"./chunk-C6Q5SG76.js";var le=["element"],ae=["*",[["content"]]],de=["*","content"];function pe(o,e){if(o&1&&(a(0,"div",4,0),ot(2,1),l(),P(3,"lg-portal",5)),o&2){let t=A(1);r(3),d("appendTarget","body")("targetElement",t)("wrapClass","tooltip tooltip--ejected")}}var J=class o{constructor(){}renderer=I(ft);gap=V(16);displayed=C(!1);full=V(!1);position=V("top");element=k("element");onClose=Q();coordinates=C({x:0,y:0});coordinatesEffect=G(()=>{this.renderer.setProperty(document.body,"style",`--tooltip-x: ${this.coordinates().x}px;--tooltip-y: ${this.coordinates().y}px;`)});toggle(e){if(this.displayed.set(!this.displayed()),this.displayed()||this.onClose.emit(),e){e.stopPropagation();let[t,i]=[e.clientX,e.clientY];console.log("x",t,"y",i),setTimeout(()=>{let s=this.element()?.nativeElement?.getBoundingClientRect(),h=s?.width,E=s?.height,pt=window.innerWidth,st=window.innerHeight,S=16,tt=t,et=i;t+h+S>pt&&(tt=pt-h-S),i+E+S>st&&(et=st-E-S),t-h-S<0&&(tt=S),i-E-S<0&&(et=S),this.coordinates.set({x:tt,y:et})})}}close(){this.displayed.set(!1),this.onClose.emit()}onClick(e){e.target instanceof HTMLElement&&(e.target.closest(".tooltip")||(this.displayed.set(!1),this.onClose.emit()))}onKeydown(e){e.key==="Escape"&&(this.displayed.set(!1),this.onClose.emit())}onScroll(e){this.displayed.set(!1),this.onClose.emit()}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=R({type:o,selectors:[["lg-tooltip"]],viewQuery:function(t,i){t&1&&F(i.element,le,5),t&2&&M()},hostBindings:function(t,i){t&1&&g("click",function(s){return i.onClick(s)},it)("keydown",function(s){return i.onKeydown(s)},it)("scroll",function(s){return i.onScroll(s)},ut)},inputs:{gap:[1,"gap"],full:[1,"full"],position:[1,"position"]},outputs:{onClose:"onClose"},ngContentSelectors:de,decls:5,vars:6,consts:[["element",""],[1,"tooltip",3,"ngClass"],[1,"tooltip__anchor"],[3,"click"],[1,"tooltip__content"],[3,"appendTarget","targetElement","wrapClass"]],template:function(t,i){t&1&&(_t(ae),a(0,"div",1)(1,"div",2)(2,"div",3),g("click",function(s){return i.toggle(s)}),ot(3),l(),f(4,pe,4,3),l()()),t&2&&(gt("--gap",i.gap(),"px"),j("fullscreen",i.full()),d("ngClass",i.position()),r(4),_(i.displayed()?4:-1))},dependencies:[xt,Ot],styles:[`lg-tooltip{flex:1;display:flex}.tooltip{display:inline-block}.tooltip--ejected{position:fixed;z-index:6;inset:0}.tooltip--ejected .tooltip__content{inset:0;position:fixed;display:flex;align-items:center;justify-content:center;padding-top:calc(var(--header-height) + 12px + 16px + 16px)}.tooltip__anchor{position:relative}.tooltip__content{position:absolute;background-color:#fff;border-radius:16px;padding:16px;box-shadow:0 4px 8px #0000001a;z-index:100}.tooltip.top .tooltip__content,.tooltip.bottom .tooltip__content{bottom:calc(100% + var(--gap));right:50%;transform:translate(50%)}.tooltip.left .tooltip__content{bottom:50%;right:calc(100% + var(--gap));transform:translateY(50%)}.tooltip.right .tooltip__content{bottom:50%;left:calc(100% + var(--gap));transform:translateY(-50%)}.tooltip.fullscreen .tooltip__content{position:fixed;inset:0;background-color:#fff;border-radius:0;padding:32px;transform:none;overflow-y:auto}
`],encapsulation:2})};function se(o,e){if(o&1){let t=w();a(0,"div",3)(1,"lg-eggs-widget",4),g("changed",function(n){v(t);let s=m();return y(s.onEggsChanged(n))}),l()()}}var Z=class o{constructor(){}eggsChanged=Q();selectedWidget=C(null);onWidgetSelect(e){this.selectedWidget.set(e)}onEggsChanged(e){e&&this.eggsChanged.emit(e)}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=R({type:o,selectors:[["lg-amount-widgets"]],outputs:{eggsChanged:"eggsChanged"},decls:6,vars:6,consts:[[1,"amount-widgets"],[1,"amount-widgets__buttons"],[1,"amount-widgets__button",3,"click"],[1,"amount-widgets__wrapper"],[3,"changed"]],template:function(t,i){t&1&&(a(0,"div",0)(1,"div",1)(2,"button",2),g("click",function(){return i.onWidgetSelect("eggs")}),u(3),p(4,"translate"),l()(),f(5,se,2,0,"div",3),l()),t&2&&(j("selected",i.selectedWidget()!=null),r(3),b("",c(4,4,"widgets.eggs.title")," "),r(2),_(i.selectedWidget()==="eggs"?5:-1))},dependencies:[ne,N],styles:[".amount-widgets[_ngcontent-%COMP%]{display:flex;gap:16px;flex-direction:column}.amount-widgets__input[_ngcontent-%COMP%]{flex:1}.amount-widgets__buttons[_ngcontent-%COMP%]{display:flex;gap:16px;flex-wrap:wrap;padding:16px;background-color:#fafafa;border-radius:12px;margin:-16px}.amount-widgets.selected[_ngcontent-%COMP%]   .amount-widgets__buttons[_ngcontent-%COMP%]{margin-bottom:0}.amount-widgets__button[_ngcontent-%COMP%]{display:flex;padding:8px 16px;border-radius:16px;background-color:#e5de38;appearance:none;border:none;font-family:inherit;font-size:inherit}"]})};var fe=["nameField"],_e=o=>({unit:o}),ge=()=>({currency:"EUR"});function Ce(o,e){if(o&1){let t=w();a(0,"lg-flex-row",16)(1,"lg-tooltip",17)(2,"lg-button",18),P(3,"mat-icon",19),l(),a(4,"div",20)(5,"lg-amount-widgets",21),g("eggsChanged",function(n){v(t);let s=m();return y(s.eggsChanged(n))}),l()()(),P(6,"lg-unit-switcher",22),l()}o&2&&(d("center",!0)("size","small"),r(),d("position","left"),r(),U("success"),d("flat",!0)("icon",!0))}function he(o,e){if(o&1&&(a(0,"span"),u(1),p(2,"currencySymbol"),l()),o&2){let t=m();r(),H(c(2,1,t.userSettings().currency))}}function ve(o,e){if(o&1&&P(0,"lg-chips-list",14),o&2){let t=m(),i=A(25);d("control",i)("items",t.topCategories())}}var B=class o{constructor(e,t,i,n){this._productsRepository=e;this._selectResourcesService=t;this._router=i;this._notificationsService=n}form=new Rt({name:new T(null,L.required),amount:new T(null,L.required),price:new T(null,L.required),unit:new T("gram"),source:new T(null),category_id:new T(null)});userSettings=I(Dt);product=V(null);topCategories=C([]);topSources=C([]);nameField=k("nameField");productEffect=G(()=>{!this.product()||this.form.dirty||(this.form.reset(lt(this.product())),this.form.markAsPristine())});get _defFormValue(){return{name:null,amount:null,price:null,source:null,category_id:null,unit:"gram"}}get _formValid(){return this.form.valid}eggsChanged(e){this.form.patchValue({amount:e})}ngOnInit(){this._loadUsingHistory(),this.form.valueChanges.pipe(W(100)).subscribe(e=>{this.form.dirty&&this.product()?.update(e)})}resetForm(e){this.form.reset(e?lt(e):this._defFormValue),this.form.markAsPristine(),this._loadUsingHistory()}validateForm(){return this._formValid?!0:(this._notificationsService.error(this._notificationsService.parseFormErrors(this.form).join(", ")),!1)}ngAfterViewInit(){this._selectResourcesService.load().then(e=>{}),this.product()?.uuid||this.nameField().focus(),this.form.markAsPristine()}_loadUsingHistory(){this._productsRepository.getTopCategories().then(e=>{this.topCategories.set(e.map(t=>({label:t.name,value:t.uuid??"",color:t.ownColor})))}),this._productsRepository.getTopSources().then(e=>{this.topSources.set(e.map(t=>({label:t,value:t})))})}smaller=Lt;static \u0275fac=function(t){return new(t||o)(x(Y),x(Ft),x(q),x(z))};static \u0275cmp=R({type:o,selectors:[["lg-add-product-form"]],viewQuery:function(t,i){t&1&&F(i.nameField,fe,5),t&2&&M()},inputs:{product:[1,"product"]},decls:28,vars:33,consts:[["nameField",""],["priceInput",""],["sourceInput",""],["sourceChips",""],["categorySelect",""],[3,"formGroup"],["formControlName","name",3,"placeholder"],[3,"center","mobileMode"],["formControlName","amount","lgExpand","","lgParseMath","",3,"onInputChange","placeholder"],["lgExtraTpl","","place","after"],["formControlName","price","lgParseMath","","lgWidth","40%",3,"placeholder"],[2,"--control-bg","#ffffff",3,"equal","mobileMode","top"],["appendTo","body","formControlName","source",3,"onSelected","noLoad","placeholder","resource"],[3,"hidden"],[3,"control","items"],["appendTo","body","formControlName","category_id",3,"placeholder","resource"],[3,"center","size"],[3,"position"],[3,"flat","icon"],["aria-hidden","false","fontIcon","add"],["ngProjectAs","content",5,["content"]],[3,"eggsChanged"],["formControlName","unit"]],template:function(t,i){if(t&1){let n=w();a(0,"form",5)(1,"lg-flex-column")(2,"lg-card")(3,"lg-flex-column"),P(4,"lg-input",6,0),p(6,"translate"),a(7,"lg-flex-row",7)(8,"lg-number-input",8),p(9,"translate"),g("onInputChange",function(){v(n);let h=A(12);return y(h.focus())}),D(10,Ce,7,7,"ng-template",9),l(),a(11,"lg-number-input",10,1),p(13,"translate"),D(14,he,3,3,"ng-template",9),l()()()(),a(15,"lg-flex-row",11)(16,"lg-flex-column")(17,"lg-autocomplete",12,2),p(19,"translate"),g("onSelected",function(){v(n);let h=A(22);return y(h.clearSelected())}),l(),a(20,"div",13),P(21,"lg-chips-list",14,3),l()(),a(23,"lg-flex-column"),P(24,"lg-multiselect",15,4),p(26,"translate"),f(27,ve,1,2,"lg-chips-list",14),l()()()()}if(t&2){let n=A(18);d("formGroup",i.form),r(4),d("placeholder",c(6,18,"product.form.name.placeholder")),r(3),d("center",!0)("mobileMode",!0),r(),d("placeholder",O(9,20,"product.form.amount.placeholder",vt(30,_e,i.form.value.unit))),r(3),d("placeholder",O(13,23,"product.form.price.placeholder",ht(32,ge))),r(4),d("equal",!0)("mobileMode",!0)("top",!0),r(2),d("noLoad",!0)("placeholder",c(19,26,"product.form.source.placeholder"))("resource","sources"),r(3),d("hidden",!i.topSources().length),r(),d("control",n)("items",i.topSources()),r(3),d("placeholder",c(26,28,"product.form.category_id.placeholder"))("resource","categories"),r(3),_(i.topCategories().length?27:-1)}},dependencies:[It,At,wt,St,Tt,Et,K,Gt,qt,J,Z,zt,X,Ht,Yt,Kt,N,Vt,Ut,$,te,Xt,ie,oe,Qt],styles:[`lg-eggs-widget{min-width:300px}
`],encapsulation:2})};function ye(o,e){if(o&1&&(a(0,"lg-title"),u(1),l()),o&2){let t,i=m();r(),b(" ",(t=i.product())==null?null:t.name," ")}}function xe(o,e){o&1&&(a(0,"lg-title"),u(1),p(2,"translate"),l()),o&2&&(r(),b(" ",c(2,1,"product.form.title")," "))}function Pe(o,e){if(o&1&&(u(0),p(1,"userCurrency")),o&2){let t,i=m();nt(" (",(t=i.product())==null?null:t.perUnitLabel," ",O(1,2,(t=i.product())==null?null:t.pricePerUnit,"1.0-5"),") ")}}function be(o,e){o&1&&(a(0,"span"),u(1),p(2,"translate"),l()),o&2&&(r(),H(c(2,1,"saved-draft-label")))}function we(o,e){o&1&&D(0,be,3,3,"ng-template",2)}function Se(o,e){if(o&1){let t=w();a(0,"lg-button",8),g("click",function(){v(t);let n=m(2);return y(n.onRemoveDraft())}),u(1),p(2,"translate"),l()}o&2&&(U("danger"),d("flat",!0),r(),b(" ",c(2,4,"product.form.delete-draft-btn")," "))}function Re(o,e){if(o&1){let t=w();a(0,"lg-button",8),g("click",function(){v(t);let n=m(2);return y(n.onDeleteProduct())}),u(1),p(2,"translate"),l()}o&2&&(U("danger"),d("flat",!0),r(),b(" ",c(2,4,"product.form.delete-btn")," "))}function Ae(o,e){if(o&1&&f(0,Se,3,6,"lg-button",7)(1,Re,3,6,"lg-button",7),o&2){let t,i=m();_(i.isDraftRoute()?0:(t=i.product())!=null&&t.uuid?1:-1)}}function Te(o,e){if(o&1&&(a(0,"small",3),u(1),p(2,"translate"),p(3,"timeAgo"),l()),o&2){let t,i=m();r(),nt(" ",c(2,2,"edited-at-label")," ",c(3,4,(t=i.product())==null?null:t.updatedAt)," ")}}function Ee(o,e){o&1&&(u(0),p(1,"translate")),o&2&&b(" ",c(1,1,"product.form.save-btn.edit.active")," ")}function Ie(o,e){o&1&&(u(0),p(1,"translate")),o&2&&b(" ",c(1,1,"product.form.save-btn.edit.disabled")," ")}function De(o,e){if(o&1){let t=w();a(0,"lg-button",9),g("click",function(){v(t);let n=m();return y(n.onEditProduct())}),f(1,Ee,2,3)(2,Ie,2,3),l()}if(o&2){let t,i,n=m();d("disabled",!(!((t=n.formComponent())==null||t.form==null)&&t.form.dirty)&&!n.draftRef()),r(),_(!((i=n.formComponent())==null||i.form==null)&&i.form.dirty||n.draftRef()?1:2)}}function Fe(o,e){o&1&&(u(0),p(1,"translate")),o&2&&b(" ",c(1,1,"product.form.save-btn.add.active")," ")}function Me(o,e){o&1&&(u(0),p(1,"translate")),o&2&&b(" ",c(1,1,"product.form.save-btn.add.disabled")," ")}function Ve(o,e){if(o&1){let t=w();a(0,"lg-button",9),g("click",function(){v(t);let n=m();return y(n.onAddProduct())}),f(1,Fe,2,3)(2,Me,2,3),l()}if(o&2){let t,i,n=m();d("disabled",!(!((t=n.formComponent())==null||t.form==null)&&t.form.dirty)&&!n.draftRef()),r(),_(!((i=n.formComponent())==null||i.form==null)&&i.form.dirty||n.draftRef()?1:2)}}var re=class o{constructor(e,t,i,n,s){this._router=e;this._aRoute=t;this._productsRepository=i;this._notificationsService=n;this._analyticsService=s}draftOrProductUUID=C(void 0);product=C(null);formComponent=k(B);draftRef=C(null);draftByExistingProduct=yt(()=>this.draftRef().meta?.uuid);isDraftRoute=C(!1);_routerManager=I(Jt);ngOnDestroy(){}ngOnInit(){ct([this._aRoute.params,this._aRoute.data]).pipe(mt(1)).subscribe(([e,t])=>{this.draftOrProductUUID.set(e.uuid),t.draft?(this.draftRef.set(t.draft),this.product.set(rt.fromRaw(t.draft.data))):this.draftOrProductUUID()?this._loadProduct(this.draftOrProductUUID()):this.product.set(rt.empty()),this.isDraftRoute.set(!!t.draftRoute)})}ngAfterViewInit(){this.formComponent()?.form.valueChanges.pipe(W(500)).subscribe(e=>{!this.formComponent().form.dirty||!this.product()||(this.draftRef()?.uuid?this._productsRepository.updateDraftProduct(this.draftRef().uuid,this.product(),this.draftRef().meta?.uuid):this.product()&&(this.draftRef.set(this._productsRepository.saveDraftProduct(this.product(),this.draftOrProductUUID()??"")),this.isDraftRoute()||this._routerManager.replace(["products/draft/"+this.draftRef().uuid])))})}onAddProduct(){!this.formComponent()?.validateForm()||!this.product()||this._addProduct(this.product())}onEditProduct(){!this.formComponent()?.validateForm()||!this.product()||this._editProduct(this.product())}onRemoveDraft(){this._removeDraft(),this._routerManager.navigate(["products"])}onDeleteProduct(){this.product()?.uuid&&this._productsRepository.deleteProduct(this.product().uuid).then(()=>{this._notificationsService.success("Product deleted"),this._routerManager.navigate(["products"])})}_addProduct(e){this._productsRepository.addOne(e).then(t=>{this._analyticsService.trackProductCreated(e.name,{product_uuid:t,price_per_unit:e.pricePerUnit,unit:e.unit,category:e.category_id?.name}),this.formComponent()?.resetForm(),this._notificationsService.success("Product added"),this.product.set(null),this.draftRef()&&this._removeDraft(),this._routerManager.navigateWithReset(["products/edit/"+t])})}_editProduct(e){if(!this.draftOrProductUUID())return;let t=this.draftRef()?.meta?.uuid??this.draftOrProductUUID();this._productsRepository.updateOne(t,e).then(()=>{this.formComponent()?.resetForm(e),this._notificationsService.success("Product edited"),this.draftRef()&&this._removeDraft(),this._routerManager.navigateWithReset(["products","edit",t])})}_removeDraft(){this.draftRef()&&(this._productsRepository.removeDraftProduct(this.draftRef().uuid),this.draftRef.set(null))}_loadProduct(e){e&&this._productsRepository.getOne(e,!0).then(t=>{t&&this.product.set(t)})}static \u0275fac=function(t){return new(t||o)(x(q),x(bt),x(Y),x(z),x(Zt))};static \u0275cmp=R({type:o,selectors:[["app-add-recipe"]],viewQuery:function(t,i){t&1&&F(i.formComponent,B,5),t&2&&M()},features:[Ct([Pt])],decls:15,vars:10,consts:[["size","medium"],[3,"center","mobileMode"],["lgInlineSeparatedGroup",""],[1,"text-muted","text-cursive"],[3,"product"],[3,"mobileMode","relaxed"],["lgShrink","",3,"disabled"],["lgShrink","",3,"style","flat"],["lgShrink","",3,"click","flat"],["lgShrink","",3,"click","disabled"]],template:function(t,i){if(t&1&&(a(0,"lg-fade-in")(1,"lg-container")(2,"lg-flex-column",0)(3,"lg-flex-row",1),f(4,ye,2,1,"lg-title")(5,xe,3,3,"lg-title"),f(6,Pe,2,5),l(),a(7,"lg-inline-separated-group"),f(8,we,1,0,null,2),D(9,Ae,2,1,"ng-template",2),l(),f(10,Te,4,6,"small",3),l(),P(11,"lg-add-product-form",4),a(12,"lg-flex-row",5),f(13,De,3,2,"lg-button",6)(14,Ve,3,2,"lg-button",6),l()()()),t&2){let n,s,h,E;r(3),d("center",!0)("mobileMode",!0),r(),_((n=i.product())!=null&&n.uuid&&!i.draftRef()||i.draftRef()&&i.draftByExistingProduct()?4:5),r(2),_((s=i.product())!=null&&s.pricePerUnit?6:-1),r(2),_(i.draftRef()&&(!((h=i.formComponent())==null||h.form==null)&&h.form.dirty)?8:-1),r(2),_((E=i.product())!=null&&E.updatedAt?10:-1),r(),d("product",i.product()),r(),d("mobileMode",!0)("relaxed",!0),r(),_(i.product()&&!i.draftRef()||i.draftRef()&&i.draftByExistingProduct()?13:14)}},dependencies:[Mt,kt,B,X,Nt,$,$t,Bt,N,K,ee,jt,Wt],encapsulation:2})};export{re as AddProductComponent};
