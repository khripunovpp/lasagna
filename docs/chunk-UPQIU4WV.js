import{a as ue,b as _e,c as ge,d as Ce,e as xe,h as ve,i as Pe}from"./chunk-M5XNCUH3.js";import"./chunk-SBEFIX5R.js";import{a as fe}from"./chunk-PRC2TUST.js";import{a as ae}from"./chunk-HE3R4OYU.js";import{a as de,c as se}from"./chunk-MY6KHXHO.js";import{b as me}from"./chunk-XWIK56RR.js";import"./chunk-HHXJ7M2I.js";import{a as re}from"./chunk-VVO2QOJB.js";import{a as Se}from"./chunk-W7F36SB2.js";import{a as pe}from"./chunk-R3RPCOKV.js";import{a as ce}from"./chunk-NCTFFSWN.js";import"./chunk-OTURUDYJ.js";import"./chunk-O7M42S4C.js";import{a as ie,b as le}from"./chunk-WR2UF3SH.js";import{a as oe}from"./chunk-ALZEZ7BP.js";import{a as ne}from"./chunk-BC325NGK.js";import"./chunk-SNDQO5FA.js";import{f as X,j as Y,n as A,o as te,p as h}from"./chunk-CB3MWB2Z.js";import{b as W}from"./chunk-M3F6BOZF.js";import"./chunk-5KSZNU56.js";import"./chunk-L3DC7GP3.js";import"./chunk-WZGWS77O.js";import{u as ee}from"./chunk-ODQSNCKZ.js";import"./chunk-2SYRDFEF.js";import{s as J,w as K}from"./chunk-UQJ3VPU4.js";import"./chunk-652DFWNF.js";import{k as H}from"./chunk-QHW4G2KK.js";import{$ as S,$b as _,Ab as D,Bb as E,Cb as r,Db as l,Eb as L,Ib as b,Lb as g,Mb as m,R as V,Va as n,Yb as p,Z as j,Zb as F,_a as C,_b as f,db as N,dc as G,ec as Q,fc as q,ga as P,ha as y,ib as T,jc as s,k as $,kc as u,lc as B,na as z,q as k,qb as a,s as M,tb as I,wb as x,xb as v,yb as U}from"./chunk-VF5EQBCE.js";import"./chunk-DELOOZDJ.js";import{f as Z}from"./chunk-2WH2EVR6.js";var ye=new j("CategorizedProductsList",{factory:()=>{let t=S(h),i=S(W);return $(t.loadAll()).pipe(V(()=>t.products$)).pipe(k(o=>o.toSorted((c,d)=>c.name.localeCompare(d.name))),k(o=>fe(o,"category_id")),M(o=>Z(void 0,null,function*(){let c=[];for(let w in o){let R=o[w],Ie=yield i.getOne(w);c.push({category:Ie?.name,products:R})}if(!c.length)return[];let[d,...O]=c.toSorted((w,R)=>w.category>R.category?1:-1);return d?.category?[d].concat(O):O.concat([d])})))}});var Le=()=>["draft","product"],be=t=>({length:t}),we=(t,i)=>i.uuid,De=(t,i)=>i==null?null:i.uuid;function Ee(t,i){t&1&&(r(0,"lg-button",8),L(1,"mat-icon",9),l()),t&2&&(I("success"),a("icon",!0)("link","/products/add")("size","medium"))}function Ae(t,i){if(t&1&&(r(0,"span"),p(1),s(2,"translate"),l()),t&2){let e=m(2).$implicit;n(),_("",u(2,2,"from-location")," ",e.source)}}function he(t,i){if(t&1&&(r(0,"span"),p(1),l(),r(2,"span"),p(3),l(),x(4,Ae,3,4,"span")),t&2){let e=m().$implicit;n(),F(e.name),n(2),_("",e.amount,"gr for ",e.price),n(),v(e.source?4:-1)}}function Re(t,i){if(t&1&&(r(0,"span"),p(1),s(2,"translate"),l()),t&2){let e=m(2).$implicit;n(),_("",u(2,2,"from-location")," ",e==null?null:e.source)}}function ke(t,i){if(t&1&&(r(0,"span"),p(1),l(),r(2,"span"),p(3),l(),x(4,Re,3,4,"span")),t&2){let e=m().$implicit;n(),F(e==null?null:e.name),n(2),_("",e==null?null:e.amount," gr for ",e==null?null:e.price),n(),v(e!=null&&e.source?4:-1)}}function Fe(t,i){if(t&1&&x(0,he,5,4)(1,ke,5,4),t&2){let e=i.flow;v(e==="new"?0:1)}}function Be(t,i){t&1&&(p(0),s(1,"translate")),t&2&&f(" ",u(1,1,"draft.list-prefix.existing")," ")}function Oe(t,i){t&1&&(p(0),s(1,"translate")),t&2&&f(" ",u(1,1,"draft.list-prefix.new")," ")}function Ze(t,i){if(t&1){let e=b();r(0,"lg-gap-row",7)(1,"a",12),x(2,Be,2,3)(3,Oe,2,3),p(4),l(),r(5,"small",13),p(6),s(7,"translate"),s(8,"timeAgo"),l(),r(9,"lg-button",14),g("click",function(){P(e);let c=m().$implicit,d=m(2);return y(d.deleteDraft(c))}),L(10,"mat-icon",15),l()()}if(t&2){let e=m().$implicit;a("center",!0),n(),a("routerLink","/products/draft/"+(e==null?null:e.uuid)),n(),v(!(e==null||e.meta==null)&&e.meta.uuid?2:3),n(2),f(" ",(e==null||e.data==null?null:e.data.name)||"Unknown"," "),n(2),_(" ",u(7,10,"edited-at-label")," ",u(8,12,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," "),n(3),I("danger"),a("size","tiny")("icon",!0)}}function $e(t,i){if(t&1&&T(0,Ze,11,14,"ng-template",11),t&2){let e=i.$implicit;a("uuid",e.uuid)}}function Me(t,i){if(t&1){let e=b();r(0,"lg-card-list",10),g("onSelected",function(c){P(e);let d=m();return y(d.selectionZoneService.putSelected(c))}),D(1,$e,1,1,null,11,we),l()}if(t&2){let e=m();a("mode",e.selectionZoneService.selectionMode())("selectAll",e.selectionZoneService.selectAll().draft)("deselectAll",e.selectionZoneService.deselectAll().draft),n(),E(e.draft())}}function Ve(t,i){if(t&1){let e=b();r(0,"lg-gap-row",7)(1,"div",19)(2,"lg-gap-row",7)(3,"lg-gap-row",20)(4,"a",21),p(5),l(),r(6,"div"),p(7),s(8,"number"),l()(),r(9,"small",22),p(10),s(11,"translate"),s(12,"timeAgo"),l()()(),r(13,"lg-button",14),g("click",function(){P(e);let c=m().$implicit,d=m(2);return y(d.deleteProduct(c))}),L(14,"mat-icon",15),l()()}if(t&2){let e=m().$implicit;a("center",!0),n(2),a("center",!0),n(),a("center",!0),n(),a("routerLink","/products/edit/"+e.uuid),n(),_(" ",e.name," ",e.source?"- "+e.source:""," "),n(2),_(" ",B(8,14,e.pricePerUnit,"1.2-5")," ",e.perUnitLabel," "),n(3),_(" ",u(11,17,"edited-at-label")," ",u(12,19,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," "),n(3),I("danger"),a("size","tiny")("icon",!0)}}function je(t,i){if(t&1&&T(0,Ve,15,21,"ng-template",18),t&2){let e=i.$implicit;a("uuid",e.uuid)}}function ze(t,i){if(t&1){let e=b();r(0,"lg-title",16),p(1),s(2,"translate"),l(),r(3,"lg-card-list",17),g("onSelected",function(c){P(e);let d=m();return y(d.selectionZoneService.putSelected(c))}),D(4,je,1,1,null,18,De),l()}if(t&2){let e=i.$implicit,o=m();a("level",3),n(),f(" ",(e==null?null:e.category)||u(2,5,"without-category-label")," "),n(2),a("mode",o.selectionZoneService.selectionMode())("selectAll",o.selectionZoneService.selectAll().product)("deselectAll",o.selectionZoneService.deselectAll().product),n(),E(e.products)}}function Ne(t,i){t&1&&(r(0,"lg-gap-row",7)(1,"lg-title",16),p(2),s(3,"translate"),l()()),t&2&&(a("center",!0),n(),a("level",5),n(),f(" ",u(3,3,"no-products")," "))}var Te=class t{constructor(i,e,o,c,d){this._productsRepository=i;this._csvReaderService=e;this._transferDataService=o;this._notificationsService=c;this.selectionZoneService=d}products=me(S(ye));draft=z([]);ProductDbInputScheme=ve;Stores=K;exportProducts(i){this._transferDataService.exportTable("productsStore","json",{selected:Array.from(i??[])})}deleteProduct(i){i.uuid&&this._productsRepository.deleteProduct(i.uuid).then(()=>{this._notificationsService.success("Product deleted"),this.loadProducts()})}deleteDraft(i){this._productsRepository.removeDraftProduct(i.uuid),this.draft.update(e=>e.filter(o=>o?.uuid!==i.uuid))}ngOnInit(){this.loadProducts();let i=this._productsRepository.getDraftProducts();i&&this.draft.set(i)}loadProducts(){this._productsRepository.loadAll()}static \u0275fac=function(e){return new(e||t)(C(h),C(X),C(te),C(ee),C(A))};static \u0275cmp=N({type:t,selectors:[["lg-product-list"]],features:[G([A])],decls:21,vars:28,consts:[["lgQuickActionsTpl",""],[3,"selectionTypes"],[3,"click","flat","size"],[3,"onDone","label","schema","storeName"],["lgImportRowTpl",""],[3,"closeLabel","openLabel"],[2,"--card-bg","#bee5ff",3,"mode","selectAll","deselectAll"],[3,"center"],[3,"icon","link","size"],["aria-hidden","false","fontIcon","add"],[2,"--card-bg","#bee5ff",3,"onSelected","mode","selectAll","deselectAll"],["lgCardListItem","","type","draft",3,"uuid"],["lgExpand","",3,"routerLink"],["lgPull","",1,"text-muted","text-cursive"],[3,"click","size","icon"],["aria-hidden","false","fontIcon","close"],[3,"level"],[3,"onSelected","mode","selectAll","deselectAll"],["lgCardListItem","","type","product",3,"uuid"],[1,"expand"],["lgExpand","",3,"center"],[3,"routerLink"],[1,"text-muted","text-cursive"]],template:function(e,o){if(e&1&&(r(0,"lg-controls-bar"),T(1,Ee,2,5,"ng-template",0),L(2,"lg-selection-tools",1),r(3,"lg-button",2),g("click",function(){return o.exportProducts(o.selectionZoneService.selected().product)}),p(4),s(5,"translate"),l(),r(6,"lg-import",3),s(7,"translate"),g("onDone",function(){return o.loadProducts()}),T(8,Fe,2,1,"ng-template",4),l()(),r(9,"lg-fade-in")(10,"lg-container")(11,"lg-title"),p(12),s(13,"translate"),l(),r(14,"lg-expander",5),s(15,"translate"),s(16,"translate"),x(17,Me,3,3,"lg-card-list",6),l(),D(18,ze,6,7,null,null,U,!1,Ne,4,5,"lg-gap-row",7),l()()),e&2){let c,d;n(2),a("selectionTypes",Q(25,Le)),n(),I("info"),a("flat",!0)("size","small"),n(),f(" ",u(5,14,"export-label")," products "),n(2),a("label",u(7,16,"import-label")+" products")("schema",o.ProductDbInputScheme)("storeName",o.Stores.PRODUCTS),n(6),f(" ",u(13,18,"products.list-title")," "),n(2),a("closeLabel",u(15,20,"drafts-close-label"))("openLabel",B(16,22,"drafts-label",q(26,be,(c=o.draft())==null?null:c.length))),n(3),v((d=o.draft())!=null&&d.length?17:-1),n(),E(o.products())}},dependencies:[le,ce,pe,ie,ne,H,se,de,_e,J,ue,oe,Ce,ge,xe,re,Se,ae,Y,Pe],styles:["[_nghost-%COMP%]{display:block}"]})};export{Te as ProductListComponent};
