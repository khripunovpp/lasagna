import{a as ae}from"./chunk-G6Z7HGTP.js";import{a as se}from"./chunk-HXFWMFTO.js";import{a as ee}from"./chunk-CHXTDSNS.js";import{a as ie}from"./chunk-ZOTOA5AS.js";import{a as re,c as ne,d as oe}from"./chunk-2M3DIOYI.js";import{a as te}from"./chunk-QKD27ACN.js";import{v as Z}from"./chunk-BZ35JVT2.js";import{a as L}from"./chunk-VQHUADFJ.js";import{a as Q}from"./chunk-OIONDWIZ.js";import{G as j,H as X,I as S,K as c,P as W,Q as z,R as B,S as H,T as U,U as q,V as J,X as K,ca as Y,f as V,n as M,r as $}from"./chunk-PHOGYWHJ.js";import{B as P}from"./chunk-NRUVM72Y.js";import{Cb as F,Eb as D,Hb as k,Ib as A,Jb as o,Kb as s,Lb as p,Lc as E,Mb as C,Mc as G,Nb as R,Ob as N,Qb as O,Ub as l,Vb as d,_ as v,_a as r,ca as y,db as w,fc as I,gc as f,ic as h,ka as x,kb as b,la as g,ua as T}from"./chunk-NHWKWTII.js";var m=class i{constructor(e){this.name=String(e.name).trim(),this.amount=parseFloat(String(e.amount)),this.percentage=e.percentage,this.description=String(e.description||"").trim(),this.items=e.items,this.uuid=e.uuid}name;amount;percentage;description;items;uuid;static fromRaw(e){return new i({name:e?.name||"",amount:e?.amount||0,percentage:e?.percentage||!1,description:e?.description||"",items:e?.items||[],uuid:e?.uuid||""})}static empty(){return new i({name:"",amount:0,percentage:!0,description:"",items:[],uuid:""})}update(e){return this.name=e.name||this.name,this.amount=e.amount||this.amount,this.percentage=e.percentage||this.percentage,this.description=e.description||this.description,this.items=e.items||this.items,this.uuid=e.uuid||this.uuid,this}toDTO(){return{name:this.name||"",amount:this.amount||0,percentage:this.percentage||!1,description:this.description||"",items:this.items||[],uuid:this.uuid||""}}};var _=class i{constructor(e){this._indexDbService=e}addOne(e){return this._indexDbService.addData("taxes",e.toDTO())}updateOne(e,t){return this._indexDbService.replaceData("taxes",e,t.toDTO())}async getOne(e){return new Promise(async(t,n)=>{if(e=typeof e=="string"?e:e.uuid,!e){t(void 0);return}await this._indexDbService.getOne("taxes",e).then(a=>{t(m.fromRaw(a))})})}getAll(){return this._indexDbService.getAll("taxes").then(e=>e.map(t=>m.fromRaw(t)))}addMany(e){return this._indexDbService.balkAdd("taxes",e.map(t=>t.toDTO()),!1)}deleteOne(e){return this._indexDbService.remove("taxes",e)}static \u0275fac=function(t){return new(t||i)(y(P))};static \u0275prov=v({token:i,factory:i.\u0275fac,providedIn:"root"})};var le=(i,e)=>e.name+e.uuid;function ue(i,e){if(i&1){let t=O();s(0,"section",2)(1,"div",5)(2,"lg-gap-row",6),C(3,"lg-input",7)(4,"lg-textarea",8),s(5,"lg-checkbox",9),l("onCheckboxChanged",function(){let a=x(t).$index,u=d();return g(u.onTaxValueChange(a))}),p(),s(6,"lg-number-input",10),l("onInputChange",function(){let a=x(t).$index,u=d();return g(u.onTaxValueChange(a))}),p(),s(7,"lg-button",11),l("click",function(){let a=x(t).$index,u=d();return g(u.deleteTxRow(a))}),C(8,"mat-icon",12),p()()()()}if(i&2){let t=e.$index;d().taxesForm.controls.rows.controls[t],o("formGroupName",t),r(),I("taxes__row--odd",t%2!==0),r(),o("top",!0)("fit",!0),r(),o("placeholder","Name"),r(),o("rows",3)("placeholder","Description"),r(),o("customMark","%"),r(),o("placeholder","Value"),r(),f("danger"),o("size","tiny")("icon",!0)}}function de(i,e){i&1&&h(0," Save changes ")}function xe(i,e){i&1&&h(0," No changes ")}var me=class i{constructor(e,t){this._taxesRepository=e;this._notificationService=t}taxes=T([]);rows=E(()=>this.taxes().map(e=>m.fromRaw(e)));taxesForm=new S({rows:new U([this._getRowGroup()])});rowsEffect=G(()=>{this._rowsFormArray.clear(),this.rows().forEach((e,t)=>{this._rowsFormArray.push(this._getRowGroup(e))}),this.taxesForm.updateValueAndValidity(),this.taxesForm.markAsPristine()});totalTaxes=T(0);formValues=this.taxesForm.valueChanges.pipe(M());get _rowsFormArray(){return this.taxesForm.get("rows")}ngOnInit(){this._taxesRepository.getAll().then(e=>{this.taxes.set(e)})}onTaxValueChange(e){}deleteTxRow(e){let t=this.taxesForm.value.rows?.[e]?.uuid;this._rowsFormArray.removeAt(e),this.taxesForm.markAsDirty(),t&&this._taxesRepository.deleteOne(t)}addTaxRow(){this._rowsFormArray.push(this._getRowGroup()),this.taxesForm.markAsDirty()}async saveTaxes(){try{let e=this.taxesForm.value.rows?.map(t=>m.fromRaw($(t)))??[];await this._taxesRepository.addMany(e),this._notificationService.success("Taxes saved successfully"),this.taxesForm.markAsPristine()}catch(e){this._notificationService.error(V(e))}}_getRowGroup(e){return new S({name:new c(e?.name||""),description:new c(e?.description||""),value:new c(e?.amount||0),amount:new c(0),percentage:new c(e?.percentage||!1),uuid:new c(e?.uuid||"")})}static \u0275fac=function(t){return new(t||i)(w(_),w(K))};static \u0275cmp=b({type:i,selectors:[["lg-taxes-settings"]],decls:11,vars:7,consts:[[3,"formGroup"],["formArrayName","rows"],[1,"taxes",3,"formGroupName"],["lgSelfCenter","","lgShrink","",3,"click","disabled"],["lgSelfCenter","","lgShrink","",3,"click"],[1,"taxes__row"],[3,"top","fit"],["formControlName","name","lgWidth","35%",3,"placeholder"],["lgWidth","35%","formControlName","description",3,"rows","placeholder"],["lgShrink","","formControlName","percentage",3,"onCheckboxChanged","customMark"],["lgParseMath","","formControlName","value",3,"onInputChange","placeholder"],["lgShrink","",3,"click","size","icon"],["aria-hidden","false","aria-label","Example home icon","fontIcon","close"]],template:function(t,n){t&1&&(s(0,"lg-gap-column"),R(1,0)(2,1),k(3,ue,9,14,"section",2,le),N()(),s(5,"lg-gap-row")(6,"lg-button",3),l("click",function(){return n.saveTaxes()}),F(7,de,1,0)(8,xe,1,0),p(),s(9,"lg-button",4),l("click",function(){return n.addTaxRow()}),h(10," Add tax "),p()()()),t&2&&(r(),o("formGroup",n.taxesForm),r(2),A(n.taxes()),r(3),f("success"),o("disabled",!n.taxesForm.dirty),r(),D(n.taxesForm.dirty?7:8),r(2),f("warning"))},dependencies:[Q,ee,q,j,X,Y,te,Z,re,ne,J,W,H,z,B,ae,oe,ie,se,L],encapsulation:2})};export{me as a};
