import{b as q,c as E}from"./chunk-JP6PMMAY.js";import{b as H}from"./chunk-OY2ELBIK.js";import{a as le,b as pe,c as me,d as se,e as L,f as de,g as n,h as ue,i as _e}from"./chunk-4MS7ILGW.js";import{c as Re}from"./chunk-X3KXMY5L.js";import{a as ae}from"./chunk-PRC2TUST.js";import{a as te}from"./chunk-TUDI3AO3.js";import{a as oe,c as re}from"./chunk-XIYQIEXZ.js";import{a as ne}from"./chunk-YVWEPQQI.js";import{b as ce}from"./chunk-TQW2ZMTR.js";import"./chunk-Y253D3CO.js";import{a as fe}from"./chunk-IMBV6HKK.js";import{b as ge}from"./chunk-D2BCHPSI.js";import{a as Y}from"./chunk-K6ET3LZC.js";import{a as ie}from"./chunk-O7CSOEHI.js";import"./chunk-WQFB6RUU.js";import{a as K,c as ee}from"./chunk-A5B4YQGG.js";import"./chunk-G7HHG7D5.js";import"./chunk-HG4USQGA.js";import{a as X}from"./chunk-4ISSSXDT.js";import{a as W}from"./chunk-PU3XS3SA.js";import"./chunk-SNDQO5FA.js";import{s as Q,v as J}from"./chunk-RFFWLM6I.js";import"./chunk-J66PYGJX.js";import{Ab as p,Bb as y,Fb as h,Ib as _,Jb as d,P as N,Sa as r,Vb as m,Wb as F,X as V,Xa as g,Xb as C,Z as f,ab as B,ac as U,ea as x,fa as T,fb as R,gc as O,hc as z,k as Z,la as $,nb as a,q as v,qb as u,s as j,tb as w,ub as A,vb as G,xb as D,yb as I,zb as l}from"./chunk-MV5CNZ6J.js";import"./chunk-DELOOZDJ.js";import{f as M}from"./chunk-2WH2EVR6.js";var ye=new V("CategorizedRecipesList",{factory:()=>{let t=f(E),i=f(H);return Z(t.loadRecipes()).pipe(N(()=>t.recipes$),v(o=>o.map(c=>c.toDTO()))).pipe(v(o=>o.toSorted((c,s)=>c.name.localeCompare(s.name))),v(o=>ae(o,"category_id")),j(o=>M(void 0,null,function*(){let c=[];for(let S in o){let k=o[S],ve=yield i.getOne(S);c.push({category:ve?.name,recipes:k.map(xe=>q.fromRaw(xe))})}if(!c.length)return[];let[s,...P]=c.toSorted((S,k)=>S.category>k.category?1:-1);return s?.category?[s].concat(P):P.concat([s])})))}});var Ce=n.object({name:n.string(),amount:n.number().or(n.string()),uuid:n.string().optional(),product_id:_e,recipe_id:n.lazy(()=>b),unit:n.enum(["gram","portion","piece"])});var b=n.object({name:n.string(),uuid:n.string().optional(),description:n.string(),ingredients:n.array(n.lazy(()=>Ce)),outcome_unit:ue,outcome_amount:n.number().or(n.string()),taxTemplateName:n.string().optional(),category_id:n.string().nullable().optional(),createdAt:n.union([n.string(),n.number()]).optional(),updatedAt:n.union([n.string(),n.number()]).optional(),tags:n.array(n.string()).optional()});var Te=(t,i)=>i==null?null:i.category,De=(t,i)=>i==null?null:i.createdAt;function Ie(t,i){t&1&&(l(0,"lg-button",6),y(1,"mat-icon",7),p()),t&2&&(u("success"),a("icon",!0)("link","/recipes/add")("size","medium"))}function he(t,i){if(t&1&&(l(0,"span"),m(1),p()),t&2){let e=i.$implicit;r(),F(e==null?null:e.name)}}function Ee(t,i){t&1&&m(0," Unsaved existing recipe: ")}function Le(t,i){t&1&&m(0," Draft recipe: ")}function be(t,i){if(t&1){let e=h();l(0,"lg-gap-row",4)(1,"a",9),w(2,Ee,1,0)(3,Le,1,0),m(4),p(),l(5,"small",10),m(6),O(7,"timeAgo"),p(),l(8,"lg-button",11),_("click",function(){x(e);let c=d().$implicit,s=d(2);return T(s.deleteDraft(c))}),y(9,"mat-icon",12),p()()}if(t&2){let e=d().$implicit;a("center",!0),r(),a("routerLink","/recipes/draft/"+(e==null?null:e.uuid)),r(),A(!(e==null||e.meta==null)&&e.meta.uuid?2:3),r(2),C(" ",(e==null||e.data==null?null:e.data.name)??""," "),r(2),C(" edited at: ",z(7,9,(e==null?null:e.createdAt)||(e==null?null:e.updatedAt))," "),r(2),u("danger"),a("size","tiny")("icon",!0)}}function ke(t,i){t&1&&R(0,be,10,11,"ng-template",8)}function we(t,i){if(t&1&&(l(0,"lg-card-list",5),D(1,ke,1,0,null,8,De),p()),t&2){let e=d();r(),I(e.draft())}}function Ae(t,i){if(t&1){let e=h();l(0,"lg-gap-row",4)(1,"a",16),m(2),p(),l(3,"lg-button",17),m(4," Calculate "),p(),l(5,"small",18),m(6),O(7,"timeAgo"),p(),l(8,"lg-button",11),_("click",function(){x(e);let c=d().$implicit,s=d(2);return T(s.deleteRecipe(c))}),y(9,"mat-icon",19),p()()}if(t&2){let e=d().$implicit;a("center",!0),r(),a("routerLink","/recipes/edit/"+e.uuid),r(),F(e.name),r(),u("primary"),a("size","small")("link","/recipes/calculate/"+e.uuid)("flat",!0),r(3),C(" edited at: ",z(7,13,(e==null?null:e.createdAt)||(e==null?null:e.updatedAt))," "),r(2),u("danger"),a("size","tiny")("icon",!0)}}function Fe(t,i){if(t&1&&R(0,Ae,10,15,"ng-template",15),t&2){let e=i.$implicit;a("uuid",e.uuid)}}function Oe(t,i){if(t&1){let e=h();l(0,"lg-title",13),m(1),p(),l(2,"lg-card-list",14),_("onSelected",function(c){x(e);let s=d();return T(s.selectionZoneService.putSelected(c))}),D(3,Fe,1,1,null,15,G),p()}if(t&2){let e=i.$implicit,o=d();a("level",3),r(),C(" ",(e==null?null:e.category)||"Uncategorized"," "),r(),a("mode",o.selectionZoneService.selectionMode())("selectAll",o.selectionZoneService.selectAll())("deselectAll",o.selectionZoneService.deselectAll()),r(),I(e.recipes)}}function ze(t,i){t&1&&(l(0,"lg-gap-row",4)(1,"lg-title",13),m(2," No recipes found "),p()()),t&2&&(a("center",!0),r(),a("level",5))}var Se=class t{constructor(i,e,o,c){this._recipesRepository=i;this._notificationsService=e;this._transferDataService=o;this.selectionZoneService=c}draft=$([]);recipes=ce(f(ye));Stores=J;ngOnInit(){this.loadRecipes();let i=this._recipesRepository.getDraftRecipe();i&&this.draft.set(i)}deleteRecipe(i){return i.uuid?this._recipesRepository.deleteRecipe(i.uuid).then(()=>{this.loadRecipes(),this._notificationsService.success("Recipe deleted")}):Promise.resolve()}loadRecipes(){this._recipesRepository.loadRecipes()}exportRecipes(i){this._transferDataService.exportTable("recipesStore","json",{selected:Array.from(i)})}deleteDraft(i){this._recipesRepository.removeDraftRecipe(i.uuid),this.draft.update(e=>e.filter(o=>o?.uuid!==i.uuid))}RecipeScheme=b;static \u0275fac=function(e){return new(e||t)(g(E),g(ge),g(Re),g(L))};static \u0275cmp=B({type:t,selectors:[["lg-recipes-list"]],features:[U([L])],decls:16,vars:9,consts:[["lgQuickActionsTpl",""],[3,"click","flat","size"],[3,"onDone","schema","storeName"],["lgImportRowTpl",""],[3,"center"],[2,"--card-bg","#bee5ff"],[3,"icon","link","size"],["aria-hidden","false","fontIcon","add"],["lgCardListItem",""],["lgExpand","",3,"routerLink"],[1,"text-muted","text-cursive"],[3,"click","size","icon"],["aria-hidden","false","fontIcon","close"],[3,"level"],[3,"onSelected","mode","selectAll","deselectAll"],["lgCardListItem","",3,"uuid"],[3,"routerLink"],[3,"size","link","flat"],["lgPull","",1,"text-muted","text-cursive"],["aria-hidden","false","aria-label","Example home icon","fontIcon","close"]],template:function(e,o){if(e&1&&(l(0,"lg-controls-bar"),R(1,Ie,2,5,"ng-template",0),y(2,"lg-selection-tools"),l(3,"lg-button",1),_("click",function(){return o.exportRecipes(o.selectionZoneService.selected())}),m(4," Export "),p(),l(5,"lg-import",2),_("onDone",function(){return o.loadRecipes()}),R(6,he,2,1,"ng-template",3),p()(),l(7,"lg-fade-in")(8,"lg-container")(9,"lg-gap-row",4)(10,"lg-title"),m(11," Recipes "),p()(),w(12,we,3,0,"lg-card-list",5),D(13,Oe,5,5,null,null,Te,!1,ze,3,2,"lg-gap-row",4),p()()),e&2){let c;r(3),u("info"),a("flat",!0)("size","small"),r(2),a("schema",o.RecipeScheme)("storeName",o.Stores.RECIPES),r(4),a("center",!0),r(3),A((c=o.draft())!=null&&c.length?12:-1),r(),I(o.recipes())}},dependencies:[ee,ie,Q,ne,K,W,re,oe,pe,le,X,se,me,de,Y,fe,te],styles:["[_nghost-%COMP%]{display:block}"]})};export{Se as RecipesListComponent};
