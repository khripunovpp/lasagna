import{a as ne,b as re,c as ce,d as ae,e as le,f as pe,g as me,h as de}from"./chunk-QGYLIZFA.js";import{a as te,c as ie}from"./chunk-OPWIYIGK.js";import{a as ee}from"./chunk-65PCG7KQ.js";import{b as oe}from"./chunk-UKAU3626.js";import"./chunk-G42TUXVK.js";import{a as se}from"./chunk-ZBULITSO.js";import"./chunk-7JNSNANE.js";import{a as O,b as q,c as R}from"./chunk-Q6KZUDEQ.js";import{a as H}from"./chunk-PVXJHGVC.js";import"./chunk-RFEBMF6P.js";import"./chunk-Q24HNGKZ.js";import"./chunk-FG5PJ7WR.js";import{a as Q,d as Y}from"./chunk-URRPTXWM.js";import"./chunk-E64ZE4KI.js";import{a as X}from"./chunk-5PVAHMKX.js";import{a as J,c as K}from"./chunk-PXM5XOY4.js";import{f as G,t as U,w as W}from"./chunk-JUGNCNLY.js";import{$b as w,Ab as C,Bb as x,Cb as j,Eb as b,Fb as h,Gb as r,Hb as c,Ib as k,Mb as T,Pb as v,Qb as m,W as N,Za as o,ac as a,bc as L,ca as $,cb as g,cc as d,dc as F,ea as u,f as A,hb as z,la as _,ma as f,mb as y,nc as Z,pc as B,r as V,ub as p,x as D,xb as I,z as M}from"./chunk-46OIECST.js";var ue=new $("CategorizedProductsList",{factory:()=>{let t=u(R),i=u(H);return V(t.loadRecipes()).pipe(N(()=>t.products$)).pipe(D(n=>n.toSorted((l,s)=>l.name.localeCompare(s.name))),D(n=>ae(n,"category_id")),M(n=>A(void 0,null,function*(){let l=[];for(let S in n){let E=n[S],fe=yield i.getOne(S);l.push({category:fe?.name,products:E})}if(!l.length)return[];let[s,...P]=l.toSorted((S,E)=>S.category>E.category?1:-1);return s?.category?[s].concat(P):P.concat([s])})))}});var ge=(t,i)=>i==null?null:i.category;function Ce(t,i){t&1&&(r(0,"lg-button",6),k(1,"mat-icon",7),c()),t&2&&(I("success"),p("icon",!0)("link","/products/add")("size","medium"))}function xe(t,i){if(t&1&&(r(0,"span"),a(1),c()),t&2){let e=m(2).$implicit;o(),d("from ",e.source)}}function ve(t,i){if(t&1&&(r(0,"span"),a(1),c(),r(2,"span"),a(3),c(),C(4,xe,2,1,"span")),t&2){let e=m().$implicit;o(),L(e.name),o(2),F("",e.amount,"gr for ",e.price),o(),x(e.source?4:-1)}}function Pe(t,i){if(t&1&&(r(0,"span"),a(1),c()),t&2){let e=m(2).$implicit;o(),d("from ",e==null?null:e.source)}}function Se(t,i){if(t&1&&(r(0,"span"),a(1),c(),r(2,"span"),a(3),c(),C(4,Pe,2,1,"span")),t&2){let e=m().$implicit;o(),L(e==null?null:e.name),o(2),F("",e==null?null:e.amount," gr for ",e==null?null:e.price),o(),x(e!=null&&e.source?4:-1)}}function ye(t,i){if(t&1&&C(0,ve,5,4)(1,Se,5,4),t&2){let e=i.flow;x(e==="new"?0:1)}}function Ie(t,i){t&1&&a(0," per gram ")}function Te(t,i){if(t&1&&a(0),t&2){let e=m(2).$implicit;d(" per ",e.unit," ")}}function we(t,i){if(t&1){let e=T();r(0,"lg-gap-row",5)(1,"div",11)(2,"lg-gap-row",5)(3,"div",12)(4,"a",13),a(5),c()(),r(6,"div",14),a(7),c(),r(8,"div",15),a(9),Z(10,"number"),C(11,Ie,1,0)(12,Te,1,1),c()()(),r(13,"lg-button",16),v("click",function(){_(e);let l=m().$implicit,s=m(2);return f(s.deleteProduct(l))}),k(14,"mat-icon",17),c()()}if(t&2){let e=m().$implicit,n=m(2);p("center",!0),o(2),p("center",!0),o(2),p("routerLink","/products/edit/"+e.uuid),o(),L(e.name),o(2),d(" ",e.source??""),o(2),d(" ",B(10,11,n.getPricePerGram(e),"1.2-5")," "),o(2),x(!e.unit||e.unit==="gram"?11:12),o(2),I("danger"),p("size","tiny")("icon",!0)}}function Le(t,i){if(t&1&&y(0,we,15,14,"ng-template",10),t&2){let e=i.$implicit;p("uuid",e.uuid)}}function Re(t,i){if(t&1){let e=T();r(0,"lg-title",8),a(1),c(),r(2,"lg-card-list",9),v("onSelected",function(l){_(e),m();let s=w(11);return f(s.putSelected(l))}),b(3,Le,1,1,null,10,j),c()}if(t&2){let e=i.$implicit;m();let n=w(11);p("level",3),o(),d(" ",(e==null?null:e.category)||"Uncategorized"," "),o(),p("mode",n.selectionMode())("selectAll",n.selectAll())("deselectAll",n.deselectAll()),o(),h(e.products)}}function Ee(t,i){t&1&&(r(0,"lg-gap-row",5)(1,"lg-title",8),a(2," No products found "),c()()),t&2&&(p("center",!0),o(),p("level",5))}var _e=class t{constructor(i,e,n,l){this._productsRepository=i;this._csvReaderService=e;this._transferDataService=n;this._notificationsService=l}products=oe(u(ue));ProductDbInputScheme=q;Stores=Q;getPricePerGram(i){return(O(i.price)||1)/(O(i.amount)||1)}exportProducts(i){this._transferDataService.exportTable("productsStore","json",{selected:Array.from(i)})}deleteProduct(i){i.uuid&&this._productsRepository.deleteProduct(i.uuid).then(()=>{this._notificationsService.success("Product deleted"),this.loadProducts()})}ngOnInit(){this.loadProducts()}loadProducts(){this._productsRepository.loadRecipes()}static \u0275fac=function(e){return new(e||t)(g(R),g(re),g(de),g(se))};static \u0275cmp=z({type:t,selectors:[["lg-product-list"]],decls:15,vars:7,consts:[["selectionZone",""],["lgQuickActionsTpl",""],[3,"click","flat","size"],[3,"onDone","schema","storeName"],["lgImportRowTpl",""],[3,"center"],[3,"icon","link","size"],["aria-hidden","false","fontIcon","add"],[3,"level"],[3,"onSelected","mode","selectAll","deselectAll"],["lgCardListItem","",3,"uuid"],[1,"expand"],[2,"flex","20%"],[3,"routerLink"],[2,"flex","10%"],[2,"flex","70%"],[3,"click","size","icon"],["aria-hidden","false","aria-label","Example home icon","fontIcon","close"]],template:function(e,n){if(e&1){let l=T();r(0,"lg-controls-bar"),y(1,Ce,2,5,"ng-template",1),r(2,"lg-button",2),v("click",function(){_(l);let P=w(11);return f(n.exportProducts(P.selected()))}),a(3," Export "),c(),r(4,"lg-import",3),v("onDone",function(){return _(l),f(n.loadProducts())}),y(5,ye,2,1,"ng-template",4),c()(),r(6,"lg-fade-in")(7,"lg-container")(8,"lg-title"),a(9," Products "),c(),r(10,"lg-selection-zone",null,0),b(12,Re,5,5,null,null,ge,!1,Ee,3,2,"lg-gap-row",5),c()()()}e&2&&(o(2),I("info"),p("flat",!0)("size","small"),o(2),p("schema",n.ProductDbInputScheme)("storeName",n.Stores.PRODUCTS),o(8),h(n.products()))},dependencies:[X,Y,ee,J,K,G,ie,te,ce,U,ne,le,W,me,pe],styles:["[_nghost-%COMP%]{display:block}"]})};export{_e as ProductListComponent};
