import{a as Te}from"./chunk-5LVT5CIW.js";import{a as Se}from"./chunk-FUDSXVU3.js";import{a as he}from"./chunk-YUP5JDQH.js";import{a as ve}from"./chunk-EFUQGURE.js";import{a as xe}from"./chunk-NPVNOLNP.js";import{a as _e}from"./chunk-M6HKTIEP.js";import{a as Ce}from"./chunk-HG7FI27B.js";import{a as ue}from"./chunk-RQOUIVSL.js";import{a as fe,c as ge}from"./chunk-OJVUNIUU.js";import{v as de}from"./chunk-VUJEMPM4.js";import{a as pe}from"./chunk-FZG57PQR.js";import{a as me}from"./chunk-J2RZLNZG.js";import{I as Z,J as ee,K as R,M as _,R as te,S as ne,T as ie,U as oe,W as re,X as ae,Y as se,da as E,g as L,ma as le,o as Q,oa as ce,t as X,z as Y}from"./chunk-JCWE4SYV.js";import{i as K}from"./chunk-FO7Q5A2R.js";import{$a as o,Bc as p,Cc as c,Db as u,Eb as C,Ec as U,Hb as G,Ib as $,Jb as r,Kb as a,Lb as m,Lc as q,Mb as y,Mc as J,Nb as P,Ob as O,Pb as N,Qb as H,Ub as f,Vb as s,Wb as j,Xb as W,dc as I,eb as B,ec as F,fc as z,gc as b,ic as x,kc as g,la as h,lb as v,ma as T,nb as S,qb as w,va as M}from"./chunk-7BND6AGV.js";var k=class n{constructor(){}selfAlign="center";static \u0275fac=function(t){return new(t||n)};static \u0275dir=S({type:n,selectors:[["","lgSelfCenter",""]],hostVars:2,hostBindings:function(t,i){t&2&&F("align-self",i.selfAlign)}})};var Fe=["*"],A=class n{static \u0275fac=function(t){return new(t||n)};static \u0275cmp=v({type:n,selectors:[["lg-control-box"]],ngContentSelectors:Fe,decls:1,vars:0,template:function(t,i){t&1&&(j(),W(0))},styles:["[_nghost-%COMP%]{display:flex;flex:1;background-color:var(--control-bg);border-radius:12px;gap:8px;padding:16px}"]})};var D=class n{constructor(){}selfAlign="end";static \u0275fac=function(t){return new(t||n)};static \u0275dir=S({type:n,selectors:[["","lgSelfEnd",""]],hostVars:2,hostBindings:function(t,i){t&2&&F("align-self",i.selfAlign)}})};var ke=(n,e)=>e.name+e.uuid+n;function Ae(n,e){n&1&&(x(0),p(1,"translate")),n&2&&g(" ",c(1,1,"settings.taxes.fees")," ")}function De(n,e){n&1&&N(0)}function Me(n,e){if(n&1&&(a(0,"lg-control-box")(1,"lg-flex-column",7),w(2,De,1,0,"ng-container",8),m()()),n&2){s();let t=I(5);o(2),r("ngTemplateOutlet",t)}}function Be(n,e){n&1&&N(0)}function Ne(n,e){if(n&1&&(a(0,"div",9),w(1,Be,1,0,"ng-container",8),m()),n&2){let t=s().$index,i=I(5);z("taxes__row--odd",t%2!==0),o(),r("ngTemplateOutlet",i)}}function Ie(n,e){n&1&&x(0," Delete this row ")}function Re(n,e){n&1&&y(0,"mat-icon",19)}function Ee(n,e){if(n&1){let t=H();a(0,"lg-flex-row",10)(1,"lg-control",11),p(2,"translate"),y(3,"lg-input",12),m(),a(4,"lg-control",11),p(5,"translate"),y(6,"lg-textarea",13),m(),a(7,"lg-control",14),p(8,"translate"),a(9,"lg-checkbox",15),f("onCheckboxChanged",function(){h(t);let l=s().$index,d=s();return T(d.onTaxValueChange(l))}),m()(),a(10,"lg-control",16),p(11,"translate"),a(12,"lg-number-input",17),f("onInputChange",function(){h(t);let l=s().$index,d=s();return T(d.onTaxValueChange(l))}),m()(),a(13,"lg-button",18),f("click",function(){h(t);let l=s().$index,d=s();return T(d.deleteTxRow(l))}),u(14,Ie,1,0)(15,Re,1,0,"mat-icon",19),m()()}if(n&2){let t=s(),i=t.$implicit,l=t.$index,d=s();r("fit",!0)("mobileMode",!0)("top",!0),o(),r("label",c(2,15,"settings.taxes.name")),o(3),r("label",c(5,17,"settings.taxes.description")),o(2),r("rows",4),o(),r("label",c(8,19,"settings.taxes.percentage")),o(2),r("customMark","%")("name",i.name+l),o(),r("label",c(11,21,"settings.taxes.value")),o(3),b("danger"),r("icon",!d.isMobile())("size","tiny"),o(),C(d.isMobile()?14:15)}}function Ve(n,e){if(n&1&&(u(0,Ae,2,3),a(1,"section",5),u(2,Me,3,1,"lg-control-box")(3,Ne,2,3,"div",6),w(4,Ee,16,23,"ng-template",null,0,U),m()),n&2){let t=e.$index,i=s();i.taxesForm.controls.rows.controls[t],C(i.feesIndex()===t?0:-1),o(),r("formGroupName",t),o(),C(i.isMobile()?2:3)}}function Ge(n,e){n&1&&(x(0),p(1,"translate")),n&2&&g(" ",c(1,1,"settings.taxes.save-changes")," ")}function $e(n,e){n&1&&(x(0),p(1,"translate")),n&2&&g(" ",c(1,1,"settings.taxes.no-changes")," ")}var we=class n{constructor(e,t){this._taxesRepository=e;this._notificationService=t}taxesAndFees=M([]);feesIndex=q(()=>this.taxesAndFees().findIndex(e=>!e.percentage));isMobile=Te(768);taxesForm=new R({rows:new re([this._getRowGroup()])});rowsEffect=J(()=>{this._rowsFormArray.clear(),this.taxesAndFees().forEach((e,t)=>{this._rowsFormArray.push(this._getRowGroup(e))}),this.taxesForm.updateValueAndValidity(),this.taxesForm.markAsPristine()});totalTaxes=M(0);formValues=this.taxesForm.valueChanges.pipe(Q());get _rowsFormArray(){return this.taxesForm.get("rows")}ngOnInit(){this._taxesRepository.getAll().then(e=>{this.taxesAndFees.set(e.toSorted((t,i)=>t.name.localeCompare(i.name)&&+i.percentage-+t.percentage))})}onTaxValueChange(e){}deleteTxRow(e){let t=this.taxesForm.value.rows?.[e]?.uuid;this._rowsFormArray.removeAt(e),this.taxesAndFees.update(i=>i.filter(l=>l.uuid!==t)),this.taxesForm.markAsDirty(),t&&this._taxesRepository.deleteOne(t)}addTaxRow(){let e=E.empty();this._rowsFormArray.push(this._getRowGroup(e)),this.taxesAndFees.update(t=>[...t,e]),this.taxesForm.markAsDirty()}async saveTaxes(){try{let e=this.taxesForm.value.rows?.map(t=>E.fromRaw(X(t)))??[];await this._taxesRepository.addMany(e),this._notificationService.success("settings.taxes.saved-success"),this.taxesForm.markAsPristine()}catch(e){this._notificationService.error(L(e))}}_getRowGroup(e){return new R({name:new _(e?.name||""),description:new _(e?.description||""),value:new _(e?.amount||0),amount:new _(0),percentage:new _(e?.percentage||!1),uuid:new _(e?.uuid||"")})}static \u0275fac=function(t){return new(t||n)(B(Se),B(le))};static \u0275cmp=v({type:n,selectors:[["lg-taxes-settings"]],decls:14,vars:13,consts:[["rowTpl",""],[3,"formGroup"],["formArrayName","rows"],["lgSelfCenter","","lgShrink","",3,"click","disabled"],["lgSelfCenter","","lgShrink","",3,"click"],[1,"taxes",3,"formGroupName"],[1,"taxes__row",3,"taxes__row--odd"],[2,"--control-bg","white"],[4,"ngTemplateOutlet"],[1,"taxes__row"],[3,"fit","mobileMode","top"],["lgShrink","","lgWidth","35%",3,"label"],["formControlName","name","placeholder",""],["formControlName","description","placeholder","",3,"rows"],["lgShrink","","lgWidth","15%",3,"label"],["formControlName","percentage",3,"onCheckboxChanged","customMark","name"],["lgWidth","15%",3,"label"],["formControlName","value","lgParseMath","","placeholder","",3,"onInputChange"],["lgSelfEnd","","lgShrink","",3,"click","icon","size"],["aria-hidden","false","aria-label","Example home icon","fontIcon","close"]],template:function(t,i){t&1&&(a(0,"lg-flex-column"),P(1,1)(2,2),x(3),p(4,"translate"),G(5,Ve,6,3,null,null,ke),O()(),a(7,"lg-flex-row")(8,"lg-button",3),f("click",function(){return i.saveTaxes()}),u(9,Ge,2,3)(10,$e,2,3),m(),a(11,"lg-button",4),f("click",function(){return i.addTaxRow()}),x(12),p(13,"translate"),m()()()),t&2&&(o(),r("formGroup",i.taxesForm),o(2),g(" ",c(4,9,"settings.taxes.title")," "),o(2),$(i.taxesAndFees()),o(3),b("success"),r("disabled",!i.taxesForm.dirty),o(),C(i.taxesForm.dirty?9:10),o(2),b("warning"),o(),g(" ",c(13,11,"settings.taxes.add-tax")," "))},dependencies:[pe,xe,ae,Z,ee,ce,ve,de,fe,ge,se,te,oe,ne,ie,k,Ce,_e,he,me,Y,ue,A,K,D],encapsulation:2})};export{k as a,A as b,D as c,we as d};
