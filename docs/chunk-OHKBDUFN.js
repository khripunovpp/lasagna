import{a as ue,b as _e,c as ge,f as Ce,i as xe,j as Se}from"./chunk-YXKLW6XS.js";import"./chunk-4UP3VRXZ.js";import{a as fe}from"./chunk-PRC2TUST.js";import{a as ae}from"./chunk-C7Y4XD5I.js";import{a as de,c as se}from"./chunk-UKASGQDE.js";import{b as me}from"./chunk-UL2AXCZQ.js";import"./chunk-6B5WCZG7.js";import{a as re}from"./chunk-3KUCNXWV.js";import{a as ve}from"./chunk-S5HI73SL.js";import{a as pe}from"./chunk-7PSVJ3RT.js";import{a as ce}from"./chunk-JTBLULAK.js";import"./chunk-KNGN5IJR.js";import"./chunk-XIO6VEU6.js";import{a as ie,b as le}from"./chunk-E6C4JVEO.js";import{a as oe}from"./chunk-6IJ5CQKN.js";import{a as ne}from"./chunk-3KK5VW3S.js";import"./chunk-SNDQO5FA.js";import{f as X,j as Y,n as h,o as te,p as R}from"./chunk-QRZHBSWL.js";import{b as W}from"./chunk-ZSE7PDFB.js";import"./chunk-5KSZNU56.js";import"./chunk-PA3IAPUX.js";import"./chunk-WML5M3MW.js";import{u as ee}from"./chunk-BEK46ZVO.js";import"./chunk-JUT3UYVX.js";import{s as J,w as K}from"./chunk-YNW7YBWB.js";import"./chunk-652DFWNF.js";import{k as H}from"./chunk-O377EGFO.js";import{$ as S,$b as _,Ab as D,Bb as E,Cb as r,Db as l,Eb as I,Ib as L,Lb as g,Mb as s,R as V,Va as n,Yb as p,Z as j,Zb as F,_a as C,_b as f,db as N,dc as G,ec as Q,fc as q,ga as y,ha as P,ib as w,jc as d,k as $,kc as m,lc as B,na as z,q as k,qb as a,s as M,tb as T,wb as x,xb as v,yb as U}from"./chunk-TBUBSNFD.js";import"./chunk-DELOOZDJ.js";import{f as Z}from"./chunk-2WH2EVR6.js";var ye=new j("CategorizedProductsList",{factory:()=>{let t=S(R),i=S(W);return $(t.loadAll()).pipe(V(()=>t.products$)).pipe(k(o=>o.toSorted((c,u)=>c.name.localeCompare(u.name))),k(o=>fe(o,"category_id")),M(o=>Z(void 0,null,function*(){let c=[];for(let b in o){let A=o[b],Te=yield i.getOne(b);c.push({category:Te?.toString(),products:A})}if(!c.length)return[];let[u,...O]=c.toSorted((b,A)=>b.category>A.category?1:-1);return u?.category?[u].concat(O):O.concat([u])})))}});var Ie=()=>["product"],Le=t=>({length:t}),be=(t,i)=>i.uuid,we=(t,i)=>i==null?null:i.uuid;function De(t,i){if(t&1&&(r(0,"span"),p(1),d(2,"translate"),l()),t&2){let e=s(2).$implicit;n(),_("",m(2,2,"from-location")," ",e.source)}}function Ee(t,i){if(t&1&&(r(0,"span"),p(1),l(),r(2,"span"),p(3),l(),x(4,De,3,4,"span")),t&2){let e=s().$implicit;n(),F(e.name),n(2),_("",e.amount,"gr for ",e.price),n(),v(e.source?4:-1)}}function he(t,i){if(t&1&&(r(0,"span"),p(1),d(2,"translate"),l()),t&2){let e=s(2).$implicit;n(),_("",m(2,2,"from-location")," ",e==null?null:e.source)}}function Re(t,i){if(t&1&&(r(0,"span"),p(1),l(),r(2,"span"),p(3),l(),x(4,he,3,4,"span")),t&2){let e=s().$implicit;n(),F(e==null?null:e.name),n(2),_("",e==null?null:e.amount," gr for ",e==null?null:e.price),n(),v(e!=null&&e.source?4:-1)}}function Ae(t,i){if(t&1&&x(0,Ee,5,4)(1,Re,5,4),t&2){let e=i.flow;v(e==="new"?0:1)}}function ke(t,i){t&1&&(p(0),d(1,"translate")),t&2&&f(" ",m(1,1,"draft.list-prefix.existing")," ")}function Fe(t,i){t&1&&(p(0),d(1,"translate")),t&2&&f(" ",m(1,1,"draft.list-prefix.new")," ")}function Be(t,i){if(t&1){let e=L();r(0,"lg-gap-row",7)(1,"a",10),x(2,ke,2,3)(3,Fe,2,3),p(4),l(),r(5,"small",11),p(6),d(7,"translate"),d(8,"timeAgo"),l(),r(9,"lg-button",12),g("click",function(){y(e);let c=s().$implicit,u=s(2);return P(u.deleteDraft(c))}),I(10,"mat-icon",13),l()()}if(t&2){let e=s().$implicit;a("center",!0),n(),a("routerLink","/products/draft/"+(e==null?null:e.uuid)),n(),v(!(e==null||e.meta==null)&&e.meta.uuid?2:3),n(2),f(" ",(e==null||e.data==null?null:e.data.name)||"Unknown"," "),n(2),_(" ",m(7,10,"edited-at-label")," ",m(8,12,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," "),n(3),T("danger"),a("size","tiny")("icon",!0)}}function Oe(t,i){if(t&1&&w(0,Be,11,14,"ng-template",9),t&2){let e=i.$implicit;a("uuid",e.uuid)}}function Ze(t,i){if(t&1){let e=L();r(0,"lg-expander",6),d(1,"translate"),d(2,"translate"),r(3,"lg-card-list",8),g("onSelected",function(c){y(e);let u=s();return P(u.selectionZoneService.putSelected(c))}),D(4,Oe,1,1,null,9,be),l()()}if(t&2){let e,o=s();a("closeLabel",m(1,5,"drafts-close-label"))("openLabel",B(2,7,"drafts-label",q(10,Le,(e=o.draft())==null?null:e.length))),n(3),a("mode",o.selectionZoneService.selectionMode())("selectAll",o.selectionZoneService.selectAll().draft)("deselectAll",o.selectionZoneService.deselectAll().draft),n(),E(o.draft())}}function $e(t,i){if(t&1){let e=L();r(0,"lg-gap-row",7)(1,"div",17)(2,"lg-gap-row",7)(3,"lg-gap-row",18)(4,"a",19),p(5),l(),r(6,"div"),p(7),d(8,"number"),l()(),r(9,"small",20),p(10),d(11,"translate"),d(12,"timeAgo"),l()()(),r(13,"lg-button",12),g("click",function(){y(e);let c=s().$implicit,u=s(2);return P(u.deleteProduct(c))}),I(14,"mat-icon",13),l()()}if(t&2){let e=s().$implicit;a("center",!0),n(2),a("center",!0),n(),a("center",!0),n(),a("routerLink","/products/edit/"+e.uuid),n(),_(" ",e.name," ",e.source?"- "+e.source:""," "),n(2),_(" ",B(8,14,e.pricePerUnit,"1.2-5")," ",e.perUnitLabel," "),n(3),_(" ",m(11,17,"edited-at-label")," ",m(12,19,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," "),n(3),T("danger"),a("size","tiny")("icon",!0)}}function Me(t,i){if(t&1&&w(0,$e,15,21,"ng-template",16),t&2){let e=i.$implicit;a("uuid",e.uuid)}}function Ve(t,i){if(t&1){let e=L();r(0,"lg-title",14),p(1),d(2,"translate"),l(),r(3,"lg-card-list",15),g("onSelected",function(c){y(e);let u=s();return P(u.selectionZoneService.putSelected(c))}),D(4,Me,1,1,null,16,we),l()}if(t&2){let e=i.$implicit,o=s();a("level",3),n(),f(" ",(e==null?null:e.category)||m(2,5,"without-category-label")," "),n(2),a("mode",o.selectionZoneService.selectionMode())("selectAll",o.selectionZoneService.selectAll().product)("deselectAll",o.selectionZoneService.deselectAll().product),n(),E(e.products)}}function je(t,i){t&1&&(r(0,"lg-gap-row",7)(1,"lg-title",14),p(2),d(3,"translate"),l()()),t&2&&(a("center",!0),n(),a("level",5),n(),f(" ",m(3,3,"no-products")," "))}var Pe=class t{constructor(i,e,o,c,u){this._productsRepository=i;this._csvReaderService=e;this._transferDataService=o;this._notificationsService=c;this.selectionZoneService=u}products=me(S(ye));draft=z([]);ProductDbInputScheme=xe;Stores=K;exportProducts(i){this._transferDataService.exportTable("productsStore","json",{selected:Array.from(i??[])})}deleteProduct(i){i.uuid&&this._productsRepository.deleteProduct(i.uuid).then(()=>{this._notificationsService.success("Product deleted"),this.loadProducts()})}deleteDraft(i){this._productsRepository.removeDraftProduct(i.uuid),this.draft.update(e=>e.filter(o=>o?.uuid!==i.uuid))}ngOnInit(){this.loadProducts();let i=this._productsRepository.getDraftProducts();i&&this.draft.set(i)}loadProducts(){this._productsRepository.loadAll()}static \u0275fac=function(e){return new(e||t)(C(R),C(X),C(te),C(ee),C(h))};static \u0275cmp=N({type:t,selectors:[["lg-product-list"]],features:[G([h])],decls:19,vars:24,consts:[[3,"icon","link","size"],["aria-hidden","false","fontIcon","add"],[3,"selectionTypes"],[3,"click","flat","size"],[3,"onDone","label","schema","storeName"],["lgImportRowTpl",""],[3,"closeLabel","openLabel"],[3,"center"],[2,"--card-bg","#bee5ff",3,"onSelected","mode","selectAll","deselectAll"],["lgCardListItem","","type","draft",3,"uuid"],["lgExpand","",3,"routerLink"],["lgPull","",1,"text-muted","text-cursive"],[3,"click","size","icon"],["aria-hidden","false","fontIcon","close"],[3,"level"],[3,"onSelected","mode","selectAll","deselectAll"],["lgCardListItem","","type","product",3,"uuid"],[1,"expand"],["lgExpand","",3,"center"],[3,"routerLink"],[1,"text-muted","text-cursive"]],template:function(e,o){if(e&1&&(r(0,"lg-controls-bar")(1,"lg-button",0),I(2,"mat-icon",1),l(),I(3,"lg-selection-tools",2),r(4,"lg-button",3),g("click",function(){return o.exportProducts(o.selectionZoneService.selected().product)}),p(5),d(6,"translate"),l(),r(7,"lg-import",4),d(8,"translate"),g("onDone",function(){return o.loadProducts()}),w(9,Ae,2,1,"ng-template",5),l()(),r(10,"lg-fade-in")(11,"lg-container")(12,"lg-title"),p(13),d(14,"translate"),l(),x(15,Ze,6,12,"lg-expander",6),D(16,Ve,6,7,null,null,U,!1,je,4,5,"lg-gap-row",7),l()()),e&2){let c;n(),T("success"),a("icon",!0)("link","/products/add")("size","medium"),n(2),a("selectionTypes",Q(23,Ie)),n(),T("info"),a("flat",!0)("size","small"),n(),f(" ",m(6,17,"export-label")," products "),n(2),a("label",m(8,19,"import-label")+" products")("schema",o.ProductDbInputScheme)("storeName",o.Stores.PRODUCTS),n(6),f(" ",m(14,21,"products.list-title")," "),n(2),v((c=o.draft())!=null&&c.length?15:-1),n(),E(o.products())}},dependencies:[le,ce,pe,ie,ne,H,se,de,_e,J,ue,oe,ge,Ce,re,ve,ae,Y,Se],styles:["[_nghost-%COMP%]{display:block}"]})};export{Pe as ProductListComponent};
