import{a as xe,b as Se,c as ve,d as $,e as H,f as ye,g as r,h as De,i as Te,j as he}from"./chunk-BGTFDZTG.js";import"./chunk-G7WHOHFE.js";import{a as Re}from"./chunk-UOPYIIM6.js";import{a as ue}from"./chunk-D6YSZB2W.js";import{a as j,c as G}from"./chunk-DVTUUVFI.js";import{b as Ce}from"./chunk-3IFB2OYN.js";import"./chunk-SXDGRFCF.js";import{a as M}from"./chunk-WOTYHX4G.js";import{a as Ie}from"./chunk-2AUJT2WP.js";import{a as ge}from"./chunk-ASUWO7DB.js";import{a as N}from"./chunk-BWGYIJEG.js";import"./chunk-C737TW6Q.js";import"./chunk-7P2DAV6F.js";import{a as de,b as P}from"./chunk-CBPIWMMR.js";import{a as fe}from"./chunk-4EGTEAFI.js";import{a as _e}from"./chunk-72REWZLE.js";import"./chunk-SNDQO5FA.js";import{c as ce,j as F,n as D,o as me,q as T}from"./chunk-AGDD4VEX.js";import"./chunk-33U52G7J.js";import"./chunk-5KSZNU56.js";import"./chunk-KAGJE7I3.js";import{b as se}from"./chunk-XVI445TZ.js";import{u as z}from"./chunk-XFMMXZ22.js";import"./chunk-LOPFG4AH.js";import{s as B,w as Z}from"./chunk-D66Q4FT5.js";import"./chunk-652DFWNF.js";import"./chunk-JDBIU23B.js";import{$ as I,$b as C,Ab as h,Bb as L,Cb as a,Db as c,Eb as Q,Ib as S,Lb as R,Mb as s,R as te,Va as l,Z as ie,Zb as m,_a as x,_b as W,ac as k,db as E,ec as V,fc as le,ga as u,gc as pe,ha as g,ib as v,k as U,kc as d,lc as _,mc as ae,na as ne,pb as oe,q as w,qb as p,s as ee,tb as y,wb as A,xb as O,yb as re}from"./chunk-CG2HRCOU.js";import"./chunk-DELOOZDJ.js";import{f as Y}from"./chunk-2WH2EVR6.js";var Le=new ie("CategorizedRecipesList",{factory:()=>{let t=I(T),i=I(se);return U(t.loadRecipes()).pipe(te(()=>t.recipes$),w(o=>o.map(n=>n.toDTO()))).pipe(w(o=>o.toSorted((n,f)=>n.name.localeCompare(f.name))),w(o=>Re(o,"category_id")),ee(o=>Y(void 0,null,function*(){let n=[];for(let b in o){let K=o[b],Ee=yield i.getOne(b);n.push({category:Ee?.toString(),recipes:K.map(Ae=>ce.fromRaw(Ae))})}if(!n.length)return[];let[f,...X]=n.toSorted((b,K)=>b.category>K.category?1:-1);return f?.category?[f].concat(X):X.concat([f])})))}});var be=r.object({name:r.string(),amount:r.number().or(r.string()),uuid:r.string().optional(),product_id:Te,recipe_id:r.lazy(()=>q),unit:r.enum(["gram","portion","piece"])});var q=r.object({name:r.string(),uuid:r.string().optional(),description:r.string(),ingredients:r.array(r.lazy(()=>be)),outcome_unit:De,outcome_amount:r.number().or(r.string()),taxTemplateName:r.string().optional(),category_id:r.string().nullable().optional(),createdAt:r.union([r.string(),r.number()]).optional(),updatedAt:r.union([r.string(),r.number()]).optional(),tags:r.array(r.string()).optional(),color:r.string().optional()});var Ve=t=>({length:t}),Be=(t,i)=>i.uuid;function Ze(t,i){if(t&1){let e=S();a(0,"lg-button",4),R("click",function(){u(e);let n=s(2);return g(n.selectionZoneService.onSelection())}),m(1),d(2,"translate"),c()}t&2&&(y("success"),p("flat",!0)("size","small"),l(),C(" ",_(2,5,"select-many-label")," "))}function Fe(t,i){if(t&1){let e=S();a(0,"lg-button",4),R("click",function(){u(e);let n=s(2);return g(n.deleteAllDrafts())}),m(1," Delete all "),c()}t&2&&(y("danger"),p("flat",!0)("size","small"))}function ze(t,i){if(t&1){let e=S();a(0,"lg-button",5),R("click",function(){u(e);let n=s(3);return g(n.deletedSelectedDrafts())}),m(1," Delete selected "),c()}if(t&2){let e=s();y("danger"),p("flat",!0)("disabled",!(e.draft!=null&&e.draft.size))("size","small")}}function Me(t,i){t&1&&v(0,ze,2,5,"ng-template",1)}function Pe(t,i){t&1&&(m(0),d(1,"translate")),t&2&&C(" ",_(1,1,"draft.list-prefix.existing")," ")}function Ne(t,i){t&1&&(m(0),d(1,"translate")),t&2&&C(" ",_(1,1,"draft.list-prefix.new")," ")}function je(t,i){if(t&1&&(a(0,"lg-gap-row",6)(1,"a",7),A(2,Pe,2,3)(3,Ne,2,3),m(4),c(),a(5,"small",8),m(6),d(7,"translate"),d(8,"timeAgo"),c()()),t&2){let e=s().$implicit;p("center",!0),l(),p("routerLink","/recipes/draft/"+(e==null?null:e.uuid)),l(),O(!(e==null||e.meta==null)&&e.meta.uuid?2:3),l(2),C(" ",(e==null||e.data==null?null:e.data.name)??""," "),l(2),k(" ",_(7,6,"edited-at-label")," ",_(8,8,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," ")}}function Ge(t,i){if(t&1&&v(0,je,9,10,"ng-template",3),t&2){let e=i.$implicit;p("uuid",e.uuid)}}function $e(t,i){if(t&1){let e=S();a(0,"lg-expander",0),d(1,"translate"),d(2,"translate"),a(3,"lg-inline-separated-group"),v(4,Ze,3,7,"ng-template",1)(5,Fe,2,4,"ng-template",1),A(6,Me,1,0,null,1),c(),a(7,"lg-card-list",2),R("onDeleteOne",function(n){u(e);let f=s();return g(f.deleteDraft(n==null?null:n.uuid))})("onSelected",function(n){u(e);let f=s();return g(f.selectionZoneService.putSelected(n))}),h(8,Ge,1,1,null,3,Be),c()()}if(t&2){let e,o,n=s();p("closeLabel",_(1,6,"drafts-close-label"))("openLabel",ae(2,8,"drafts-label",pe(11,Ve,(e=n.drafts())==null?null:e.length))),l(6),O((o=n.selectionZoneService.selected())?6:-1,o),l(),p("mode",n.selectionZoneService.selectionMode())("selectAll",n.selectionZoneService.selectAll().draft)("deselectAll",n.selectionZoneService.deselectAll().draft),l(),L(n.drafts())}}var J=class t{constructor(i,e,o){this._recipesRepository=i;this._notificationsService=e;this.selectionZoneService=o}drafts=ne([]);Stores=Z;get hidden(){return this.drafts()?.length===0?!0:null}ngOnInit(){let i=this._recipesRepository.getDraftRecipe();i&&this.drafts.set(i)}deleteAllDrafts(){this._recipesRepository.removeDraftMany(this.drafts().map(i=>i.uuid)).then(()=>{this.drafts.set([]),this._notificationsService.success("Drafts deleted")})}deletedSelectedDrafts(){let i=this.selectionZoneService.selected().draft;i&&this._recipesRepository.removeDraftMany(Array.from(i)).then(()=>{this.drafts.update(e=>e.filter(o=>!i.has(o.uuid))),this._notificationsService.success("Drafts deleted")})}deleteDraft(i){i&&(this._recipesRepository.removeDraftRecipe(i),this.drafts.update(e=>e.filter(o=>o?.uuid!==i)))}static \u0275fac=function(e){return new(e||t)(x(T),x(z),x(D))};static \u0275cmp=E({type:t,selectors:[["lg-draft-recipes-list"]],hostVars:1,hostBindings:function(e,o){e&2&&oe("hidden",o.hidden)},features:[V([D])],decls:1,vars:1,consts:[[3,"closeLabel","openLabel"],["lgInlineSeparatedGroup",""],[2,"--card-bg","#bee5ff",3,"onDeleteOne","onSelected","mode","selectAll","deselectAll"],["lgCardListItem","","type","draft",3,"uuid"],[3,"click","flat","size"],[3,"click","flat","disabled","size"],[3,"center"],["lgExpand","",3,"routerLink"],[1,"text-muted","text-cursive"]],template:function(e,o){if(e&1&&A(0,$e,10,13,"lg-expander",0),e&2){let n;O((n=o.drafts())!=null&&n.length?0:-1)}},dependencies:[P,N,G,j,B,M,Ie,F,he,H,$],encapsulation:2})};var He=()=>["recipe"],qe=(t,i)=>i==null?null:i.category;function Je(t,i){if(t&1){let e=S();a(0,"lg-button",5),R("click",function(){u(e);let n=s();return g(n.exportRecipes(n.selectionZoneService.selected().recipe))}),m(1),d(2,"translate"),c()}t&2&&(y("info"),p("flat",!0)("size","small"),l(),C(" ",_(2,5,"export-label")," recipes "))}function Ke(t,i){if(t&1&&(a(0,"span"),m(1),c()),t&2){let e=i.$implicit;l(),W(e==null?null:e.name)}}function Qe(t,i){if(t&1){let e=S();a(0,"lg-import",6),d(1,"translate"),R("onDone",function(){u(e);let n=s();return g(n.loadRecipes())}),v(2,Ke,2,1,"ng-template",7),c()}if(t&2){let e=s();p("label",_(1,3,"import-label")+" products")("schema",e.RecipeScheme)("storeName",e.Stores.RECIPES)}}function We(t,i){if(t&1&&(a(0,"lg-gap-row",3)(1,"a",11),m(2),c(),a(3,"lg-button",12),m(4),d(5,"translate"),c(),a(6,"small",13),m(7),d(8,"translate"),d(9,"timeAgo"),c()()),t&2){let e=s().$implicit;p("center",!0),l(),p("routerLink","/recipes/edit/"+e.uuid),l(),W(e.name),l(),y("primary"),p("size","small")("link","/recipes/calculate/"+e.uuid)("flat",!0),l(),C(" ",_(5,11,"recipes.calculate-btn")," "),l(3),k(" ",_(8,13,"edited-at-label")," ",_(9,15,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," ")}}function Xe(t,i){if(t&1&&v(0,We,10,17,"ng-template",10),t&2){let e=i.$implicit;p("uuid",e.uuid)}}function Ye(t,i){if(t&1){let e=S();a(0,"lg-title",8),m(1),d(2,"translate"),c(),a(3,"lg-card-list",9),R("onSelected",function(n){u(e);let f=s();return g(f.selectionZoneService.putSelected(n))})("onDeleteOne",function(n){u(e);let f=s();return g(f.deleteRecipe(n))}),h(4,Xe,1,1,null,10,re),c()}if(t&2){let e=i.$implicit,o=s();p("level",3),l(),C(" ",(e==null?null:e.category)||_(2,5,"without-category-label")," "),l(2),p("mode",o.selectionZoneService.selectionMode())("selectAll",o.selectionZoneService.selectAll().recipe)("deselectAll",o.selectionZoneService.deselectAll().recipe),l(),L(e.recipes)}}function Ue(t,i){t&1&&(a(0,"lg-gap-row",3)(1,"lg-title",8),m(2),d(3,"translate"),c()()),t&2&&(p("center",!0),l(),p("level",5),l(),C(" ",_(3,3,"no-recipes")," "))}var we=class t{constructor(i,e,o,n){this._recipesRepository=i;this._notificationsService=e;this._transferDataService=o;this.selectionZoneService=n}recipes=Ce(I(Le));Stores=Z;RecipeScheme=q;ngOnInit(){this.loadRecipes()}deleteRecipe(i){i?.uuid&&this._recipesRepository.deleteOne(i.uuid).then(()=>{this._notificationsService.success("Recipe deleted"),this.loadRecipes()})}loadRecipes(){this._recipesRepository.loadRecipes()}exportRecipes(i){this._transferDataService.exportTable("recipesStore","json",{selected:Array.from(i||[])})}static \u0275fac=function(e){return new(e||t)(x(T),x(z),x(me),x(D))};static \u0275cmp=E({type:t,selectors:[["lg-recipes-list"]],features:[V([D])],decls:17,vars:12,consts:[[3,"icon","link","size"],["aria-hidden","false","fontIcon","add"],["lgInlineSeparatedGroup",""],[3,"center"],[3,"selectionTypes"],[3,"click","flat","size"],[3,"onDone","label","schema","storeName"],["lgImportRowTpl",""],[3,"level"],[3,"onSelected","onDeleteOne","mode","selectAll","deselectAll"],["lgCardListItem","","type","recipe",3,"uuid"],[3,"routerLink"],[3,"size","link","flat"],["lgPull","",1,"text-muted","text-cursive"]],template:function(e,o){e&1&&(a(0,"lg-controls-bar")(1,"lg-button",0),Q(2,"mat-icon",1),c(),a(3,"lg-inline-separated-group"),v(4,Je,3,7,"ng-template",2)(5,Qe,3,5,"ng-template",2),c()(),a(6,"lg-fade-in")(7,"lg-container")(8,"lg-gap-row",3)(9,"lg-title"),m(10),d(11,"translate"),c()(),Q(12,"lg-draft-recipes-list")(13,"lg-selection-tools",4),h(14,Ye,6,7,null,null,qe,!1,Ue,4,5,"lg-gap-row",3),c()()),e&2&&(l(),y("success"),p("icon",!0)("link","/recipes/add")("size","medium"),l(7),p("center",!0),l(2),C(" ",_(11,9,"recipes.list-title")," "),l(3),p("selectionTypes",le(11,He)),l(),L(o.recipes()))},dependencies:[P,N,B,ge,de,_e,G,j,Se,xe,fe,ve,ye,M,ue,F,J,H,$],styles:["[_nghost-%COMP%]{display:block}"]})};export{we as RecipesListComponent};
