import{a as Ee,b as Re}from"./chunk-MLWLSOXH.js";import"./chunk-VKWU2J5T.js";import"./chunk-DECIG3UW.js";import{a as Ie}from"./chunk-QYTKUNDN.js";import{a as ke,c as We,d as G}from"./chunk-43NZQBGQ.js";import{a as Te}from"./chunk-BREASPLR.js";import{a as V}from"./chunk-OFWTFEIU.js";import{a as Be}from"./chunk-MTKE3TKK.js";import{a as D}from"./chunk-KB5VWG36.js";import"./chunk-ACHQGNI7.js";import{a as xe,b as w}from"./chunk-4GMAHVOM.js";import{a as Se}from"./chunk-2AG3W6NR.js";import{a as M}from"./chunk-6OA5NOZV.js";import"./chunk-SNDQO5FA.js";import{a as me,d as pe,m as we,p as be}from"./chunk-KHHX4XAO.js";import"./chunk-PPZB7COH.js";import"./chunk-5KSZNU56.js";import"./chunk-TCTFHDUI.js";import"./chunk-H5OOR6F4.js";import{a as de,f as E,g as ue,h as R,i as P,j as ge,k as fe,m as _e,n as Ce,p as ye,r as F,s as ve,u as he,v as N}from"./chunk-3I72GHQM.js";import"./chunk-6D4L3YT6.js";import"./chunk-2UE5YCBQ.js";import"./chunk-652DFWNF.js";import{k as ce}from"./chunk-GM4BKM5X.js";import{$b as S,Ac as le,Bb as Z,Cb as ee,Cc as se,Db as l,Dc as W,Eb as a,Fb as f,Jb as h,Mb as v,Nb as p,V as K,Va as r,_a as x,_b as s,ac as te,cc as B,db as y,dc as T,ec as k,fc as oe,ga as d,gc as ne,ha as u,hc as ie,ib as Q,ic as I,na as g,oc as O,qb as c,qc as q,sb as j,tb as X,wb as _,yb as C,yc as re,zc as ae}from"./chunk-ESI6QU3H.js";import"./chunk-DELOOZDJ.js";import{a as Y,f as $}from"./chunk-2WH2EVR6.js";function De(o,t){if(o&1){let e=h();l(0,"lg-gap-column",0)(1,"lg-control",6)(2,"lg-input",4),k("ngModelChange",function(i){d(e);let m=p(2);return T(m.product.name,i)||(m.product.name=i),u(i)}),a()(),l(3,"lg-control",6)(4,"lg-number-input",4),k("ngModelChange",function(i){d(e);let m=p(2);return T(m.product.amount,i)||(m.product.amount=i),u(i)}),a()(),l(5,"lg-control",6)(6,"lg-number-input",4),k("ngModelChange",function(i){d(e);let m=p(2);return T(m.product.price,i)||(m.product.price=i),u(i)}),a(),l(7,"div"),s(8),a()(),l(9,"lg-button",7),v("click",function(){d(e);let i=p(2);return u(i.addProduct())}),s(10,"Add product"),a()()}if(o&2){let e=p(2);c("size","medium"),r(),c("label","Name"),r(),B("ngModel",e.product.name),c("placeholder","Name"),r(),c("label","Amount"),r(),B("ngModel",e.product.amount),c("placeholder","Amount"),r(),c("label","Price"),r(),B("ngModel",e.product.price),c("placeholder","Price"),r(2),S(e.product.unit)}}function Ne(o,t){if(o&1){let e=h();f(0,"video",2),l(1,"lg-gap-column")(2,"lg-gap-row",3)(3,"lg-input",4),k("ngModelChange",function(i){d(e);let m=p();return T(m.barcode,i)||(m.barcode=i),u(i)}),a(),l(4,"lg-button",5),v("click",function(){d(e);let i=p();return u(i.onBarcodeManualInput())}),s(5,"Search"),a(),l(6,"lg-button",5),v("click",function(){d(e);let i=p();return u(i.clear())}),s(7,"Clear"),a()(),_(8,De,11,11,"lg-gap-column",0),a()}if(o&2){let e=p();r(3),B("ngModel",e.barcode),c("placeholder","Barcode"),r(5),C(e.showProductForm()&&e.productResult()?8:-1)}}function Ve(o,t){if(o&1){let e=h();l(0,"lg-button",5),v("click",function(){d(e);let i=p();return u(i.openScanner())}),s(1,"Scan"),a()}}var A=class o{constructor(t,e,n,i){this._openFoodFactsService=t;this._arcodeReaderService=e;this._productRepository=n;this._notificationService=i}productAdded=se();barcode=g("");product={name:"",price:0,amount:0,unit:"gram"};lockRequest=!1;showFormInitially=W(!1);showScanerInitially=W(!1);showScanner=g(!1);showProductForm=g(!1);userResource=le({request:()=>({id:this.barcode()}),loader:({request:t,abortSignal:e})=>this.lockRequest||!t.id?Promise.resolve(null):(this._notificationService.info("Barcode detected: "+t.id),this.lockRequest=!0,this._openFoodFactsService.getProductByBarcode(t.id).then(n=>(this.showProductForm.set(!0),n)))});productResult=re(()=>{let t=this.userResource.value();if(t?.status===1){let e=t.product;return this.product.name=(e.product_name||"")+" ("+(e.brands||"")+")",this.product.amount=this.extractAmount(e),this.product.unit=this.detectUnit(e),Y({},this.product)}return null});onBarcodeManualInput(){this.lockRequest=!1}openScanner(){this.showScanner.set(!0),this.startCamera()}clear(){this.barcode.set(""),this.product={name:"",price:0,amount:0,unit:"gram"},this.showProductForm.set(!1),this.lockRequest=!1}closeScanner(){this.showScanner.set(!1),this.stopCamera()}extractAmount(t){if(t.quantity){let e=t.quantity.match(/\d+/);return e?+e[0]:0}return 0}stopCamera(){this._arcodeReaderService.stopCamera()}detectUnit(t){let e=(t.serving_quantity_unit||"").toLowerCase();return e.includes("g")||e.includes("ml")?"gram":e.includes("pc")||e.includes("\u0448\u0442")?"piece":"gram"}addProduct(){this._productRepository.addOne(me.fromRaw({name:this.product.name,price:this.product.price,amount:this.product.amount,unit:this.product.unit,source:"openfoodfacts",category_id:"",tags:[],createdAt:Date.now()})).then(t=>{this.productAdded.emit({uuid:t,name:this.product.name}),this.product={name:"",price:0,amount:0,unit:"gram"},this.barcode.set(""),this.lockRequest=!1})}startCamera(){return this._arcodeReaderService.startCamera("video",t=>{t&&this.barcode.set(t)})}ngAfterViewInit(){return $(this,null,function*(){this.showScanerInitially()&&(this.showScanner.set(!0),yield this.startCamera())})}ngOnDestroy(){this.stopCamera()}static \u0275fac=function(e){return new(e||o)(x(we),x(pe),x(be),x(he))};static \u0275cmp=y({type:o,selectors:[["lg-barcode-add-product-widget"]],inputs:{showFormInitially:[1,"showFormInitially"],showScanerInitially:[1,"showScanerInitially"]},outputs:{productAdded:"productAdded"},features:[I([])],decls:6,vars:4,consts:[[3,"size"],[3,"top","mobileMode"],["id","video"],["lgExpand",""],["lgExpand","","lgParseMath","",3,"ngModelChange","ngModel","placeholder"],[3,"click"],[3,"label"],["lgShrink","",3,"click"]],template:function(e,n){e&1&&(l(0,"lg-gap-column",0)(1,"lg-title"),s(2," \u{1F4F7} Scan barcode or enter manually "),a(),l(3,"lg-gap-row",1),_(4,Ne,9,3)(5,Ve,2,0,"lg-button"),a()()),e&2&&(c("size","medium"),r(3),c("top",!0)("mobileMode",!0),r(),C(n.showScanner()?4:5))},dependencies:[F,E,ge,D,V,M,N,Be,We,w,ke,Te,G],encapsulation:2})};var Ge=(o,t)=>t.value;function Ae(o,t){if(o&1){let e=h();l(0,"lg-button",2),v("click",function(){let i=d(e),m=i.$implicit,b=i.$index,Fe=p();return u(Fe.onClickItem(m,b))}),s(1),a()}if(o&2){let e=t.$implicit,n=t.$index,i=t.$count,m=p();X(e.style||"default"),j("buttons-group__item--active",m.activeIndex()==n),c("active",m.activeIndex()==n)("flat",m.flat)("noScale",!0)("size",e.size||"default")("noLeftRadius",n===i-1)("noRightRadius",n===0)("noRadius",n!==0&&n!==i-1),r(),te(" ",e.label," ")}}var J=class o{flat=!1;items=W();activeIndex=g(0);value=g("");effect=ae(()=>{let t=this.items()?.findIndex(e=>e.value===this.value())??-1;this.activeIndex.set(t===-1?0:t)});onClickItem(t,e){this.activeIndex.set(e),this.writeValue(t.value),t.onClick?.()}onChange=()=>{};onTouched=()=>{};writeValue(t){this._change(t)}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}onChangeInput(t){this._change(t.target.value)}_change(t){this.value.set(t),this.onChange(this.value())}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=y({type:o,selectors:[["lg-buttons-group"]],inputs:{flat:"flat",items:[1,"items"]},features:[I([{provide:de,useExisting:K(()=>o),multi:!0}])],decls:3,vars:2,consts:[[1,"buttons-group"],[1,"buttons-group__item",3,"active","flat","noScale","style","size","noLeftRadius","noRightRadius","noRadius","buttons-group__item--active"],[1,"buttons-group__item",3,"click","active","flat","noScale","size","noLeftRadius","noRightRadius","noRadius"]],template:function(e,n){e&1&&(l(0,"div",0),Z(1,Ae,2,12,"lg-button",1,Ge),a()),e&2&&(j("buttons-group--flat",n.flat),r(),ee(n.items()))},dependencies:[N],styles:[`.buttons-group{display:flex}.buttons-group lg-button{flex:1}.buttons-group lg-button button{width:100%}.buttons-group--flat{gap:16px;width:100%}
`],encapsulation:2})};var Je={powder:{mass:o=>o*5+o},leaf:{mass:o=>o*5+o},mass:{powder:o=>o/6,leaf:o=>o/6}},ze=o=>o*5,Le=o=>o*5/6,z=class{constructor(t){this.type=t}convertToBase(t,e){return Je[this.type]?.[t]?.(e)||e}convertToWater(t,e){return this.type==="mass"&&t==="mass"||this.type==="leaf"||t==="leaf"?0:this.type==="mass"?ze(e):t==="mass"?Le(e):0}};function je(o,t){o&1&&s(0," \u{1F35A} ")}function Oe(o,t){o&1&&s(0," \u{1F343} ")}function qe(o,t){o&1&&s(0," \u{1F9EB} ")}function Ue(o,t){o&1&&(l(0,"div"),s(1," With "),a())}function He(o,t){o&1&&(l(0,"div"),s(1," And "),a())}function Ye(o,t){o&1&&(l(0,"div"),s(1," And "),a())}function $e(o,t){o&1&&(f(0,"br"),s(1,"included "))}function Ke(o,t){if(o&1&&(l(0,"lg-gap-column",8)(1,"div"),_(2,Ue,2,0,"div"),_(3,He,2,0,"div")(4,Ye,2,0,"div"),a(),l(5,"lg-gap-row",9)(6,"div"),s(7),O(8,"number"),a(),s(9," \u{1F4A7} "),a(),l(10,"div"),s(11," ml of water "),_(12,$e,2,0),a()()),o&2){let e,n,i,m=p(),b=ie(11);c("size","small")("position","center"),r(2),C((e=b)==="mass"?2:-1),r(),C((n=b)==="powder"?3:n==="leaf"?4:-1),r(2),c("size","small"),r(2),S(q(8,7,m.waterNeeded(),"1.0-2")),r(5),C((i=b)==="mass"?12:-1)}}var L=class o{result=g(0);waterNeeded=g(0);constructor(){this.form.valueChanges.subscribe(t=>{let e=parseInt(String(t?.from?.amount));if(isNaN(e))return;let n=new z(t?.from?.type),i=n.convertToBase(t?.to?.type,e),m=n.convertToWater(t?.to?.type,i);this.result.set(i),this.waterNeeded.set(m)})}form=new R({from:new R({type:new P("mass"),amount:new P(null)}),to:new R({type:new P("powder")})});typeButtons=[{label:"powder",value:"powder",style:"secondary"},{label:"leaf",value:"leaf",style:"secondary"},{label:"mass",value:"mass",style:"secondary"}];static \u0275fac=function(e){return new(e||o)};static \u0275cmp=y({type:o,selectors:[["lg-jelly-widget"]],decls:27,vars:17,consts:[[3,"formGroup"],[3,"bottom","mobileMode"],["formGroupName","from"],["formControlName","amount",3,"placeholder"],["ngProjectAs","after",5,["after"]],["formControlName","type",3,"items"],["formGroupName","to"],[1,"text-center",3,"strictCenter"],["lgShrink","",3,"size","position"],[2,"font-size","2rem",3,"size"]],template:function(e,n){if(e&1&&(l(0,"lg-gap-column")(1,"form",0)(2,"lg-gap-row",1)(3,"lg-gap-column",2),s(4," In recipe you have "),l(5,"lg-input",3)(6,"div",4),s(7," grams of "),a()(),f(8,"lg-buttons-group",5),a(),l(9,"lg-gap-column",6),oe(10)(11),l(12,"lg-gap-row",7)(13,"lg-gap-column",8)(14,"div"),s(15," You need "),a(),l(16,"lg-gap-row",9)(17,"div"),s(18),O(19,"number"),a(),_(20,je,1,0)(21,Oe,1,0)(22,qe,1,0),a(),l(23,"div"),s(24," grams of "),a()(),_(25,Ke,13,10,"lg-gap-column",8),a(),f(26,"lg-buttons-group",5),a()()()()),e&2){let i;r(),c("formGroup",n.form),r(),c("bottom",!0)("mobileMode",!0),r(3),c("placeholder","Amount"),r(3),c("items",n.typeButtons),n.form.value==null||n.form.value.from==null||n.form.value.from.type,r(3);let m=ne(n.form.value==null||n.form.value.to==null?null:n.form.value.to.type);r(),c("strictCenter",!0),r(),c("size","small")("position","center"),r(3),c("size","small"),r(2),S(q(19,14,n.result(),"1.0-2")),r(2),C((i=m)==="powder"?20:i==="leaf"?21:i==="mass"?22:-1),r(5),C(n.waterNeeded()?25:-1),r(),c("items",n.typeButtons)}},dependencies:[F,fe,E,ue,ve,_e,ye,Ce,D,V,w,J,ce,G],styles:[`:host{--control-bg: #fcfcfc}lg-eggs-widget{display:flex}.eggs-widget{display:flex;flex-direction:column}.eggs-widget__eggs{display:flex;align-items:flex-end;gap:8px}.eggs-widget__eggs img{width:40px}.eggs-widget__egg{display:flex;align-items:center;justify-content:center;flex:1;flex-direction:column;white-space:nowrap;gap:8px;background-color:var(--control-bg);border-radius:24px;padding:16px}.eggs-widget__egg:first-child img{transform:scale(.8)}.eggs-widget__egg:last-child img{transform:scale(1.2)}.eggs-widget__egg.selected{background-color:#61b789}.eggs-widget__egg.selected:first-child{background-color:#b4b8f8}.eggs-widget__egg.selected:last-child{background-color:#ff8080}
`],encapsulation:2})};function Qe(o,t){o&1&&f(0,"lg-jelly-widget")}function Xe(o,t){o&1&&f(0,"lg-eggs-widget")}function Ze(o,t){o&1&&f(0,"lg-barcode-add-product-widget")}var Pe=class o{static \u0275fac=function(e){return new(e||o)};static \u0275cmp=y({type:o,selectors:[["lg-widgets-page"]],decls:9,vars:1,consts:[[3,"center"],["label","Jelly calculator","alias","jelly-calculator","lgTab",""],["label","Eggs calculator","alias","eggs-calculator","lgTab",""],["label","Barcode Seeker","alias","barcode-seeker","lgTab",""]],template:function(e,n){e&1&&(l(0,"lg-fade-in")(1,"lg-container")(2,"lg-gap-row",0)(3,"lg-title"),s(4," Widgets "),a()(),l(5,"lg-tabs"),Q(6,Qe,1,0,"ng-template",1)(7,Xe,1,0,"ng-template",2)(8,Ze,1,0,"ng-template",3),a()()()),e&2&&(r(2),c("center",!0))},dependencies:[Ie,xe,w,M,A,Se,Ee,Re,L],encapsulation:2})};export{Pe as WidgetsPageComponent};
