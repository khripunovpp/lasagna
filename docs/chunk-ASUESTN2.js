import{a as ct,b as pt,c as mt,d as st,e as h,f as ut,i as _t}from"./chunk-A2HPB2NV.js";import{b as at,c as Ct}from"./chunk-2AURZCPC.js";import{a as dt}from"./chunk-PRC2TUST.js";import{a as et}from"./chunk-PK5DH7CM.js";import{a as nt,b as rt}from"./chunk-F56BMA2L.js";import"./chunk-SCFN6F3R.js";import{b as lt}from"./chunk-3QIAGCJF.js";import{a as ot}from"./chunk-UJQWE6GX.js";import"./chunk-6BVDG3RH.js";import{a as ft}from"./chunk-UZ4ZOUQK.js";import{a as gt}from"./chunk-F6M2S2BE.js";import"./chunk-H46Y7ZP7.js";import{a as Y}from"./chunk-GMS3E2FY.js";import{a as it}from"./chunk-TP72K2HT.js";import"./chunk-C3YIVVSQ.js";import{a as K,c as tt}from"./chunk-UYEJDPNH.js";import{g as R}from"./chunk-VPC2COZP.js";import{b as J}from"./chunk-YSLWWUVN.js";import{a as X}from"./chunk-LVIA722N.js";import{a as W}from"./chunk-2ZEJWSE3.js";import"./chunk-SNDQO5FA.js";import{s as q,v as H}from"./chunk-B3CZXN5N.js";import{k as Q}from"./chunk-IZT3LVRQ.js";import{Ab as r,Bb as l,Cb as S,Gb as E,Jb as g,Kb as d,Q as z,Ta as o,Wb as c,Xb as F,Y as N,Ya as u,Yb as s,Zb as P,_ as C,bb as V,bc as B,fa as T,ga as I,gb as v,hc as w,ic as O,jc as G,k as $,ma as U,ob as p,q as k,rb as x,s as j,ub as _,vb as f,wb as A,yb as L,zb as D}from"./chunk-PNZYYIKS.js";import"./chunk-DELOOZDJ.js";import{f as Z}from"./chunk-2WH2EVR6.js";var vt=new N("CategorizedProductsList",{factory:()=>{let e=C(R),i=C(J);return $(e.loadAll()).pipe(z(()=>e.products$)).pipe(k(n=>n.toSorted((a,m)=>a.name.localeCompare(m.name))),k(n=>dt(n,"category_id")),j(n=>Z(void 0,null,function*(){let a=[];for(let y in n){let b=n[y],St=yield i.getOne(y);a.push({category:St?.name,products:b})}if(!a.length)return[];let[m,...M]=a.toSorted((y,b)=>y.category>b.category?1:-1);return m?.category?[m].concat(M):M.concat([m])})))}});var Pt=(e,i)=>i==null?null:i.createdAt;function yt(e,i){e&1&&(r(0,"lg-button",6),S(1,"mat-icon",7),l()),e&2&&(x("success"),p("icon",!0)("link","/products/add")("size","medium"))}function Tt(e,i){if(e&1&&(r(0,"span"),c(1),l()),e&2){let t=d(2).$implicit;o(),s("from ",t.source)}}function It(e,i){if(e&1&&(r(0,"span"),c(1),l(),r(2,"span"),c(3),l(),_(4,Tt,2,1,"span")),e&2){let t=d().$implicit;o(),F(t.name),o(2),P("",t.amount,"gr for ",t.price),o(),f(t.source?4:-1)}}function Lt(e,i){if(e&1&&(r(0,"span"),c(1),l()),e&2){let t=d(2).$implicit;o(),s("from ",t==null?null:t.source)}}function Dt(e,i){if(e&1&&(r(0,"span"),c(1),l(),r(2,"span"),c(3),l(),_(4,Lt,2,1,"span")),e&2){let t=d().$implicit;o(),F(t==null?null:t.name),o(2),P("",t==null?null:t.amount," gr for ",t==null?null:t.price),o(),f(t!=null&&t.source?4:-1)}}function Et(e,i){if(e&1&&_(0,It,5,4)(1,Dt,5,4),e&2){let t=i.flow;f(t==="new"?0:1)}}function wt(e,i){e&1&&c(0," Unsaved existing product: ")}function Rt(e,i){e&1&&c(0," Draft product: ")}function ht(e,i){if(e&1){let t=E();r(0,"lg-gap-row",5)(1,"a",9),_(2,wt,1,0)(3,Rt,1,0),c(4),l(),r(5,"small",10),c(6),w(7,"timeAgo"),l(),r(8,"lg-button",11),g("click",function(){T(t);let a=d().$implicit,m=d(2);return I(m.deleteDraft(a))}),S(9,"mat-icon",12),l()()}if(e&2){let t=d().$implicit;p("center",!0),o(),p("routerLink","/products/draft/"+(t==null?null:t.uuid)),o(),f(!(t==null||t.meta==null)&&t.meta.uuid?2:3),o(2),s(" ",(t==null||t.data==null?null:t.data.name)||"Unknown"," "),o(2),s(" edited at: ",O(7,9,(t==null?null:t.updatedAt)||(t==null?null:t.createdAt))," "),o(2),x("danger"),p("size","tiny")("icon",!0)}}function bt(e,i){e&1&&v(0,ht,10,11,"ng-template",8)}function kt(e,i){if(e&1&&(r(0,"lg-card-list",4),L(1,bt,1,0,null,8,Pt),l()),e&2){let t=d();o(),D(t.draft())}}function At(e,i){if(e&1){let t=E();r(0,"lg-gap-row",5)(1,"div",16)(2,"lg-gap-row",5)(3,"lg-gap-row",17)(4,"a",18),c(5),l(),r(6,"div"),c(7),w(8,"number"),l()(),r(9,"small",19),c(10),w(11,"timeAgo"),l()()(),r(12,"lg-button",11),g("click",function(){T(t);let a=d().$implicit,m=d(2);return I(m.deleteProduct(a))}),S(13,"mat-icon",20),l()()}if(e&2){let t=d().$implicit;p("center",!0),o(2),p("center",!0),o(),p("center",!0),o(),p("routerLink","/products/edit/"+t.uuid),o(),P(" ",t.name," ",t.source?"- "+t.source:""," "),o(2),P(" ",G(8,13,t.pricePerUnit,"1.2-5")," ",t.perUnitLabel," "),o(3),s(" edited at: ",O(11,16,(t==null?null:t.updatedAt)||(t==null?null:t.createdAt))," "),o(2),x("danger"),p("size","tiny")("icon",!0)}}function Ft(e,i){if(e&1&&v(0,At,14,18,"ng-template",15),e&2){let t=i.$implicit;p("uuid",t.uuid)}}function Ot(e,i){if(e&1){let t=E();r(0,"lg-title",13),c(1),l(),r(2,"lg-card-list",14),g("onSelected",function(a){T(t);let m=d();return I(m.selectionZoneService.putSelected(a))}),L(3,Ft,1,1,null,15,A),l()}if(e&2){let t=i.$implicit,n=d();p("level",3),o(),s(" ",(t==null?null:t.category)||"Uncategorized"," "),o(),p("mode",n.selectionZoneService.selectionMode())("selectAll",n.selectionZoneService.selectAll())("deselectAll",n.selectionZoneService.deselectAll()),o(),D(t.products)}}function Mt(e,i){e&1&&(r(0,"lg-gap-row",5)(1,"lg-title",13),c(2," No products found "),l()()),e&2&&(p("center",!0),o(),p("level",5))}var xt=class e{constructor(i,t,n,a,m){this._productsRepository=i;this._csvReaderService=t;this._transferDataService=n;this._notificationsService=a;this.selectionZoneService=m}products=lt(C(vt));draft=U([]);ProductDbInputScheme=_t;Stores=H;exportProducts(i){this._transferDataService.exportTable("productsStore","json",{selected:Array.from(i)})}deleteProduct(i){i.uuid&&this._productsRepository.deleteProduct(i.uuid).then(()=>{this._notificationsService.success("Product deleted"),this.loadProducts()})}deleteDraft(i){this._productsRepository.removeDraftProduct(i.uuid),this.draft.update(t=>t.filter(n=>n?.uuid!==i.uuid))}ngOnInit(){this.loadProducts();let i=this._productsRepository.getDraftProducts();i&&this.draft.set(i)}loadProducts(){this._productsRepository.loadAll()}static \u0275fac=function(t){return new(t||e)(u(R),u(at),u(Ct),u(gt),u(h))};static \u0275cmp=V({type:e,selectors:[["lg-product-list"]],features:[B([h])],decls:15,vars:8,consts:[["lgQuickActionsTpl",""],[3,"click","flat","size"],[3,"onDone","schema","storeName"],["lgImportRowTpl",""],[2,"--card-bg","#bee5ff"],[3,"center"],[3,"icon","link","size"],["aria-hidden","false","fontIcon","add"],["lgCardListItem",""],["lgExpand","",3,"routerLink"],["lgPull","",1,"text-muted","text-cursive"],[3,"click","size","icon"],["aria-hidden","false","fontIcon","close"],[3,"level"],[3,"onSelected","mode","selectAll","deselectAll"],["lgCardListItem","",3,"uuid"],[1,"expand"],["lgExpand","",3,"center"],[3,"routerLink"],[1,"text-muted","text-cursive"],["aria-hidden","false","aria-label","Example home icon","fontIcon","close"]],template:function(t,n){if(t&1&&(r(0,"lg-controls-bar"),v(1,yt,2,5,"ng-template",0),S(2,"lg-selection-tools"),r(3,"lg-button",1),g("click",function(){return n.exportProducts(n.selectionZoneService.selected())}),c(4," Export "),l(),r(5,"lg-import",2),g("onDone",function(){return n.loadProducts()}),v(6,Et,2,1,"ng-template",3),l()(),r(7,"lg-fade-in")(8,"lg-container")(9,"lg-title"),c(10," Products "),l(),_(11,kt,3,0,"lg-card-list",4),L(12,Ot,5,5,null,null,A,!1,Mt,3,2,"lg-gap-row",5),l()()),t&2){let a;o(3),x("info"),p("flat",!0)("size","small"),o(2),p("schema",n.ProductDbInputScheme)("storeName",n.Stores.PRODUCTS),o(6),f((a=n.draft())!=null&&a.length?11:-1),o(),D(n.products())}},dependencies:[tt,it,ot,K,W,Q,rt,nt,pt,q,ct,X,st,mt,ut,Y,ft,et],styles:["[_nghost-%COMP%]{display:block}"]})};export{xt as ProductListComponent};
