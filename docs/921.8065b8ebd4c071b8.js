"use strict";(self.webpackChunklasagna=self.webpackChunklasagna||[]).push([[921],{553:(S,g,o)=>{o.d(g,{i:()=>y});var t=o(1007);const h=["*"];let y=(()=>{class c{constructor(){}flat=(0,t.hFB)(!1);center=(0,t.hFB)(!1);static \u0275fac=function(a){return new(a||c)};static \u0275cmp=t.VBU({type:c,selectors:[["lg-card"]],inputs:{flat:[1,"flat"],center:[1,"center"]},ngContentSelectors:h,decls:2,vars:4,consts:[[1,"card"]],template:function(a,i){1&a&&(t.NAR(),t.j41(0,"div",0),t.SdG(1),t.k0s()),2&a&&t.AVh("flat",i.flat())("center",i.center())},styles:["[_nghost-%COMP%]{display:flex;width:100%}.card[_ngcontent-%COMP%]{background-color:#fff;padding:24px;border-radius:32px;width:100%;display:flex;flex-direction:column}.card.flat[_ngcontent-%COMP%]{padding:0}.card.center[_ngcontent-%COMP%]{justify-content:center;align-items:center}"]})}return c})()},1086:(S,g,o)=>{o.d(g,{W:()=>y});var t=o(1007);const h=["*"];let y=(()=>{class c{level=(0,t.vPA)(1);static \u0275fac=function(a){return new(a||c)};static \u0275cmp=t.VBU({type:c,selectors:[["lg-title"]],ngContentSelectors:h,decls:2,vars:0,consts:[["role","heading",1,"title"]],template:function(a,i){1&a&&(t.NAR(),t.j41(0,"p",0),t.SdG(1),t.k0s())},styles:[".title[_ngcontent-%COMP%]{font-size:1.5em;font-weight:700;margin:0}"]})}return c})()},1091:(S,g,o)=>{o.r(g),o.d(g,{CalculateRecipeComponent:()=>$});var t=o(1007),h=o(5642),y=o(1086),c=o(553);const M=["*"];let l=(()=>{class r{constructor(){}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=t.VBU({type:r,selectors:[["lg-table-card"]],ngContentSelectors:M,decls:4,vars:1,consts:[[3,"flat"],[1,"table"],[1,"table__scroll"]],template:function(n,m){1&n&&(t.NAR(),t.j41(0,"lg-card",0)(1,"div",1)(2,"div",2),t.SdG(3),t.k0s()()()),2&n&&t.Y8G("flat",!0)},dependencies:[c.i],styles:[":host{display:flex;width:100%}.table__scroll{overflow-x:auto}table{width:100%;border-collapse:collapse;--border-color: #efefef}table thead tr{border-bottom:1px solid var(--border-color)}table thead th{text-align:left;padding:16px 24px}table tbody tr{border-bottom:1px solid var(--border-color)}table tbody tr:last-child{border-bottom:none}td{padding:16px 24px}\n"],encapsulation:2})}return r})();var a=o(177),i=o(1119),R=o(7512),C=o(5554),u=o(467),k=o(9512),T=o(7201);let w=(()=>{class r{_recipeRepository;_productRepository;constructor(e,n){this._recipeRepository=e,this._productRepository=n}calculation;calculateRecipe(e){var n=this;return new Promise(function(){var m=(0,u.A)(function*(d,f){const F=[];let s=0,j=0;yield n._recipeRepository.getOne(e,function(){var A=(0,u.A)(function*(b){const{table:v,totalAmount:x}=yield n._makeIngredientTable(b);s+=x||0,j=b.ingredients.reduce((E,p)=>E+parseInt(p.amount),0),F.push(...v),F.push(n._makeTotal(s,j)),d({recipe:b,result:F,total:s})});return function(b){return A.apply(this,arguments)}}())});return function(d,f){return m.apply(this,arguments)}}())}_makeRecipeSubTable(e){var n=this;return(0,u.A)(function*(){return new Promise(function(){var m=(0,u.A)(function*(d,f){const F=[];let s=0,j=0;const A=e.amount;yield n._recipeRepository.getOne(e.recipe_id,function(){var b=(0,u.A)(function*(v){const x=v.ingredients.reduce((_,I)=>_+parseInt(I.amount),0),E=A/x,p=yield n._makeIngredientTable(v);p.table=p.table.map((_,I)=>({..._,amount:parseFloat((_.amount?_.amount*E:0).toFixed(5)),total:parseFloat((_.total?_.total*E:0).toFixed(5)),indent:_.indent+1}));const P=p.totalAmount/p.totalWeight;F.push(n._makeRecipeCaption({name:v.name,price_per_gram:P,amount:e.amount,total:P*e.amount})),F.push(...p.table),j+=P*e.amount,s+=p.totalWeight,d({table:F,totalAmount:j,totalWeight:s})});return function(v){return b.apply(this,arguments)}}())});return function(d,f){return m.apply(this,arguments)}}())})()}_makeIngredientTable(e){var n=this;const m=[];let d=0,f=0;return Promise.all(e.ingredients.map(function(){var F=(0,u.A)(function*(s,j){const A=s.recipe_id,b=s.product_id,v=s.name;if(A||b||v)if(A){const x=yield n._makeRecipeSubTable(s);m.push(...x.table),f+=x.totalAmount,d+=x.totalWeight}else b?yield n._productRepository.getOne(s.product_id,function(){var E=(0,u.A)(function*(p){if(!p?.price||!p?.amount)return;const P=p.price/p.amount,_=P*s.amount;m.push(n._makeRow({name:p.name,price_per_gram:P,amount:s.amount,total:_})),f+=_,d+=+s.amount});return function(p){return E.apply(this,arguments)}}()):v&&(m.push(n._makeRow({name:s.name,price_per_gram:void 0,amount:s.amount,total:void 0})),d+=+s.amount)});return function(s,j){return F.apply(this,arguments)}}())).then(()=>({table:m,totalAmount:f,totalWeight:d}))}_makeRow(e){return{name:e.name,price_per_gram:parseFloat(e.price_per_gram?.toFixed(5)??"0"),amount:e.amount,total:parseFloat(e.total?.toFixed(5)??"0"),unit:"g",indent:e.indent??0,type:"row"}}_makeCaption(e){return{name:e,unit:void 0,price_per_gram:void 0,amount:void 0,total:void 0,indent:0,type:"caption"}}_makeRecipeCaption(e){return{name:e.name,price_per_gram:parseFloat(e.price_per_gram.toFixed(5)),amount:e.amount,total:parseFloat(e.total.toFixed(2)),unit:"g",indent:0,type:"recipe-row"}}_makeTotal(e,n){return{name:"Total",amount:n,unit:"g",price_per_gram:parseFloat((e/n).toFixed(5)),total:parseFloat(e.toFixed(2)),indent:0,type:"total"}}static \u0275fac=function(n){return new(n||r)(t.KVO(k.m),t.KVO(T.d))};static \u0275prov=t.jDH({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function D(r,O){if(1&r&&(t.j41(0,"tr")(1,"td"),t.EFF(2),t.k0s(),t.j41(3,"td")(4,"span",7),t.EFF(5),t.k0s()(),t.j41(6,"td"),t.EFF(7),t.k0s(),t.j41(8,"td"),t.EFF(9),t.k0s(),t.j41(10,"td"),t.EFF(11),t.k0s(),t.j41(12,"td"),t.EFF(13),t.k0s()()),2&r){const e=O.$implicit,n=O.$index;t.R7$(2),t.JRh(n+1),t.R7$(2),t.Y8G("ngClass","indent-"+e.indent),t.R7$(),t.JRh(e.name),t.R7$(2),t.JRh(e.amount),t.R7$(2),t.JRh(e.unit),t.R7$(2),t.JRh(e.price_per_gram),t.R7$(2),t.JRh(e.total)}}function G(r,O){if(1&r&&(t.j41(0,"table")(1,"colgroup"),t.nrm(2,"col",2)(3,"col",3)(4,"col",4)(5,"col",5)(6,"col",4)(7,"col",6),t.k0s(),t.j41(8,"thead")(9,"tr")(10,"th"),t.EFF(11,"#"),t.k0s(),t.j41(12,"th"),t.EFF(13,"Name"),t.k0s(),t.j41(14,"th"),t.EFF(15,"Amount"),t.k0s(),t.j41(16,"th"),t.EFF(17,"Unit"),t.k0s(),t.j41(18,"th"),t.EFF(19,"Price per gram"),t.k0s(),t.j41(20,"th"),t.EFF(21,"Total"),t.k0s()()(),t.j41(22,"tbody"),t.Z7z(23,D,14,7,"tr",null,t.Vm6),t.k0s()()),2&r){let e;const n=t.XpG();t.R7$(23),t.Dyx(null==(e=n.result())?null:e.result)}}function U(r,O){1&r&&(t.j41(0,"div"),t.EFF(1,"Loading..."),t.k0s())}let $=(()=>{class r{_aRoute;_calculateRecipeService;constructor(e,n){this._aRoute=e,this._calculateRecipeService=n}uuid=(0,t.vPA)("");result=(0,t.vPA)(null);ngOnInit(){this._aRoute.params.subscribe(e=>{this.uuid.set(e.uuid),this._calculateRecipeService.calculateRecipe(e.uuid).then(n=>{this.result.set(n)})})}static \u0275fac=function(n){return new(n||r)(t.rXU(C.nX),t.rXU(w))};static \u0275cmp=t.VBU({type:r,selectors:[["lg-calculate-recipe"]],decls:9,vars:8,consts:[[3,"center"],[3,"flat","link","size"],["span","1",2,"width","1%"],["span","1",2,"width","20%"],["span","1",2,"width","5%"],["span","1",2,"width","3%"],["span","1",2,"width","7%"],[3,"ngClass"]],template:function(n,m){if(1&n&&(t.j41(0,"lg-container")(1,"lg-gap-row",0)(2,"lg-title"),t.EFF(3),t.k0s(),t.j41(4,"lg-button",1),t.EFF(5," Edit "),t.k0s()(),t.j41(6,"lg-table-card"),t.DNE(7,G,25,0,"table")(8,U,2,0,"div"),t.k0s()()),2&n){let d,f;t.R7$(),t.Y8G("center",!0),t.R7$(2),t.SpI(" ",null==(d=m.result())||null==d.recipe?null:d.recipe.name," cost calculation "),t.R7$(),t.Aen("primary"),t.Y8G("flat",!0)("link","/edit-recipe/"+(null==(f=m.result())||null==f.recipe?null:f.recipe.uuid))("size","small"),t.R7$(3),t.vxM(m.result()?7:8)}},dependencies:[h.H,y.W,l,a.YU,i.Q,R.I],encapsulation:2})}return r})()},5559:(S,g,o)=>{o.d(g,{Q:()=>y});var t=o(467),h=o(1007);let y=(()=>{class c{constructor(){}get _uuid(){return Math.random().toString(36).substring(2)+Date.now().toString(36)}openDb(l){return new Promise(function(){var a=(0,t.A)(function*(i,R){const C=yield window.indexedDB.open("lasagna-db",1);C.onerror=u=>{R(u)},C.onsuccess=u=>{l(u.target?.result)},C.onupgradeneeded=u=>{const k=u.target?.result;k.createObjectStore("productsStore",{keyPath:"uuid",autoIncrement:!0}).createIndex("name","name",{unique:!1}),k.createObjectStore("recipesStore",{keyPath:"uuid",autoIncrement:!0}).createIndex("name","name",{unique:!1}),k.createObjectStore("categoryStore",{keyPath:"uuid",autoIncrement:!0}).createIndex("name","name",{unique:!1})},i()});return function(i,R){return a.apply(this,arguments)}}())}addData(l,a){this.openDb(i=>{i.transaction(l,"readwrite").objectStore(l).add({...a,uuid:this._uuid})})}replaceData(l,a,i){this.openDb(R=>{R.transaction(l,"readwrite").objectStore(l).put({...i,uuid:a})})}getOne(l,a,i){this.openDb(R=>{R.transaction(l,"readonly").objectStore(l).get(a).onsuccess=T=>{i(T.target.result)}})}static \u0275fac=function(a){return new(a||c)};static \u0275prov=h.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}return c})()},7512:(S,g,o)=>{o.d(g,{I:()=>y});var t=o(1007);const h=["*"];let y=(()=>{class c{constructor(){}center=(0,t.hFB)(!1);static \u0275fac=function(a){return new(a||c)};static \u0275cmp=t.VBU({type:c,selectors:[["lg-gap-row"]],inputs:{center:[1,"center"]},ngContentSelectors:h,decls:2,vars:2,consts:[[1,"gap-row"]],template:function(a,i){1&a&&(t.NAR(),t.j41(0,"div",0),t.SdG(1),t.k0s()),2&a&&t.AVh("gap-row__center",i.center())},styles:["[_nghost-%COMP%]{flex:1}.gap-row[_ngcontent-%COMP%]{display:flex;gap:32px}.gap-row__center[_ngcontent-%COMP%]{align-items:center}"]})}return c})()}}]);