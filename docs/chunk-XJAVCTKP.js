import{a as le}from"./chunk-EJK6JA4S.js";import{a as pe}from"./chunk-IQGSUA4J.js";import{a as me}from"./chunk-2PXFNS3H.js";import{a as ne}from"./chunk-MGUYQA7S.js";import{a as oe}from"./chunk-J5IRJC5E.js";import{a as se}from"./chunk-5SETSLBD.js";import{a as re,c as ae}from"./chunk-JIX6S6OM.js";import{v as ie}from"./chunk-VUJEMPM4.js";import{a as ee}from"./chunk-BW6KPQFF.js";import{a as Z}from"./chunk-XTIJKHFS.js";import{I as j,J as z,K as k,M as l,R as J,S as U,T as q,U as K,W as L,X as Q,Y as X,da as A,g as $,ma as Y,o as H,oa as te,t as O,z as W}from"./chunk-S7GYMRNG.js";import{$a as o,Bc as s,Cc as p,Db as T,Eb as S,Hb as R,Ib as N,Jb as a,Kb as m,Lb as c,Lc as E,Mb as C,Mc as P,Nb as D,Ob as V,Qb as G,Ub as d,Vb as g,eb as y,ec as M,fc as B,gc as w,ic as x,kc as u,la as _,lb as b,ma as h,nb as I,va as v}from"./chunk-7BND6AGV.js";var F=class n{constructor(){}selfAlign="center";static \u0275fac=function(t){return new(t||n)};static \u0275dir=I({type:n,selectors:[["","lgSelfCenter",""]],hostVars:2,hostBindings:function(t,i){t&2&&M("align-self",i.selfAlign)}})};var xe=(n,e)=>e.name+e.uuid+n;function ue(n,e){n&1&&(x(0),s(1,"translate")),n&2&&u(" ",p(1,1,"settings.taxes.fees")," ")}function fe(n,e){if(n&1){let t=G();T(0,ue,2,3),m(1,"section",4)(2,"div",5)(3,"lg-flex-row",6),C(4,"lg-input",7),s(5,"translate"),C(6,"lg-textarea",8),s(7,"translate"),m(8,"lg-checkbox",9),d("onCheckboxChanged",function(){let r=_(t).$index,f=g();return h(f.onTaxValueChange(r))}),c(),m(9,"lg-number-input",10),s(10,"translate"),d("onInputChange",function(){let r=_(t).$index,f=g();return h(f.onTaxValueChange(r))}),c(),m(11,"lg-button",11),d("click",function(){let r=_(t).$index,f=g();return h(f.deleteTxRow(r))}),C(12,"mat-icon",12),c()()()()}if(n&2){let t=e.$implicit,i=e.$index,r=g();r.taxesForm.controls.rows.controls[i],S(r.feesIndex()===i?0:-1),o(),a("formGroupName",i),o(),B("taxes__row--odd",i%2!==0),o(),a("fit",!0)("top",!0),o(),a("placeholder",p(5,16,"settings.taxes.name")),o(2),a("placeholder",p(7,18,"settings.taxes.description"))("rows",3),o(2),a("customMark","%")("name",t.name+i),o(),a("placeholder",p(10,20,"settings.taxes.value")),o(2),w("danger"),a("icon",!0)("size","tiny")}}function ge(n,e){n&1&&(x(0),s(1,"translate")),n&2&&u(" ",p(1,1,"settings.taxes.save-changes")," ")}function _e(n,e){n&1&&(x(0),s(1,"translate")),n&2&&u(" ",p(1,1,"settings.taxes.no-changes")," ")}var ce=class n{constructor(e,t){this._taxesRepository=e;this._notificationService=t}taxesAndFees=v([]);feesIndex=E(()=>this.taxesAndFees().findIndex(e=>!e.percentage));taxesForm=new k({rows:new L([this._getRowGroup()])});rowsEffect=P(()=>{this._rowsFormArray.clear(),this.taxesAndFees().forEach((e,t)=>{this._rowsFormArray.push(this._getRowGroup(e))}),this.taxesForm.updateValueAndValidity(),this.taxesForm.markAsPristine()});totalTaxes=v(0);formValues=this.taxesForm.valueChanges.pipe(H());get _rowsFormArray(){return this.taxesForm.get("rows")}ngOnInit(){this._taxesRepository.getAll().then(e=>{this.taxesAndFees.set(e.toSorted((t,i)=>t.name.localeCompare(i.name)&&+i.percentage-+t.percentage))})}onTaxValueChange(e){}deleteTxRow(e){let t=this.taxesForm.value.rows?.[e]?.uuid;this._rowsFormArray.removeAt(e),this.taxesAndFees.update(i=>i.filter(r=>r.uuid!==t)),this.taxesForm.markAsDirty(),t&&this._taxesRepository.deleteOne(t)}addTaxRow(){let e=A.empty();this._rowsFormArray.push(this._getRowGroup(e)),this.taxesAndFees.update(t=>[...t,e]),this.taxesForm.markAsDirty()}async saveTaxes(){try{let e=this.taxesForm.value.rows?.map(t=>A.fromRaw(O(t)))??[];await this._taxesRepository.addMany(e),this._notificationService.success("settings.taxes.saved-success"),this.taxesForm.markAsPristine()}catch(e){this._notificationService.error($(e))}}_getRowGroup(e){return new k({name:new l(e?.name||""),description:new l(e?.description||""),value:new l(e?.amount||0),amount:new l(0),percentage:new l(e?.percentage||!1),uuid:new l(e?.uuid||"")})}static \u0275fac=function(t){return new(t||n)(y(le),y(Y))};static \u0275cmp=b({type:n,selectors:[["lg-taxes-settings"]],decls:14,vars:13,consts:[[3,"formGroup"],["formArrayName","rows"],["lgSelfCenter","","lgShrink","",3,"click","disabled"],["lgSelfCenter","","lgShrink","",3,"click"],[1,"taxes",3,"formGroupName"],[1,"taxes__row"],[3,"fit","top"],["formControlName","name","lgWidth","35%",3,"placeholder"],["formControlName","description","lgWidth","35%",3,"placeholder","rows"],["formControlName","percentage","lgShrink","",3,"onCheckboxChanged","customMark","name"],["formControlName","value","lgParseMath","",3,"onInputChange","placeholder"],["lgShrink","",3,"click","icon","size"],["aria-hidden","false","aria-label","Example home icon","fontIcon","close"]],template:function(t,i){t&1&&(m(0,"lg-flex-column"),D(1,0)(2,1),x(3),s(4,"translate"),R(5,fe,13,22,null,null,xe),V()(),m(7,"lg-flex-row")(8,"lg-button",2),d("click",function(){return i.saveTaxes()}),T(9,ge,2,3)(10,_e,2,3),c(),m(11,"lg-button",3),d("click",function(){return i.addTaxRow()}),x(12),s(13,"translate"),c()()()),t&2&&(o(),a("formGroup",i.taxesForm),o(2),u(" ",p(4,9,"settings.taxes.title")," "),o(2),N(i.taxesAndFees()),o(3),w("success"),a("disabled",!i.taxesForm.dirty),o(),S(i.taxesForm.dirty?9:10),o(2),w("warning"),o(),u(" ",p(13,11,"settings.taxes.add-tax")," "))},dependencies:[ee,ne,Q,j,z,te,me,ie,re,ae,X,J,K,U,q,F,se,oe,pe,Z,W],encapsulation:2})};export{F as a,ce as b};
