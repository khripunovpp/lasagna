import{a as D}from"./chunk-HG4USQGA.js";import{x as A,z as T}from"./chunk-Z5IKK74Y.js";import{U as u,Y as S}from"./chunk-RDTQHNEQ.js";import{a as f,b as h,f as y}from"./chunk-2WH2EVR6.js";var b=()=>`rgb(${Math.floor(Math.random()*256)}, ${Math.floor(Math.random()*256)}, ${Math.floor(Math.random()*256)})`;var p=class r{constructor(t,e,n){this.name=t;this.color=e;this.uuid=n}static fromRaw(t){return typeof t=="string"?new r(t,b()):new r(t?.name||t?.label||t?.value||t,t?.color||b(),t?.uuid||void 0)}toDTO(){return{name:this.name,color:this.color,uuid:this.uuid}}toString(){return String(this.name)}};var l=r=>{if(typeof r=="number")return r;if(typeof r=="string"){let t=r.replace(",","."),e=parseFloat(t);return isNaN(e)?0:e}return 0};var O=class r{constructor(t){this.name=t.name,this.amount=parseFloat(String(t.amount)),this.price=t.price,this.unit=t.unit,this.source=t.source,this.category_id=D.fromRaw(t.category_id),this.tags=t.tags?.map(e=>p.fromRaw(e)),this.uuid=t.uuid,this.createdAt=t.createdAt?Number(t.createdAt):void 0,this.updatedAt=t.updatedAt?Number(t.updatedAt):void 0}name;amount;price;unit;category_id;source;tags;uuid;createdAt;updatedAt;get pricePerUnit(){return l(this.price)===0||l(this.amount)===0?0:l(this.price)/l(this.amount)}get perUnitLabel(){return!this.unit||this.unit==="gram"?"per gram":`per ${this.unit}`}static fromRaw(t){return new r({name:t?.name||"",amount:Number(t?.amount)||0,price:Number(t?.price)||0,unit:t?.unit||"gram",source:t?.source||"",category_id:t?.category_id||"",tags:t?.tags,uuid:t?.uuid,createdAt:t?.createdAt,updatedAt:t?.updatedAt})}static empty(){return new r({name:"",amount:0,price:0,unit:"gram",source:void 0,category_id:"",tags:[]})}update(t){return this.name=t.name||this.name,this.amount=t.amount?Number(t.amount):this.amount,this.price=t.price?Number(t.price):this.price,this.unit=t.unit||this.unit,this.source=t.source||this.source,this.category_id=D.fromRaw(t.category_id||""),this.tags=t.tags?.map(e=>p.fromRaw(e))||this.tags,this.uuid=t.uuid||this.uuid,this.createdAt=t.createdAt?Number(t.createdAt):this.createdAt,this.updatedAt=t?.updatedAt||Date.now(),this}toDTO(){return{name:this.name,amount:this.amount,price:this.price,unit:this.unit,source:this.source??"",category_id:this.category_id.toUUID(),tags:this.tags?.map(t=>t.toString()),uuid:this.uuid,createdAt:this.createdAt??Date.now(),updatedAt:this.updatedAt??Date.now()}}};var F=class r{constructor(){}read(t){try{let e=JSON.parse(localStorage.getItem(t+"_top")||"{}"),n=JSON.parse(localStorage.getItem(t+"_recent")||"{}");return{top:e,recent:n}}catch(e){return console.error("Error reading from localStorage:",e),{top:{},recent:{}}}}count(t,e){if(!e)return;let n=t+"_history",c=t+"_recent",d=t+"_top",a=JSON.parse(localStorage.getItem(n)||"{}"),i=Date.now(),o=i-30*24*60*60*1e3;a[e]={count:(a[e]?.count||0)+1,updatedAt:i};let m=Object.entries(a).filter(([g,s])=>s.updatedAt>=o),N=m.sort((g,s)=>s[1].updatedAt-g[1].updatedAt).slice(0,5),v=m.sort((g,s)=>s[1].count-g[1].count||s[1].updatedAt-g[1].updatedAt).slice(0,5);localStorage.setItem(n,JSON.stringify(Object.fromEntries(m))),localStorage.setItem(c,JSON.stringify(Object.fromEntries(N))),localStorage.setItem(d,JSON.stringify(Object.fromEntries(v)))}static \u0275fac=function(e){return new(e||r)};static \u0275prov=u({token:r,factory:r.\u0275fac,providedIn:"root"})};var I=class r{constructor(){}getDraftForms=t=>{let e=localStorage.getItem(t);return e?JSON.parse(e):null};setDraftForm=(t,e,n,c={})=>{let d=this.getDraftForms(t),a=Date.now(),i=A(),o={uuid:i,createdAt:a,data:e,mode:n,meta:c},m=h(f({},d),{[i]:o});return localStorage.setItem(t,JSON.stringify(m)),o};updateDraftForm=(t,e,n,c,d={})=>{let a=this.getDraftForms(t),i={},o=a;a?.[n]&&(i=h(f({},a?.[n]),{updatedAt:Date.now(),data:f(f({},a?.[n].data),e),mode:c,meta:d}),o[n]=i),localStorage.setItem(t,JSON.stringify(o))};removeDraftForm=(t,e)=>{let n=this.getDraftForms(t);if(n){if(e)delete n[e];else{localStorage.removeItem(t);return}localStorage.setItem(t,JSON.stringify(n))}};static \u0275fac=function(e){return new(e||r)};static \u0275prov=u({token:r,factory:r.\u0275fac,providedIn:"root"})};var w=class r{constructor(t){this._indexDbService=t}addOne(t){return this._indexDbService.addData("tags",t.toDTO(),t.name)}getOne(t){return y(this,null,function*(){return this._indexDbService.getOne("tags",t)})}getAll(){return this._indexDbService.getAll("tags")}getMany(t){return this._indexDbService.getMany("tags",t)}editOne(t,e){return this._indexDbService.replaceData("tags",t,e.toDTO())}deleteOne(t){return this._indexDbService.remove("tags",t)}static \u0275fac=function(e){return new(e||r)(S(T))};static \u0275prov=u({token:r,factory:r.\u0275fac,providedIn:"root"})};export{l as a,p as b,O as c,F as d,I as e,w as f};
