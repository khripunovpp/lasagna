import{a as fe,b as _e}from"./chunk-2VTUNQ5M.js";import{g as S}from"./chunk-LHUC6J4E.js";import"./chunk-GALYHWJT.js";import"./chunk-RQXCDFF7.js";import"./chunk-HWTAL2KX.js";import"./chunk-3DMBXY5D.js";import{a as pe,b as me}from"./chunk-WM7H27HU.js";import{a as de,b as ue}from"./chunk-X7ALQ6IE.js";import"./chunk-DUD2ZZQL.js";import"./chunk-FK6H3RFT.js";import"./chunk-FHCFN5NX.js";import{a as ve}from"./chunk-5ZBILTT3.js";import{v as ae}from"./chunk-4JACCPQC.js";import{a as re}from"./chunk-TKRM7P4A.js";import{a as ie}from"./chunk-3I72BRDH.js";import{a as se}from"./chunk-H7PEEFRQ.js";import{b as le}from"./chunk-XSSJM7QR.js";import{c as te}from"./chunk-BELZJZQU.js";import{a as oe}from"./chunk-HK2A7YRA.js";import"./chunk-MPFUNZLY.js";import{a as ne}from"./chunk-SDVVFYH2.js";import{U as ee,V as C,W as ce,h as X,p as Y}from"./chunk-SE5JQ57N.js";import{p as J,q as Q,u as W}from"./chunk-DGKRNV7D.js";import"./chunk-CABIONZL.js";import"./chunk-EMIJRNYJ.js";import{f as K,l as U,m as q,n as H}from"./chunk-VKLQR74F.js";import{$a as o,Bb as Z,Cc as d,Dc as g,Ec as y,Gb as N,Ib as E,Jb as h,Kb as s,Lb as a,Mb as c,Mc as D,Nb as w,Rb as P,V as R,Vb as A,Wb as v,ca as B,ea as x,eb as I,hc as $,jc as p,l as O,la as b,lb as F,lc as f,ma as L,mc as j,nc as V,qb as M,r as T,t as k,wc as z,xc as G}from"./chunk-TMZLFVGH.js";import"./chunk-2RGDSI3Q.js";import"./chunk-C6Q5SG76.js";var Ie=new B("CategorizedInvoicesList",{factory:()=>{let r=x(S);return O(r.loadToObservable()).pipe(R(()=>r.items$)).pipe(T(e=>e.toSorted((t,l)=>t.prefix.localeCompare(l.prefix))),T(e=>X(e,"prefix")),k(async e=>{let t=[];for(let u in e)t.push({group_key:u,items:e[u]?.toSorted((m,_)=>m.createdAt>_.createdAt?-1:1)||[]});if(!t.length)return[];let[l,...i]=t.toSorted((u,m)=>u.group_key>m.group_key?1:-1);return l?.group_key?[l].concat(i):i.concat([l])}))}});var xe=()=>["product"],ye=(r,n)=>(n.uuid??"")+r;function Ce(r,n){if(r&1&&(a(0,"lg-flex-column",7)(1,"lg-flex-row",3)(2,"lg-flex-row",8)(3,"a",9),p(4),c(),a(5,"div",10),p(6),c()(),a(7,"small",11),d(8,"date"),p(9),d(10,"translate"),d(11,"timeAgo"),c()(),a(12,"lg-flex-row",3)(13,"div"),p(14),d(15,"date"),c(),a(16,"div"),p(17),d(18,"number"),c()()()),r&2){let e,t,l=v(),i=l.$implicit,u=l.$index,m=v().$index,_=v();s("size","medium"),o(),s("center",!0),o(),s("center",!0),o(),s("routerLink","/invoices/edit/"+i.uuid),o(),V(" #",i.prefix,"/",i.invoice_number," - ",i.name," "),o(),s("ngClass",(e=_.stateBadgeClasses())==null||e[m]==null?null:e[m][u]),o(),f(" ",(t=_.stateLabels())==null||t[m]==null?null:t[m][u]," "),o(),Z("title",y(8,15,(i==null?null:i.updatedAt)||(i==null?null:i.createdAt),"short")),o(2),j(" ",g(10,18,"edited-at-label")," ",g(11,20,(i==null?null:i.updatedAt)||(i==null?null:i.createdAt))," "),o(3),s("center",!0),o(2),f(" Date due: ",y(15,22,i.date_due,"shortDate")," "),o(3),f(" Days left: ",y(18,25,(i.date_due-_.nowDate)/(1e3*60*60*24),"1.0-0")," ")}}function Se(r,n){if(r&1&&M(0,Ce,19,28,"ng-template",6),r&2){let e=n.$implicit;s("uuid",e.uuid)}}function Te(r,n){if(r&1){let e=P();a(0,"lg-title",4),p(1),d(2,"translate"),c(),a(3,"lg-card-list",5),A("onSelected",function(l){b(e);let i=v();return L(i.selectionZoneService.putSelected(l))})("onDeleteOne",function(l){b(e);let i=v();return L(i.deleteOne(l))}),E(4,Se,1,1,null,6,ye),c()}if(r&2){let e=n.$implicit,t=v();s("level",3),o(),f(" ",(e==null?null:e.group_key)||g(2,5,"without-category-label")," "),o(2),s("mode",t.selectionZoneService.selectionMode())("selectAll",t.selectionZoneService.selectAll())("deselectAll",t.selectionZoneService.deselectAll()),o(),h(e.items)}}function be(r,n){r&1&&(a(0,"lg-flex-row",3)(1,"lg-title",4),p(2),d(3,"translate"),c()()),r&2&&(s("center",!0),o(),s("level",5),o(),f(" ",g(3,3,"no-products")," "))}var ge=class r{constructor(n,e,t,l){this._notificationsService=n;this.selectionZoneService=e;this._invoicesRepository=t;this._router=l}nowDate=Date.now();invoices=Y(x(Ie));stateLabels=D(()=>this.invoices()?.map(n=>n?.items?.map(e=>{let t=e.state;return _e[t]||"Unknown"})));stateBadgeClasses=D(()=>this.invoices()?.map(n=>n?.items?.map(e=>{let t=e.state;return fe[t||"draft"]})));Stores=W;deleteOne(n){n?.uuid&&this._invoicesRepository.deleteOne(n.uuid).then(()=>{this._notificationsService.success("invoice.deleted"),this.loadItems()})}ngOnInit(){this.loadItems()}loadItems(){this._invoicesRepository.loadToObservable()}onAddInvoice(){this._invoicesRepository.createEmpty().then(n=>{this._router.navigate(["/invoices/edit",n])})}static \u0275fac=function(e){return new(e||r)(I(ee),I(C),I(S),I(J))};static \u0275cmp=F({type:r,selectors:[["lg-invoices-list"]],features:[z([C,H])],decls:11,vars:7,consts:[[3,"click","icon","size"],["aria-hidden","false","fontIcon","add"],[3,"selectionTypes"],[3,"center"],[3,"level"],[3,"onSelected","onDeleteOne","mode","selectAll","deselectAll"],["lgCardListItem","","type","product",3,"uuid"],[3,"size"],["lgExpand","",3,"center"],[3,"routerLink"],[3,"ngClass"],[1,"text-muted","text-cursive"]],template:function(e,t){e&1&&(a(0,"lg-controls-bar")(1,"lg-button",0),A("click",function(){return t.onAddInvoice()}),w(2,"mat-icon",1),c()(),a(3,"lg-fade-in")(4,"lg-container")(5,"lg-title"),p(6," Invoices "),c(),w(7,"lg-selection-tools",2),E(8,Te,6,7,null,null,N,!1,be,4,5,"lg-flex-row",3),c()()),e&2&&(o(),$("success"),s("icon",!0)("size","medium"),o(6),s("selectionTypes",G(6,xe)),o(),h(t.invoices()))},dependencies:[se,ce,ae,ie,ne,ue,de,Q,oe,pe,me,le,ve,te,re,U,q,K],styles:["[_nghost-%COMP%]{display:block}"]})};export{ge as InvoicesListComponent};
