import {
  ChipsListComponent,
  HtmlEditorComponent
} from "./chunk-RQQNVSG6.js";
import {
  UnitStringPipe
} from "./chunk-G7O37WZ6.js";
import {
  EntityItemSelectorComponent
} from "./chunk-HHQJHC7V.js";
import {
  UnitSwitcherComponent
} from "./chunk-DZGBWSEE.js";
import {
  UserCurrencyPipe
} from "./chunk-MSSA67JN.js";
import {
  DeleteConfirmationPopoverComponent,
  DeleteConfirmationService
} from "./chunk-PN5PQSS2.js";
import {
  ControlTemplateDirective,
  MultiselectComponent,
  NgLabelTemplateDirective,
  NgMultiLabelTemplateDirective,
  NgOptionTemplateDirective,
  NgSelectComponent,
  SelfStartDirective
} from "./chunk-QCDXA5J3.js";
import {
  ControlBoxComponent
} from "./chunk-U3TDYFCF.js";
import {
  WidthDirective
} from "./chunk-LRBNXK2T.js";
import {
  ShrinkDirective
} from "./chunk-V7J77S6Z.js";
import {
  ParseMathDirective
} from "./chunk-5P5OGC4J.js";
import {
  NumberInputComponent
} from "./chunk-X57NSDUU.js";
import {
  ROUTER_MANAGER
} from "./chunk-6TJSNOWD.js";
import {
  AnalyticsService
} from "./chunk-PF6RY5D3.js";
import "./chunk-CR4NZLV7.js";
import {
  ControlComponent
} from "./chunk-HUXXML4Q.js";
import {
  InputComponent
} from "./chunk-GIEGUCCS.js";
import {
  ControlExtraTemplateDirective
} from "./chunk-WDCOU2SU.js";
import "./chunk-EROQRXO4.js";
import {
  RecipeScheme
} from "./chunk-B6BXXPI6.js";
import "./chunk-AYB6SB63.js";
import {
  ControlsBarComponent
} from "./chunk-EEM4H4NM.js";
import {
  InlineSeparatedGroupComponent,
  InlineSeparatedGroupDirective
} from "./chunk-VUN3T56G.js";
import "./chunk-IWKECZQN.js";
import "./chunk-SSW253TQ.js";
import {
  ExpandDirective
} from "./chunk-STX6NIUK.js";
import {
  MatIcon
} from "./chunk-MKQIBRI6.js";
import {
  ContainerComponent
} from "./chunk-WON5FF4H.js";
import {
  FlexRowComponent
} from "./chunk-UFJVMPSL.js";
import "./chunk-R64U7JLD.js";
import {
  CardComponent
} from "./chunk-PJDK3IYM.js";
import {
  TimeAgoPipe
} from "./chunk-FDNQMWQM.js";
import {
  RecipesRepository,
  SelectResourcesService
} from "./chunk-WZJWRJIG.js";
import "./chunk-PWIGGAMT.js";
import "./chunk-ETIKHZBE.js";
import "./chunk-IGVRSL6U.js";
import {
  NotificationsService,
  Recipe,
  SettingsKeysConst,
  SettingsService,
  Tag,
  checkCycleRecipe,
  errorHandler,
  getIngredientGroup,
  marker,
  productLabelFactoryProvider,
  recipeToFormValue
} from "./chunk-JVOZ4YPY.js";
import "./chunk-GRS3SI4M.js";
import {
  Stores,
  UnitValue
} from "./chunk-7REZCGNQ.js";
import "./chunk-T5CRNY7R.js";
import "./chunk-5WJUMO7X.js";
import {
  FadeInComponent
} from "./chunk-YUWU6IJY.js";
import {
  TitleComponent
} from "./chunk-T6NLT234.js";
import "./chunk-GGH4TL4E.js";
import {
  CheckboxControlValueAccessor,
  ControlContainer,
  FormArray,
  FormArrayName,
  FormControl,
  FormControlName,
  FormGroup,
  FormGroupDirective,
  FormGroupName,
  FormsModule,
  NG_VALUE_ACCESSOR,
  NgControlStatus,
  NgControlStatusGroup,
  NgModel,
  ReactiveFormsModule,
  Validators,
  injectParams,
  takeUntilDestroyed,
  ɵNgNoValidate
} from "./chunk-4GKKNB6P.js";
import {
  ButtonComponent
} from "./chunk-IHCVSUQN.js";
import {
  TranslateDirective,
  TranslatePipe,
  TranslateService
} from "./chunk-KKROIGFS.js";
import {
  ActivatedRoute,
  Router,
  RouterLink
} from "./chunk-UUUEGOMT.js";
import "./chunk-CE7BC4LB.js";
import "./chunk-IWOUTMKL.js";
import {
  FlexColumnComponent
} from "./chunk-3KXU4X6J.js";
import {
  NgClass,
  NgStyle
} from "./chunk-KBRICXTE.js";
import {
  ChangeDetectionStrategy,
  Component,
  DestroyRef,
  HostListener,
  Input,
  Optional,
  ViewEncapsulation,
  combineLatest,
  computed,
  debounceTime,
  effect,
  forwardRef,
  inject,
  input,
  output,
  setClassMetadata,
  signal,
  viewChild,
  viewChildren,
  ɵsetClassDebugInfo,
  ɵɵProvidersFeature,
  ɵɵadvance,
  ɵɵattribute,
  ɵɵconditional,
  ɵɵconditionalCreate,
  ɵɵdefineComponent,
  ɵɵdirectiveInject,
  ɵɵdomElementEnd,
  ɵɵdomElementStart,
  ɵɵelement,
  ɵɵelementContainerEnd,
  ɵɵelementContainerStart,
  ɵɵelementEnd,
  ɵɵelementStart,
  ɵɵgetCurrentView,
  ɵɵinterpolate,
  ɵɵinterpolate1,
  ɵɵlistener,
  ɵɵnextContext,
  ɵɵpipe,
  ɵɵpipeBind1,
  ɵɵpipeBind2,
  ɵɵprojection,
  ɵɵprojectionDef,
  ɵɵproperty,
  ɵɵpureFunction1,
  ɵɵqueryAdvance,
  ɵɵreference,
  ɵɵrepeater,
  ɵɵrepeaterCreate,
  ɵɵresetView,
  ɵɵrestoreView,
  ɵɵstyleMap,
  ɵɵtemplate,
  ɵɵtext,
  ɵɵtextInterpolate,
  ɵɵtextInterpolate1,
  ɵɵtextInterpolate2,
  ɵɵviewQuerySignal
} from "./chunk-Z5TNFCCP.js";
import "./chunk-PZQLIUCM.js";
import "./chunk-7YWLATDR.js";
import {
  __spreadProps,
  __spreadValues
} from "./chunk-46DXP6YY.js";

// src/app/features/controls/form/control-group.component.ts
var _c0 = ["*"];
function ControlGroupComponent_Conditional_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275domElementStart(0, "p", 1);
    \u0275\u0275text(1);
    \u0275\u0275domElementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", ctx_r0.label(), " ");
  }
}
var ControlGroupComponent = class _ControlGroupComponent {
  constructor() {
  }
  label = input("", ...ngDevMode ? [{ debugName: "label" }] : []);
  static \u0275fac = function ControlGroupComponent_Factory(__ngFactoryType__) {
    return new (__ngFactoryType__ || _ControlGroupComponent)();
  };
  static \u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _ControlGroupComponent, selectors: [["lg-control-group"]], inputs: { label: [1, "label"] }, ngContentSelectors: _c0, decls: 4, vars: 1, consts: [[1, "control-group"], [1, "control-group__label"], [1, "control-group__content"]], template: function ControlGroupComponent_Template(rf, ctx) {
    if (rf & 1) {
      \u0275\u0275projectionDef();
      \u0275\u0275domElementStart(0, "div", 0);
      \u0275\u0275conditionalCreate(1, ControlGroupComponent_Conditional_1_Template, 2, 1, "p", 1);
      \u0275\u0275domElementStart(2, "div", 2);
      \u0275\u0275projection(3);
      \u0275\u0275domElementEnd()();
    }
    if (rf & 2) {
      \u0275\u0275advance();
      \u0275\u0275conditional(ctx.label() ? 1 : -1);
    }
  }, styles: ["\n\n[_nghost-%COMP%] {\n  display: flex;\n  flex: 1;\n}\n.control-group[_ngcontent-%COMP%] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n  min-width: 0;\n}\n.control-group__label[_ngcontent-%COMP%] {\n  font-size: 1.2rem;\n  margin: 0;\n}\n.control-group__content[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 8px;\n  align-items: flex-end;\n}\n.control-group__content[_ngcontent-%COMP%]    > *[_ngcontent-%COMP%] {\n  flex: 1;\n}\n/*# sourceMappingURL=control-group.component.css.map */"] });
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(ControlGroupComponent, [{
    type: Component,
    args: [{ selector: "lg-control-group", standalone: true, template: `
    <div class="control-group">
      @if (label()) {
        <p class="control-group__label"> {{ label() }} </p>
      }
      <div class="control-group__content">
        <ng-content></ng-content>
      </div>
    </div>
  `, styles: ["/* angular:styles/component:scss;7755ebaddfbdc4e485ebb5876f5ef507f165307962ac534534881c497427d613;/Users/khripunovpavel/Documents/my/lasagna/lasagna/src/app/features/controls/form/control-group.component.ts */\n:host {\n  display: flex;\n  flex: 1;\n}\n.control-group {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n  min-width: 0;\n}\n.control-group__label {\n  font-size: 1.2rem;\n  margin: 0;\n}\n.control-group__content {\n  display: flex;\n  gap: 8px;\n  align-items: flex-end;\n}\n.control-group__content > * {\n  flex: 1;\n}\n/*# sourceMappingURL=control-group.component.css.map */\n"] }]
  }], () => [], null);
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(ControlGroupComponent, { className: "ControlGroupComponent", filePath: "src/app/features/controls/form/control-group.component.ts", lineNumber: 48 });
})();

// src/app/features/controls/form/tags-control.component.ts
var _c02 = (a0) => ({ background: a0 });
var _forTrack0 = ($index, $item) => ($item == null ? null : $item.name) ?? ($item == null ? null : $item.label) ?? $item;
function TagsControlComponent_ng_template_4_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0);
  }
  if (rf & 2) {
    const item_r1 = ctx.item;
    \u0275\u0275textInterpolate1(" ", (item_r1 == null ? null : item_r1.name) ?? (item_r1 == null ? null : item_r1.label) ?? item_r1, " ");
  }
}
function TagsControlComponent_ng_template_5_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0);
  }
  if (rf & 2) {
    const item_r2 = ctx.item;
    \u0275\u0275textInterpolate1(" ", (item_r2 == null ? null : item_r2.name) ?? (item_r2 == null ? null : item_r2.label) ?? item_r2, " ");
  }
}
function TagsControlComponent_ng_template_6_For_1_Template(rf, ctx) {
  if (rf & 1) {
    const _r3 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 5)(1, "span", 6);
    \u0275\u0275text(2);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "span", 7);
    \u0275\u0275listener("click", function TagsControlComponent_ng_template_6_For_1_Template_span_click_3_listener() {
      const item_r4 = \u0275\u0275restoreView(_r3).$implicit;
      const clear_r5 = \u0275\u0275nextContext().clear;
      return \u0275\u0275resetView(clear_r5(item_r4));
    });
    \u0275\u0275text(4, "\xD7");
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const item_r4 = ctx.$implicit;
    \u0275\u0275property("ngStyle", \u0275\u0275pureFunction1(2, _c02, (item_r4 == null ? null : item_r4.color) ? item_r4 == null ? null : item_r4.color : null));
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1(" ", (item_r4 == null ? null : item_r4.name) ?? (item_r4 == null ? null : item_r4.label) ?? item_r4, " ");
  }
}
function TagsControlComponent_ng_template_6_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275repeaterCreate(0, TagsControlComponent_ng_template_6_For_1_Template, 5, 4, "div", 5, _forTrack0);
  }
  if (rf & 2) {
    const items_r6 = ctx.items;
    \u0275\u0275repeater(items_r6);
  }
}
var TagsControlComponent = class _TagsControlComponent {
  _selectResourcesService;
  constructor(_selectResourcesService) {
    this._selectResourcesService = _selectResourcesService;
  }
  placeholder = "";
  addTagText = marker("tags.add-tag-text");
  resource = input("", ...ngDevMode ? [{ debugName: "resource" }] : []);
  autoLoad = input(false, ...ngDevMode ? [{ debugName: "autoLoad" }] : []);
  multi = input(false, ...ngDevMode ? [{ debugName: "multi" }] : []);
  loadedList = signal([], ...ngDevMode ? [{ debugName: "loadedList" }] : []);
  onSelected = output();
  value = null;
  selectComponent = viewChild(NgSelectComponent, ...ngDevMode ? [{ debugName: "selectComponent" }] : []);
  addTagFn(name) {
    return Tag.fromRaw(name);
  }
  onChange = () => {
  };
  onTouched = () => {
  };
  searchFn = (term, item) => {
    const val = item;
    return val?.toString().toLowerCase().includes(term.toLowerCase());
  };
  compareWith = (a, b) => {
    const valA = a;
    const valB = b;
    return valA === valB;
  };
  writeValue(value) {
    this.change(value);
  }
  change(value) {
    if (Array.isArray(value)) {
      this.value = value.map((item) => Tag.fromRaw(item).toDTO());
    } else {
      this.value = Tag.fromRaw(value).toDTO();
    }
    this.onChange(this.value);
  }
  registerOnChange(fn) {
    this.onChange = fn;
  }
  registerOnTouched(fn) {
    this.onTouched = fn;
  }
  onChangeInput(value) {
    this.change(value);
  }
  onChangeSelect(value) {
    this.change(value);
    this.onSelected.emit(value);
  }
  ngOnInit() {
    this._selectResourcesService.register(this.resource());
    if (this.autoLoad()) {
      this._selectResourcesService.load([this.resource()]);
    }
    this._selectResourcesService.subscribe((registry) => {
      const items = registry.get(this.resource())?.list ?? [];
      this.loadedList.set(items);
    });
  }
  reload() {
    return this._selectResourcesService.load([this.resource()], true);
  }
  static \u0275fac = function TagsControlComponent_Factory(__ngFactoryType__) {
    return new (__ngFactoryType__ || _TagsControlComponent)(\u0275\u0275directiveInject(SelectResourcesService, 8));
  };
  static \u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _TagsControlComponent, selectors: [["lg-tags-control"]], viewQuery: function TagsControlComponent_Query(rf, ctx) {
    if (rf & 1) {
      \u0275\u0275viewQuerySignal(ctx.selectComponent, NgSelectComponent, 5);
    }
    if (rf & 2) {
      \u0275\u0275queryAdvance();
    }
  }, inputs: { placeholder: "placeholder", addTagText: "addTagText", resource: [1, "resource"], autoLoad: [1, "autoLoad"], multi: [1, "multi"] }, outputs: { onSelected: "onSelected" }, features: [\u0275\u0275ProvidersFeature([
    {
      provide: NG_VALUE_ACCESSOR,
      useExisting: forwardRef(() => _TagsControlComponent),
      multi: true
    }
  ])], decls: 7, vars: 13, consts: [[1, "tags-control"], [3, "change", "ngModelChange", "addTagText", "addTag", "appendTo", "compareWith", "items", "multiple", "ngModel", "placeholder", "searchFn"], ["ng-label-tmp", ""], ["ng-option-tmp", ""], ["ng-multi-label-tmp", ""], [1, "ng-value", 3, "ngStyle"], [1, "ng-value-label"], ["aria-hidden", "true", 1, "ng-value-icon", "right", 3, "click"]], template: function TagsControlComponent_Template(rf, ctx) {
    if (rf & 1) {
      \u0275\u0275elementStart(0, "div", 0)(1, "ng-select", 1);
      \u0275\u0275pipe(2, "translate");
      \u0275\u0275pipe(3, "translate");
      \u0275\u0275listener("change", function TagsControlComponent_Template_ng_select_change_1_listener($event) {
        return ctx.onChangeSelect($event);
      })("ngModelChange", function TagsControlComponent_Template_ng_select_ngModelChange_1_listener($event) {
        return ctx.onChangeInput($event);
      });
      \u0275\u0275template(4, TagsControlComponent_ng_template_4_Template, 1, 1, "ng-template", 2)(5, TagsControlComponent_ng_template_5_Template, 1, 1, "ng-template", 3)(6, TagsControlComponent_ng_template_6_Template, 2, 0, "ng-template", 4);
      \u0275\u0275elementEnd()();
    }
    if (rf & 2) {
      \u0275\u0275advance();
      \u0275\u0275property("addTagText", \u0275\u0275pipeBind1(2, 9, ctx.addTagText))("addTag", ctx.addTagFn)("appendTo", "body")("compareWith", ctx.compareWith)("items", ctx.loadedList())("multiple", ctx.multi())("ngModel", ctx.value)("placeholder", \u0275\u0275pipeBind1(3, 11, ctx.placeholder))("searchFn", ctx.searchFn);
    }
  }, dependencies: [
    NgSelectComponent,
    FormsModule,
    NgControlStatus,
    NgModel,
    NgOptionTemplateDirective,
    NgLabelTemplateDirective,
    NgMultiLabelTemplateDirective,
    NgStyle,
    TranslatePipe
  ], styles: ["/* angular:styles/component:scss;350aa6bbb8a2cb7071496b299ed22ed5e400c6b80bbedf06b89e270c9e36d21c;/Users/khripunovpavel/Documents/my/lasagna/lasagna/src/app/features/controls/form/tags-control.component.ts */\nlg-tags-control {\n  display: flex;\n  flex: 1;\n  min-width: 150px;\n}\n.tags-control {\n  flex: 1;\n  width: 100%;\n}\n.tags-control .ng-select .ng-select-container {\n  height: 51px;\n}\n.tags-control .ng-select .ng-select-container {\n  border: none;\n  border-radius: 12px;\n  background-color: var(--control-bg);\n}\n.tags-control .ng-select .ng-select-container .ng-input {\n  top: 16px !important;\n}\n.tags-control .ng-select .ng-select-container .ng-input > input {\n  color: var(--text);\n  font-family: inherit;\n  font-size: inherit;\n}\n.tags-control .ng-dropdown-panel {\n  border: none;\n  box-shadow: 0 4px 16px 0 rgba(0, 0, 0, 0.1);\n  border-radius: 12px;\n  overflow: hidden;\n}\n.tags-control .ng-dropdown-panel .ng-option {\n  padding: 16px;\n  border-radius: 12px;\n}\n/*# sourceMappingURL=tags-control.component.css.map */\n"], encapsulation: 2 });
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(TagsControlComponent, [{
    type: Component,
    args: [{ selector: "lg-tags-control", standalone: true, template: `
    <div class="tags-control">
      <ng-select (change)="onChangeSelect($event)"
                 (ngModelChange)="onChangeInput($event)"
                 [addTagText]="addTagText | translate"
                 [addTag]="addTagFn"
                 [appendTo]="'body'"
                 [compareWith]="compareWith"
                 [items]="loadedList()"
                 [multiple]="multi()"
                 [ngModel]="value"
                 [placeholder]="placeholder | translate"
                 [searchFn]="searchFn">
        <ng-template let-item="item" ng-label-tmp>
          {{ $any(item)?.name ?? $any(item)?.label ?? item }}
        </ng-template>
        <ng-template let-item="item" ng-option-tmp>
          {{ $any(item)?.name ?? $any(item)?.label ?? item }}
        </ng-template>
        <ng-template let-clear="clear" let-items="items" ng-multi-label-tmp>
          @for (item of items; track $any(item)?.name ?? $any(item)?.label ?? item) {
            <div class="ng-value"
                 [ngStyle]="{background: $any(item)?.color ? $any(item)?.color : null}">
                          <span class="ng-value-label">
                              {{ $any(item)?.name ?? $any(item)?.label ?? item }}
                          </span>
              <span class="ng-value-icon right" (click)="clear(item)" aria-hidden="true">\xD7</span>
            </div>
          }

        </ng-template>
      </ng-select>
    </div>
  `, imports: [
      NgSelectComponent,
      FormsModule,
      NgOptionTemplateDirective,
      NgLabelTemplateDirective,
      NgMultiLabelTemplateDirective,
      NgStyle,
      TranslatePipe
    ], providers: [
      {
        provide: NG_VALUE_ACCESSOR,
        useExisting: forwardRef(() => TagsControlComponent),
        multi: true
      }
    ], encapsulation: ViewEncapsulation.None, styles: ["/* angular:styles/component:scss;350aa6bbb8a2cb7071496b299ed22ed5e400c6b80bbedf06b89e270c9e36d21c;/Users/khripunovpavel/Documents/my/lasagna/lasagna/src/app/features/controls/form/tags-control.component.ts */\nlg-tags-control {\n  display: flex;\n  flex: 1;\n  min-width: 150px;\n}\n.tags-control {\n  flex: 1;\n  width: 100%;\n}\n.tags-control .ng-select .ng-select-container {\n  height: 51px;\n}\n.tags-control .ng-select .ng-select-container {\n  border: none;\n  border-radius: 12px;\n  background-color: var(--control-bg);\n}\n.tags-control .ng-select .ng-select-container .ng-input {\n  top: 16px !important;\n}\n.tags-control .ng-select .ng-select-container .ng-input > input {\n  color: var(--text);\n  font-family: inherit;\n  font-size: inherit;\n}\n.tags-control .ng-dropdown-panel {\n  border: none;\n  box-shadow: 0 4px 16px 0 rgba(0, 0, 0, 0.1);\n  border-radius: 12px;\n  overflow: hidden;\n}\n.tags-control .ng-dropdown-panel .ng-option {\n  padding: 16px;\n  border-radius: 12px;\n}\n/*# sourceMappingURL=tags-control.component.css.map */\n"] }]
  }], () => [{ type: SelectResourcesService, decorators: [{
    type: Optional
  }] }], { placeholder: [{
    type: Input
  }], addTagText: [{
    type: Input
  }] });
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(TagsControlComponent, { className: "TagsControlComponent", filePath: "src/app/features/controls/form/tags-control.component.ts", lineNumber: 132 });
})();

// src/app/features/controls/form/switch.component.ts
var _c03 = [[["", "slot", "left"]], [["", "slot", "right"]]];
var _c1 = ["[slot='left']", "[slot='right']"];
var SwitchComponent = class _SwitchComponent {
  value = input("", ...ngDevMode ? [{ debugName: "value" }] : []);
  name = input("lg-switch", ...ngDevMode ? [{ debugName: "name" }] : []);
  size = input("default", ...ngDevMode ? [{ debugName: "size" }] : []);
  modelValue = false;
  onKeydown(event) {
    event.preventDefault();
    this.onChangeSwitch(!this.modelValue);
  }
  onChange = () => {
  };
  onTouched = () => {
  };
  writeValue(value) {
    this._change(value);
  }
  registerOnChange(fn) {
    this.onChange = fn;
  }
  registerOnTouched(fn) {
    this.onTouched = fn;
  }
  onChangeSwitch(value) {
    this._change(value);
  }
  _change(value) {
    this.modelValue = value;
    this.onChange(this.modelValue);
  }
  static \u0275fac = function SwitchComponent_Factory(__ngFactoryType__) {
    return new (__ngFactoryType__ || _SwitchComponent)();
  };
  static \u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _SwitchComponent, selectors: [["lg-switch"]], hostBindings: function SwitchComponent_HostBindings(rf, ctx) {
    if (rf & 1) {
      \u0275\u0275listener("keydown.enter", function SwitchComponent_keydown_enter_HostBindingHandler($event) {
        return ctx.onKeydown($event);
      })("keydown.space", function SwitchComponent_keydown_space_HostBindingHandler($event) {
        return ctx.onKeydown($event);
      });
    }
  }, inputs: { value: [1, "value"], name: [1, "name"], size: [1, "size"] }, features: [\u0275\u0275ProvidersFeature([{
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef(() => _SwitchComponent),
    multi: true
  }])], ngContentSelectors: _c1, decls: 6, vars: 5, consts: [["tabindex", "0", 1, "lg-switch", 3, "ngClass"], ["type", "checkbox", 1, "switch", 3, "ngModelChange", "ngModel"], [1, "lg-switch__track"], [1, "lg-switch__thumb"]], template: function SwitchComponent_Template(rf, ctx) {
    if (rf & 1) {
      \u0275\u0275projectionDef(_c03);
      \u0275\u0275elementStart(0, "label", 0);
      \u0275\u0275projection(1);
      \u0275\u0275elementStart(2, "input", 1);
      \u0275\u0275listener("ngModelChange", function SwitchComponent_Template_input_ngModelChange_2_listener($event) {
        return ctx.onChangeSwitch($event);
      });
      \u0275\u0275elementEnd();
      \u0275\u0275elementStart(3, "span", 2);
      \u0275\u0275element(4, "span", 3);
      \u0275\u0275elementEnd();
      \u0275\u0275projection(5, 1);
      \u0275\u0275elementEnd();
    }
    if (rf & 2) {
      \u0275\u0275property("ngClass", ctx.size());
      \u0275\u0275attribute("for", ctx.name());
      \u0275\u0275advance(2);
      \u0275\u0275property("ngModel", ctx.modelValue);
      \u0275\u0275attribute("id", ctx.name())("name", ctx.name());
    }
  }, dependencies: [FormsModule, CheckboxControlValueAccessor, NgControlStatus, NgModel, NgClass], styles: ["/* angular:styles/component:scss;11cce97f128544a5a4754a21c322f565df446e7c5653a1c9aa5ae92e836f605f;/Users/khripunovpavel/Documents/my/lasagna/lasagna/src/app/features/controls/form/switch.component.ts */\n.lg-switch {\n  display: inline-flex;\n  align-items: center;\n  gap: 8px;\n  cursor: pointer;\n  border-radius: 9999px;\n}\n.switch {\n  display: none;\n}\n.lg-switch__track {\n  position: relative;\n  display: inline-flex;\n  align-items: center;\n  width: 42px;\n  height: 24px;\n  background-color: var(--control-bg, #ccc);\n  border-radius: 9999px;\n  transition: background-color 0.2s ease-in-out;\n}\n.lg-switch__thumb {\n  position: absolute;\n  left: 2px;\n  width: 20px;\n  height: 20px;\n  background-color: #fff;\n  border-radius: 50%;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);\n  transition: transform 0.2s ease-in-out;\n}\n.switch:checked + .lg-switch__track {\n  background-color: var(--control-bg-selected, #4caf50);\n}\n.switch:checked + .lg-switch__track .lg-switch__thumb {\n  transform: translateX(18px);\n}\n.lg-switch.small .lg-switch__track {\n  width: 28px;\n  height: 16px;\n}\n.lg-switch.small .lg-switch__thumb {\n  width: 12px;\n  height: 12px;\n  left: 2px;\n}\n.lg-switch.small .switch:checked + .lg-switch__track .lg-switch__thumb {\n  transform: translateX(12px);\n}\n.lg-switch.medium .lg-switch__track {\n  width: 36px;\n  height: 20px;\n}\n.lg-switch.medium .lg-switch__thumb {\n  width: 16px;\n  height: 16px;\n  left: 2px;\n}\n.lg-switch.medium .switch:checked + .lg-switch__track .lg-switch__thumb {\n  transform: translateX(16px);\n}\n/*# sourceMappingURL=switch.component.css.map */\n"], encapsulation: 2 });
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(SwitchComponent, [{
    type: Component,
    args: [{ selector: "lg-switch", standalone: true, template: `
    <label class="lg-switch"
           [ngClass]="size()"
           [attr.for]="name()"
           tabindex="0">

      <ng-content select="[slot='left']"></ng-content>

      <input type="checkbox"
             class="switch"
             [attr.id]="name()"
             [attr.name]="name()"
             [ngModel]="modelValue"
             (ngModelChange)="onChangeSwitch($event)"/>

      <span class="lg-switch__track">
        <span class="lg-switch__thumb"></span>
      </span>

      <ng-content select="[slot='right']"></ng-content>
    </label>
  `, encapsulation: ViewEncapsulation.None, providers: [{
      provide: NG_VALUE_ACCESSOR,
      useExisting: forwardRef(() => SwitchComponent),
      multi: true
    }], imports: [
      FormsModule,
      NgClass
    ], styles: ["/* angular:styles/component:scss;11cce97f128544a5a4754a21c322f565df446e7c5653a1c9aa5ae92e836f605f;/Users/khripunovpavel/Documents/my/lasagna/lasagna/src/app/features/controls/form/switch.component.ts */\n.lg-switch {\n  display: inline-flex;\n  align-items: center;\n  gap: 8px;\n  cursor: pointer;\n  border-radius: 9999px;\n}\n.switch {\n  display: none;\n}\n.lg-switch__track {\n  position: relative;\n  display: inline-flex;\n  align-items: center;\n  width: 42px;\n  height: 24px;\n  background-color: var(--control-bg, #ccc);\n  border-radius: 9999px;\n  transition: background-color 0.2s ease-in-out;\n}\n.lg-switch__thumb {\n  position: absolute;\n  left: 2px;\n  width: 20px;\n  height: 20px;\n  background-color: #fff;\n  border-radius: 50%;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);\n  transition: transform 0.2s ease-in-out;\n}\n.switch:checked + .lg-switch__track {\n  background-color: var(--control-bg-selected, #4caf50);\n}\n.switch:checked + .lg-switch__track .lg-switch__thumb {\n  transform: translateX(18px);\n}\n.lg-switch.small .lg-switch__track {\n  width: 28px;\n  height: 16px;\n}\n.lg-switch.small .lg-switch__thumb {\n  width: 12px;\n  height: 12px;\n  left: 2px;\n}\n.lg-switch.small .switch:checked + .lg-switch__track .lg-switch__thumb {\n  transform: translateX(12px);\n}\n.lg-switch.medium .lg-switch__track {\n  width: 36px;\n  height: 20px;\n}\n.lg-switch.medium .lg-switch__thumb {\n  width: 16px;\n  height: 16px;\n  left: 2px;\n}\n.lg-switch.medium .switch:checked + .lg-switch__track .lg-switch__thumb {\n  transform: translateX(16px);\n}\n/*# sourceMappingURL=switch.component.css.map */\n"] }]
  }], null, { onKeydown: [{
    type: HostListener,
    args: ["keydown.enter", ["$event"]]
  }, {
    type: HostListener,
    args: ["keydown.space", ["$event"]]
  }] });
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(SwitchComponent, { className: "SwitchComponent", filePath: "src/app/features/controls/form/switch.component.ts", lineNumber: 117 });
})();

// src/app/features/recipes/view/add-recipe-form/add-recipe-form.component.ts
var _c04 = ["tooltipComponent"];
var _c12 = ["products"];
var _c2 = ["productsSelector"];
var _c3 = ["nameField"];
var _c4 = (a0) => ({ unit: a0 });
var _forTrack02 = ($index, $item) => $item.value.amount + $index + 1;
function AddRecipeFormComponent_Conditional_0_For_23_ng_template_7_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0);
    \u0275\u0275pipe(1, "userCurrency");
    \u0275\u0275element(2, "span", 38);
    \u0275\u0275pipe(3, "unitString");
    \u0275\u0275pipe(4, "translate");
  }
  if (rf & 2) {
    const item_r6 = ctx.$implicit;
    const ctx_r4 = \u0275\u0275nextContext(3);
    \u0275\u0275textInterpolate2(" ", ctx_r4.productLabelFactory(item_r6), " / ", \u0275\u0275pipeBind2(1, 4, item_r6.pricePerUnit, ctx_r4.pipesDigits()), " ");
    \u0275\u0275advance(2);
    \u0275\u0275property("translateParams", \u0275\u0275pureFunction1(11, _c4, \u0275\u0275pipeBind1(4, 9, \u0275\u0275pipeBind1(3, 7, item_r6 == null ? null : item_r6.unit))))("translate", "per-unit.label");
  }
}
function AddRecipeFormComponent_Conditional_0_For_23_ng_template_8_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0);
    \u0275\u0275pipe(1, "userCurrency");
    \u0275\u0275element(2, "span", 38);
    \u0275\u0275pipe(3, "unitString");
    \u0275\u0275pipe(4, "translate");
  }
  if (rf & 2) {
    const item_r7 = ctx.$implicit;
    const ctx_r4 = \u0275\u0275nextContext(3);
    \u0275\u0275textInterpolate2(" ", ctx_r4.productLabelFactory(item_r7), " / ", \u0275\u0275pipeBind2(1, 4, item_r7.pricePerUnit, ctx_r4.pipesDigits()), " ");
    \u0275\u0275advance(2);
    \u0275\u0275property("translateParams", \u0275\u0275pureFunction1(11, _c4, \u0275\u0275pipeBind1(4, 9, \u0275\u0275pipeBind1(3, 7, item_r7 == null ? null : item_r7.unit))))("translate", "per-unit.label");
  }
}
function AddRecipeFormComponent_Conditional_0_For_23_ng_template_17_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "lg-unit-switcher", 39);
  }
}
function AddRecipeFormComponent_Conditional_0_For_23_Conditional_21_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "hr", 37);
  }
}
function AddRecipeFormComponent_Conditional_0_For_23_Template(rf, ctx) {
  if (rf & 1) {
    const _r2 = \u0275\u0275getCurrentView();
    \u0275\u0275elementContainerStart(0, 11);
    \u0275\u0275elementStart(1, "lg-flex-row", 25)(2, "lg-entity-item-selector", 26)(3, "lg-multiselect", 27);
    \u0275\u0275pipe(4, "translate");
    \u0275\u0275listener("onSelected", function AddRecipeFormComponent_Conditional_0_For_23_Template_lg_multiselect_onSelected_3_listener() {
      const \u0275$index_38_r3 = \u0275\u0275restoreView(_r2).$index;
      const amount_r4 = \u0275\u0275reference(14);
      const ctx_r4 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r4.onIngredientSelected(amount_r4, \u0275$index_38_r3, ["product_id", "name"]));
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "lg-multiselect", 28);
    \u0275\u0275pipe(6, "translate");
    \u0275\u0275listener("onSelected", function AddRecipeFormComponent_Conditional_0_For_23_Template_lg_multiselect_onSelected_5_listener() {
      const \u0275$index_38_r3 = \u0275\u0275restoreView(_r2).$index;
      const amount_r4 = \u0275\u0275reference(14);
      const ctx_r4 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r4.onIngredientSelected(amount_r4, \u0275$index_38_r3, ["recipe_id", "name"]));
    });
    \u0275\u0275template(7, AddRecipeFormComponent_Conditional_0_For_23_ng_template_7_Template, 5, 13, "ng-template", 29)(8, AddRecipeFormComponent_Conditional_0_For_23_ng_template_8_Template, 5, 13, "ng-template", 30);
    \u0275\u0275elementEnd();
    \u0275\u0275element(9, "lg-input", 31);
    \u0275\u0275pipe(10, "translate");
    \u0275\u0275elementStart(11, "div", 32);
    \u0275\u0275element(12, "mat-icon", 13);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(13, "lg-number-input", 33, 1);
    \u0275\u0275pipe(15, "translate");
    \u0275\u0275pipe(16, "translate");
    \u0275\u0275listener("onKeydown", function AddRecipeFormComponent_Conditional_0_For_23_Template_lg_number_input_onKeydown_13_listener() {
      \u0275\u0275restoreView(_r2);
      const ctx_r4 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r4.addLast());
    });
    \u0275\u0275template(17, AddRecipeFormComponent_Conditional_0_For_23_ng_template_17_Template, 1, 0, "ng-template", 34);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(18, "div")(19, "lg-button", 35);
    \u0275\u0275listener("click", function AddRecipeFormComponent_Conditional_0_For_23_Template_lg_button_click_19_listener() {
      const \u0275$index_38_r3 = \u0275\u0275restoreView(_r2).$index;
      const ctx_r4 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r4.deleteIngredient(\u0275$index_38_r3));
    });
    \u0275\u0275element(20, "mat-icon", 36);
    \u0275\u0275elementEnd()()();
    \u0275\u0275conditionalCreate(21, AddRecipeFormComponent_Conditional_0_For_23_Conditional_21_Template, 1, 0, "hr", 37);
    \u0275\u0275elementContainerEnd();
  }
  if (rf & 2) {
    const \u0275$index_38_r3 = ctx.$index;
    const \u0275$count_38_r8 = ctx.$count;
    const ctx_r4 = \u0275\u0275nextContext(2);
    \u0275\u0275property("formGroupName", \u0275$index_38_r3);
    \u0275\u0275advance();
    \u0275\u0275property("bottom", true)("mobileMode", true);
    \u0275\u0275advance(2);
    \u0275\u0275property("resource", "recipes")("placeholder", \u0275\u0275pipeBind1(4, 19, "recipe.form.ingredients.recipe_id.label"))("autoLoad", true);
    \u0275\u0275advance(2);
    \u0275\u0275property("resource", "products")("labelFactory", ctx_r4.productLabelFactory)("optionFactory", ctx_r4.productLabelFactory)("placeholder", \u0275\u0275pipeBind1(6, 21, "recipe.form.ingredients.product_id.label"))("autoLoad", true);
    \u0275\u0275advance(4);
    \u0275\u0275property("placeholder", \u0275\u0275pipeBind1(10, 23, "recipe.form.ingredients.new_product_name.label"));
    \u0275\u0275advance(3);
    \u0275\u0275property("inline", true);
    \u0275\u0275advance();
    \u0275\u0275property("placeholder", \u0275\u0275pipeBind2(16, 27, "recipe.form.ingredients.amount.placeholder", \u0275\u0275pureFunction1(30, _c4, \u0275\u0275pipeBind1(15, 25, "unit.long." + ((ctx_r4.form.value.ingredients == null ? null : ctx_r4.form.value.ingredients[\u0275$index_38_r3] == null ? null : ctx_r4.form.value.ingredients[\u0275$index_38_r3].unit) || ctx_r4.UnitValue.GRAM)))));
    \u0275\u0275advance(6);
    \u0275\u0275styleMap("danger");
    \u0275\u0275property("flat", true)("icon", true);
    \u0275\u0275advance(2);
    \u0275\u0275conditional(!(\u0275$index_38_r3 === \u0275$count_38_r8 - 1) ? 21 : -1);
  }
}
function AddRecipeFormComponent_Conditional_0_Conditional_46_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "lg-chips-list", 24);
  }
  if (rf & 2) {
    \u0275\u0275nextContext();
    const categorySelect_r9 = \u0275\u0275reference(45);
    const ctx_r4 = \u0275\u0275nextContext();
    \u0275\u0275property("control", categorySelect_r9)("items", ctx_r4.topCategories());
  }
}
function AddRecipeFormComponent_Conditional_0_Template(rf, ctx) {
  if (rf & 1) {
    const _r1 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "form", 3)(1, "lg-flex-column")(2, "lg-card")(3, "lg-flex-column", 4)(4, "lg-control", 5);
    \u0275\u0275pipe(5, "translate");
    \u0275\u0275element(6, "lg-input", 6, 0);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(8, "lg-control", 5);
    \u0275\u0275pipe(9, "translate");
    \u0275\u0275elementStart(10, "lg-control-box", 7);
    \u0275\u0275element(11, "lg-html-editor", 8);
    \u0275\u0275elementEnd()()()();
    \u0275\u0275elementStart(12, "lg-card")(13, "lg-flex-column", 4)(14, "lg-control", 5);
    \u0275\u0275pipe(15, "translate");
    \u0275\u0275element(16, "lg-number-input", 9, 1);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(18, "lg-control-group", 5);
    \u0275\u0275pipe(19, "translate");
    \u0275\u0275elementStart(20, "lg-flex-column", 4)(21, "lg-flex-column", 10);
    \u0275\u0275repeaterCreate(22, AddRecipeFormComponent_Conditional_0_For_23_Template, 22, 32, "ng-container", 11, _forTrack02);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(24, "lg-button", 12);
    \u0275\u0275listener("click", function AddRecipeFormComponent_Conditional_0_Template_lg_button_click_24_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r4 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r4.addIngredient());
    });
    \u0275\u0275element(25, "mat-icon", 13);
    \u0275\u0275text(26);
    \u0275\u0275pipe(27, "translate");
    \u0275\u0275elementEnd()()()()();
    \u0275\u0275elementStart(28, "lg-flex-row", 14)(29, "lg-control-box", 15)(30, "lg-switch", 16)(31, "span", 17);
    \u0275\u0275text(32);
    \u0275\u0275pipe(33, "translate");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(34, "span", 18);
    \u0275\u0275text(35);
    \u0275\u0275pipe(36, "translate");
    \u0275\u0275elementEnd()()()();
    \u0275\u0275elementStart(37, "lg-flex-row", 19)(38, "lg-control", 20);
    \u0275\u0275pipe(39, "translate");
    \u0275\u0275element(40, "lg-tags-control", 21);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(41, "lg-control", 20);
    \u0275\u0275pipe(42, "translate");
    \u0275\u0275elementStart(43, "lg-flex-column", 22);
    \u0275\u0275element(44, "lg-multiselect", 23, 2);
    \u0275\u0275conditionalCreate(46, AddRecipeFormComponent_Conditional_0_Conditional_46_Template, 1, 2, "lg-chips-list", 24);
    \u0275\u0275elementEnd()()()()();
  }
  if (rf & 2) {
    const ctx_r4 = \u0275\u0275nextContext();
    \u0275\u0275property("formGroup", ctx_r4.form);
    \u0275\u0275advance(3);
    \u0275\u0275property("position", "start");
    \u0275\u0275advance();
    \u0275\u0275property("label", \u0275\u0275pipeBind1(5, 28, "recipe.form.name.placeholder"));
    \u0275\u0275advance(4);
    \u0275\u0275property("label", \u0275\u0275pipeBind1(9, 30, "recipe.form.description.placeholder"));
    \u0275\u0275advance(3);
    \u0275\u0275property("placeholder", "");
    \u0275\u0275advance(2);
    \u0275\u0275property("position", "start");
    \u0275\u0275advance();
    \u0275\u0275property("label", \u0275\u0275pipeBind1(15, 32, "recipe.form.outcome_amount.placeholder"));
    \u0275\u0275advance(4);
    \u0275\u0275property("label", \u0275\u0275interpolate(\u0275\u0275pipeBind1(19, 34, "recipe.form.ingredients.label")));
    \u0275\u0275advance(2);
    \u0275\u0275property("position", "start");
    \u0275\u0275advance();
    \u0275\u0275property("size", "medium");
    \u0275\u0275advance();
    \u0275\u0275repeater(ctx_r4.ingredients.controls);
    \u0275\u0275advance(2);
    \u0275\u0275property("outlined", true)("size", "small");
    \u0275\u0275advance();
    \u0275\u0275property("inline", true);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", \u0275\u0275pipeBind1(27, 36, "recipe.form.ingredients.add-btn"), " ");
    \u0275\u0275advance(2);
    \u0275\u0275property("mobileMode", true);
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(\u0275\u0275pipeBind1(33, 38, "recipe.form.chunk.label"));
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate(\u0275\u0275pipeBind1(36, 40, "recipe.form.master.label"));
    \u0275\u0275advance(2);
    \u0275\u0275property("equal", true)("mobileMode", true);
    \u0275\u0275advance();
    \u0275\u0275property("label", \u0275\u0275pipeBind1(39, 42, "recipe.form.tags.placeholder"));
    \u0275\u0275advance(2);
    \u0275\u0275property("multi", true)("resource", "tags");
    \u0275\u0275advance();
    \u0275\u0275property("label", \u0275\u0275pipeBind1(42, 44, "recipe.form.category.placeholder"));
    \u0275\u0275advance(2);
    \u0275\u0275property("position", "start")("size", "medium");
    \u0275\u0275advance();
    \u0275\u0275property("resource", "recipes-categories");
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r4.topCategories().length ? 46 : -1);
  }
}
var AddRecipeFormComponent = class _AddRecipeFormComponent {
  _recipesRepository;
  _selectResourcesService;
  _router;
  _aRoute;
  _notificationsService;
  _settingsService;
  _controlContainer;
  constructor(_recipesRepository, _selectResourcesService, _router, _aRoute, _notificationsService, _settingsService, _controlContainer) {
    this._recipesRepository = _recipesRepository;
    this._selectResourcesService = _selectResourcesService;
    this._router = _router;
    this._aRoute = _aRoute;
    this._notificationsService = _notificationsService;
    this._settingsService = _settingsService;
    this._controlContainer = _controlContainer;
  }
  precisions = computed(() => this._settingsService.settingsSignal()?.getSetting(SettingsKeysConst.pricePrecision)?.data ?? 2, ...ngDevMode ? [{ debugName: "precisions" }] : []);
  pipesDigits = computed(() => `1.0-${this.precisions()}`, ...ngDevMode ? [{ debugName: "pipesDigits" }] : []);
  editMode = input(false, ...ngDevMode ? [{ debugName: "editMode" }] : []);
  recipe = input(void 0, ...ngDevMode ? [{ debugName: "recipe" }] : []);
  uuid = injectParams("uuid");
  form;
  recipeFieldState = signal({}, ...ngDevMode ? [{ debugName: "recipeFieldState" }] : []);
  tooltipComponent = viewChildren("tooltipComponent", ...ngDevMode ? [{ debugName: "tooltipComponent" }] : []);
  productsWidget = viewChildren("products", ...ngDevMode ? [{ debugName: "productsWidget" }] : []);
  productsSelector = viewChildren("productsSelector", ...ngDevMode ? [{ debugName: "productsSelector" }] : []);
  nameField = viewChild("nameField", ...ngDevMode ? [{ debugName: "nameField" }] : []);
  topCategories = signal([], ...ngDevMode ? [{ debugName: "topCategories" }] : []);
  UnitValue = UnitValue;
  productLabelFactory = inject(productLabelFactoryProvider);
  recipeEffect = effect(() => {
    if (this.recipe()) {
      this.fillForm(this.recipe());
    }
  }, ...ngDevMode ? [{ debugName: "recipeEffect" }] : []);
  get ingredients() {
    return this.form?.get("ingredients") || void 0;
  }
  ngOnInit() {
    this.form = this._controlContainer.control;
    this._loadUsingHistory();
  }
  ngAfterViewInit() {
    this._selectResourcesService.load().then((resources) => {
      if (!this.editMode()) {
        this.nameField().focus();
      }
    }).catch((err) => {
      this._notificationsService.error(errorHandler(err));
    });
  }
  fillForm(recipe) {
    this.form?.reset({
      ingredients: []
    });
    this.ingredients.clear();
    if (!recipe) {
      return;
    }
    this.form?.reset(__spreadProps(__spreadValues({}, recipeToFormValue(recipe)), {
      ingredients: []
    }));
    if (recipe.ingredients.length) {
      recipe.ingredients.forEach((ingredient, index) => {
        this.ingredients.push(this._getIngredientGroup(ingredient));
        if (ingredient.recipe_id) {
          this.openRecipeField(index);
        }
      });
    } else {
      this.ingredients.push(this._getIngredientGroup());
    }
    this.form?.updateValueAndValidity();
    this.form?.markAsPristine();
  }
  resetForm(recipe) {
    this.fillForm(recipe);
    this._loadUsingHistory();
    this.form?.markAsPristine();
  }
  addLast() {
    const lastControl = this.ingredients.at(this.ingredients.length - 1);
    if (lastControl.value.name || lastControl.value.amount || lastControl.value.product_id) {
      this.addIngredient();
    }
  }
  addIngredient() {
    this.ingredients.push(this._getIngredientGroup());
    this.form?.markAsDirty();
  }
  deleteIngredient(index) {
    this.ingredients.removeAt(index);
    this.form?.markAsDirty();
  }
  onIngredientSelected(amount, index, clearField) {
    amount.focus();
    const value = this.ingredients.at(index).value;
    this.ingredients.at(index).patchValue(__spreadProps(__spreadValues({}, Array.isArray(clearField) ? clearField.reduce((acc, field) => __spreadProps(__spreadValues({}, acc), {
      [field]: null
    }), {}) : { [clearField]: null }), {
      unit: value.product_id?.unit || value.recipe_id?.unit || UnitValue.GRAM
    }));
  }
  openRecipeField(index) {
    this.recipeFieldState.update((value) => {
      return __spreadProps(__spreadValues({}, value), {
        [index]: true
      });
    });
  }
  closeRecipeField(index) {
    this.recipeFieldState.update((value) => {
      return __spreadProps(__spreadValues({}, value), {
        [index]: false
      });
    });
  }
  _getIngredientGroup = (ingredient) => {
    return getIngredientGroup(this.form, ingredient, this.uuid());
  };
  _loadUsingHistory() {
    this._recipesRepository.getTopCategories().then((categories) => {
      this.topCategories.set(categories.map((category) => ({
        label: category.name,
        value: {
          uuid: category.uuid,
          name: category.name
        }
      })));
    });
  }
  static \u0275fac = function AddRecipeFormComponent_Factory(__ngFactoryType__) {
    return new (__ngFactoryType__ || _AddRecipeFormComponent)(\u0275\u0275directiveInject(RecipesRepository), \u0275\u0275directiveInject(SelectResourcesService), \u0275\u0275directiveInject(Router), \u0275\u0275directiveInject(ActivatedRoute), \u0275\u0275directiveInject(NotificationsService), \u0275\u0275directiveInject(SettingsService), \u0275\u0275directiveInject(ControlContainer));
  };
  static \u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _AddRecipeFormComponent, selectors: [["lg-add-recipe-form"]], viewQuery: function AddRecipeFormComponent_Query(rf, ctx) {
    if (rf & 1) {
      \u0275\u0275viewQuerySignal(ctx.tooltipComponent, _c04, 5);
      \u0275\u0275viewQuerySignal(ctx.productsWidget, _c12, 5);
      \u0275\u0275viewQuerySignal(ctx.productsSelector, _c2, 5);
      \u0275\u0275viewQuerySignal(ctx.nameField, _c3, 5);
    }
    if (rf & 2) {
      \u0275\u0275queryAdvance(4);
    }
  }, inputs: { editMode: [1, "editMode"], recipe: [1, "recipe"] }, features: [\u0275\u0275ProvidersFeature([
    {
      provide: SelectResourcesService,
      useClass: SelectResourcesService
    }
  ])], decls: 1, vars: 1, consts: [["nameField", ""], ["amount", ""], ["categorySelect", ""], [3, "formGroup"], [3, "position"], ["lgExpand", "", 3, "label"], ["formControlName", "name", "placeholder", ""], ["lgExpand", "", 2, "--control-box-bg", "var(--control-bg)"], ["formControlName", "description", 3, "placeholder"], ["formControlName", "portions", "lgParseMath", "", "placeholder", ""], ["formArrayName", "ingredients", "lgExpand", "", 3, "size"], [3, "formGroupName"], [3, "click", "outlined", "size"], ["aria-hidden", "false", "fontIcon", "add", 3, "inline"], [3, "mobileMode"], ["lgSelfStart", "", "lgWidth", "50%", 2, "--control-box-bg", "var(--hr-bg-strong)"], ["formControlName", "master"], ["slot", "left", 1, "text-center"], ["slot", "right", 1, "text-center"], [2, "--control-bg", "var(--hr-bg-strong)", 3, "equal", "mobileMode"], [3, "label"], ["formControlName", "tags", 3, "multi", "resource"], [3, "position", "size"], ["appendTo", "body", "formControlName", "category_id", "lgExpand", "", 3, "resource"], [3, "control", "items"], ["size", "medium", 3, "bottom", "mobileMode"], ["lgExpand", "", "formControlName", "active_tab"], ["appendTo", "body", "formControlName", "recipe_id", "ngProjectAs", "recipes", 5, ["recipes"], 3, "onSelected", "resource", "placeholder", "autoLoad"], ["appendTo", "body", "formControlName", "product_id", "ngProjectAs", "products", 5, ["products"], 3, "onSelected", "resource", "labelFactory", "optionFactory", "placeholder", "autoLoad"], ["lgControlTpl", "", "type", "label"], ["lgControlTpl", "", "type", "option"], ["ngProjectAs", "custom", "formControlName", "new_product_name", 5, ["custom"], 3, "placeholder"], ["ngProjectAs", "custom-title", 5, ["custom-title"]], ["lgParseMath", "", "lgWidth", "40%", "formControlName", "amount", 3, "onKeydown", "placeholder"], ["lgExtraTpl", "", "place", "after"], [3, "click", "flat", "icon"], ["aria-hidden", "false", "fontIcon", "close"], ["size", "2", "lgExpand", "", "color", "#fafafa"], [3, "translateParams", "translate"], ["formControlName", "unit"]], template: function AddRecipeFormComponent_Template(rf, ctx) {
    if (rf & 1) {
      \u0275\u0275conditionalCreate(0, AddRecipeFormComponent_Conditional_0_Template, 47, 46, "form", 3);
    }
    if (rf & 2) {
      \u0275\u0275conditional(ctx.form ? 0 : -1);
    }
  }, dependencies: [
    ReactiveFormsModule,
    \u0275NgNoValidate,
    NgControlStatus,
    NgControlStatusGroup,
    FormGroupDirective,
    FormControlName,
    FormGroupName,
    FormArrayName,
    ControlGroupComponent,
    FlexColumnComponent,
    ButtonComponent,
    MultiselectComponent,
    NumberInputComponent,
    ExpandDirective,
    ParseMathDirective,
    ChipsListComponent,
    FormsModule,
    MatIcon,
    UnitSwitcherComponent,
    CardComponent,
    ControlExtraTemplateDirective,
    TagsControlComponent,
    FlexRowComponent,
    ControlComponent,
    EntityItemSelectorComponent,
    SwitchComponent,
    InputComponent,
    ControlBoxComponent,
    SelfStartDirective,
    WidthDirective,
    HtmlEditorComponent,
    ControlTemplateDirective,
    TranslateDirective,
    TranslatePipe,
    UserCurrencyPipe,
    UnitStringPipe
  ], encapsulation: 2, changeDetection: 0 });
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(AddRecipeFormComponent, [{
    type: Component,
    args: [{ selector: "lg-add-recipe-form", standalone: true, changeDetection: ChangeDetectionStrategy.OnPush, imports: [
      ReactiveFormsModule,
      ControlGroupComponent,
      FlexColumnComponent,
      ButtonComponent,
      MultiselectComponent,
      NumberInputComponent,
      ExpandDirective,
      ParseMathDirective,
      ChipsListComponent,
      FormsModule,
      MatIcon,
      TranslatePipe,
      UnitSwitcherComponent,
      CardComponent,
      ControlExtraTemplateDirective,
      TagsControlComponent,
      FlexRowComponent,
      ControlComponent,
      EntityItemSelectorComponent,
      SwitchComponent,
      InputComponent,
      ControlBoxComponent,
      SelfStartDirective,
      WidthDirective,
      HtmlEditorComponent,
      ControlTemplateDirective,
      UserCurrencyPipe,
      UnitStringPipe,
      TranslateDirective
    ], providers: [
      {
        provide: SelectResourcesService,
        useClass: SelectResourcesService
      }
    ], template: `@if (form) {
  <form [formGroup]="form">
    <lg-flex-column>
      <lg-card>
        <lg-flex-column [position]="'start'">
          <lg-control [label]="'recipe.form.name.placeholder'|translate"
                      lgExpand>
            <lg-input #nameField
                      formControlName="name"
                      placeholder=""
            ></lg-input>
          </lg-control>

          <lg-control [label]="'recipe.form.description.placeholder'|translate"
                      lgExpand>
            <lg-control-box lgExpand
                            style="--control-box-bg: var(--control-bg)">
              <lg-html-editor [placeholder]="''"
                              formControlName="description"></lg-html-editor>
            </lg-control-box>
          </lg-control>
        </lg-flex-column>
      </lg-card>
      <lg-card>

        <lg-flex-column [position]="'start'">
          <lg-control [label]="'recipe.form.outcome_amount.placeholder'|translate"
                      lgExpand>
            <lg-number-input #amount
                             formControlName="portions"
                             lgParseMath
                             placeholder=""></lg-number-input>
          </lg-control>

          <lg-control-group label="{{ 'recipe.form.ingredients.label'|translate }}" lgExpand>
            <lg-flex-column [position]="'start'">
              <lg-flex-column [size]="'medium'"
                              formArrayName="ingredients"
                              lgExpand>
                @for (control of ingredients.controls; track (control.value.amount + i + 1); let i = $index,
                  last = $last) {
                  <ng-container [formGroupName]="i">
                    <lg-flex-row [bottom]="true"
                                 size="medium"
                                 [mobileMode]="true">
                      <lg-entity-item-selector lgExpand
                                               formControlName="active_tab">
                        <lg-multiselect [resource]="'recipes'"
                                        appendTo="body"
                                        (onSelected)="onIngredientSelected(amount, i, ['product_id', 'name'])"
                                        [placeholder]="'recipe.form.ingredients.recipe_id.label' | translate"
                                        formControlName="recipe_id"
                                        ngProjectAs="recipes"
                                        [autoLoad]="true"></lg-multiselect>

                        <lg-multiselect [resource]="'products'"
                                        appendTo="body"
                                        (onSelected)="onIngredientSelected(amount, i, ['recipe_id', 'name'])"
                                        [labelFactory]="productLabelFactory"
                                        [optionFactory]="productLabelFactory"
                                        formControlName="product_id"
                                        [placeholder]="'recipe.form.ingredients.product_id.label' | translate"
                                        ngProjectAs="products"
                                        [autoLoad]="true">
                          <ng-template lgControlTpl type="label" let-item>
                            {{ productLabelFactory(item) }} / {{ item.pricePerUnit | userCurrency:pipesDigits() }}
                            <span [translateParams]="{unit:$any(item)?.unit | unitString | translate}"
                                  [translate]="'per-unit.label'"></span>
                          </ng-template>
                          <ng-template lgControlTpl type="option" let-item>
                            {{ productLabelFactory(item) }} / {{ item.pricePerUnit | userCurrency:pipesDigits() }}
                            <span [translateParams]="{unit:$any(item)?.unit | unitString | translate}"
                                  [translate]="'per-unit.label'"></span>
                          </ng-template>
                        </lg-multiselect>

                        <lg-input ngProjectAs="custom"
                                  formControlName="new_product_name"
                                  [placeholder]="'recipe.form.ingredients.new_product_name.label' | translate"></lg-input>
                        <div ngProjectAs="custom-title">
                          <mat-icon [inline]="true"
                                    aria-hidden="false"
                                    fontIcon="add"></mat-icon>
                        </div>
                      </lg-entity-item-selector>

                      <lg-number-input #amount
                                       lgParseMath
                                       lgWidth="40%"
                                       (onKeydown)="addLast()"
                                       [placeholder]="'recipe.form.ingredients.amount.placeholder'|translate:{unit:('unit.long.'+(form.value.ingredients?.[i]?.unit || UnitValue.GRAM)|translate)}"
                                       formControlName="amount">
                        <ng-template lgExtraTpl place="after">
                          <lg-unit-switcher formControlName="unit">
                          </lg-unit-switcher>
                        </ng-template>
                      </lg-number-input>

                      <div>
                        <lg-button [style]="'danger'"
                                   [flat]="true"
                                   [icon]="true"
                                   (click)="deleteIngredient(i)">
                          <mat-icon aria-hidden="false" fontIcon="close"></mat-icon>
                        </lg-button>
                      </div>

                    </lg-flex-row>
                    @if (!last) {
                      <hr size="2" lgExpand color="#fafafa"/>
                    }
                  </ng-container>
                }
              </lg-flex-column>

              <lg-button (click)="addIngredient()"
                         [outlined]="true"
                         [size]="'small'">
                <mat-icon [inline]="true"
                          aria-hidden="false"
                          fontIcon="add"></mat-icon>
                {{ 'recipe.form.ingredients.add-btn'|translate }}
              </lg-button>
            </lg-flex-column>
          </lg-control-group>
        </lg-flex-column>
      </lg-card>

      <lg-flex-row [mobileMode]="true">
        <lg-control-box lgSelfStart lgWidth="50%" style="--control-box-bg: var(--hr-bg-strong)">
          <lg-switch formControlName="master">
            <span class="text-center" slot="left">{{ 'recipe.form.chunk.label' | translate }}</span>
            <span class="text-center" slot="right">{{ 'recipe.form.master.label' | translate }}</span>
          </lg-switch>
        </lg-control-box>
      </lg-flex-row>

      <lg-flex-row [equal]="true" [mobileMode]="true" style="--control-bg: var(--hr-bg-strong)">
        <lg-control [label]="'recipe.form.tags.placeholder'|translate">
          <lg-tags-control [multi]="true"
                           [resource]="'tags'"
                           formControlName="tags"></lg-tags-control>
        </lg-control>

        <lg-control [label]="'recipe.form.category.placeholder'|translate">
          <lg-flex-column [position]="'start'" [size]="'medium'">
            <lg-multiselect #categorySelect
                            [resource]="'recipes-categories'"
                            appendTo="body"
                            formControlName="category_id"
                            lgExpand>
            </lg-multiselect>

            @if (topCategories().length) {
              <lg-chips-list [control]="categorySelect" [items]="topCategories()"></lg-chips-list>
            }
          </lg-flex-column>
        </lg-control>
      </lg-flex-row>
    </lg-flex-column>
  </form>
}
` }]
  }], () => [{ type: RecipesRepository }, { type: SelectResourcesService }, { type: Router }, { type: ActivatedRoute }, { type: NotificationsService }, { type: SettingsService }, { type: ControlContainer }], null);
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(AddRecipeFormComponent, { className: "AddRecipeFormComponent", filePath: "src/app/features/recipes/view/add-recipe-form/add-recipe-form.component.ts", lineNumber: 101 });
})();

// src/app/features/recipes/view/add-recipe/add-recipe.component.ts
function AddRecipeComponent_Conditional_0_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "lg-controls-bar", 0)(1, "lg-button", 6);
    \u0275\u0275pipe(2, "translate");
    \u0275\u0275element(3, "mat-icon", 7);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    \u0275\u0275advance();
    \u0275\u0275styleMap("primary");
    \u0275\u0275property("icon", true)("link", "/recipes/add")("size", "small")("label", \u0275\u0275pipeBind1(2, 6, "recipe.form.add-new-btn"));
  }
}
function AddRecipeComponent_Conditional_4_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "p");
    \u0275\u0275text(1);
    \u0275\u0275pipe(2, "translate");
    \u0275\u0275elementStart(3, "a", 8);
    \u0275\u0275text(4);
    \u0275\u0275pipe(5, "translate");
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", \u0275\u0275pipeBind1(2, 4, "recipe.added-informer"), " ");
    \u0275\u0275advance(2);
    \u0275\u0275property("routerLink", \u0275\u0275interpolate1("/recipes/edit/", ctx));
    \u0275\u0275advance();
    \u0275\u0275textInterpolate(\u0275\u0275pipeBind1(5, 6, "recipe.added-informer.link"));
  }
}
function AddRecipeComponent_Conditional_5_Conditional_4_ng_template_0_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "lg-fade-in")(1, "span", 13);
    \u0275\u0275text(2);
    \u0275\u0275pipe(3, "translate");
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(\u0275\u0275pipeBind1(3, 1, "saved-draft-label"));
  }
}
function AddRecipeComponent_Conditional_5_Conditional_4_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275template(0, AddRecipeComponent_Conditional_5_Conditional_4_ng_template_0_Template, 4, 3, "ng-template", 11);
  }
}
function AddRecipeComponent_Conditional_5_ng_template_5_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "lg-button", 14);
    \u0275\u0275text(1);
    \u0275\u0275pipe(2, "translate");
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    let tmp_5_0;
    const ctx_r0 = \u0275\u0275nextContext(2);
    \u0275\u0275styleMap("default");
    \u0275\u0275property("flat", true)("disabled", !!ctx_r0.draftRef())("link", "/recipes/calculate/" + ((tmp_5_0 = ctx_r0.recipe()) == null ? null : tmp_5_0.uuid));
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", \u0275\u0275pipeBind1(2, 6, "recipe.calculate-btn"), " ");
  }
}
function AddRecipeComponent_Conditional_5_Conditional_6_ng_template_0_Template(rf, ctx) {
  if (rf & 1) {
    const _r2 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "lg-button", 15);
    \u0275\u0275listener("click", function AddRecipeComponent_Conditional_5_Conditional_6_ng_template_0_Template_lg_button_click_0_listener() {
      \u0275\u0275restoreView(_r2);
      const ctx_r0 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r0.onCloneRecipe());
    });
    \u0275\u0275text(1);
    \u0275\u0275pipe(2, "translate");
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    \u0275\u0275styleMap("default");
    \u0275\u0275property("flat", true);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", \u0275\u0275pipeBind1(2, 4, "recipe.form.clone-btn"), " ");
  }
}
function AddRecipeComponent_Conditional_5_Conditional_6_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275template(0, AddRecipeComponent_Conditional_5_Conditional_6_ng_template_0_Template, 3, 6, "ng-template", 11);
  }
}
function AddRecipeComponent_Conditional_5_Conditional_7_ng_template_0_Template(rf, ctx) {
  if (rf & 1) {
    const _r3 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "lg-button", 15);
    \u0275\u0275listener("click", function AddRecipeComponent_Conditional_5_Conditional_7_ng_template_0_Template_lg_button_click_0_listener() {
      \u0275\u0275restoreView(_r3);
      const ctx_r0 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r0.onRemoveDraft());
    });
    \u0275\u0275text(1);
    \u0275\u0275pipe(2, "translate");
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    \u0275\u0275styleMap("danger");
    \u0275\u0275property("flat", true);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", \u0275\u0275pipeBind1(2, 4, "recipe.form.delete-draft-btn"), " ");
  }
}
function AddRecipeComponent_Conditional_5_Conditional_7_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275template(0, AddRecipeComponent_Conditional_5_Conditional_7_ng_template_0_Template, 3, 6, "ng-template", 11);
  }
}
function AddRecipeComponent_Conditional_5_Conditional_8_ng_template_0_Template(rf, ctx) {
  if (rf & 1) {
    const _r4 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "lg-button", 15);
    \u0275\u0275listener("click", function AddRecipeComponent_Conditional_5_Conditional_8_ng_template_0_Template_lg_button_click_0_listener() {
      \u0275\u0275restoreView(_r4);
      const ctx_r0 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r0.onDeleteRecipe());
    });
    \u0275\u0275text(1);
    \u0275\u0275pipe(2, "translate");
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    \u0275\u0275styleMap("danger");
    \u0275\u0275property("flat", true);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", \u0275\u0275pipeBind1(2, 4, "recipe.form.delete-btn"), " ");
  }
}
function AddRecipeComponent_Conditional_5_Conditional_8_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275template(0, AddRecipeComponent_Conditional_5_Conditional_8_ng_template_0_Template, 3, 6, "ng-template", 11);
  }
}
function AddRecipeComponent_Conditional_5_Conditional_9_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "small", 12);
    \u0275\u0275text(1);
    \u0275\u0275pipe(2, "translate");
    \u0275\u0275pipe(3, "timeAgo");
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    let tmp_2_0;
    const ctx_r0 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate2(" ", \u0275\u0275pipeBind1(2, 2, "edited-at-label"), " ", \u0275\u0275pipeBind1(3, 4, (tmp_2_0 = ctx_r0.recipe()) == null ? null : tmp_2_0.updatedAt), " ");
  }
}
function AddRecipeComponent_Conditional_5_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "lg-flex-row", 9)(1, "lg-title", 10);
    \u0275\u0275text(2);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(3, "lg-inline-separated-group");
    \u0275\u0275conditionalCreate(4, AddRecipeComponent_Conditional_5_Conditional_4_Template, 1, 0, null, 11);
    \u0275\u0275template(5, AddRecipeComponent_Conditional_5_ng_template_5_Template, 3, 8, "ng-template", 11);
    \u0275\u0275conditionalCreate(6, AddRecipeComponent_Conditional_5_Conditional_6_Template, 1, 0, null, 11);
    \u0275\u0275conditionalCreate(7, AddRecipeComponent_Conditional_5_Conditional_7_Template, 1, 0, null, 11)(8, AddRecipeComponent_Conditional_5_Conditional_8_Template, 1, 0, null, 11);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(9, AddRecipeComponent_Conditional_5_Conditional_9_Template, 4, 6, "small", 12);
  }
  if (rf & 2) {
    let tmp_3_0;
    let tmp_6_0;
    let tmp_7_0;
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275property("mobileMode", true)("center", true);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1(" ", (tmp_3_0 = ctx_r0.recipe()) == null ? null : tmp_3_0.name, " ");
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r0.draftRef() && ctx_r0.form.dirty ? 4 : -1);
    \u0275\u0275advance(2);
    \u0275\u0275conditional(!ctx_r0.draftRef() && ctx_r0.editMode() ? 6 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.isDraftRoute() ? 7 : ((tmp_6_0 = ctx_r0.recipe()) == null ? null : tmp_6_0.uuid) ? 8 : -1);
    \u0275\u0275advance(2);
    \u0275\u0275conditional(((tmp_7_0 = ctx_r0.recipe()) == null ? null : tmp_7_0.updatedAt) ? 9 : -1);
  }
}
function AddRecipeComponent_Conditional_6_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "lg-title");
    \u0275\u0275text(1);
    \u0275\u0275pipe(2, "translate");
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", \u0275\u0275pipeBind1(2, 1, "recipe.form.title"), " ");
  }
}
function AddRecipeComponent_Conditional_9_Conditional_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0);
    \u0275\u0275pipe(1, "translate");
  }
  if (rf & 2) {
    \u0275\u0275textInterpolate1(" ", \u0275\u0275pipeBind1(1, 1, "recipe.form.save-btn.edit.active"), " ");
  }
}
function AddRecipeComponent_Conditional_9_Conditional_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0);
    \u0275\u0275pipe(1, "translate");
  }
  if (rf & 2) {
    \u0275\u0275textInterpolate1(" ", \u0275\u0275pipeBind1(1, 1, "recipe.form.save-btn.edit.disabled"), " ");
  }
}
function AddRecipeComponent_Conditional_9_Template(rf, ctx) {
  if (rf & 1) {
    const _r5 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "lg-button", 16);
    \u0275\u0275listener("click", function AddRecipeComponent_Conditional_9_Template_lg_button_click_0_listener() {
      \u0275\u0275restoreView(_r5);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.onEditRecipe());
    });
    \u0275\u0275conditionalCreate(1, AddRecipeComponent_Conditional_9_Conditional_1_Template, 2, 3)(2, AddRecipeComponent_Conditional_9_Conditional_2_Template, 2, 3);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275styleMap("primary");
    \u0275\u0275property("disabled", !ctx_r0.form.dirty && !ctx_r0.draftRef());
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.form.dirty || ctx_r0.draftRef() ? 1 : 2);
  }
}
function AddRecipeComponent_Conditional_10_Conditional_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0);
    \u0275\u0275pipe(1, "translate");
  }
  if (rf & 2) {
    \u0275\u0275textInterpolate1(" ", \u0275\u0275pipeBind1(1, 1, "recipe.form.save-btn.add.active"), " ");
  }
}
function AddRecipeComponent_Conditional_10_Conditional_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0);
    \u0275\u0275pipe(1, "translate");
  }
  if (rf & 2) {
    \u0275\u0275textInterpolate1(" ", \u0275\u0275pipeBind1(1, 1, "recipe.form.save-btn.add.disabled"), " ");
  }
}
function AddRecipeComponent_Conditional_10_Template(rf, ctx) {
  if (rf & 1) {
    const _r6 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "lg-button", 16);
    \u0275\u0275listener("click", function AddRecipeComponent_Conditional_10_Template_lg_button_click_0_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.onAddRecipe());
    });
    \u0275\u0275conditionalCreate(1, AddRecipeComponent_Conditional_10_Conditional_1_Template, 2, 3)(2, AddRecipeComponent_Conditional_10_Conditional_2_Template, 2, 3);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275styleMap("primary");
    \u0275\u0275property("disabled", !ctx_r0.form.dirty && !ctx_r0.draftRef());
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.form.dirty || ctx_r0.draftRef() ? 1 : 2);
  }
}
var AddRecipeComponent = class _AddRecipeComponent {
  _aRoute;
  _recipesRepository;
  _notificationsService;
  _analyticsService;
  _translateService;
  constructor(_aRoute, _recipesRepository, _notificationsService, _analyticsService, _translateService) {
    this._aRoute = _aRoute;
    this._recipesRepository = _recipesRepository;
    this._notificationsService = _notificationsService;
    this._analyticsService = _analyticsService;
    this._translateService = _translateService;
  }
  uuid = injectParams("uuid");
  deleteConfirmationService = inject(DeleteConfirmationService);
  draftOrRecipeUUID = signal(void 0, ...ngDevMode ? [{ debugName: "draftOrRecipeUUID" }] : []);
  recipe = signal(void 0, ...ngDevMode ? [{ debugName: "recipe" }] : []);
  formComponent = viewChild(AddRecipeFormComponent, ...ngDevMode ? [{ debugName: "formComponent" }] : []);
  draftRef = signal(void 0, ...ngDevMode ? [{ debugName: "draftRef" }] : []);
  draftByExistingRecipe = computed(() => {
    return this.draftRef()?.meta?.["uuid"];
  }, ...ngDevMode ? [{ debugName: "draftByExistingRecipe" }] : []);
  form = new FormGroup({
    name: new FormControl(null, Validators.required),
    description: new FormControl(""),
    portions: new FormControl(null),
    ingredients: new FormArray([]),
    category_id: new FormControl(null),
    tags: new FormControl([]),
    master: new FormControl(false)
  });
  isDraftRoute = signal(false, ...ngDevMode ? [{ debugName: "isDraftRoute" }] : []);
  addedRecipeInformerUUID = signal(null, ...ngDevMode ? [{ debugName: "addedRecipeInformerUUID" }] : []);
  editMode = computed(() => {
    return this.recipe()?.uuid && !this.draftRef() || this.draftRef() && this.draftByExistingRecipe();
  }, ...ngDevMode ? [{ debugName: "editMode" }] : []);
  RecipeScheme = RecipeScheme;
  Stores = Stores;
  _routerManager = inject(ROUTER_MANAGER);
  _destroyRef = inject(DestroyRef);
  get ingredients() {
    return this.form.get("ingredients");
  }
  get _formValid() {
    return this.form.valid && !checkCycleRecipe(this.form?.getRawValue().ingredients, this.uuid());
  }
  ngOnInit() {
    combineLatest([
      this._aRoute.params,
      this._aRoute.data
    ]).pipe(takeUntilDestroyed(this._destroyRef)).subscribe(([params, data]) => {
      const draft = data["draft"];
      this.draftOrRecipeUUID.set(params["uuid"]);
      if (draft) {
        this.draftRef.set(draft);
        this.recipe.set(draft.data);
      } else if (data["recipe"]) {
        this.recipe.set(data["recipe"]);
      } else if (this.draftOrRecipeUUID()) {
        this._loadRecipe(this.draftOrRecipeUUID());
      } else {
        this.recipe.set(Recipe.empty());
      }
      this.isDraftRoute.set(!!data["draftRoute"]);
    });
  }
  ngAfterViewInit() {
    this.form.valueChanges.pipe(debounceTime(500), takeUntilDestroyed(this._destroyRef)).subscribe((value) => {
      if (!this.form.dirty) {
        return;
      }
      this.recipe()?.update(this.form?.getRawValue());
      const hasCycledRecipe = checkCycleRecipe(this.form?.getRawValue().ingredients, this.uuid());
      if (hasCycledRecipe) {
        this._notificationsService.error("notifications.recipe.cycle-error");
      }
      if (this.draftRef()?.uuid) {
        this._recipesRepository.updateDraftRecipe(this.draftRef().uuid, this.recipe(), this.draftRef().meta?.["uuid"]);
      } else if (this.recipe()) {
        this.draftRef.set(this._recipesRepository.saveDraftRecipe(this.recipe(), this.draftOrRecipeUUID() ?? ""));
      }
    });
  }
  async onAddRecipe() {
    try {
      if (!this.recipe() || !this._validateForm()) {
        return;
      }
      const { recipe: newRecipe, addedCount } = await this._recipesRepository.createRelatedProducts(this.recipe(), this.form.value.ingredients ?? []);
      const newUUID = await this._recipesRepository.addRecipe(newRecipe);
      this._analyticsService.trackRecipeCreated(newRecipe.name, {
        recipe_uuid: newUUID,
        ingredients_count: newRecipe.ingredients?.length || 0,
        portions: newRecipe.portions,
        category: newRecipe.category_id?.name
      });
      this.formComponent()?.resetForm();
      this._notificationsService.success("notifications.recipe.added");
      if (addedCount > 0) {
        this._notificationsService.success(this._translateService.instant("notifications.recipe.related-products-created", {
          count: addedCount
        }));
      }
      if (this.draftRef()) {
        this._removeDraft();
      }
      await this._routerManager.replace(["recipes", "edit", newUUID]);
      await this._loadRecipe(newUUID);
      this.addedRecipeInformerUUID.set(newUUID);
    } catch (e) {
      this._notificationsService.error(errorHandler(e));
    }
  }
  async onEditRecipe() {
    if (!this.recipe() || !this._validateForm() || !this.draftOrRecipeUUID()) {
      return;
    }
    try {
      let recipeUUID = this.draftRef()?.meta?.["uuid"] ?? this.draftOrRecipeUUID();
      const { recipe: newRecipe, addedCount } = await this._recipesRepository.createRelatedProducts(this.recipe(), this.form.value.ingredients ?? []);
      await this._recipesRepository.editRecipe(recipeUUID, newRecipe);
      this.formComponent()?.resetForm(newRecipe);
      this._notificationsService.success("notifications.recipe.edited");
      if (addedCount > 0) {
        this._notificationsService.success(this._translateService.instant("notifications.recipe.related-products-created", {
          count: addedCount
        }));
      }
      if (this.draftRef()) {
        this._removeDraft();
      }
      this._routerManager.replace(["recipes", "edit", recipeUUID]);
    } catch (e) {
      this._notificationsService.error(errorHandler(e));
    }
  }
  onRemoveDraft() {
    this._removeDraft();
    this._routerManager.navigate(["recipes"]);
  }
  onDeleteRecipe() {
    if (!this.recipe()?.uuid) {
      return;
    }
    this.deleteConfirmationService.configure({
      message: this._translateService.instant("recipe.form.delete-confirm-message"),
      onSuccess: () => {
        this._recipesRepository.deleteOne(this.recipe().uuid).then(() => {
          this._notificationsService.success("notifications.recipe.deleted");
          this._routerManager.navigate(["recipes"]);
        }).catch((e) => {
          this._notificationsService.error(errorHandler(e));
        });
      },
      onCancel: () => {
      }
    });
  }
  onCloneRecipe() {
    if (!this.recipe()) {
      return;
    }
    this._recipesRepository.cloneRecipe(this.recipe()).then(async (newUUID) => {
      this._notificationsService.success("notifications.recipe.cloned");
      await this._routerManager.replace(["recipes", "edit", newUUID]);
      await this._loadRecipe(newUUID);
      return newUUID;
    }).catch((e) => {
      this._notificationsService.error(errorHandler(e));
    });
  }
  _validateForm() {
    if (!this._formValid) {
      this._notificationsService.error(this._notificationsService.parseFormErrors(this.form).join(", "));
      return false;
    }
    return true;
  }
  _removeDraft() {
    if (!this.draftRef()) {
      return;
    }
    this._recipesRepository.removeDraftRecipe(this.draftRef().uuid);
    this.draftRef.set(void 0);
  }
  _loadRecipe(uuid) {
    if (!uuid)
      return Promise.resolve();
    return this._recipesRepository.getOne(uuid).then((recipe) => {
      if (!recipe)
        return;
      this.recipe.set(recipe);
    }).catch((e) => {
      this._notificationsService.error(errorHandler(e));
    });
  }
  static \u0275fac = function AddRecipeComponent_Factory(__ngFactoryType__) {
    return new (__ngFactoryType__ || _AddRecipeComponent)(\u0275\u0275directiveInject(ActivatedRoute), \u0275\u0275directiveInject(RecipesRepository), \u0275\u0275directiveInject(NotificationsService), \u0275\u0275directiveInject(AnalyticsService), \u0275\u0275directiveInject(TranslateService));
  };
  static \u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _AddRecipeComponent, selectors: [["lg-add-recipe"]], viewQuery: function AddRecipeComponent_Query(rf, ctx) {
    if (rf & 1) {
      \u0275\u0275viewQuerySignal(ctx.formComponent, AddRecipeFormComponent, 5);
    }
    if (rf & 2) {
      \u0275\u0275queryAdvance();
    }
  }, features: [\u0275\u0275ProvidersFeature([
    DeleteConfirmationService
  ])], decls: 12, vars: 9, consts: [["size", "small"], [3, "formGroup"], ["size", "medium"], [3, "editMode", "recipe"], [3, "mobileMode", "relaxed"], ["lgShrink", "", 3, "disabled", "style"], [3, "icon", "link", "size", "label"], ["aria-hidden", "false", "fontIcon", "add"], [3, "routerLink"], [3, "mobileMode", "center"], ["lgSelfStart", ""], ["lgInlineSeparatedGroup", ""], [1, "text-muted", "text-cursive"], [1, "text-success"], [3, "flat", "disabled", "link"], ["lgShrink", "", 3, "click", "flat"], ["lgShrink", "", 3, "click", "disabled"]], template: function AddRecipeComponent_Template(rf, ctx) {
    if (rf & 1) {
      \u0275\u0275conditionalCreate(0, AddRecipeComponent_Conditional_0_Template, 4, 8, "lg-controls-bar", 0);
      \u0275\u0275elementStart(1, "lg-fade-in")(2, "lg-container", 1)(3, "lg-flex-column", 2);
      \u0275\u0275conditionalCreate(4, AddRecipeComponent_Conditional_4_Template, 6, 8, "p");
      \u0275\u0275conditionalCreate(5, AddRecipeComponent_Conditional_5_Template, 10, 7)(6, AddRecipeComponent_Conditional_6_Template, 3, 3, "lg-title");
      \u0275\u0275elementEnd();
      \u0275\u0275element(7, "lg-add-recipe-form", 3);
      \u0275\u0275elementStart(8, "lg-flex-row", 4);
      \u0275\u0275conditionalCreate(9, AddRecipeComponent_Conditional_9_Template, 3, 4, "lg-button", 5)(10, AddRecipeComponent_Conditional_10_Template, 3, 4, "lg-button", 5);
      \u0275\u0275elementEnd()()();
      \u0275\u0275element(11, "lg-delete-confirmation-popover");
    }
    if (rf & 2) {
      let tmp_2_0;
      let tmp_3_0;
      let tmp_8_0;
      \u0275\u0275conditional(ctx.editMode() ? 0 : -1);
      \u0275\u0275advance(2);
      \u0275\u0275property("formGroup", ctx.form);
      \u0275\u0275advance(2);
      \u0275\u0275conditional((tmp_2_0 = ctx.addedRecipeInformerUUID()) ? 4 : -1, tmp_2_0);
      \u0275\u0275advance();
      \u0275\u0275conditional(((tmp_3_0 = ctx.recipe()) == null ? null : tmp_3_0.uuid) && !ctx.draftRef() || ctx.draftRef() && ctx.draftByExistingRecipe() ? 5 : 6);
      \u0275\u0275advance(2);
      \u0275\u0275property("editMode", ctx.editMode())("recipe", ctx.recipe());
      \u0275\u0275advance();
      \u0275\u0275property("mobileMode", true)("relaxed", true);
      \u0275\u0275advance();
      \u0275\u0275conditional(((tmp_8_0 = ctx.recipe()) == null ? null : tmp_8_0.uuid) && !ctx.draftRef() || ctx.draftRef() && ctx.draftByExistingRecipe() ? 9 : 10);
    }
  }, dependencies: [
    ContainerComponent,
    TitleComponent,
    AddRecipeFormComponent,
    ButtonComponent,
    FlexRowComponent,
    FadeInComponent,
    ShrinkDirective,
    FlexColumnComponent,
    RouterLink,
    InlineSeparatedGroupComponent,
    InlineSeparatedGroupDirective,
    SelfStartDirective,
    ControlsBarComponent,
    MatIcon,
    DeleteConfirmationPopoverComponent,
    ReactiveFormsModule,
    NgControlStatusGroup,
    FormGroupDirective,
    TimeAgoPipe,
    TranslatePipe
  ], encapsulation: 2 });
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(AddRecipeComponent, [{
    type: Component,
    args: [{ selector: "lg-add-recipe", providers: [
      DeleteConfirmationService
    ], imports: [
      ContainerComponent,
      TitleComponent,
      AddRecipeFormComponent,
      ButtonComponent,
      FlexRowComponent,
      FadeInComponent,
      ShrinkDirective,
      TimeAgoPipe,
      FlexColumnComponent,
      TranslatePipe,
      RouterLink,
      InlineSeparatedGroupComponent,
      InlineSeparatedGroupDirective,
      SelfStartDirective,
      ControlsBarComponent,
      MatIcon,
      DeleteConfirmationPopoverComponent,
      ReactiveFormsModule
    ], template: `@if (editMode()) {
  <lg-controls-bar size="small">
    <lg-button [icon]="true"
               [link]="'/recipes/add'"
               [size]="'small'"
               [label]="'recipe.form.add-new-btn'|translate"
               [style]="'primary'">
      <mat-icon aria-hidden="false" fontIcon="add"></mat-icon>
    </lg-button>
  </lg-controls-bar>
}

<lg-fade-in>
  <lg-container [formGroup]="form">
    <lg-flex-column size="medium">
      @if (addedRecipeInformerUUID(); as uuid) {
        <p>
          {{ 'recipe.added-informer' | translate }} <a
          routerLink="/recipes/edit/{{ uuid }}">{{ 'recipe.added-informer.link' | translate }}</a>
        </p>
      }

      @if ((recipe()?.uuid && !draftRef()) || (draftRef() && draftByExistingRecipe())) {
        <lg-flex-row [mobileMode]="true" [center]="true">
          <lg-title lgSelfStart>
            {{ recipe()?.name }}
          </lg-title>
        </lg-flex-row>

        <lg-inline-separated-group>
          @if (draftRef() && form.dirty) {
            <ng-template lgInlineSeparatedGroup>
              <lg-fade-in>
                <span class="text-success">{{ 'saved-draft-label'|translate }}</span>
              </lg-fade-in>
            </ng-template>
          }

          <ng-template lgInlineSeparatedGroup>
            <lg-button [flat]="true"
                       [disabled]="!!draftRef()"
                       [link]="'/recipes/calculate/' + recipe()?.uuid"
                       [style]="'default'">
              {{ 'recipe.calculate-btn'|translate }}
            </lg-button>
          </ng-template>

          @if (!draftRef() && editMode()) {
            <ng-template lgInlineSeparatedGroup>
              <lg-button lgShrink
                         [style]="'default'"
                         [flat]="true"
                         (click)="onCloneRecipe()">
                {{ 'recipe.form.clone-btn'|translate }}
              </lg-button>
            </ng-template>
          }

          @if (isDraftRoute()) {
            <ng-template lgInlineSeparatedGroup>
              <lg-button lgShrink
                         [style]="'danger'"
                         [flat]="true"
                         (click)="onRemoveDraft()">
                {{ 'recipe.form.delete-draft-btn'|translate }}
              </lg-button>
            </ng-template>
          } @else if (recipe()?.uuid) {
            <ng-template lgInlineSeparatedGroup>
              <lg-button lgShrink
                         [style]="'danger'"
                         [flat]="true"
                         (click)="onDeleteRecipe()">
                {{ 'recipe.form.delete-btn'|translate }}
              </lg-button>
            </ng-template>
          }
        </lg-inline-separated-group>

        @if (recipe()?.updatedAt) {
          <small class="text-muted text-cursive">
            {{ 'edited-at-label'|translate }} {{ recipe()?.updatedAt | timeAgo }}
          </small>
        }
      } @else {
        <lg-title>
          {{ 'recipe.form.title'|translate }}
        </lg-title>
      }
    </lg-flex-column>

    <lg-add-recipe-form [editMode]="editMode()"
                        [recipe]="recipe()"></lg-add-recipe-form>

    <lg-flex-row [mobileMode]="true" [relaxed]="true">
      @if ((recipe()?.uuid && !draftRef()) || (draftRef() && draftByExistingRecipe())) {
        <lg-button [disabled]="!form.dirty && !draftRef()"
                   lgShrink
                   [style]="'primary'"
                   (click)="onEditRecipe()">
          @if (form.dirty || draftRef()) {
            {{ 'recipe.form.save-btn.edit.active'|translate }}
          } @else {
            {{ 'recipe.form.save-btn.edit.disabled'|translate }}
          }
        </lg-button>
      } @else {
        <lg-button [disabled]="!form.dirty && !draftRef()"
                   lgShrink
                   [style]="'primary'"
                   (click)="onAddRecipe()">
          @if (form.dirty || draftRef()) {
            {{ 'recipe.form.save-btn.add.active'|translate }}
          } @else {
            {{ 'recipe.form.save-btn.add.disabled'|translate }}
          }
        </lg-button>
      }
    </lg-flex-row>
  </lg-container>
</lg-fade-in>

<lg-delete-confirmation-popover></lg-delete-confirmation-popover>
` }]
  }], () => [{ type: ActivatedRoute }, { type: RecipesRepository }, { type: NotificationsService }, { type: AnalyticsService }, { type: TranslateService }], null);
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(AddRecipeComponent, { className: "AddRecipeComponent", filePath: "src/app/features/recipes/view/add-recipe/add-recipe.component.ts", lineNumber: 66 });
})();
export {
  AddRecipeComponent
};
//# sourceMappingURL=chunk-QSJ4YEWO.js.map
