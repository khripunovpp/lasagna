import{c as g}from"./chunk-RF4VKWMZ.js";import{a as T,g as d}from"./chunk-CSWOURBG.js";import{U as m,Y as u}from"./chunk-VOOOUGHD.js";import{f as s}from"./chunk-2WH2EVR6.js";var l=class{constructor(e){this.recipe=e}result;get totalPrice(){return this.recipe?this.recipe.ingredients.reduce((e,t)=>e+t.totalPrice,0):0}get ingredients(){return this.recipe?.ingredients||[]}get pricePerUnit(){return this.recipe?this.totalPrice/this.totalWeight:0}get totalWeight(){return this.recipe?this.recipe.ingredients.reduce((e,t)=>e+t.totalWeightGram,0):0}};var f=class n{constructor(e,t){this._recipeRepository=e;this._productRepository=t}calculation;linkTaxTemplate(e,t){return new Promise((a,i)=>s(this,null,function*(){yield this._recipeRepository.getOne(e).then(r=>s(this,null,function*(){if(!r){a(null);return}r.taxTemplateName=t,yield this._recipeRepository.editRecipe(r.uuid,r),a(r)}))}))}calculateRecipe(e,t=0){return new Promise((a,i)=>s(this,null,function*(){let r=[],c=yield this._recipeRepository.getOne(e,!0),p=new l(c);p.ingredients.forEach(o=>{r.push(this._makeRow({name:o.generalName,price_per_gram:o.pricePerUnit,amount:o.amount,total:o.totalPrice,unit:o.unit,uuid:o.uuid||"",indent:0,type:o.recipe_id?"recipe-row":void 0}))}),r.push(this._makeTotal(p.totalPrice,p.totalWeight)),a({calculation:p,table:r})}))}_makeRow(e){return{name:e.name,price_per_gram:e.price_per_gram??0,amount:e.amount,total:e.total??0,unit:e.unit||"gram",indent:e.indent??0,type:e.type||"row",uuid:e.uuid}}_makeTotal(e,t){return{name:"Total (without taxes and fees)",amount:t,unit:"gram",price_per_gram:T(e/t),total:e,indent:0,type:"total"}}static \u0275fac=function(t){return new(t||n)(u(g),u(d))};static \u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})};var y=class n{constructor(){}getTemplates(e){let t=localStorage.getItem(this.getStorageKey(e));return t?JSON.parse(t):[]}getTemplateById(e,t){return this.getTemplates(e).find(i=>i.id===t)}getTemplateByName(e,t){return this.getTemplates(e).find(i=>i.name===t)}saveTemplate(e,t){let a=this.getTemplates(e);this._checkUniqName(a,t.name)?(a.push(t),this._storeTemplates(e,a)):this.updateTemplateData(e,t.name,t.data)}updateTemplateData(e,t,a){let i=this.getTemplates(e),r=i.find(c=>c.name===t);r&&(r.data=a,this._storeTemplates(e,i))}deleteTemplate(e,t){let a=this.getTemplates(e).filter(i=>i.id!==t);this._storeTemplates(e,a)}updateTemplate(e,t){let a=this.getTemplates(e).map(i=>i.id===t.id?t:i);this._storeTemplates(e,a)}_checkUniqName(e,t){return!e.some(a=>a.name===t)}getStorageKey(e){return`template-${e}`}_storeTemplates(e,t){localStorage.setItem(this.getStorageKey(e),JSON.stringify(t))}static \u0275fac=function(t){return new(t||n)};static \u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})};export{f as a,y as b};
