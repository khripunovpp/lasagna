{
  "version": 3,
  "sources": ["src/app/features/home/view/last-backup-informer.component.ts"],
  "sourcesContent": ["import {Component, computed, HostListener, inject, signal} from '@angular/core';\nimport {TimeAgoPipe} from '../../../shared/view/pipes/time-ago.pipe';\nimport {TitleCasePipe} from '@angular/common';\nimport {RouterLink} from '@angular/router';\nimport {UserService} from '../../settings/service/services/user.service';\nimport {TranslatePipe} from '@ngx-translate/core';\nimport {NotificationsService} from '../../../shared/service/services';\nimport {errorHandler} from '../../../shared/helpers';\nimport {WINDOW} from '../../../shared/service/tokens/window.token';\n\n@Component({\n  selector: 'lg-last-backup-informer',\n  standalone: true,\n  template: `\n    @if (showButton()) {\n      <a [routerLink]=\"['/settings']\"\n         (click)=\"hide()\"\n         [queryParams]=\"{download_backup: true,tab:'backup'}\">\n        @if (lastBackupDate()) {\n          {{ lastBackupDate() | timeAgo | titlecase }}\n        } @else {\n          {{ 'backup.no-backup' | translate }}\n        }\n      </a>\n    }\n  `,\n  styles: [`\n    :host {\n      display: contents;\n    }\n\n    a {\n      background-image: linear-gradient(45deg, #de2c51, #fff400);\n      color: white;\n      border: none;\n      padding: 10px 20px;\n      cursor: pointer;\n      text-align: center;\n      text-decoration: none;\n      border-radius: 0 16px 16px 0;\n      background-size: calc(100% + 70px) 100%;\n      transition: background-position 0.3s ease;\n      white-space: nowrap;\n    }\n\n    a:hover {\n      background-position: -70px 0;\n    }\n  `],\n  imports: [\n    TimeAgoPipe,\n    TitleCasePipe,\n    RouterLink,\n    TranslatePipe\n  ]\n})\nexport class LastBackupInformerComponent {\n  constructor() {\n  }\n\n  oneDayInMilliseconds = 24 * 60 * 60 * 1000;\n  twoWeeksInMilliseconds = 14 * this.oneDayInMilliseconds;\n  userService = inject(UserService);\n  storedBackupDate = signal<string | null>(this._getStoredDate());\n  today: Date = new Date();\n  lastBackupDate = computed(() => this.storedBackupDate()\n    ? new Date(this.storedBackupDate()!) :\n    undefined);\n  private readonly _notificationsService = inject(NotificationsService);\n  showButton = computed(() => {\n    try {\n      if (this._window?.location.hostname === 'localhost') {\n        return false;\n      }\n      const sinceDate = this.userService.isUserFirstDate;\n      if (!sinceDate) {\n        return false\n      }\n      const todayTs = this.today.getTime();\n      const sinceDateTs = sinceDate.getTime();\n      const diffInMilliseconds = todayTs - sinceDateTs;\n      if (diffInMilliseconds < 0) {\n        return false; // Since date is in the future\n      }\n      if (diffInMilliseconds < this.twoWeeksInMilliseconds) {\n        return false\n      }\n\n      if (!this.lastBackupDate()) {\n        return true\n      }\n      const lastBackupDateTs = this.lastBackupDate()!.getTime();\n\n      return lastBackupDateTs < sinceDateTs ||\n        lastBackupDateTs < todayTs - this.twoWeeksInMilliseconds;\n    } catch (e) {\n      this._notificationsService.error(errorHandler(e));\n      return false;\n    }\n  });\n  private readonly _window = inject(WINDOW);\n\n  hide() {\n    this.storedBackupDate.set(null);\n  }\n\n  @HostListener('click', ['$event']) onClick(event: Event) {\n    setTimeout(() => {\n      this.storedBackupDate.set(this._getStoredDate());\n    }, 500);\n  }\n\n  private _getStoredDate() {\n    try {\n      return this._window?.localStorage.getItem('lastBackupDate') || null;\n    } catch (e) {\n      console.log('e', e);\n      return null\n    }\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
