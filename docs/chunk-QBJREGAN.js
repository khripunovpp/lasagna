import{a as ce}from"./chunk-RD3LRVG7.js";import{a as pe}from"./chunk-H3QNTD3T.js";import{a as oe}from"./chunk-FGQO4AJV.js";import{a as ee,b as te,c as ie}from"./chunk-QM7YARSH.js";import{a as Z}from"./chunk-55RDZAIO.js";import{a as le}from"./chunk-OR7JGCP6.js";import{a as ae,c as se,d as me}from"./chunk-UW6BJR4X.js";import{a as ne}from"./chunk-4N6QLKKM.js";import{a as re}from"./chunk-INEBIGEH.js";import{a as Y}from"./chunk-3BUOAPBA.js";import{a as J,b as K}from"./chunk-LQWVTX57.js";import"./chunk-FDX4ZR27.js";import"./chunk-G4MUTO2L.js";import"./chunk-5KSZNU56.js";import"./chunk-57P3MUNF.js";import"./chunk-A2JL76VU.js";import{f as P,g as j,h as S,i as l,n as X,o as L,p as W,q as z,r as U,s as B,t as H,v as q,w as Q}from"./chunk-NFHTE42N.js";import"./chunk-X7V7MNYG.js";import{A as $}from"./chunk-B6IEM4UA.js";import"./chunk-652DFWNF.js";import"./chunk-AQAYOHHC.js";import{$ as b,$a as w,$b as T,Ac as V,Cb as N,Db as O,Eb as s,Fb as m,Gb as _,Hb as I,Ib as E,Kb as G,Nb as u,Ob as c,Wa as r,X as y,eb as D,ha as g,ia as f,jb as F,oa as v,rb as n,tb as k,ub as h,xb as A,zb as R,zc as M}from"./chunk-MWDKUV2C.js";import"./chunk-DELOOZDJ.js";import{f as x}from"./chunk-2WH2EVR6.js";var p=class i{constructor(e){this.name=String(e.name).trim(),this.amount=parseFloat(String(e.amount)),this.percentage=e.percentage,this.description=String(e.description||"").trim(),this.items=e.items,this.uuid=e.uuid}name;amount;percentage;description;items;uuid;static fromRaw(e){return new i({name:e?.name||"",amount:e?.amount||0,percentage:e?.percentage||!1,description:e?.description||"",items:e?.items||[],uuid:e?.uuid||""})}static empty(){return new i({name:"",amount:0,percentage:!0,description:"",items:[],uuid:""})}update(e){return this.name=e.name||this.name,this.amount=e.amount||this.amount,this.percentage=e.percentage||this.percentage,this.description=e.description||this.description,this.items=e.items||this.items,this.uuid=e.uuid||this.uuid,this}toDTO(){return{name:this.name||"",amount:this.amount||0,percentage:this.percentage||!1,description:this.description||"",items:this.items||[],uuid:this.uuid||""}}};var ue=i=>({name:i.name,description:i.description,amount:i.value,percentage:i.percentage,uuid:i.uuid});var C=class i{constructor(e){this._indexDbService=e}addOne(e){return this._indexDbService.addData("taxes",e.toDTO())}updateOne(e,t){return this._indexDbService.replaceData("taxes",e,t.toDTO())}getOne(e){return x(this,null,function*(){return new Promise((t,o)=>x(this,null,function*(){if(e=typeof e=="string"?e:e.uuid,!e){t(void 0);return}yield this._indexDbService.getOne("taxes",e).then(a=>{t(p.fromRaw(a))})}))})}getAll(){return this._indexDbService.getAll("taxes").then(e=>e.map(t=>p.fromRaw(t)))}addMany(e){return this._indexDbService.balkAdd("taxes",e.map(t=>t.toDTO()),!1)}deleteOne(e){return this._indexDbService.remove("taxes",e)}static \u0275fac=function(t){return new(t||i)(b($))};static \u0275prov=y({token:i,factory:i.\u0275fac,providedIn:"root"})};var fe=(i,e)=>e.value.name+e.value.value;function he(i,e){if(i&1){let t=G();s(0,"section",5)(1,"div",6)(2,"lg-gap-row",7)(3,"lg-control",8),_(4,"lg-input",9),m(),s(5,"lg-control",8),_(6,"lg-textarea",10),m(),s(7,"lg-control",8)(8,"lg-checkbox",11),u("onCheckboxChanged",function(){g(t);let a=c().$index,d=c();return f(d.onTaxValueChange(a))}),m()(),s(9,"lg-control",12)(10,"lg-number-input",13),u("onInputChange",function(){g(t);let a=c().$index,d=c();return f(d.onTaxValueChange(a))}),m()(),s(11,"lg-button",14),u("click",function(){g(t);let a=c().$index,d=c();return f(d.deleteTxRow(a))}),_(12,"mat-icon",15),m()()()()}if(i&2){let t=c().$index;n("formGroupName",t),r(),k("taxes__row--odd",t%2!==0),r(),n("bottom",!0)("fit",!0),r(),n("label","Name"),r(),n("placeholder","Name"),r(),n("label","Description"),r(),n("rows",3)("placeholder","Description"),r(),n("label","Use percentage"),r(),n("customMark","%"),r(),n("label","Value")("lgWidth","200px"),r(),n("placeholder","Value"),r(),h("danger"),n("size","tiny")("icon",!0)}}function _e(i,e){i&1&&F(0,he,13,19,"ng-template",2)}function Te(i,e){i&1&&T(0," Save changes ")}function Ce(i,e){i&1&&T(0," No changes ")}var de=class i{constructor(e,t){this._taxesRepository=e;this._notificationService=t}taxes=v([]);rows=M(()=>this.taxes().map(e=>p.fromRaw(e)));taxesForm=new S({rows:new U([this._getRowGroup()])});rowsEffect=V(()=>{this._rowsFormArray.clear(),this.rows().forEach((e,t)=>{this._rowsFormArray.push(this._getRowGroup(e))}),this.taxesForm.updateValueAndValidity(),this.taxesForm.markAsPristine()});totalTaxes=v(0);formValues=this.taxesForm.valueChanges.pipe(Z());get _rowsFormArray(){return this.taxesForm.get("rows")}ngOnInit(){this._taxesRepository.getAll().then(e=>{this.taxes.set(e)})}onTaxValueChange(e){}deleteTxRow(e){let t=this.taxesForm.value.rows?.[e]?.uuid;this._rowsFormArray.removeAt(e),this.taxesForm.markAsDirty(),t&&this._taxesRepository.deleteOne(t)}addTaxRow(){this._rowsFormArray.push(this._getRowGroup()),this.taxesForm.markAsDirty()}saveTaxes(){return x(this,null,function*(){try{let e=this.taxesForm.value.rows?.map(t=>p.fromRaw(ue(t)))??[];yield this._taxesRepository.addMany(e),this._notificationService.success("Taxes saved successfully"),this.taxesForm.markAsPristine()}catch(e){this._notificationService.error(ce(e))}})}_getRowGroup(e){return new S({name:new l(e?.name||""),description:new l(e?.description||""),value:new l(e?.amount||0),amount:new l(0),percentage:new l(e?.percentage||!1),uuid:new l(e?.uuid||"")})}static \u0275fac=function(t){return new(t||i)(w(C),w(q))};static \u0275cmp=D({type:i,selectors:[["lg-backup-settings"]],decls:11,vars:7,consts:[[3,"formGroup"],["formArrayName","rows"],["lgCardListItem",""],["lgSelfCenter","","lgShrink","",3,"click","disabled"],["lgSelfCenter","","lgShrink","",3,"click"],[1,"taxes",3,"formGroupName"],[1,"taxes__row"],[3,"bottom","fit"],[3,"label"],["formControlName","name",3,"placeholder"],["formControlName","description",3,"rows","placeholder"],["formControlName","percentage",3,"onCheckboxChanged","customMark"],[3,"label","lgWidth"],["lgParseMath","","formControlName","value",3,"onInputChange","placeholder"],["lgSelfCenter","","lgShrink","",3,"click","size","icon"],["aria-hidden","false","aria-label","Example home icon","fontIcon","close"]],template:function(t,o){t&1&&(s(0,"lg-container")(1,"lg-card-list",0),I(2,1),N(3,_e,1,0,null,2,fe),E(),m(),s(5,"lg-gap-row")(6,"lg-button",3),u("click",function(){return o.saveTaxes()}),A(7,Te,1,0)(8,Ce,1,0),m(),s(9,"lg-button",4),u("click",function(){return o.addTaxRow()}),T(10," Add tax "),m()()()),t&2&&(r(),n("formGroup",o.taxesForm),r(2),O(o.taxesForm.controls.rows.controls),r(3),h("success"),n("disabled",!o.taxesForm.dirty),r(),R(o.taxesForm.dirty?7:8),r(2),h("warning"))},dependencies:[K,te,B,P,j,Q,J,ie,ee,ne,re,Y,ae,se,H,X,z,L,W,pe,me,oe,le],encapsulation:2})};export{de as TaxesSettingsComponent};
