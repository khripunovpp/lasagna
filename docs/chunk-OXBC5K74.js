import{a as it,b as ot,c as nt,d as rt,e as ct}from"./chunk-CL2YXL2O.js";import{a as Y,b as tt}from"./chunk-572RCR4K.js";import{a as X}from"./chunk-RQHIUHWL.js";import{b as et}from"./chunk-GT7COLCQ.js";import{a as at}from"./chunk-AIQH2UTR.js";import"./chunk-BIKB4Y5Y.js";import{a as w,b as q,c as y}from"./chunk-SW5BJD3C.js";import{a as H}from"./chunk-XXOKXP6S.js";import"./chunk-6L5LI2P6.js";import"./chunk-KZZMX7TE.js";import"./chunk-GORGKC4U.js";import{a as Z,d as W}from"./chunk-YBVUJ3DZ.js";import"./chunk-7XJBFH7X.js";import{a as Q}from"./chunk-OIABF7X4.js";import{a as J,c as K}from"./chunk-JVT2USDN.js";import{Aa as x,Da as f,Ea as g,Fa as j,Ha as L,I as F,Ia as R,Ja as r,Ka as n,La as z,P as O,Pa as G,Qa as v,Qb as A,R as u,Ra as m,V as N,W as M,ac as V,bb as a,cb as P,db as d,eb as E,f as b,ja as o,ma as _,n as h,oa as $,ob as U,qb as B,r as I,s as k,sa as T,xa as l}from"./chunk-AWPX63HX.js";var lt=new O("CategorizedProductsList",{factory:()=>{let e=u(y),i=u(H);return h(e.loadRecipes()).pipe(F(()=>e.products$)).pipe(I(c=>c.toSorted((p,s)=>p.name.localeCompare(s.name))),I(c=>rt(c,"category_id")),k(c=>b(void 0,null,function*(){let p=[];for(let C in c){let S=c[C],mt=yield i.getOne(C);p.push({category:mt?.name,products:S})}if(!p.length)return[];let[s,...D]=p.toSorted((C,S)=>C.category>S.category?1:-1);return s?.category?[s].concat(D):D.concat([s])})))}});var st=(e,i)=>i==null?null:i.category;function dt(e,i){if(e&1&&(r(0,"span"),a(1),n()),e&2){let t=m(2).$implicit;o(),d("from ",t.source)}}function ut(e,i){if(e&1&&(r(0,"span"),a(1),n(),r(2,"span"),a(3),n(),f(4,dt,2,1,"span")),e&2){let t=m().$implicit;o(),P(t.name),o(2),E("",t.amount,"gr for ",t.price),o(),g(t.source?4:-1)}}function _t(e,i){if(e&1&&(r(0,"span"),a(1),n()),e&2){let t=m(2).$implicit;o(),d("from ",t==null?null:t.source)}}function ft(e,i){if(e&1&&(r(0,"span"),a(1),n(),r(2,"span"),a(3),n(),f(4,_t,2,1,"span")),e&2){let t=m().$implicit;o(),P(t==null?null:t.name),o(2),E("",t==null?null:t.amount," gr for ",t==null?null:t.price),o(),g(t!=null&&t.source?4:-1)}}function gt(e,i){if(e&1&&f(0,ut,5,4)(1,ft,5,4),e&2){let t=i.flow;g(t==="new"?0:1)}}function Ct(e,i){e&1&&a(0," per gram ")}function xt(e,i){if(e&1&&a(0),e&2){let t=m(2).$implicit;d(" per ",t.unit," ")}}function vt(e,i){if(e&1){let t=G();r(0,"lg-gap-row",0)(1,"div",7)(2,"lg-gap-row",0)(3,"div",8)(4,"a",9),a(5),n()(),r(6,"div",10),a(7),n(),r(8,"div",11),a(9),U(10,"number"),f(11,Ct,1,0)(12,xt,1,1),n()()(),r(13,"lg-button",12),v("click",function(){N(t);let p=m().$implicit,s=m(2);return M(s.deleteProduct(p))}),z(14,"mat-icon",13),n()()}if(e&2){let t=m().$implicit,c=m(2);l("center",!0),o(2),l("center",!0),o(2),l("routerLink","/products/edit/"+t.uuid),o(),P(t.name),o(2),d(" ",t.source??""),o(2),d(" ",B(10,11,c.getPricePerGram(t),"1.2-5")," "),o(2),g(!t.unit||t.unit==="gram"?11:12),o(2),x("danger"),l("size","small")("icon",!0)}}function Pt(e,i){e&1&&T(0,vt,15,14,"ng-template",6)}function yt(e,i){if(e&1&&(r(0,"lg-title",5),a(1),n(),r(2,"lg-card-list"),L(3,Pt,1,0,null,6,j),n()),e&2){let t=i.$implicit;l("level",3),o(),d(" ",(t==null?null:t.category)||"Uncategorized"," "),o(2),R(t.products)}}function St(e,i){e&1&&(r(0,"lg-gap-row",0)(1,"lg-title",5),a(2," No products found "),n()()),e&2&&(l("center",!0),o(),l("level",5))}var pt=class e{constructor(i,t,c,p){this._productsRepository=i;this._csvReaderService=t;this._transferDataService=c;this._notificationsService=p}products=et(u(lt));ProductDbInputScheme=q;Stores=Z;getPricePerGram(i){return(w(i.price)||1)/(w(i.amount)||1)}exportProducts(){this._transferDataService.exportTable("productsStore","json")}deleteProduct(i){i.uuid&&this._productsRepository.deleteProduct(i.uuid).then(()=>{this._notificationsService.success("Product deleted"),this.loadProducts()})}ngOnInit(){this.loadProducts()}loadProducts(){this._productsRepository.loadRecipes()}static \u0275fac=function(t){return new(t||e)(_(y),_(ot),_(ct),_(at))};static \u0275cmp=$({type:e,selectors:[["lg-product-list"]],decls:13,vars:13,consts:[[3,"center"],[3,"flat","link","size"],[3,"click","flat","size"],[3,"onDone","schema","storeName"],["lgImportRowTpl",""],[3,"level"],["lgCardListItem",""],[1,"expand"],[2,"flex","20%"],[3,"routerLink"],[2,"flex","10%"],[2,"flex","70%"],[3,"click","size","icon"],["aria-hidden","false","aria-label","Example home icon","fontIcon","close"]],template:function(t,c){t&1&&(r(0,"lg-container")(1,"lg-title"),a(2," Products "),n(),r(3,"lg-gap-row",0)(4,"lg-button",1),a(5," Add "),n(),r(6,"lg-button",2),v("click",function(){return c.exportProducts()}),a(7," Export "),n(),r(8,"lg-import",3),v("onDone",function(){return c.loadProducts()}),T(9,gt,2,1,"ng-template",4),n()(),L(10,yt,5,2,null,null,st,!1,St,3,2,"lg-gap-row",0),n()),t&2&&(o(3),l("center",!0),o(),x("primary"),l("flat",!0)("link","/products/add")("size","small"),o(2),x("info"),l("flat",!0)("size","small"),o(2),l("schema",c.ProductDbInputScheme)("storeName",c.Stores.PRODUCTS),o(2),R(c.products()))},dependencies:[Q,W,X,J,K,A,tt,Y,nt,V,it],styles:["[_nghost-%COMP%]{display:block}"]})};export{pt as ProductListComponent};
