import{a as Le}from"./chunk-NVKU3EAN.js";import{a as ve,b as Pe,e as R,f as Te}from"./chunk-KMO3GKOW.js";import{a as ye,b as De}from"./chunk-SO27MVIS.js";import"./chunk-3FT5GRKM.js";import"./chunk-3HYY4BR3.js";import{a as H}from"./chunk-MYUS3HVV.js";import{a as U}from"./chunk-IDGGWOUE.js";import"./chunk-MGUYQA7S.js";import"./chunk-VMYCS2MK.js";import"./chunk-757C5FF6.js";import{a as xe}from"./chunk-SGRQ54KV.js";import{a as G,b as $}from"./chunk-RAQDWDKG.js";import{a as q}from"./chunk-T6WLNLQD.js";import{v as Se}from"./chunk-VUJEMPM4.js";import"./chunk-UKFGKW5Z.js";import{a as fe}from"./chunk-FV4RUXOV.js";import{a as N}from"./chunk-BW6KPQFF.js";import{a as j}from"./chunk-IJ46JICA.js";import"./chunk-XTIJKHFS.js";import"./chunk-4U4Z3QUR.js";import{a as Ce}from"./chunk-FMODVMJQ.js";import"./chunk-MPFUNZLY.js";import{a as ge}from"./chunk-UEOYHVW7.js";import{c as ue,k as _e,l as I}from"./chunk-6WYQITK5.js";import"./chunk-NIXUCLGK.js";import{h as me,ma as M,na as P,oa as z,q as F,z as Z}from"./chunk-S7GYMRNG.js";import{q as B,u as de}from"./chunk-JNPSWS74.js";import"./chunk-CABIONZL.js";import"./chunk-EMIJRNYJ.js";import{n as se}from"./chunk-FO7Q5A2R.js";import{$a as n,Bb as ne,Bc as p,Cc as m,Db as A,Dc as V,Eb as k,Fb as le,Hb as h,Ib as w,Jb as l,Kb as c,Lb as a,Mb as X,Qb as x,Ub as S,V as ie,Vb as s,ca as oe,ea as y,eb as C,gc as D,ic as d,jc as ce,kc as u,l as ee,la as f,lb as E,lc as L,ma as g,qb as v,r as W,t as te,va as re,vc as O,wc as ae,xc as pe}from"./chunk-7BND6AGV.js";import"./chunk-2RGDSI3Q.js";import"./chunk-FK6H3RFT.js";import"./chunk-C6Q5SG76.js";var J=new oe("CategorizedProductsList",{factory:()=>{let t=y(I),i=y(ue);return ee(t.loadAll()).pipe(ie(()=>t.products$)).pipe(W(r=>r.toSorted((o,_)=>o.name.localeCompare(_.name))),W(r=>me(r,"category_id")),te(async r=>{let o=[],_=Object.keys(r).filter(T=>T!==""),be=await i.getMany(_);for(let T of be){let b=r[T.uuid];b&&b.length&&o.push({category:T.toString(),products:b})}if(!o.length)return[];let[Q,...Y]=o.toSorted((T,b)=>T.category>b.category?1:-1);return Q?.category?[Q].concat(Y):Y.concat([Q])}))}});var Re=t=>({length:t}),Ee=(t,i)=>i.uuid;function Ae(t,i){if(t&1){let e=x();c(0,"lg-button",4),S("click",function(){f(e);let o=s(2);return g(o.selectionZoneService.onSelection())}),d(1),p(2,"translate"),a()}t&2&&(D("success"),l("flat",!0)("size","small"),n(),u(" ",m(2,5,"select-many-label")," "))}function ke(t,i){if(t&1){let e=x();c(0,"lg-button",4),S("click",function(){f(e);let o=s(2);return g(o.deleteAllDrafts())}),d(1),p(2,"translate"),a()}t&2&&(D("danger"),l("flat",!0)("size","small"),n(),u(" ",m(2,5,"delete-all-label")," "))}function Oe(t,i){if(t&1){let e=x();c(0,"lg-button",5),S("click",function(){f(e);let o=s(3);return g(o.deletedSelectedDrafts())}),d(1),p(2,"translate"),a()}if(t&2){let e=s();D("danger"),l("flat",!0)("disabled",!(e!=null&&e.size))("size","small"),n(),u(" ",m(2,6,"delete-selected-label")," ")}}function Ve(t,i){t&1&&v(0,Oe,3,8,"ng-template",1)}function Be(t,i){t&1&&(d(0),p(1,"translate")),t&2&&u(" ",m(1,1,"draft.list-prefix.existing")," ")}function Fe(t,i){t&1&&(d(0),p(1,"translate")),t&2&&u(" ",m(1,1,"draft.list-prefix.new")," ")}function Ze(t,i){if(t&1&&(c(0,"lg-flex-row",6)(1,"a",7),A(2,Be,2,3)(3,Fe,2,3),d(4),a(),c(5,"small",8),d(6),p(7,"translate"),p(8,"timeAgo"),a()()),t&2){let e=s().$implicit;l("center",!0),n(),l("routerLink","/products/draft/"+(e==null?null:e.uuid)),n(),k(!(e==null||e.meta==null)&&e.meta.uuid?2:3),n(2),u(" ",(e==null||e.data==null?null:e.data.name)||"Unknown"," "),n(2),L(" ",m(7,6,"edited-at-label")," ",m(8,8,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," ")}}function Me(t,i){if(t&1&&v(0,Ze,9,10,"ng-template",3),t&2){let e=i.$implicit;l("uuid",e.uuid)}}function je(t,i){if(t&1){let e=x();c(0,"lg-expander",0),p(1,"translate"),p(2,"translate"),c(3,"lg-inline-separated-group"),v(4,Ae,3,7,"ng-template",1)(5,ke,3,7,"ng-template",1),A(6,Ve,1,0,null,1),a(),c(7,"lg-card-list",2),S("onSelected",function(o){f(e);let _=s();return g(_.selectionZoneService.putSelected(o))})("onDeleteOne",function(o){f(e);let _=s();return g(_.deleteDraft(o==null?null:o.uuid))}),h(8,Me,1,1,null,3,Ee),a()()}if(t&2){let e,r,o=s();l("closeLabel",m(1,6,"drafts-close-label"))("openLabel",V(2,8,"drafts-label",pe(11,Re,(e=o.drafts())==null?null:e.length))),n(6),k((r=o.selectionZoneService.selected())?6:-1,r),n(),l("mode",o.selectionZoneService.selectionMode())("selectAll",o.selectionZoneService.selectAll())("deselectAll",o.selectionZoneService.deselectAll()),n(),w(o.drafts())}}var K=class t{constructor(i,e,r){this._productsRepository=i;this._notificationsService=e;this.selectionZoneService=r}products=F(y(J));drafts=re([]);ProductDbInputScheme=R;get hidden(){return this.drafts()?.length===0?!0:null}deleteDraft(i){i&&(this._productsRepository.removeDraftProduct(i),this.drafts.update(e=>e.filter(r=>r?.uuid!==i)))}deleteAllDrafts(){this._productsRepository.removeDraftMany(this.drafts().map(i=>i.uuid)).then(()=>{this.drafts.set([]),this._notificationsService.success("Drafts deleted")})}deletedSelectedDrafts(){let i=this.selectionZoneService.selected();i&&this._productsRepository.removeDraftMany(Array.from(i)).then(()=>{this.drafts.update(e=>e.filter(r=>!i.has(r.uuid))),this._notificationsService.success("Drafts deleted")})}ngOnInit(){let i=this._productsRepository.getDraftProducts();i&&this.drafts.set(i)}static \u0275fac=function(e){return new(e||t)(C(I),C(M),C(P))};static \u0275cmp=E({type:t,selectors:[["lg-draft-products-list"]],hostVars:1,hostBindings:function(e,r){e&2&&ne("hidden",r.hidden)},features:[O([P])],decls:1,vars:1,consts:[[3,"closeLabel","openLabel"],["lgInlineSeparatedGroup",""],[2,"--card-bg","var(--card-bg-draft)",3,"onSelected","onDeleteOne","mode","selectAll","deselectAll"],["lgCardListItem","","type","draft",3,"uuid"],[3,"click","flat","size"],[3,"click","flat","disabled","size"],[3,"center"],["lgExpand","",3,"routerLink"],["lgPull","",1,"text-muted","text-cursive"]],template:function(e,r){if(e&1&&A(0,je,10,13,"lg-expander",0),e&2){let o;k((o=r.drafts())!=null&&o.length?0:-1)}},dependencies:[N,z,H,U,B,j,q,xe,Z,Te,$,G],encapsulation:2})};var Ne=()=>["product"],ze=(t,i)=>(i.uuid??"")+t;function Ge(t,i){if(t&1){let e=x();c(0,"lg-button",5),S("click",function(){f(e);let o=s();return g(o.exportProducts(o.selectionZoneService.selected()))}),d(1),p(2,"translate"),a()}t&2&&(D("info"),l("flat",!0)("size","small"),n(),u(" ",m(2,5,"export-label")," products "))}function $e(t,i){if(t&1&&(c(0,"span"),d(1),a()),t&2){let e=i.$implicit;n(),ce(e==null?null:e.name)}}function Ue(t,i){if(t&1){let e=x();c(0,"lg-import",6),p(1,"translate"),S("onDone",function(){f(e);let o=s();return g(o.loadProducts())}),v(2,$e,2,1,"ng-template",7),a()}if(t&2){let e=s();l("label",m(1,3,"import-label")+" products")("schema",e.ProductScheme)("storeName",e.Stores.PRODUCTS)}}function He(t,i){if(t&1&&(c(0,"lg-flex-row",4)(1,"div",11)(2,"lg-flex-row",4)(3,"lg-flex-row",12)(4,"a",13),d(5),a(),c(6,"div"),d(7),p(8,"userCurrency"),a()(),c(9,"small",14),d(10),p(11,"translate"),p(12,"timeAgo"),a()()()()),t&2){let e=s().$implicit;l("center",!0),n(2),l("center",!0),n(),l("center",!0),n(),l("routerLink","/products/edit/"+e.uuid),n(),L(" ",e.name," ",e.source?"- "+e.source:""," "),n(2),L(" ",V(8,10,e.pricePerUnit,"1.0-5")," ",e.perUnitLabel," "),n(3),L(" ",m(11,13,"edited-at-label")," ",m(12,15,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," ")}}function qe(t,i){if(t&1&&v(0,He,13,17,"ng-template",10),t&2){let e=i.$implicit;l("uuid",e.uuid)}}function Je(t,i){if(t&1){let e=x();c(0,"lg-title",8),d(1),p(2,"translate"),a(),c(3,"lg-card-list",9),S("onSelected",function(o){f(e);let _=s();return g(_.selectionZoneService.putSelected(o))})("onDeleteOne",function(o){f(e);let _=s();return g(_.deleteProduct(o))}),h(4,qe,1,1,null,10,ze),a()}if(t&2){let e=i.$implicit,r=s();l("level",3),n(),u(" ",(e==null?null:e.category)||m(2,5,"without-category-label")," "),n(2),l("mode",r.selectionZoneService.selectionMode())("selectAll",r.selectionZoneService.selectAll())("deselectAll",r.selectionZoneService.deselectAll()),n(),w(e.products)}}function Ke(t,i){t&1&&(c(0,"lg-flex-row",4)(1,"lg-title",8),d(2),p(3,"translate"),a()()),t&2&&(l("center",!0),n(),l("level",5),n(),u(" ",m(3,3,"no-products")," "))}var Ie=class t{constructor(i,e,r,o){this._productsRepository=i;this._transferDataService=e;this._notificationsService=r;this.selectionZoneService=o}products=F(y(J));ProductDbInputScheme=R;Stores=de;ProductScheme=R;exportProducts(i){this._transferDataService.exportTable("productsStore","json",{selected:Array.from(i??[])})}deleteProduct(i){i?.uuid&&this._productsRepository.deleteProduct(i.uuid).then(()=>{this._notificationsService.success("Product deleted"),this.loadProducts()})}ngOnInit(){this.loadProducts()}loadProducts(){this._productsRepository.loadAll()}static \u0275fac=function(e){return new(e||t)(C(I),C(_e),C(M),C(P))};static \u0275cmp=E({type:t,selectors:[["lg-product-list"]],features:[O([P,se])],decls:16,vars:11,consts:[[3,"icon","link","size"],["aria-hidden","false","fontIcon","add"],["lgInlineSeparatedGroup",""],[3,"selectionTypes"],[3,"center"],[3,"click","flat","size"],[3,"onDone","label","schema","storeName"],["lgImportRowTpl",""],[3,"level"],[3,"onSelected","onDeleteOne","mode","selectAll","deselectAll"],["lgCardListItem","","type","product",3,"uuid"],[1,"expand"],["lgExpand","",3,"center"],[3,"routerLink"],[1,"text-muted","text-cursive"]],template:function(e,r){e&1&&(c(0,"lg-controls-bar")(1,"lg-button",0),X(2,"mat-icon",1),a(),c(3,"lg-inline-separated-group"),v(4,Ge,3,7,"ng-template",2)(5,Ue,3,5,"ng-template",2),a()(),c(6,"lg-fade-in")(7,"lg-container")(8,"lg-title"),d(9),p(10,"translate"),a(),X(11,"lg-draft-products-list")(12,"lg-selection-tools",3),h(13,Je,6,7,null,null,le,!1,Ke,4,5,"lg-flex-row",4),a()()),e&2&&(n(),D("success"),l("icon",!0)("link","/products/add")("size","medium"),n(8),u(" ",m(10,8,"products.list-title")," "),n(3),l("selectionTypes",ae(10,Ne)),n(),w(r.products()))},dependencies:[N,z,Se,fe,ge,H,U,Pe,B,ve,Ce,ye,De,j,q,Z,K,$,G,Le],styles:["[_nghost-%COMP%]{display:block}"]})};export{Ie as ProductListComponent};
