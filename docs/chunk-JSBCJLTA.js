import{a as re}from"./chunk-RBGSIQNE.js";import{a as ie}from"./chunk-4AJ4ZPW6.js";import{a as oe}from"./chunk-NVKU3EAN.js";import{a as ee}from"./chunk-IQGSUA4J.js";import{a as ne}from"./chunk-2PXFNS3H.js";import{a as Ot}from"./chunk-VMYCS2MK.js";import{a as Yt,b as Kt}from"./chunk-4GF4XO2H.js";import{a as te}from"./chunk-VQVMM7PF.js";import{f as Gt}from"./chunk-2SA2DJOV.js";import{a as Xt}from"./chunk-QV3J2WNJ.js";import{a as Jt}from"./chunk-5SETSLBD.js";import{a as $t}from"./chunk-YQVS65SW.js";import{a as qt,b as Lt,c as zt}from"./chunk-JIX6S6OM.js";import{a as Zt}from"./chunk-PDWU57BK.js";import{a as Qt}from"./chunk-XJ4QFZPO.js";import"./chunk-CWUUYJTE.js";import{a as Wt,b as jt}from"./chunk-RAQDWDKG.js";import{a as Ht}from"./chunk-T6WLNLQD.js";import{v as Ut}from"./chunk-VUJEMPM4.js";import{a as Vt}from"./chunk-UKFGKW5Z.js";import{a as Mt}from"./chunk-FV4RUXOV.js";import{a as X}from"./chunk-BW6KPQFF.js";import{a as Bt}from"./chunk-IJ46JICA.js";import{a as K}from"./chunk-XTIJKHFS.js";import{a as Nt}from"./chunk-FMODVMJQ.js";import"./chunk-MPFUNZLY.js";import{a as kt}from"./chunk-UEOYHVW7.js";import{j as Ft,l as Y}from"./chunk-6WYQITK5.js";import"./chunk-NIXUCLGK.js";import{G as L,I as wt,J as St,K as Rt,M as T,O as At,R as Tt,U as Et,Y as It,c as rt,ha as Dt,i as lt,ma as z,oa as $,z as N}from"./chunk-S7GYMRNG.js";import{m as bt,p as q}from"./chunk-JNPSWS74.js";import"./chunk-CABIONZL.js";import"./chunk-EMIJRNYJ.js";import{f as xt,n as Pt}from"./chunk-FO7Q5A2R.js";import{$a as n,Bc as p,Cc as s,Db as f,Dc as O,Eb as _,H as W,J as mt,Jb as d,Kb as l,Lb as a,Lc as yt,Mb as P,Mc as G,Pc as Q,Qb as w,Qc as V,Rc as k,Ub as g,Vb as m,Wb as _t,Xb as it,Za as ut,_a as ot,bc as F,cc as M,db as ft,dc as A,ea as I,eb as x,ec as gt,fc as j,gc as U,ic as u,jc as H,kc as b,la as v,lb as R,lc as nt,ma as y,qb as D,s as st,va as C,vc as Ct,wc as ht,xc as vt}from"./chunk-7BND6AGV.js";import"./chunk-2RGDSI3Q.js";import"./chunk-FK6H3RFT.js";import"./chunk-C6Q5SG76.js";var ae=["element"],de=["*",[["content"]]],pe=["*","content"];function ce(i,e){if(i&1&&(l(0,"div",4,0),it(2,1),a(),P(3,"lg-portal",5)),i&2){let t=A(1);n(3),d("appendTarget","body")("targetElement",t)("wrapClass","tooltip tooltip--ejected")}}var J=class i{constructor(){}renderer=I(ft);gap=V(16);displayed=C(!1);full=V(!1);position=V("top");element=k("element");onClose=Q();coordinates=C({x:0,y:0});coordinatesEffect=G(()=>{this.renderer.setProperty(document.body,"style",`--tooltip-x: ${this.coordinates().x}px;--tooltip-y: ${this.coordinates().y}px;`)});toggle(e){if(this.displayed.set(!this.displayed()),this.displayed()||this.onClose.emit(),e){e.stopPropagation();let[t,o]=[e.clientX,e.clientY];console.log("x",t,"y",o),setTimeout(()=>{let c=this.element()?.nativeElement?.getBoundingClientRect(),h=c?.width,E=c?.height,pt=window.innerWidth,ct=window.innerHeight,S=16,tt=t,et=o;t+h+S>pt&&(tt=pt-h-S),o+E+S>ct&&(et=ct-E-S),t-h-S<0&&(tt=S),o-E-S<0&&(et=S),this.coordinates.set({x:tt,y:et})})}}close(){this.displayed.set(!1),this.onClose.emit()}onClick(e){e.target instanceof HTMLElement&&(e.target.closest(".tooltip")||(this.displayed.set(!1),this.onClose.emit()))}onKeydown(e){e.key==="Escape"&&(this.displayed.set(!1),this.onClose.emit())}onScroll(e){this.displayed.set(!1),this.onClose.emit()}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=R({type:i,selectors:[["lg-tooltip"]],viewQuery:function(t,o){t&1&&F(o.element,ae,5),t&2&&M()},hostBindings:function(t,o){t&1&&g("click",function(c){return o.onClick(c)},ot)("keydown",function(c){return o.onKeydown(c)},ot)("scroll",function(c){return o.onScroll(c)},ut)},inputs:{gap:[1,"gap"],full:[1,"full"],position:[1,"position"]},outputs:{onClose:"onClose"},ngContentSelectors:pe,decls:5,vars:6,consts:[["element",""],[1,"tooltip",3,"ngClass"],[1,"tooltip__anchor"],[3,"click"],[1,"tooltip__content"],[3,"appendTarget","targetElement","wrapClass"]],template:function(t,o){t&1&&(_t(de),l(0,"div",1)(1,"div",2)(2,"div",3),g("click",function(c){return o.toggle(c)}),it(3),a(),f(4,ce,4,3),a()()),t&2&&(gt("--gap",o.gap(),"px"),j("fullscreen",o.full()),d("ngClass",o.position()),n(4),_(o.displayed()?4:-1))},dependencies:[xt,Ot],styles:[`lg-tooltip{flex:1;display:flex}.tooltip{display:inline-block}.tooltip--ejected{position:fixed;z-index:6;inset:0}.tooltip--ejected .tooltip__content{inset:0;position:fixed;display:flex;align-items:center;justify-content:center;padding-top:calc(var(--header-height) + 12px + 16px + 16px)}.tooltip__anchor{position:relative}.tooltip__content{position:absolute;background-color:#fff;border-radius:16px;padding:16px;box-shadow:0 4px 8px #0000001a;z-index:100}.tooltip.top .tooltip__content,.tooltip.bottom .tooltip__content{bottom:calc(100% + var(--gap));right:50%;transform:translate(50%)}.tooltip.left .tooltip__content{bottom:50%;right:calc(100% + var(--gap));transform:translateY(50%)}.tooltip.right .tooltip__content{bottom:50%;left:calc(100% + var(--gap));transform:translateY(-50%)}.tooltip.fullscreen .tooltip__content{position:fixed;inset:0;background-color:#fff;border-radius:0;padding:32px;transform:none;overflow-y:auto}
`],encapsulation:2})};function se(i,e){if(i&1){let t=w();l(0,"div",3)(1,"lg-eggs-widget",4),g("changed",function(r){v(t);let c=m();return y(c.onEggsChanged(r))}),a()()}}var Z=class i{constructor(){}eggsChanged=Q();selectedWidget=C(null);onWidgetSelect(e){this.selectedWidget.set(e)}onEggsChanged(e){e&&this.eggsChanged.emit(e)}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=R({type:i,selectors:[["lg-amount-widgets"]],outputs:{eggsChanged:"eggsChanged"},decls:6,vars:6,consts:[[1,"amount-widgets"],[1,"amount-widgets__buttons"],[1,"amount-widgets__button",3,"click"],[1,"amount-widgets__wrapper"],[3,"changed"]],template:function(t,o){t&1&&(l(0,"div",0)(1,"div",1)(2,"button",2),g("click",function(){return o.onWidgetSelect("eggs")}),u(3),p(4,"translate"),a()(),f(5,se,2,0,"div",3),a()),t&2&&(j("selected",o.selectedWidget()!=null),n(3),b("",s(4,4,"widgets.eggs.title")," "),n(2),_(o.selectedWidget()==="eggs"?5:-1))},dependencies:[re,N],styles:[".amount-widgets[_ngcontent-%COMP%]{display:flex;gap:16px;flex-direction:column}.amount-widgets__input[_ngcontent-%COMP%]{flex:1}.amount-widgets__buttons[_ngcontent-%COMP%]{display:flex;gap:16px;flex-wrap:wrap;padding:16px;background-color:#fafafa;border-radius:12px;margin:-16px}.amount-widgets.selected[_ngcontent-%COMP%]   .amount-widgets__buttons[_ngcontent-%COMP%]{margin-bottom:0}.amount-widgets__button[_ngcontent-%COMP%]{display:flex;padding:8px 16px;border-radius:16px;background-color:#e5de38;appearance:none;border:none;font-family:inherit;font-size:inherit}"]})};var _e=["nameField"],ge=i=>({unit:i}),Ce=()=>({currency:"EUR"});function he(i,e){if(i&1){let t=w();l(0,"lg-flex-row",19)(1,"lg-tooltip",20)(2,"lg-button",21),P(3,"mat-icon",22),a(),l(4,"div",23)(5,"lg-amount-widgets",24),g("eggsChanged",function(r){v(t);let c=m();return y(c.eggsChanged(r))}),a()()(),P(6,"lg-unit-switcher",25),a()}i&2&&(d("center",!0)("size","small"),n(),d("position","left"),n(),U("success"),d("flat",!0)("icon",!0))}function ve(i,e){if(i&1&&(l(0,"span"),u(1),p(2,"currencySymbol"),a()),i&2){let t=m();n(),H(s(2,1,t.userSettings().currency))}}function ye(i,e){if(i&1&&P(0,"lg-chips-list",17),i&2){let t=m(),o=A(31);d("control",o)("items",t.topCategories())}}var B=class i{constructor(e,t,o,r){this._productsRepository=e;this._selectResourcesService=t;this._router=o;this._notificationsService=r}form=new Rt({name:new T(null,L.required),amount:new T(null,L.required),price:new T(null,L.required),unit:new T("gram"),source:new T(null),category_id:new T(null)});userSettings=I(Dt);product=V(null);topCategories=C([]);topSources=C([]);nameField=k("nameField");productEffect=G(()=>{!this.product()||this.form.dirty||(this.form.reset(lt(this.product())),this.form.markAsPristine())});get _defFormValue(){return{name:null,amount:null,price:null,source:null,category_id:null,unit:"gram"}}get _formValid(){return this.form.valid}eggsChanged(e){this.form.patchValue({amount:e})}ngOnInit(){this._loadUsingHistory(),this.form.valueChanges.pipe(W(100)).subscribe(e=>{this.form.dirty&&this.product()?.update(e)})}resetForm(e){this.form.reset(e?lt(e):this._defFormValue),this.form.markAsPristine(),this._loadUsingHistory()}validateForm(){return this._formValid?!0:(this._notificationsService.error(this._notificationsService.parseFormErrors(this.form).join(", ")),!1)}ngAfterViewInit(){this._selectResourcesService.load().then(e=>{}),this.product()?.uuid||this.nameField().focus(),this.form.markAsPristine()}_loadUsingHistory(){this._productsRepository.getTopCategories().then(e=>{this.topCategories.set(e.map(t=>({label:t.name,value:t.uuid??"",color:t.ownColor})))}),this._productsRepository.getTopSources().then(e=>{this.topSources.set(e.map(t=>({label:t,value:t})))})}smaller=Lt;static \u0275fac=function(t){return new(t||i)(x(Y),x(Ft),x(q),x(z))};static \u0275cmp=R({type:i,selectors:[["lg-add-product-form"]],viewQuery:function(t,o){t&1&&F(o.nameField,_e,5),t&2&&M()},inputs:{product:[1,"product"]},decls:33,vars:33,consts:[["nameField",""],["priceInput",""],["sourceInput",""],["sourceChips",""],["categorySelect",""],[3,"formGroup"],[3,"label"],["formControlName","name","placeholder",""],[3,"center","mobileMode"],["lgExpand","",3,"label"],["formControlName","amount","lgParseMath","","placeholder","",3,"onInputChange"],["lgExtraTpl","","place","after"],["lgWidth","40%",3,"label"],["formControlName","price","lgParseMath","","placeholder",""],[2,"--control-bg","var(--hr-bg-strong)",3,"equal","mobileMode","top"],["appendTo","body","formControlName","source","placeholder","",3,"onSelected","noLoad","resource"],[3,"hidden"],[3,"control","items"],["appendTo","body","formControlName","category_id","placeholder","",3,"resource"],[3,"center","size"],[3,"position"],[3,"flat","icon"],["aria-hidden","false","fontIcon","add"],["ngProjectAs","content",5,["content"]],[3,"eggsChanged"],["formControlName","unit"]],template:function(t,o){if(t&1){let r=w();l(0,"form",5)(1,"lg-flex-column")(2,"lg-card")(3,"lg-flex-column")(4,"lg-control",6),p(5,"translate"),P(6,"lg-input",7,0),a(),l(8,"lg-flex-row",8)(9,"lg-control",9),p(10,"translate"),l(11,"lg-number-input",10),g("onInputChange",function(){v(r);let h=A(16);return y(h.focus())}),D(12,he,7,7,"ng-template",11),a()(),l(13,"lg-control",12),p(14,"translate"),l(15,"lg-number-input",13,1),D(17,ve,3,3,"ng-template",11),a()()()()(),l(18,"lg-flex-row",14)(19,"lg-control",6),p(20,"translate"),l(21,"lg-flex-column")(22,"lg-autocomplete",15,2),g("onSelected",function(){v(r);let h=A(26);return y(h.clearSelected())}),a(),l(24,"div",16),P(25,"lg-chips-list",17,3),a()()(),l(27,"lg-control",6),p(28,"translate"),l(29,"lg-flex-column"),P(30,"lg-multiselect",18,4),f(32,ye,1,2,"lg-chips-list",17),a()()()()()}if(t&2){let r=A(23);d("formGroup",o.form),n(4),d("label",s(5,18,"product.form.name.placeholder")),n(4),d("center",!0)("mobileMode",!0),n(),d("label",O(10,20,"product.form.amount.placeholder",vt(30,ge,o.form.value.unit))),n(4),d("label",O(14,23,"product.form.price.placeholder",ht(32,Ce))),n(5),d("equal",!0)("mobileMode",!0)("top",!0),n(),d("label",s(20,26,"product.form.source.placeholder")),n(3),d("noLoad",!0)("resource","sources"),n(2),d("hidden",!o.topSources().length),n(),d("control",r)("items",o.topSources()),n(2),d("label",s(28,28,"product.form.category_id.placeholder")),n(3),d("resource","categories"),n(2),_(o.topCategories().length?32:-1)}},dependencies:[It,At,wt,St,Tt,Et,K,Gt,qt,J,Z,zt,X,Ht,Yt,Kt,N,Vt,Ut,$,ee,Xt,ie,ne,Qt,$t],styles:[`lg-eggs-widget{min-width:300px}
`],encapsulation:2})};function xe(i,e){if(i&1&&(l(0,"lg-title"),u(1),a()),i&2){let t,o=m();n(),b(" ",(t=o.product())==null?null:t.name," ")}}function Pe(i,e){i&1&&(l(0,"lg-title"),u(1),p(2,"translate"),a()),i&2&&(n(),b(" ",s(2,1,"product.form.title")," "))}function be(i,e){if(i&1&&(u(0),p(1,"userCurrency")),i&2){let t,o=m();nt(" (",(t=o.product())==null?null:t.perUnitLabel," ",O(1,2,(t=o.product())==null?null:t.pricePerUnit,"1.0-5"),") ")}}function we(i,e){i&1&&(l(0,"span"),u(1),p(2,"translate"),a()),i&2&&(n(),H(s(2,1,"saved-draft-label")))}function Se(i,e){i&1&&D(0,we,3,3,"ng-template",2)}function Re(i,e){if(i&1){let t=w();l(0,"lg-button",8),g("click",function(){v(t);let r=m(2);return y(r.onRemoveDraft())}),u(1),p(2,"translate"),a()}i&2&&(U("danger"),d("flat",!0),n(),b(" ",s(2,4,"product.form.delete-draft-btn")," "))}function Ae(i,e){if(i&1){let t=w();l(0,"lg-button",8),g("click",function(){v(t);let r=m(2);return y(r.onDeleteProduct())}),u(1),p(2,"translate"),a()}i&2&&(U("danger"),d("flat",!0),n(),b(" ",s(2,4,"product.form.delete-btn")," "))}function Te(i,e){if(i&1&&f(0,Re,3,6,"lg-button",7)(1,Ae,3,6,"lg-button",7),i&2){let t,o=m();_(o.isDraftRoute()?0:(t=o.product())!=null&&t.uuid?1:-1)}}function Ee(i,e){if(i&1&&(l(0,"small",3),u(1),p(2,"translate"),p(3,"timeAgo"),a()),i&2){let t,o=m();n(),nt(" ",s(2,2,"edited-at-label")," ",s(3,4,(t=o.product())==null?null:t.updatedAt)," ")}}function Ie(i,e){i&1&&(u(0),p(1,"translate")),i&2&&b(" ",s(1,1,"product.form.save-btn.edit.active")," ")}function De(i,e){i&1&&(u(0),p(1,"translate")),i&2&&b(" ",s(1,1,"product.form.save-btn.edit.disabled")," ")}function Fe(i,e){if(i&1){let t=w();l(0,"lg-button",9),g("click",function(){v(t);let r=m();return y(r.onEditProduct())}),f(1,Ie,2,3)(2,De,2,3),a()}if(i&2){let t,o,r=m();d("disabled",!(!((t=r.formComponent())==null||t.form==null)&&t.form.dirty)&&!r.draftRef()),n(),_(!((o=r.formComponent())==null||o.form==null)&&o.form.dirty||r.draftRef()?1:2)}}function Me(i,e){i&1&&(u(0),p(1,"translate")),i&2&&b(" ",s(1,1,"product.form.save-btn.add.active")," ")}function Ve(i,e){i&1&&(u(0),p(1,"translate")),i&2&&b(" ",s(1,1,"product.form.save-btn.add.disabled")," ")}function ke(i,e){if(i&1){let t=w();l(0,"lg-button",9),g("click",function(){v(t);let r=m();return y(r.onAddProduct())}),f(1,Me,2,3)(2,Ve,2,3),a()}if(i&2){let t,o,r=m();d("disabled",!(!((t=r.formComponent())==null||t.form==null)&&t.form.dirty)&&!r.draftRef()),n(),_(!((o=r.formComponent())==null||o.form==null)&&o.form.dirty||r.draftRef()?1:2)}}var le=class i{constructor(e,t,o,r,c){this._router=e;this._aRoute=t;this._productsRepository=o;this._notificationsService=r;this._analyticsService=c}draftOrProductUUID=C(void 0);product=C(null);formComponent=k(B);draftRef=C(null);draftByExistingProduct=yt(()=>this.draftRef().meta?.uuid);isDraftRoute=C(!1);_routerManager=I(Zt);ngOnDestroy(){}ngOnInit(){st([this._aRoute.params,this._aRoute.data]).pipe(mt(1)).subscribe(([e,t])=>{this.draftOrProductUUID.set(e.uuid),t.draft?(this.draftRef.set(t.draft),this.product.set(rt.fromRaw(t.draft.data))):this.draftOrProductUUID()?this._loadProduct(this.draftOrProductUUID()):this.product.set(rt.empty()),this.isDraftRoute.set(!!t.draftRoute)})}ngAfterViewInit(){this.formComponent()?.form.valueChanges.pipe(W(500)).subscribe(e=>{!this.formComponent().form.dirty||!this.product()||(this.draftRef()?.uuid?this._productsRepository.updateDraftProduct(this.draftRef().uuid,this.product(),this.draftRef().meta?.uuid):this.product()&&(this.draftRef.set(this._productsRepository.saveDraftProduct(this.product(),this.draftOrProductUUID()??"")),this.isDraftRoute()||this._routerManager.replace(["products/draft/"+this.draftRef().uuid])))})}onAddProduct(){!this.formComponent()?.validateForm()||!this.product()||this._addProduct(this.product())}onEditProduct(){!this.formComponent()?.validateForm()||!this.product()||this._editProduct(this.product())}onRemoveDraft(){this._removeDraft(),this._routerManager.navigate(["products"])}onDeleteProduct(){this.product()?.uuid&&this._productsRepository.deleteProduct(this.product().uuid).then(()=>{this._notificationsService.success("Product deleted"),this._routerManager.navigate(["products"])})}_addProduct(e){this._productsRepository.addOne(e).then(t=>{this._analyticsService.trackProductCreated(e.name,{product_uuid:t,price_per_unit:e.pricePerUnit,unit:e.unit,category:e.category_id?.name}),this.formComponent()?.resetForm(),this._notificationsService.success("Product added"),this.product.set(null),this.draftRef()&&this._removeDraft(),this._routerManager.navigateWithReset(["products/edit/"+t])})}_editProduct(e){if(!this.draftOrProductUUID())return;let t=this.draftRef()?.meta?.uuid??this.draftOrProductUUID();this._productsRepository.updateOne(t,e).then(()=>{this.formComponent()?.resetForm(e),this._notificationsService.success("Product edited"),this.draftRef()&&this._removeDraft(),this._routerManager.navigateWithReset(["products","edit",t])})}_removeDraft(){this.draftRef()&&(this._productsRepository.removeDraftProduct(this.draftRef().uuid),this.draftRef.set(null))}_loadProduct(e){e&&this._productsRepository.getOne(e,!0).then(t=>{t&&this.product.set(t)})}static \u0275fac=function(t){return new(t||i)(x(q),x(bt),x(Y),x(z),x(te))};static \u0275cmp=R({type:i,selectors:[["app-add-recipe"]],viewQuery:function(t,o){t&1&&F(o.formComponent,B,5),t&2&&M()},features:[Ct([Pt])],decls:15,vars:10,consts:[["size","medium"],[3,"center","mobileMode"],["lgInlineSeparatedGroup",""],[1,"text-muted","text-cursive"],[3,"product"],[3,"mobileMode","relaxed"],["lgShrink","",3,"disabled"],["lgShrink","",3,"style","flat"],["lgShrink","",3,"click","flat"],["lgShrink","",3,"click","disabled"]],template:function(t,o){if(t&1&&(l(0,"lg-fade-in")(1,"lg-container")(2,"lg-flex-column",0)(3,"lg-flex-row",1),f(4,xe,2,1,"lg-title")(5,Pe,3,3,"lg-title"),f(6,be,2,5),a(),l(7,"lg-inline-separated-group"),f(8,Se,1,0,null,2),D(9,Te,2,1,"ng-template",2),a(),f(10,Ee,4,6,"small",3),a(),P(11,"lg-add-product-form",4),l(12,"lg-flex-row",5),f(13,Fe,3,2,"lg-button",6)(14,ke,3,2,"lg-button",6),a()()()),t&2){let r,c,h,E;n(3),d("center",!0)("mobileMode",!0),n(),_((r=o.product())!=null&&r.uuid&&!o.draftRef()||o.draftRef()&&o.draftByExistingProduct()?4:5),n(2),_((c=o.product())!=null&&c.pricePerUnit?6:-1),n(2),_(o.draftRef()&&(!((h=o.formComponent())==null||h.form==null)&&h.form.dirty)?8:-1),n(2),_((E=o.product())!=null&&E.updatedAt?10:-1),n(),d("product",o.product()),n(),d("mobileMode",!0)("relaxed",!0),n(),_(o.product()&&!o.draftRef()||o.draftRef()&&o.draftByExistingProduct()?13:14)}},dependencies:[Mt,kt,B,X,Nt,$,Jt,Bt,N,K,oe,jt,Wt],encapsulation:2})};export{le as AddProductComponent};
