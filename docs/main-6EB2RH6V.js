import{a as Pe,b as Ae}from"./chunk-UUQD5OCZ.js";import{a as R}from"./chunk-VPI3UFS2.js";import{a as I}from"./chunk-CQDQLFXT.js";import{a as xe}from"./chunk-TG44ZCI4.js";import{b as _e}from"./chunk-HLUOBQIS.js";import{c as Ee}from"./chunk-2H6ZB4B2.js";import{a as L}from"./chunk-K3OSNH4A.js";import"./chunk-3EENQPAB.js";import"./chunk-BZLRTCBN.js";import{d as Q}from"./chunk-T5OOR2YZ.js";import{Bb as he,C,Ca as re,Da as ne,Eb as ge,Ga as ie,H as E,Ha as se,Ia as f,Ja as h,Ka as v,M as H,O as Y,Oa as ae,P as K,Pa as pe,Q as a,Qa as ce,R as J,Tb as ve,U as X,V as ee,Vb as ye,W as te,Xb as Ce,Yb as be,Z as z,Za as le,_a as ue,_b as we,a as G,ab as T,ac as Re,bc as Se,cb as de,cc as ke,ea as oe,f as d,hb as me,i as _,ia as b,ib as g,j as O,na as w,r as k,sb as fe,ta as M,ua as Z,w as y,wa as P,x as V}from"./chunk-FL5UAJ26.js";var F=(e,o)=>e.reduce((t,n)=>{let r=n[o]||"unknown";return t[r]||(t[r]=[]),t[r].push(n),t},{});var Oe=(e,o)=>d(void 0,null,function*(){let t=a(R),n=a(I),s=(yield t.getRecipes()).toSorted((p,m)=>p.name.localeCompare(m.name)),i=F(s,"category_id"),c=[];for(let p in i){let m=i[p],U=yield n.getOne(p);c.push({category:U?.name,recipes:m})}if(!c.length)return[];let[l,...u]=c.toSorted((p,m)=>p.category>m.category?1:-1);return l?.category?[l].concat(u):u.concat([l])});var $=(e,o)=>d(void 0,null,function*(){let t=e.paramMap.get("uuid");return a(R)?.getOne(t)});var Me=(e,o)=>d(void 0,null,function*(){let t=e.paramMap.get("uuid");return a(Pe)?.calculateRecipe(t)});var Te=(e,o)=>d(void 0,null,function*(){let t=e.paramMap.get("uuid"),n=a(R),r=a(Ae),i=(yield n.getOne(t))?.taxTemplateName;return i?r.getTemplateByName("tax",i):null});var Ie=(e,o)=>d(void 0,null,function*(){let t=a(Ee),n=a(L),s=(yield t.getProducts()).toSorted((p,m)=>p.name.localeCompare(m.name)),i=F(s,"category_id"),c=[];for(let p in i){let m=i[p],U=yield n.getOne(p);c.push({category:U?.name,products:m})}if(!c.length)return[];let[l,...u]=c.toSorted((p,m)=>p.category>m.category?1:-1);return l?.category?[l].concat(u):u.concat([l])});var Le=[{path:"",children:[{path:"",redirectTo:"home",pathMatch:"full"},{path:"home",loadComponent:()=>import("./chunk-WFXB4J7K.js").then(e=>e.ApplicationComponent)},{path:"recipes",children:[{path:"",loadComponent:()=>import("./chunk-ADXMBFLY.js").then(e=>e.RecipesListComponent),resolve:{list:Oe}},{path:"add",loadComponent:()=>import("./chunk-3YQFYSM7.js").then(e=>e.AddRecipeComponent)},{path:"edit/:uuid",loadComponent:()=>import("./chunk-3YQFYSM7.js").then(e=>e.AddRecipeComponent),resolve:{recipe:$}},{path:"calculate/:uuid",loadComponent:()=>import("./chunk-N26WMA7N.js").then(e=>e.CalculateRecipeComponent),resolve:{result:Me,template:Te}}]},{path:"products",children:[{path:"",loadComponent:()=>import("./chunk-3FWBQM47.js").then(e=>e.ProductListComponent),resolve:{list:Ie}},{path:"add",loadComponent:()=>import("./chunk-GI26GYDM.js").then(e=>e.AddProductComponent)},{path:"edit/:uuid",loadComponent:()=>import("./chunk-GI26GYDM.js").then(e=>e.AddProductComponent),resolve:{product:$}}]},{path:"settings",children:[{path:"",loadComponent:()=>import("./chunk-NH5COVYO.js").then(e=>e.SettingsComponent)},{path:"categories",children:[{path:"products",children:[{path:"",loadComponent:()=>import("./chunk-R5Y42RHB.js").then(e=>e.CategoryListComponent)},{path:"add",loadComponent:()=>import("./chunk-ONWK65MP.js").then(e=>e.AddCategoryComponent)},{path:"edit/:uuid",loadComponent:()=>import("./chunk-ONWK65MP.js").then(e=>e.AddCategoryComponent)}]},{path:"recipes",children:[{path:"",loadComponent:()=>import("./chunk-ZVGJGF6L.js").then(e=>e.CategoryRecipeListComponent)},{path:"add",loadComponent:()=>import("./chunk-NB6QXCSG.js").then(e=>e.AddCategoryRecipeComponent)},{path:"edit/:uuid",loadComponent:()=>import("./chunk-NB6QXCSG.js").then(e=>e.AddCategoryRecipeComponent)}]}]}]},{path:"widgets",loadComponent:()=>import("./chunk-2WGIRMKR.js").then(e=>e.WidgetsPageComponent)}]}];var A="Service workers are disabled or not supported by this browser",S=class{serviceWorker;worker;registration;events;constructor(o,t){if(this.serviceWorker=o,!o)this.worker=this.events=this.registration=new _(n=>n.error(new Error(A)));else{let n=null,r=new O;this.worker=new _(u=>(n!==null&&u.next(n),r.subscribe(p=>u.next(p))));let s=()=>{let{controller:u}=o;u!==null&&(n=u,r.next(n))};o.addEventListener("controllerchange",s),s(),this.registration=this.worker.pipe(E(()=>o.getRegistration()));let i=new O;this.events=i.asObservable();let c=u=>{let{data:p}=u;p?.type&&i.next(p)};o.addEventListener("message",c),t?.get(Z,null,{optional:!0})?.onDestroy(()=>{o.removeEventListener("controllerchange",s),o.removeEventListener("message",c)})}}postMessage(o,t){return new Promise(n=>{this.worker.pipe(C(1)).subscribe(r=>{r.postMessage(G({action:o},t)),n()})})}postMessageWithOperation(o,t,n){let r=this.waitForOperationCompleted(n),s=this.postMessage(o,t);return Promise.all([s,r]).then(([,i])=>i)}generateNonce(){return Math.round(Math.random()*1e7)}eventsOfType(o){let t;return typeof o=="string"?t=n=>n.type===o:t=n=>o.includes(n.type),this.events.pipe(V(t))}nextEventOfType(o){return this.eventsOfType(o).pipe(C(1))}waitForOperationCompleted(o){return new Promise((t,n)=>{this.eventsOfType("OPERATION_COMPLETED").pipe(V(r=>r.nonce===o),C(1),k(r=>{if(r.result!==void 0)return r.result;throw new Error(r.error)})).subscribe({next:t,error:n})})}get isEnabled(){return!!this.serviceWorker}},Be=(()=>{class e{sw;messages;notificationClicks;subscription;get isEnabled(){return this.sw.isEnabled}pushManager=null;subscriptionChanges=new O;constructor(t){if(this.sw=t,!t.isEnabled){this.messages=y,this.notificationClicks=y,this.subscription=y;return}this.messages=this.sw.eventsOfType("PUSH").pipe(k(r=>r.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(k(r=>r.data)),this.pushManager=this.sw.registration.pipe(k(r=>r.pushManager));let n=this.pushManager.pipe(E(r=>r.getSubscription()));this.subscription=new _(r=>{let s=n.subscribe(r),i=this.subscriptionChanges.subscribe(r);return()=>{s.unsubscribe(),i.unsubscribe()}})}requestSubscription(t){if(!this.sw.isEnabled||this.pushManager===null)return Promise.reject(new Error(A));let n={userVisibleOnly:!0},r=this.decodeBase64(t.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),s=new Uint8Array(new ArrayBuffer(r.length));for(let i=0;i<r.length;i++)s[i]=r.charCodeAt(i);return n.applicationServerKey=s,new Promise((i,c)=>{this.pushManager.pipe(E(l=>l.subscribe(n)),C(1)).subscribe({next:l=>{this.subscriptionChanges.next(l),i(l)},error:c})})}unsubscribe(){if(!this.sw.isEnabled)return Promise.reject(new Error(A));let t=n=>{if(n===null)throw new Error("Not subscribed to push notifications.");return n.unsubscribe().then(r=>{if(!r)throw new Error("Unsubscribe failed!");this.subscriptionChanges.next(null)})};return new Promise((n,r)=>{this.subscription.pipe(C(1),E(t)).subscribe({next:n,error:r})})}decodeBase64(t){return atob(t)}static \u0275fac=function(n){return new(n||e)(K(S))};static \u0275prov=H({token:e,factory:e.\u0275fac})}return e})(),Ue=(()=>{class e{sw;versionUpdates;unrecoverable;get isEnabled(){return this.sw.isEnabled}constructor(t){if(this.sw=t,!t.isEnabled){this.versionUpdates=y,this.unrecoverable=y;return}this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY","NO_NEW_VERSION_DETECTED"]),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(A));let t=this.sw.generateNonce();return this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:t},t)}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(A));let t=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:t},t)}static \u0275fac=function(n){return new(n||e)(K(S))};static \u0275prov=H({token:e,factory:e.\u0275fac})}return e})();var De=new Y("");function Ve(){let e=a(x);if(!("serviceWorker"in navigator&&e.enabled!==!1))return;let o=a(De),t=a(oe),n=a(Z);t.runOutsideAngular(()=>{let r=navigator.serviceWorker,s=()=>r.controller?.postMessage({action:"INITIALIZE"});r.addEventListener("controllerchange",s),n.onDestroy(()=>{r.removeEventListener("controllerchange",s)})}),t.runOutsideAngular(()=>{let r,{registrationStrategy:s}=e;if(typeof s=="function")r=new Promise(i=>s().subscribe(()=>i()));else{let[i,...c]=(s||"registerWhenStable:30000").split(":");switch(i){case"registerImmediately":r=Promise.resolve();break;case"registerWithDelay":r=Fe(+c[0]||0);break;case"registerWhenStable":r=Promise.race([n.whenStable(),Fe(+c[0])]);break;default:throw new Error(`Unknown ServiceWorker registration strategy: ${e.registrationStrategy}`)}}r.then(()=>navigator.serviceWorker.register(o,{scope:e.scope}).catch(i=>console.error("Service worker registration failed with:",i)))})}function Fe(e){return new Promise(o=>setTimeout(o,e))}function He(e,o){return new S(e.enabled!==!1?navigator.serviceWorker:void 0,o)}var x=class{enabled;scope;registrationStrategy};function Ne(e,o={}){return J([Be,Ue,{provide:De,useValue:e},{provide:x,useValue:o},{provide:S,useFactory:He,deps:[x,te]},M(Ve)])}var je={providers:[fe({eventCoalescing:!0}),ke(Le),be(Ce()),_e(),ye(),M(()=>{let e=a(L),o=a(I);return Promise.all([e.preloadCategories(),o.preloadCategories()])}),Ne("ngsw-worker.js",{enabled:!ge(),registrationStrategy:"registerWhenStable:30000"})]};function Ke(e,o){if(e&1){let t=ae();f(0,"button",0),pe("click",function(){X(t);let r=ce();return ee(r.installPWA())}),T(1,"\u0423\u0441\u0442\u0430\u043D\u043E\u0432\u0438\u0442\u044C PWA"),h()}}var D=class e{deferredPrompt=null;showButton=!1;ngOnInit(){window.addEventListener("beforeinstallprompt",o=>{o.preventDefault(),this.deferredPrompt=o,this.showButton=!0})}installPWA(){return d(this,null,function*(){if(!this.deferredPrompt)return;this.deferredPrompt.prompt();let{outcome:o}=yield this.deferredPrompt.userChoice;o==="accepted"?(this.showButton=!1,console.log("PWA \u0443\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D\u0430!")):console.log("\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C \u043E\u0442\u043A\u0430\u0437\u0430\u043B\u0441\u044F \u043E\u0442 \u0443\u0441\u0442\u0430\u043D\u043E\u0432\u043A\u0438"),this.deferredPrompt=null,this.showButton=!1})}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=w({type:e,selectors:[["lg-pwa-install"]],decls:1,vars:1,consts:[[3,"click"]],template:function(t,n){t&1&&re(0,Ke,2,0,"button"),t&2&&ne(n.showButton?0:-1)},styles:["lg-pwa-install[_ngcontent-%COMP%]{display:flex}button[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;border:none;padding:10px 20px;cursor:pointer;width:100%}button[_ngcontent-%COMP%]:hover{background-color:#0056b3}"]})};var N=()=>({exact:!1}),j=()=>["route-active"],ze=(e,o)=>o.label;function Ze(e,o){if(e&1&&(f(0,"a",4),T(1),h()),e&2){let t=o.$implicit;P("routerLink",t.link)("routerLinkActive",g(4,j))("routerLinkActiveOptions",g(5,N)),b(),de(" ",t.label," ")}}var W=class e{constructor(){}items=z([{label:"Recipes",link:"/recipes"},{label:"Products",link:"/products"}]);activeIndex=z(0);links=he(Q);setActive(o){this.activeIndex.set(o)}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=w({type:e,selectors:[["lg-header"]],viewQuery:function(t,n){t&1&&le(n.links,Q,5),t&2&&ue()},decls:10,vars:15,consts:[[1,"lg-header"],[1,"lg-header__icon",3,"routerLinkActiveOptions","routerLinkActive","routerLink"],["aria-hidden","false","fontIcon","home"],[1,"lg-header__inner"],[1,"lg-header__link",3,"routerLink","routerLinkActive","routerLinkActiveOptions"],["aria-hidden","false","fontIcon","settings"],["aria-hidden","false","fontIcon","widgets"]],template:function(t,n){t&1&&(f(0,"header",0)(1,"a",1),v(2,"mat-icon",2),h(),f(3,"div",3),ie(4,Ze,2,6,"a",4,ze),h(),f(6,"a",1),v(7,"mat-icon",5),h(),f(8,"a",1),v(9,"mat-icon",6),h()()),t&2&&(b(),P("routerLinkActiveOptions",g(9,N))("routerLinkActive",g(10,j))("routerLink","/home"),b(3),se(n.items()),b(2),P("routerLinkActiveOptions",g(11,N))("routerLinkActive",g(12,j))("routerLink","/settings"),b(2),P("routerLinkActiveOptions",g(13,N))("routerLinkActive",g(14,j))("routerLink","/widgets"))},dependencies:[Re,Se,xe],styles:[".lg-header[_ngcontent-%COMP%]{position:fixed;z-index:3;height:var(--header-height);left:0;right:0;top:12px;display:flex;align-items:center;justify-content:center;gap:16px;overflow-x:auto;white-space:nowrap;padding:0 16px}@media (max-width: 768px){.lg-header[_ngcontent-%COMP%]{justify-content:normal;scroll-snap-type:both mandatory;overscroll-behavior-x:contain;scrollbar-width:none}}.lg-header__inner[_ngcontent-%COMP%]{display:flex;border-radius:35px;padding:8px;-webkit-backdrop-filter:blur(3px);backdrop-filter:blur(3px);background-color:#ffffffb3}.lg-header__link[_ngcontent-%COMP%]{font-size:1rem;font-family:inherit;text-decoration:none;padding:8px 24px;border-radius:32px;cursor:pointer;display:flex;align-items:center;justify-content:center;scroll-snap-align:center}.lg-header__link.route-active[_ngcontent-%COMP%]{background-color:#a26dc7;color:#fff}.lg-header__icon[_ngcontent-%COMP%]{border-radius:50%;display:flex;align-items:center;justify-content:center;padding:8px;cursor:pointer;scroll-snap-align:center;-webkit-backdrop-filter:blur(3px);backdrop-filter:blur(3px);background-color:#ffffffb3}.lg-header__icon.route-active[_ngcontent-%COMP%]{background-color:#a26dc7;color:#fff}"]})};var B=class e{title="lasagna";static \u0275fac=function(t){return new(t||e)};static \u0275cmp=w({type:e,selectors:[["app-root"]],features:[me([])],decls:5,vars:0,consts:[[1,"app"],[1,"app-content"]],template:function(t,n){t&1&&(v(0,"lg-pwa-install"),f(1,"main",0),v(2,"lg-header"),f(3,"div",1),v(4,"router-outlet"),h()())},dependencies:[we,D,W],styles:[".app-content[_ngcontent-%COMP%]{padding-top:calc(var(--header-height) + 44px);padding-bottom:32px}"]})};ve(B,je).catch(e=>console.error(e));
