"use strict";(self.webpackChunklasagna=self.webpackChunklasagna||[]).push([[921],{553:(D,v,a)=>{a.d(v,{i:()=>j});var t=a(1007);const k=["*"];let j=(()=>{class i{constructor(){}flat=(0,t.hFB)(!1);center=(0,t.hFB)(!1);static \u0275fac=function(l){return new(l||i)};static \u0275cmp=t.VBU({type:i,selectors:[["lg-card"]],inputs:{flat:[1,"flat"],center:[1,"center"]},ngContentSelectors:k,decls:2,vars:4,consts:[[1,"card"]],template:function(l,d){1&l&&(t.NAR(),t.j41(0,"div",0),t.SdG(1),t.k0s()),2&l&&t.AVh("flat",d.flat())("center",d.center())},styles:["[_nghost-%COMP%]{display:flex;width:100%}.card[_ngcontent-%COMP%]{background-color:#fff;padding:24px;border-radius:32px;width:100%;display:flex;flex-direction:column}.card.flat[_ngcontent-%COMP%]{padding:0}.card.center[_ngcontent-%COMP%]{justify-content:center;align-items:center}"]})}return i})()},1086:(D,v,a)=>{a.d(v,{W:()=>j});var t=a(1007);const k=["*"];let j=(()=>{class i{level=(0,t.vPA)(1);static \u0275fac=function(l){return new(l||i)};static \u0275cmp=t.VBU({type:i,selectors:[["lg-title"]],ngContentSelectors:k,decls:2,vars:0,consts:[["role","heading",1,"title"]],template:function(l,d){1&l&&(t.NAR(),t.j41(0,"p",0),t.SdG(1),t.k0s())},styles:[".title[_ngcontent-%COMP%]{font-size:1.5em;font-weight:700;margin:0}"]})}return i})()},1091:(D,v,a)=>{a.r(v),a.d(v,{CalculateRecipeComponent:()=>V});var t=a(1007),k=a(5642),j=a(1086),i=a(553);const w=["*"];let s=(()=>{class o{constructor(){}static \u0275fac=function(n){return new(n||o)};static \u0275cmp=t.VBU({type:o,selectors:[["lg-table-card"]],ngContentSelectors:w,decls:4,vars:1,consts:[[3,"flat"],[1,"table"],[1,"table__scroll"]],template:function(n,r){1&n&&(t.NAR(),t.j41(0,"lg-card",0)(1,"div",1)(2,"div",2),t.SdG(3),t.k0s()()()),2&n&&t.Y8G("flat",!0)},dependencies:[i.i],styles:[":host{display:flex;width:100%}.table__scroll{overflow-x:auto}table{width:100%;border-collapse:collapse;--border-color: #efefef}table thead tr{border-bottom:1px solid var(--border-color)}table thead th{text-align:left;padding:16px 24px;opacity:.4;font-size:.8em}table tbody tr{border-bottom:1px solid var(--border-color)}table tbody tr:last-child{border-bottom:none}td{padding:16px 24px}\n"],encapsulation:2})}return o})();var l=a(177),d=a(1119),F=a(7512),C=a(5554),u=a(467),f=a(4625),P=a(9512),I=a(7201);let O=(()=>{class o{_recipeRepository;_productRepository;constructor(e,n){this._recipeRepository=e,this._productRepository=n}calculation;calculateRecipe(e){var n=this;return new Promise(function(){var r=(0,u.A)(function*(m,g){const _=[];let c=0,b=0;yield n._recipeRepository.getOne(e,function(){var S=(0,u.A)(function*(R){const{table:y,totalAmount:x}=yield n._makeIngredientTable(R);c+=x||0,b=R.ingredients.reduce((T,p)=>T+((0,f.N)(p.amount)||0),0),_.push(...y),_.push(n._makeTotal(c,b)),m({recipe:R,result:_,total:c,totalWeight:b})});return function(R){return S.apply(this,arguments)}}())});return function(m,g){return r.apply(this,arguments)}}())}_makeRecipeSubTable(e){var n=this;return(0,u.A)(function*(){return new Promise(function(){var r=(0,u.A)(function*(m,g){const _=[];let c=0,b=0;const S=e.amount;yield n._recipeRepository.getOne(e.recipe_id,function(){var R=(0,u.A)(function*(y){const x=y.ingredients.reduce((h,$)=>h+((0,f.N)($.amount)||0),0),T=S/x,p=yield n._makeIngredientTable(y);p.table=p.table.map((h,$)=>({...h,amount:parseFloat((h.amount?h.amount*T:0).toFixed(5)),total:parseFloat((h.total?h.total*T:0).toFixed(5)),indent:h.indent+1}));const A=p.totalAmount/p.totalWeight;_.push(n._makeRecipeCaption({name:y.name,price_per_gram:A,amount:e.amount,total:A*e.amount})),_.push(...p.table),b+=A*e.amount,c+=p.totalWeight,m({table:_,totalAmount:b,totalWeight:c})});return function(y){return R.apply(this,arguments)}}())});return function(m,g){return r.apply(this,arguments)}}())})()}_makeIngredientTable(e){var n=this;const r=[];let m=0,g=0;return Promise.all(e.ingredients.map(function(){var _=(0,u.A)(function*(c,b){const S=c.recipe_id,R=c.product_id,y=c.name;if(S||R||y)if(S){const x=yield n._makeRecipeSubTable(c);r.push(...x.table),g+=x.totalAmount,m+=x.totalWeight}else R?yield n._productRepository.getOne(c.product_id,function(){var T=(0,u.A)(function*(p){if(!p?.price||!p?.amount)return;const A=((0,f.N)(p.price)||1)/((0,f.N)(p.amount)||1),h=A*((0,f.N)(c.amount)||1);r.push(n._makeRow({name:p.name,price_per_gram:A,amount:c.amount,total:h})),g+=h,m+=+c.amount});return function(p){return T.apply(this,arguments)}}()):y&&(r.push(n._makeRow({name:c.name,price_per_gram:void 0,amount:c.amount,total:void 0})),m+=+c.amount)});return function(c,b){return _.apply(this,arguments)}}())).then(()=>({table:r,totalAmount:g,totalWeight:m}))}_makeRow(e){return{name:e.name,price_per_gram:parseFloat(e.price_per_gram?.toFixed(5)??"0"),amount:e.amount,total:parseFloat(e.total?.toFixed(5)??"0"),unit:"g",indent:e.indent??0,type:"row"}}_makeCaption(e){return{name:e,unit:void 0,price_per_gram:void 0,amount:void 0,total:void 0,indent:0,type:"caption"}}_makeRecipeCaption(e){return{name:e.name,price_per_gram:parseFloat(e.price_per_gram.toFixed(5)),amount:e.amount,total:parseFloat(e.total.toFixed(2)),unit:"g",indent:0,type:"recipe-row"}}_makeTotal(e,n){return{name:"Total",amount:n,unit:"g",price_per_gram:parseFloat((e/n).toFixed(5)),total:parseFloat(e.toFixed(2)),indent:0,type:"total"}}static \u0275fac=function(n){return new(n||o)(t.KVO(P.m),t.KVO(I.d))};static \u0275prov=t.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();function G(o,E){if(1&o&&(t.j41(0,"div"),t.EFF(1),t.k0s(),t.j41(2,"div"),t.EFF(3),t.nI1(4,"number"),t.k0s()),2&o){let e,n;const r=t.XpG(2);t.R7$(),t.Lme("Calculation outcome: ",null==(e=r.result())||null==e.recipe?null:e.recipe.outcome_amount," ",null==(e=r.result())||null==e.recipe?null:e.recipe.outcome_unit," "),t.R7$(2),t.SpI("one portion costs: ",t.i5U(4,3,((null==(n=r.result())?null:n.total)||1)/((null==(n=r.result())||null==n.recipe?null:n.recipe.outcome_amount)||1),"1.2-2")," ")}}function M(o,E){if(1&o&&(t.j41(0,"div"),t.EFF(1),t.k0s(),t.j41(2,"div"),t.EFF(3),t.nI1(4,"number"),t.k0s()),2&o){let e,n;const r=t.XpG(2);t.R7$(),t.SpI("Calculation outcome: ",null==(e=r.result())?null:e.totalWeight," grams"),t.R7$(2),t.SpI("costs: ",t.i5U(4,2,null==(n=r.result())?null:n.total,"1.2-2"),"")}}function U(o,E){if(1&o&&(t.j41(0,"lg-gap-row",0),t.DNE(1,G,5,6)(2,M,5,5),t.k0s()),2&o){let e;const n=t.XpG();t.Y8G("center",!0),t.R7$(),t.vxM(null!=(e=n.result())&&null!=e.recipe&&e.recipe.outcome_unit?1:2)}}function N(o,E){if(1&o&&(t.j41(0,"tr",7)(1,"td"),t.EFF(2),t.k0s(),t.j41(3,"td")(4,"span",7),t.EFF(5),t.k0s()(),t.j41(6,"td"),t.EFF(7),t.k0s(),t.j41(8,"td"),t.EFF(9),t.k0s(),t.j41(10,"td"),t.EFF(11),t.k0s(),t.j41(12,"td"),t.EFF(13),t.k0s()()),2&o){const e=E.$implicit,n=E.$index;t.Y8G("ngClass",e.type),t.R7$(2),t.JRh(n+1),t.R7$(2),t.Y8G("ngClass","indent-"+e.indent),t.R7$(),t.JRh(e.name),t.R7$(2),t.JRh(e.amount),t.R7$(2),t.JRh(e.unit),t.R7$(2),t.JRh(e.price_per_gram),t.R7$(2),t.JRh(e.total)}}function W(o,E){if(1&o&&(t.j41(0,"table")(1,"colgroup"),t.nrm(2,"col",2)(3,"col",3)(4,"col",4)(5,"col",5)(6,"col",4)(7,"col",6),t.k0s(),t.j41(8,"thead")(9,"tr")(10,"th"),t.EFF(11,"#"),t.k0s(),t.j41(12,"th"),t.EFF(13,"Name"),t.k0s(),t.j41(14,"th"),t.EFF(15,"Amount"),t.k0s(),t.j41(16,"th"),t.EFF(17,"Unit"),t.k0s(),t.j41(18,"th"),t.EFF(19,"Price per gram"),t.k0s(),t.j41(20,"th"),t.EFF(21,"Total"),t.k0s()()(),t.j41(22,"tbody"),t.Z7z(23,N,14,8,"tr",7,t.Vm6),t.k0s()()),2&o){let e;const n=t.XpG();t.R7$(23),t.Dyx(null==(e=n.result())?null:e.result)}}function B(o,E){1&o&&(t.j41(0,"div"),t.EFF(1,"Loading..."),t.k0s())}let V=(()=>{class o{_aRoute;_calculateRecipeService;constructor(e,n){this._aRoute=e,this._calculateRecipeService=n}uuid=(0,t.vPA)("");result=(0,t.vPA)(null);ngOnInit(){this._aRoute.params.subscribe(e=>{this.uuid.set(e.uuid),this._calculateRecipeService.calculateRecipe(e.uuid).then(n=>{this.result.set(n)})})}static \u0275fac=function(n){return new(n||o)(t.rXU(C.nX),t.rXU(O))};static \u0275cmp=t.VBU({type:o,selectors:[["lg-calculate-recipe"]],decls:12,vars:14,consts:[[3,"center"],[3,"flat","link","size"],["span","1",2,"width","1%"],["span","1",2,"width","20%"],["span","1",2,"width","5%"],["span","1",2,"width","3%"],["span","1",2,"width","7%"],[3,"ngClass"]],template:function(n,r){if(1&n&&(t.j41(0,"lg-container")(1,"lg-gap-row",0)(2,"lg-title"),t.EFF(3),t.k0s(),t.j41(4,"lg-button",1),t.EFF(5," Edit "),t.k0s(),t.j41(6,"lg-button",1),t.EFF(7," Back to list "),t.k0s()(),t.DNE(8,U,3,2,"lg-gap-row",0),t.j41(9,"lg-table-card"),t.DNE(10,W,25,0,"table")(11,B,2,0,"div"),t.k0s()()),2&n){let m,g,_;t.R7$(),t.Y8G("center",!0),t.R7$(2),t.SpI(" ",null==(m=r.result())||null==m.recipe?null:m.recipe.name," cost calculation "),t.R7$(),t.Aen("primary"),t.Y8G("flat",!0)("link","/edit-recipe/"+(null==(g=r.result())||null==g.recipe?null:g.recipe.uuid))("size","small"),t.R7$(2),t.Aen("warning"),t.Y8G("flat",!0)("link","/recipes")("size","small"),t.R7$(2),t.vxM(null!=(_=r.result())&&_.total?8:-1),t.R7$(2),t.vxM(r.result()?10:11)}},dependencies:[k.H,j.W,s,l.YU,d.Q,F.I,l.QX],encapsulation:2})}return o})()},5559:(D,v,a)=>{a.d(v,{Q:()=>j});var t=a(467),k=a(1007);let j=(()=>{class i{constructor(){}get _uuid(){return Math.random().toString(36).substring(2)+Date.now().toString(36)}openDb(s){return new Promise(function(){var l=(0,t.A)(function*(d,F){const C=yield window.indexedDB.open("lasagna-db",1);C.onerror=u=>{F(u)},C.onsuccess=u=>{s(u.target?.result)},C.onupgradeneeded=u=>{const f=u.target?.result;f.createObjectStore("productsStore",{keyPath:"uuid",autoIncrement:!0}).createIndex("name","name",{unique:!1}),f.createObjectStore("recipesStore",{keyPath:"uuid",autoIncrement:!0}).createIndex("name","name",{unique:!1}),f.createObjectStore("categoryStore",{keyPath:"uuid",autoIncrement:!0}).createIndex("name","name",{unique:!1})},d()});return function(d,F){return l.apply(this,arguments)}}())}addData(s,l){this.openDb(d=>{d.transaction(s,"readwrite").objectStore(s).add({...l,uuid:this._uuid})})}replaceData(s,l,d){this.openDb(F=>{F.transaction(s,"readwrite").objectStore(s).put({...d,uuid:l})})}getOne(s,l,d){this.openDb(F=>{F.transaction(s,"readonly").objectStore(s).get(l).onsuccess=P=>{d(P.target.result)}})}static \u0275fac=function(l){return new(l||i)};static \u0275prov=k.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})()}}]);