import{a as mt,b as st,c as _t,d as ft,e as gt,h as Ct}from"./chunk-N5MDOLP5.js";import"./chunk-FQZGD2HY.js";import{a as ut}from"./chunk-PRC2TUST.js";import{a as rt}from"./chunk-MQFBNNJC.js";import{a as ct,c as pt}from"./chunk-P5B2PAQA.js";import{b as dt}from"./chunk-E4DOWUUR.js";import"./chunk-WWIGOA57.js";import{a as nt}from"./chunk-7CX5ADF4.js";import{a as xt}from"./chunk-UCD3FRBR.js";import{a as at}from"./chunk-XQWFJXAQ.js";import{a as lt}from"./chunk-GD35DILB.js";import"./chunk-2CMRCJH6.js";import"./chunk-EIHALQTV.js";import{a as tt,b as ot}from"./chunk-C3TWNGHF.js";import{a as it}from"./chunk-NBI3H4TU.js";import{a as et}from"./chunk-PUFYVR3X.js";import"./chunk-SNDQO5FA.js";import{g as K,k as W,o as R,p as Y,q as h}from"./chunk-E7PMWA7O.js";import{b as J}from"./chunk-TZ6AACHZ.js";import"./chunk-5KSZNU56.js";import"./chunk-WLVDGM7I.js";import"./chunk-UTON52JF.js";import{u as X}from"./chunk-BVNLWVVY.js";import"./chunk-GEHL2P5P.js";import{s as q,w as H}from"./chunk-HDKQOM4M.js";import"./chunk-652DFWNF.js";import{k as Q}from"./chunk-RUQPARWX.js";import{$ as S,$b as _,Ab as w,Bb as E,Cb as r,Db as l,Eb as T,Ib as b,Lb as v,Mb as d,R as j,Va as n,Yb as a,Z as V,Zb as B,_a as g,_b as f,db as N,dc as U,ga as L,ha as D,ib as P,jc as m,k as Z,kc as s,lc as G,na as z,q as A,qb as p,s as $,tb as y,wb as C,xb as x,yb as F}from"./chunk-FSGSBBFI.js";import"./chunk-DELOOZDJ.js";import{f as M}from"./chunk-2WH2EVR6.js";var vt=new V("CategorizedProductsList",{factory:()=>{let e=S(h),i=S(J);return Z(e.loadAll()).pipe(j(()=>e.products$)).pipe(A(o=>o.toSorted((c,u)=>c.name.localeCompare(u.name))),A(o=>ut(o,"category_id")),$(o=>M(void 0,null,function*(){let c=[];for(let I in o){let k=o[I],Pt=yield i.getOne(I);c.push({category:Pt?.name,products:k})}if(!c.length)return[];let[u,...O]=c.toSorted((I,k)=>I.category>k.category?1:-1);return u?.category?[u].concat(O):O.concat([u])})))}});var yt=(e,i)=>i==null?null:i.createdAt;function Tt(e,i){e&1&&(r(0,"lg-button",6),T(1,"mat-icon",7),l()),e&2&&(y("success"),p("icon",!0)("link","/products/add")("size","medium"))}function It(e,i){if(e&1&&(r(0,"span"),a(1),m(2,"translate"),l()),e&2){let t=d(2).$implicit;n(),_("",s(2,2,"from-location")," ",t.source)}}function Lt(e,i){if(e&1&&(r(0,"span"),a(1),l(),r(2,"span"),a(3),l(),C(4,It,3,4,"span")),e&2){let t=d().$implicit;n(),B(t.name),n(2),_("",t.amount,"gr for ",t.price),n(),x(t.source?4:-1)}}function Dt(e,i){if(e&1&&(r(0,"span"),a(1),m(2,"translate"),l()),e&2){let t=d(2).$implicit;n(),_("",s(2,2,"from-location")," ",t==null?null:t.source)}}function wt(e,i){if(e&1&&(r(0,"span"),a(1),l(),r(2,"span"),a(3),l(),C(4,Dt,3,4,"span")),e&2){let t=d().$implicit;n(),B(t==null?null:t.name),n(2),_("",t==null?null:t.amount," gr for ",t==null?null:t.price),n(),x(t!=null&&t.source?4:-1)}}function Et(e,i){if(e&1&&C(0,Lt,5,4)(1,wt,5,4),e&2){let t=i.flow;x(t==="new"?0:1)}}function bt(e,i){e&1&&(a(0),m(1,"translate")),e&2&&f(" ",s(1,1,"draft.list-prefix.existing")," ")}function Rt(e,i){e&1&&(a(0),m(1,"translate")),e&2&&f(" ",s(1,1,"draft.list-prefix.new")," ")}function ht(e,i){if(e&1){let t=b();r(0,"lg-gap-row",5)(1,"a",9),C(2,bt,2,3)(3,Rt,2,3),a(4),l(),r(5,"small",10),a(6),m(7,"translate"),m(8,"timeAgo"),l(),r(9,"lg-button",11),v("click",function(){L(t);let c=d().$implicit,u=d(2);return D(u.deleteDraft(c))}),T(10,"mat-icon",12),l()()}if(e&2){let t=d().$implicit;p("center",!0),n(),p("routerLink","/products/draft/"+(t==null?null:t.uuid)),n(),x(!(t==null||t.meta==null)&&t.meta.uuid?2:3),n(2),f(" ",(t==null||t.data==null?null:t.data.name)||"Unknown"," "),n(2),_(" ",s(7,10,"edited-at-label")," ",s(8,12,(t==null?null:t.updatedAt)||(t==null?null:t.createdAt))," "),n(3),y("danger"),p("size","tiny")("icon",!0)}}function kt(e,i){e&1&&P(0,ht,11,14,"ng-template",8)}function At(e,i){if(e&1&&(r(0,"lg-card-list",4),w(1,kt,1,0,null,8,yt),l()),e&2){let t=d();n(),E(t.draft())}}function Ft(e,i){if(e&1){let t=b();r(0,"lg-gap-row",5)(1,"div",16)(2,"lg-gap-row",5)(3,"lg-gap-row",17)(4,"a",18),a(5),l(),r(6,"div"),a(7),m(8,"number"),l()(),r(9,"small",19),a(10),m(11,"translate"),m(12,"timeAgo"),l()()(),r(13,"lg-button",11),v("click",function(){L(t);let c=d().$implicit,u=d(2);return D(u.deleteProduct(c))}),T(14,"mat-icon",12),l()()}if(e&2){let t=d().$implicit;p("center",!0),n(2),p("center",!0),n(),p("center",!0),n(),p("routerLink","/products/edit/"+t.uuid),n(),_(" ",t.name," ",t.source?"- "+t.source:""," "),n(2),_(" ",G(8,14,t.pricePerUnit,"1.2-5")," ",t.perUnitLabel," "),n(3),_(" ",s(11,17,"edited-at-label")," ",s(12,19,(t==null?null:t.updatedAt)||(t==null?null:t.createdAt))," "),n(3),y("danger"),p("size","tiny")("icon",!0)}}function Bt(e,i){if(e&1&&P(0,Ft,15,21,"ng-template",15),e&2){let t=i.$implicit;p("uuid",t.uuid)}}function Ot(e,i){if(e&1){let t=b();r(0,"lg-title",13),a(1),m(2,"translate"),l(),r(3,"lg-card-list",14),v("onSelected",function(c){L(t);let u=d();return D(u.selectionZoneService.putSelected(c))}),w(4,Bt,1,1,null,15,F),l()}if(e&2){let t=i.$implicit,o=d();p("level",3),n(),f(" ",(t==null?null:t.category)||s(2,5,"without-category-label")," "),n(2),p("mode",o.selectionZoneService.selectionMode())("selectAll",o.selectionZoneService.selectAll())("deselectAll",o.selectionZoneService.deselectAll()),n(),E(t.products)}}function Mt(e,i){e&1&&(r(0,"lg-gap-row",5)(1,"lg-title",13),a(2),m(3,"translate"),l()()),e&2&&(p("center",!0),n(),p("level",5),n(),f(" ",s(3,3,"no-products")," "))}var St=class e{constructor(i,t,o,c,u){this._productsRepository=i;this._csvReaderService=t;this._transferDataService=o;this._notificationsService=c;this.selectionZoneService=u}products=dt(S(vt));draft=z([]);ProductDbInputScheme=Ct;Stores=H;exportProducts(i){this._transferDataService.exportTable("productsStore","json",{selected:Array.from(i)})}deleteProduct(i){i.uuid&&this._productsRepository.deleteProduct(i.uuid).then(()=>{this._notificationsService.success("Product deleted"),this.loadProducts()})}deleteDraft(i){this._productsRepository.removeDraftProduct(i.uuid),this.draft.update(t=>t.filter(o=>o?.uuid!==i.uuid))}ngOnInit(){this.loadProducts();let i=this._productsRepository.getDraftProducts();i&&this.draft.set(i)}loadProducts(){this._productsRepository.loadAll()}static \u0275fac=function(t){return new(t||e)(g(h),g(K),g(Y),g(X),g(R))};static \u0275cmp=N({type:e,selectors:[["lg-product-list"]],features:[U([R])],decls:17,vars:14,consts:[["lgQuickActionsTpl",""],[3,"click","flat","size"],[3,"onDone","schema","storeName"],["lgImportRowTpl",""],[2,"--card-bg","#bee5ff"],[3,"center"],[3,"icon","link","size"],["aria-hidden","false","fontIcon","add"],["lgCardListItem",""],["lgExpand","",3,"routerLink"],["lgPull","",1,"text-muted","text-cursive"],[3,"click","size","icon"],["aria-hidden","false","fontIcon","close"],[3,"level"],[3,"onSelected","mode","selectAll","deselectAll"],["lgCardListItem","",3,"uuid"],[1,"expand"],["lgExpand","",3,"center"],[3,"routerLink"],[1,"text-muted","text-cursive"]],template:function(t,o){if(t&1&&(r(0,"lg-controls-bar"),P(1,Tt,2,5,"ng-template",0),T(2,"lg-selection-tools"),r(3,"lg-button",1),v("click",function(){return o.exportProducts(o.selectionZoneService.selected())}),a(4),m(5,"translate"),l(),r(6,"lg-import",2),v("onDone",function(){return o.loadProducts()}),P(7,Et,2,1,"ng-template",3),l()(),r(8,"lg-fade-in")(9,"lg-container")(10,"lg-title"),a(11),m(12,"translate"),l(),C(13,At,3,0,"lg-card-list",4),w(14,Ot,6,7,null,null,F,!1,Mt,4,5,"lg-gap-row",5),l()()),t&2){let c;n(3),y("info"),p("flat",!0)("size","small"),n(),f(" ",s(5,10,"export-label")," "),n(2),p("schema",o.ProductDbInputScheme)("storeName",o.Stores.PRODUCTS),n(5),f(" ",s(12,12,"products.list-title")," "),n(2),x((c=o.draft())!=null&&c.length?13:-1),n(),E(o.products())}},dependencies:[ot,lt,at,tt,et,Q,pt,ct,st,q,mt,it,ft,_t,gt,nt,xt,rt,W],styles:["[_nghost-%COMP%]{display:block}"]})};export{St as ProductListComponent};
