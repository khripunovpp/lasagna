import{B as h,C as m,d as f}from"./chunk-JNPSWS74.js";import{$ as u,da as c,ea as p,g as d,q as a}from"./chunk-7BND6AGV.js";import{a as l,b as g}from"./chunk-C6Q5SG76.js";var D=class s{constructor(e,i){this._http=e;this._indexedDB=i}orderTitles={"getting-started":1,invoices:4,settings:5,recipes:3,storage:2};_userLang=p(m);docs$=new d([]);tree$=new d([]);async init(){try{let e=await a(this._http.get("./docs/meta.json")),n=(await this._indexedDB.getAll("documentation"))?.find(t=>t.key==="meta")?.value;if(!n||new Date(e.updatedAt)>new Date(n.updatedAt)){let[t,o]=await Promise.all([a(this._http.get("./docs/data.json")),a(this._http.get("./docs/tree.json"))]);await this._indexedDB.balkAdd("documentation",[{key:"meta",value:e},{key:"data",value:t},{key:"tree",value:o}]),this.docs$.next(t),this.tree$.next(o)}else{let t=await this._getStoredDocs();this.tree$.next(t.tree),this.docs$.next(t.docs)}}catch(e){console.error("Failed to initialize docs service:",e)}}filterLanguage(e,i){if(e.language&&e.language!==i)return null;if(e.type==="file")return e;let n=(e.children||[]).reduce((r,t)=>{let o=this.filterLanguage(t,i);return o&&r.push(o),r},[]);return n.length>0?g(l({},e),{children:n.toSorted((r,t)=>(r.order||0)-(t.order||0))}):null}getDocsView(){return this.docs$.getValue()}getDocs(){return this.docs$.asObservable()}getTree(){return this.tree$.asObservable()}async getDocByPath(e){}async _getStoredDocs(){let e=await this._indexedDB.getAll("documentation"),i=(e?.find(r=>r.key==="tree")?.value.reduce((r,t)=>{let o=this.filterLanguage(t,this._userLang());return o&&r.push(o),r},[])||[]).toSorted((r,t)=>(this.orderTitles[r.name||""]||0)-(this.orderTitles[t.name||""]||0)),n=e?.find(r=>r.key==="data")?.value;return{tree:i,docs:n}}static \u0275fac=function(i){return new(i||s)(c(f),c(h))};static \u0275prov=u({token:s,factory:s.\u0275fac,providedIn:"root"})};export{D as a};
