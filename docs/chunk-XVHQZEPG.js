import{a as Se}from"./chunk-2XKYYXGX.js";import{a as L,c as Ee,d as Te}from"./chunk-F4GDUX67.js";import{a as Pe}from"./chunk-T6K3LUN6.js";import{a as we}from"./chunk-3JL2QINL.js";import{a as be,b as xe}from"./chunk-PBY37YKW.js";import{c as ae}from"./chunk-EAMXOKBF.js";import"./chunk-UHSOGUHE.js";import{a as I}from"./chunk-WTF2FVJ4.js";import{a as he,b as ve}from"./chunk-ZYT64JFR.js";import"./chunk-M5IBY6FX.js";import{a as ye}from"./chunk-GKQZ6TBK.js";import{a as Me}from"./chunk-ZEKB2U6M.js";import"./chunk-BSYU4TDD.js";import{c as M,e as de,f as me,g as ue,h as P,j as ge,k as fe,n as Ce,q as _e}from"./chunk-FMSTASSM.js";import{c as A}from"./chunk-TQTLV33A.js";import{a as V}from"./chunk-2NSFWKSX.js";import{a as pe,b as ce}from"./chunk-HMFW6PL3.js";import{$a as C,Ca as h,Da as v,Ia as l,Ib as ie,Ja as i,Ka as c,Oa as x,Pa as d,Qa as f,Ra as J,Sa as z,U as w,V as b,Wb as re,Ya as Z,Yb as le,Z as m,Za as $,_a as E,ac as se,ba as K,bb as ee,gb as te,ha as B,ia as r,ka as Q,la as u,na as g,tb as oe,wa as a,wb as R,xa as q,xb as T,ya as S,yb as ne,za as X}from"./chunk-EBX4ADAM.js";var F=class n{constructor(t,e){this.renderer=t;this._elementRef=e}targetElement;appendTarget="";wrapClass="";portalContainer;get _appendTarget(){return this.appendTarget?this.appendTarget==="body"?document.body:this.appendTarget:this._elementRef.nativeElement}ngAfterViewInit(){this.portalContainer=this.renderer.createElement("div"),this.renderer.appendChild(this._appendTarget,this.portalContainer),this.targetElement&&(this.wrapClass&&this.wrapClass.split(" ").forEach(e=>this.renderer.addClass(this.portalContainer,e)),this.renderer.appendChild(this.portalContainer,this.targetElement))}ngOnDestroy(){this.targetElement&&this.renderer.removeChild(this.portalContainer,this.targetElement),this.renderer.removeChild(this._appendTarget,this.portalContainer)}static \u0275fac=function(e){return new(e||n)(u(Q),u(K))};static \u0275cmp=g({type:n,selectors:[["lg-portal"]],inputs:{targetElement:"targetElement",appendTarget:"appendTarget",wrapClass:"wrapClass"},decls:0,vars:0,template:function(e,o){},styles:["[_nghost-%COMP%]{display:flex;height:100%;width:100%}"]})};var Ae=["element"],Ie=["*",[["content"]]],Ve=["*","content"];function Fe(n,t){if(n&1&&(l(0,"div",4,0),z(2,1),i(),c(3,"lg-portal",5)),n&2){let e=E(1),o=f();q("left",o.coordinates().x,"px")("top",o.coordinates().y,"px"),r(3),a("appendTarget","body")("targetElement",e)("wrapClass","tooltip")}}var D=class n{constructor(){}gap=T(16);displayed=m(!1);full=T(!1);position=T("top");element=ne("element");onClose=R();coordinates=m({x:0,y:0});toggle(t){if(this.displayed.set(!this.displayed()),this.displayed()||this.onClose.emit(),t){t.stopPropagation();let[e,o]=[t.clientX,t.clientY];setTimeout(()=>{let p=(this.element()?.nativeElement).getBoundingClientRect(),y=p.width,H=p.height,Y=window.innerWidth,U=window.innerHeight,_=16,j=e,G=o;e+y+_>Y&&(j=Y-y-_),o+H+_>U&&(G=U-H-_),e-y-_<0&&(j=_),o-H-_<0&&(G=_),this.coordinates.set({x:j,y:G})})}}close(){this.displayed.set(!1),this.onClose.emit()}onClick(t){t.target instanceof HTMLElement&&(t.target.closest(".tooltip")||(this.displayed.set(!1),this.onClose.emit()))}onKeydown(t){t.key==="Escape"&&(this.displayed.set(!1),this.onClose.emit())}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=g({type:n,selectors:[["lg-tooltip"]],viewQuery:function(e,o){e&1&&Z(o.element,Ae,5),e&2&&$()},hostBindings:function(e,o){e&1&&d("click",function(p){return o.onClick(p)},B)("keydown",function(p){return o.onKeydown(p)},B)},inputs:{gap:[1,"gap"],full:[1,"full"],position:[1,"position"]},outputs:{onClose:"onClose"},ngContentSelectors:Ve,decls:5,vars:6,consts:[["element",""],[1,"tooltip",3,"ngClass"],[1,"tooltip__anchor"],[3,"click"],[1,"tooltip__content"],[3,"appendTarget","targetElement","wrapClass"]],template:function(e,o){e&1&&(J(Ie),l(0,"div",1)(1,"div",2)(2,"div",3),d("click",function(p){return o.toggle(p)}),z(3),i(),h(4,Fe,4,7),i()()),e&2&&(q("--gap",o.gap(),"px"),S("fullscreen",o.full()),a("ngClass",o.position()),r(4),v(o.displayed()?4:-1))},dependencies:[ie,F],styles:[".tooltip[_ngcontent-%COMP%]{position:relative;display:inline-block}.tooltip__anchor[_ngcontent-%COMP%]{position:relative}.tooltip__content[_ngcontent-%COMP%]{position:absolute;background-color:#fff;border-radius:16px;padding:16px;box-shadow:0 4px 8px #0000001a;z-index:100}.tooltip.top[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%], .tooltip.bottom[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%]{bottom:calc(100% + var(--gap));right:50%;transform:translate(50%)}.tooltip.left[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%]{bottom:50%;right:calc(100% + var(--gap));transform:translateY(50%)}.tooltip.right[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%]{bottom:50%;left:calc(100% + var(--gap));transform:translateY(-50%)}.tooltip.fullscreen[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#fff;border-radius:0;padding:32px;transform:none;overflow-y:auto}"]})};function Oe(n,t){if(n&1){let e=x();l(0,"div",3)(1,"lg-eggs-widget",4),d("changed",function(s){w(e);let p=f();return b(p.onEggsChanged(s))}),i()()}}var N=class n{constructor(){}eggsChanged=R();selectedWidget=m(null);onWidgetSelect(t){this.selectedWidget.set(t)}onEggsChanged(t){t&&this.eggsChanged.emit(t)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=g({type:n,selectors:[["lg-amount-widgets"]],outputs:{eggsChanged:"eggsChanged"},decls:5,vars:3,consts:[[1,"amount-widgets"],[1,"amount-widgets__buttons"],[1,"amount-widgets__button",3,"click"],[1,"amount-widgets__wrapper"],[3,"changed"]],template:function(e,o){e&1&&(l(0,"div",0)(1,"div",1)(2,"button",2),d("click",function(){return o.onWidgetSelect("eggs")}),C(3,"Eggs "),i()(),h(4,Oe,2,0,"div",3),i()),e&2&&(S("selected",o.selectedWidget()!=null),r(4),v(o.selectedWidget()==="eggs"?4:-1))},dependencies:[Se],styles:[".amount-widgets[_ngcontent-%COMP%]{display:flex;gap:16px;flex-direction:column}.amount-widgets__input[_ngcontent-%COMP%]{flex:1}.amount-widgets__buttons[_ngcontent-%COMP%]{display:flex;gap:16px;flex-wrap:wrap;padding:16px;background-color:#fafafa;border-radius:12px;margin:-16px}.amount-widgets.selected[_ngcontent-%COMP%]   .amount-widgets__buttons[_ngcontent-%COMP%]{margin-bottom:0}.amount-widgets__button[_ngcontent-%COMP%]{display:flex;padding:8px 16px;border-radius:16px;background-color:#e5de38;appearance:none;border:none;font-family:inherit;font-size:inherit}"]})};function De(n,t){if(n&1&&c(0,"lg-chips-list",18),n&2){let e=f(),o=E(19);a("control",o)("items",e.topSources())}}function Ne(n,t){if(n&1&&c(0,"lg-chips-list",18),n&2){let e=f(),o=E(24);a("control",o)("items",e.topCategories())}}function We(n,t){if(n&1){let e=x();l(0,"lg-button",21),d("click",function(){w(e);let s=f();return b(s.editProduct(s.value))}),C(1," Edit Product "),i()}}function He(n,t){if(n&1){let e=x();l(0,"lg-button",21),d("click",function(){w(e);let s=f();return b(s.addProduct(s.value))}),C(1," Add Product "),i()}}var W=class n{constructor(t,e,o,s){this._productsRepository=t;this._selectResourcesService=e;this._router=o;this._notificationsService=s}form=new ue({name:new P("",M.required),amount:new P(null,M.required),price:new P(null,M.required),unit:new P("gram"),source:new P(""),category_id:new P(null,M.required)});buttons=[{label:"Grams",value:"gram",style:"secondary",onClick:()=>{console.log("Grams")}},{label:"Pieces",value:"piece",style:"secondary",onClick:()=>{console.log("Piece")}}];uuid=T("");topCategories=m([]);topSources=m([]);uuidEffect=oe(()=>{this.uuid()&&this._productsRepository.getOne(this.uuid()).then(t=>{this.form.reset(t)})});get value(){return this.form.value}get _defFormValue(){return{name:"",amount:null,price:null,source:"",category_id:null,unit:"gram"}}eggsChanged(t){this.form.patchValue({amount:t})}ngOnInit(){this._loadUsingHistory()}addProduct(t){this._productsRepository.addProduct(L(t)).then(()=>{this.form.reset(this._defFormValue),this._notificationsService.success("Product added"),this._loadUsingHistory()})}editProduct(t){this._productsRepository.editProduct(this.uuid(),L(t)).then(()=>{this._notificationsService.success("Product edited")})}ngAfterViewInit(){this._selectResourcesService.load().then(t=>{})}_loadUsingHistory(){this._productsRepository.getTopCategories().then(t=>{this.topCategories.set(t.map(e=>({label:e.name,value:e.uuid})))}),this._productsRepository.getTopSources().then(t=>{this.topSources.set(t.map(e=>({label:e,value:e})))})}static \u0275fac=function(e){return new(e||n)(u(ae),u(I),u(le),u(Me))};static \u0275cmp=g({type:n,selectors:[["lg-add-product-form"]],inputs:{uuid:[1,"uuid"]},features:[te([{provide:I,useClass:I}])],decls:28,vars:13,consts:[["priceInput",""],["sourceInput",""],["categorySelect",""],[3,"formGroup"],["label","Name"],["formControlName","name",3,"placeholder"],[3,"bottom","mobileMode"],["label","Amount","lgExpand",""],["formControlName","amount","lgParseMath","",3,"onInputChange","placeholder"],["ngProjectAs","after",5,["after"]],[3,"position"],["ngProjectAs","content",5,["content"]],[3,"eggsChanged"],["formControlName","unit",3,"items"],["label","Price"],["formControlName","price","lgParseMath","",3,"placeholder"],["label","Source"],["formControlName","source",3,"placeholder"],[3,"control","items"],["label","Category"],["formControlName","category_id",3,"resource"],[3,"click"]],template:function(e,o){if(e&1){let s=x();l(0,"form",3)(1,"lg-gap-column")(2,"lg-control",4),c(3,"lg-input",5),i(),l(4,"lg-gap-row",6)(5,"lg-control",7)(6,"lg-number-input",8),d("onInputChange",function(){w(s);let y=E(15);return b(y.focus())}),l(7,"div",9)(8,"lg-tooltip",10),C(9," Widgets "),l(10,"div",11)(11,"lg-amount-widgets",12),d("eggsChanged",function(y){return w(s),b(o.eggsChanged(y))}),i()()()()()(),c(12,"lg-buttons-group",13),i(),l(13,"lg-control",14),c(14,"lg-number-input",15,0),i(),l(16,"lg-gap-column")(17,"lg-control",16),c(18,"lg-input",17,1),i(),h(20,De,1,2,"lg-chips-list",18),i(),l(21,"lg-gap-column")(22,"lg-control",19),c(23,"lg-multiselect",20,2),i(),h(25,Ne,1,2,"lg-chips-list",18),i(),h(26,We,2,0,"lg-button")(27,He,2,0,"lg-button"),i()()}e&2&&(a("formGroup",o.form),r(3),a("placeholder","Your product name"),r(),a("bottom",!0)("mobileMode",!0),r(2),a("placeholder","In "+o.form.value.unit),r(2),a("position","left"),r(4),a("items",o.buttons),r(2),a("placeholder","For the entire product in your currency"),r(4),a("placeholder","Where do you buy it?"),r(2),v(o.topSources().length?20:-1),r(3),a("resource","categories"),r(2),v(o.topCategories().length?25:-1),r(),v(o.uuid()?26:27))},dependencies:[_e,ge,de,me,fe,Ce,he,ve,ye,A,we,be,D,N,xe,V,Ee,Pe,Te],styles:[`lg-eggs-widget{min-width:300px}
`],encapsulation:2})};var Re=class n{constructor(t){this._aRoute=t}uuid=m("");ngOnInit(){this._aRoute.params.subscribe(t=>{this.uuid.set(t.uuid)})}static \u0275fac=function(e){return new(e||n)(u(re))};static \u0275cmp=g({type:n,selectors:[["app-add-recipe"]],decls:8,vars:8,consts:[[3,"center"],[3,"flat","link","size"],[3,"uuid"]],template:function(e,o){e&1&&(l(0,"lg-container")(1,"lg-gap-row",0)(2,"lg-title"),C(3),i(),l(4,"lg-button",1),C(5," Back to list "),i()(),l(6,"lg-card"),c(7,"lg-add-product-form",2),i()()),e&2&&(r(),a("center",!0),r(2),ee("",o.uuid()?"Edit":"Add"," Product"),r(),X("warning"),a("flat",!0)("link","/products")("size","small"),r(3),a("uuid",o.uuid()))},dependencies:[se,pe,ce,W,A,V],encapsulation:2})};export{Re as AddProductComponent};
