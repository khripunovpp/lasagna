import{a as Se,b as $}from"./chunk-GWMBQJKZ.js";import{a as ne}from"./chunk-CH6IPXKI.js";import"./chunk-OGV7MEY2.js";import{a as he}from"./chunk-UKAU3626.js";import{a as Ae,b as Ee,c as Ne,d as ke,e as Me}from"./chunk-AY44UDQR.js";import{a as Te}from"./chunk-MN42LU3T.js";import{e as Fe}from"./chunk-NDH2T75U.js";import{a as N}from"./chunk-47737BAE.js";import{a as Ie,b as Ve}from"./chunk-FNMHIIFF.js";import{a as we,b as Re}from"./chunk-VZQQYTJ7.js";import{b as ye}from"./chunk-RNBI2NK7.js";import"./chunk-FG5PJ7WR.js";import{d as j,g as se,i as pe,j as me,k as B,l as g,n as de,o as ue,p as _e,q as fe,r as ge,s as Ce,t as ve,u as xe}from"./chunk-CXKCNMAZ.js";import{a as be}from"./chunk-ZTZGKGRL.js";import{a as ae}from"./chunk-JXYZKXYP.js";import{a as oe,b as re,c as le}from"./chunk-L3VKWLRX.js";import{r as D,t as ie,x as ce}from"./chunk-O3EHXZ3L.js";import{$b as V,Ab as v,Bb as x,Bc as P,Cc as te,Dc as G,Eb as J,Fb as Y,Gb as l,Hb as r,Ib as C,Jb as S,Kb as F,M as q,Mb as h,Pb as _,Qb as s,Rb as k,Sb as I,Za as c,Zb as T,_b as X,a as b,ac as m,b as y,cb as w,cc as M,f as U,hb as R,hc as Z,la as d,ma as u,s as W,sa as A,ub as a,wb as K,xb as E,xc as ee}from"./chunk-46OIECST.js";var Ge=["*"];function De(n,t){if(n&1&&(l(0,"p",1),m(1),r()),n&2){let e=s();c(),M(" ",e.label()," ")}}var O=class n{constructor(){}label=P("");static \u0275fac=function(e){return new(e||n)};static \u0275cmp=R({type:n,selectors:[["lg-control-group"]],inputs:{label:[1,"label"]},ngContentSelectors:Ge,decls:4,vars:1,consts:[[1,"control-group"],[1,"control-group__label"],[1,"control-group__content"]],template:function(e,i){e&1&&(k(),l(0,"div",0),v(1,De,2,1,"p",1),l(2,"div",2),I(3),r()()),e&2&&(c(),x(i.label()?1:-1))},styles:["[_nghost-%COMP%]{display:flex;flex:1}.control-group[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:16px}.control-group__label[_ngcontent-%COMP%]{font-size:1.2rem;margin:0}.control-group__content[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:flex-end}.control-group__content[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{flex:1}"]})};var je=["*",[["rowActions"]]],$e=["*","rowActions"],z=class n{constructor(){}mobileMode=P(!1);static \u0275fac=function(e){return new(e||n)};static \u0275cmp=R({type:n,selectors:[["lg-controls-row"]],inputs:{mobileMode:[1,"mobileMode"]},ngContentSelectors:$e,decls:5,vars:2,consts:[[1,"controls-row"],[1,"controls-row__controls"],[1,"controls-row__actions"]],template:function(e,i){e&1&&(k(je),l(0,"div",0)(1,"div",1),I(2),r(),l(3,"div",2),I(4,1),r()()),e&2&&K("controls-row__mobile",i.mobileMode())},styles:[`:host{display:flex;gap:16px}.controls-row{width:100%;display:flex;align-items:flex-end;gap:16px;flex:1}.controls-row__controls,.controls-row__actions{display:flex;align-items:flex-end;gap:16px}.controls-row__controls{flex:1}.controls-row__actions{flex:0;white-space:nowrap}.controls-row__controls>*,.controls-row__actions>*{flex:1}@media (max-width: 600px){.controls-row__mobile,.controls-row__mobile .controls-row__controls{flex-direction:column;align-items:stretch}}
`],encapsulation:2})};var ze=["tooltipComponent"],Le=["products"],Be=["productsSelector"],He=["nameField"],Qe=(n,t)=>(t.value.product_id==null?null:t.value.product_id.id)||t.value.name||t.value.amount;function Ue(n,t){if(n&1){let e=h();l(0,"lg-gap-column",22)(1,"lg-control",27),S(2,28),l(3,"span",29),_("click",function(){d(e);let o=s().$index,p=s();return u(p.closeTextField(o))}),m(4,"Hide"),r(),F(),l(5,"lg-input",30),_("onInputChanged",function(){d(e);let o=s().$index,p=V(6),f=s();return u(f.onIngredientSelected(p,o,["product_id","recipe_id"]))}),r()()()}n&2&&(a("size","small"),c(5),a("placeholder","Here you can write the name of the ingredient"))}function We(n,t){if(n&1){let e=h();l(0,"lg-multiselect",36),_("onSelected",function(){d(e);let o=s(2).$index,p=V(6),f=s();return u(f.onIngredientSelected(p,o,["product_id","name"]))}),r()}n&2&&a("resource","recipes")("autoLoad",!0)}function qe(n,t){if(n&1){let e=h();l(0,"lg-multiselect",37,3),_("onSelected",function(){d(e);let o=s(2).$index,p=V(6),f=s();return u(f.onIngredientSelected(p,o,["recipe_id","name"]))}),r()}n&2&&a("resource","products")("autoLoad",!0)}function Ke(n,t){if(n&1){let e=h();l(0,"lg-gap-column",22)(1,"lg-control"),S(2,31),l(3,"lg-button",32),_("click",function(){d(e);let o=s().$index,p=s();return u(p.closeRecipeField(o))}),m(4," Product "),r(),F(),S(5,33),l(6,"lg-button",32),_("click",function(){d(e);let o=s().$index,p=s();return u(p.openRecipeField(o))}),m(7,"Recipe "),r(),F(),S(8,28),l(9,"span",29),_("click",function(){d(e);let o=s().$index,p=s();return u(p.openTextField(o))}),m(10,"As text"),r(),F(),v(11,We,1,2,"lg-multiselect",34)(12,qe,2,2,"lg-multiselect",35),r()()}if(n&2){let e=s().$index,i=s();a("size","small"),c(3),a("flat",!0)("size","small")("active",!i.recipeFieldState()[e]),c(3),a("flat",!0)("size","small")("active",i.recipeFieldState()[e]),c(5),x(i.recipeFieldState()[e]?11:12)}}function Je(n,t){if(n&1){let e=h();S(0,16),l(1,"lg-controls-row",21),v(2,Ue,6,2,"lg-gap-column",22)(3,Ke,13,8,"lg-gap-column",22),l(4,"lg-control",23)(5,"lg-number-input",24,1),_("onKeydown",function(){d(e);let o=s();return u(o.addLast())}),r()(),C(7,"lg-buttons-group",25),S(8,26),l(9,"lg-button",17),_("click",function(){let o=d(e).$index,p=s();return u(p.deleteIngredient(o))}),m(10," Delete Ingredient "),r(),F(),r(),F()}if(n&2){let e=t.$index,i=s();a("formGroupName",e),c(),a("mobileMode",!0),c(),x(i.textFieldState()[e]?2:3),c(3),a("placeholder","In "+((i.form.value.ingredients==null||i.form.value.ingredients[e]==null?null:i.form.value.ingredients[e].unit)||"gram")),c(2),a("items",i.buttons),c(2),E("danger"),a("size","small")}}function Ye(n,t){if(n&1&&C(0,"lg-chips-list",20),n&2){let e=s(),i=V(21);a("control",i)("items",e.topCategories())}}function Xe(n,t){if(n&1){let e=h();l(0,"lg-button",29),_("click",function(){d(e);let o=s();return u(o.editRecipe(o.value))}),m(1," Edit Recipe "),r()}}function Ze(n,t){if(n&1){let e=h();l(0,"lg-button",29),_("click",function(){d(e);let o=s();return u(o.addRecipe(o.value))}),m(1," Add Recipe "),r()}}var L=class n{constructor(t,e,i,o,p){this._recipesRepository=t;this._selectResourcesService=e;this._router=i;this._aRoute=o;this._notificationsService=p;this._aRoute.data.pipe(he()).subscribe(f=>{this.recipe.set(f.recipe||null)})}recipe=A(null);uuid=$("uuid");form=new B({name:new g(null,se.required),description:new g(""),outcome_amount:new g(null),outcome_unit:new g(""),ingredients:new Ce([this._getIngredientGroup()]),category_id:new g(null)},t=>{let e=t.value?.outcome_amount,i=t.value?.outcome_unit,o=t.value?.ingredients?.reduce((p,f)=>f.unit!=="gram"?p:p+(+f.amount||0),0)||0;return e&&i=="gram"&&e>o?{outcomeAmountGreaterThanIngredients:!0}:null});textFieldState=A({});recipeFieldState=A({});buttons=[{label:"Grams",value:"gram",style:"secondary",onClick:()=>{console.log("Grams")}},{label:"Pieces",value:"piece",style:"secondary",onClick:()=>{console.log("Piece")}}];tooltipComponent=G("tooltipComponent");productsWidget=G("products");productsSelector=G("productsSelector");nameField=te("nameField");topCategories=A([]);people$=W([{uuid:"5a15b13c36e7a7f00cf0d7cb",name:"John Doe"},{uuid:"352f3a2c36e7a7f00cf0d7cb",name:"Alice Smith"},{uuid:"5a15b13c36e7a7f00cf0d7cb",name:"Bob Johnson"},{uuid:"352f3a2c36e7a7f00cf0d7cb",name:"Charlie Brown"}]);selectedPersonId="5a15b13c36e7a7f00cf0d7cb";recipeEffect=ee(()=>{this.recipe()&&(this.form.reset(y(b({},this.recipe()),{ingredients:[]})),this.form.get("ingredients").clear(),this.recipe()?.ingredients.forEach((t,e)=>{this.ingredients.push(this._getIngredientGroup(t)),t.recipe_id&&this.openRecipeField(e),t.name&&this.openTextField(e)}),this.form.updateValueAndValidity())});get ingredients(){return this.form.get("ingredients")}get value(){return this.form.value}get _values(){let t=this.form.value;return Ee(Ae(t))}get _formValid(){return this.form.valid&&!this.checkCycleRecipe(this.form.value.ingredients,this.uuid())}productAdded(t,e){return U(this,null,function*(){yield this._selectResourcesService.load(),this.tooltipComponent()?.at(e)?.close(),this.productsWidget()?.at(e)?.stopCamera(),this.ingredients.at(e).get("product_id")?.reset({uuid:t.uuid,name:t.name})})}addLast(){let t=this.ingredients.at(this.ingredients.length-1);(t.value.name||t.value.amount||t.value.product_id)&&this.addIngredient()}ngOnInit(){this._loadUsingHistory(),this.form.valueChanges.pipe(q(100)).subscribe({next:t=>{this.checkCycleRecipe(t.ingredients,this.uuid())&&this._notificationsService.error("You cannot add a recipe to itself")}})}ngAfterViewInit(){this._selectResourcesService.load().then(t=>{}),this.nameField().focus()}addIngredient(){this.ingredients.push(this._getIngredientGroup())}deleteIngredient(t){this.ingredients.removeAt(t)}addRecipe(t){if(!this._formValid){this._notificationsService.error(this._notificationsService.parseFormErrors(this.form).join(", "));return}this._recipesRepository.addRecipe(this._values).then(()=>{this.ingredients.clear(),this.form.reset({}),this.addIngredient(),this._loadUsingHistory(),this._notificationsService.success("Recipe added")})}editRecipe(t){if(!this._formValid){this._notificationsService.error(this._notificationsService.parseFormErrors(this.form).join(", "));return}this._recipesRepository.editRecipe(this.uuid(),this._values).then(()=>{this._notificationsService.success("Recipe edited")}).catch(e=>{console.error(e)})}onIngredientSelected(t,e,i){t.focus();let o=this.ingredients.at(e).value;this.ingredients.at(e).patchValue(y(b({},Array.isArray(i)?i.reduce((p,f)=>y(b({},p),{[f]:null}),{}):{[i]:null}),{unit:o.product_id?.unit||o.recipe_id?.unit||"gram"}))}openTextField(t){this.textFieldState.update(e=>y(b({},e),{[t]:!0}))}closeTextField(t){this.textFieldState.update(e=>y(b({},e),{[t]:!1}))}openRecipeField(t){this.recipeFieldState.update(e=>y(b({},e),{[t]:!0}))}closeRecipeField(t){this.recipeFieldState.update(e=>y(b({},e),{[t]:!1}))}checkCycleRecipe(t,e){let i=!1;for(let o of t){let p=o.recipe_id?.uuid;if(p&&p===e){i=!0;break}}return i}_loadUsingHistory(){this._recipesRepository.getTopCategories().then(t=>{this.topCategories.set(t.map(e=>({label:e.name,value:e.uuid})))})}_getIngredientGroup(t){return new B({name:new g(t?.name),amount:new g(t?.amount?.toString()??null),product_id:new g(t?.product_id?t.product_id:null),recipe_id:new g(t?.recipe_id?t.recipe_id:null),unit:new g(t?.unit??"gram")},e=>{if(!e.value.product_id&&!e.value.name&&!e.value.recipe_id&&!parseFloat(e.value.amount))return null;if((e.value.product_id||e.value.name||e.value.recipe_id)&&!parseFloat(e.value.amount))return{ingredientAmountRequired:!0};if(!this.uuid)return null;let i=this.uuid();return this.checkCycleRecipe([e.value],i)?{cycleRecipe:!0}:!e.value.product_id&&!e.value.name&&!e.value.recipe_id?{ingredientRequired:!0}:null})}static \u0275fac=function(e){return new(e||n)(w(ne),w(N),w(ie),w(D),w(ye))};static \u0275cmp=R({type:n,selectors:[["lg-add-recipe-form"]],viewQuery:function(e,i){e&1&&(T(i.tooltipComponent,ze,5),T(i.productsWidget,Le,5),T(i.productsSelector,Be,5),T(i.nameField,He,5)),e&2&&X(4)},features:[Z([{provide:N,useClass:N}])],decls:25,vars:15,consts:[["nameField",""],["amount",""],["categorySelect",""],["productsSelector",""],[3,"formGroup"],[3,"position"],["label","Name","lgExpand",""],["formControlName","name",3,"key","resource"],["label","Description","lgExpand",""],["formControlName","description",3,"placeholder"],["lgExpand","",3,"mobileMode"],["label","Amount of the outcome","lgExpand",""],["formControlName","outcome_amount","lgParseMath","",3,"placeholder"],["formControlName","outcome_unit",3,"items"],["label","Ingredients","lgExpand",""],["formArrayName","ingredients","lgExpand",""],[3,"formGroupName"],[3,"click","size"],["label","Category","lgExpand",""],["formControlName","category_id",3,"resource"],[3,"control","items"],[3,"mobileMode"],[3,"size"],["label","Amount"],["lgParseMath","","formControlName","amount",3,"onKeydown","placeholder"],["formControlName","unit",3,"items"],["ngProjectAs","rowActions",5,["rowActions"]],["label","Name"],["ngProjectAs","endLabelTpl",5,["endLabelTpl"]],[3,"click"],["formControlName","name",3,"onInputChanged","placeholder"],["ngProjectAs","labelTpl",5,["labelTpl"]],[3,"click","flat","size","active"],["ngProjectAs","afterLabelTpl",5,["afterLabelTpl"]],["formControlName","recipe_id",3,"resource","autoLoad"],["formControlName","product_id",3,"resource","autoLoad"],["formControlName","recipe_id",3,"onSelected","resource","autoLoad"],["formControlName","product_id",3,"onSelected","resource","autoLoad"]],template:function(e,i){if(e&1){let o=h();l(0,"form",4)(1,"lg-gap-column",5)(2,"lg-control",6),C(3,"lg-autocomplete",7,0),r(),l(5,"lg-control",8),C(6,"lg-textarea",9),r(),l(7,"lg-controls-row",10)(8,"lg-control",11),C(9,"lg-number-input",12,1),r(),C(11,"lg-buttons-group",13),r(),l(12,"lg-control-group",14)(13,"lg-gap-column",5)(14,"lg-gap-column",15),J(15,Je,11,8,"ng-container",16,Qe),r(),l(17,"lg-button",17),_("click",function(){return d(o),u(i.addIngredient())}),m(18," Add Ingredient "),r()()(),l(19,"lg-control",18),C(20,"lg-multiselect",19,2),r(),v(22,Ye,1,2,"lg-chips-list",20),v(23,Xe,2,0,"lg-button")(24,Ze,2,0,"lg-button"),r()()}e&2&&(a("formGroup",i.form),c(),a("position","start"),c(2),a("key","name")("resource","recipes-names"),c(3),a("placeholder","Describe your recipe, how to make it, what to pay attention to, etc."),c(),a("mobileMode",!0),c(2),a("placeholder",i.form.value.outcome_unit||"Here you can write the amount of the outcome (e.g. 100, 12, etc.)"),c(2),a("items",i.buttons),c(2),a("position","start"),c(2),Y(i.ingredients.controls),c(2),E("success"),a("size","small"),c(3),a("resource","recipes-categories"),c(2),x(i.topCategories().length?22:-1),c(),x(i.uuid()?23:24))},dependencies:[xe,de,pe,me,ue,ge,_e,fe,we,Re,O,be,j,Se,Fe,Ie,z,Te,Ve,Ne,ke,Me,ve],encapsulation:2})};function et(n,t){if(n&1&&(l(0,"lg-button",2),m(1," Calculate "),r()),n&2){let e=s();E("primary"),a("flat",!0)("link","/recipes/calculate/"+e.uuid())("size","small")}}var Pe=class n{constructor(t){this._aRoute=t}uuid=$("uuid");static \u0275fac=function(e){return new(e||n)(w(D))};static \u0275cmp=R({type:n,selectors:[["app-add-recipe"]],decls:8,vars:4,consts:[[3,"center","mobileMode"],[3,"flat","link","size","style"],[3,"flat","link","size"]],template:function(e,i){e&1&&(l(0,"lg-fade-in")(1,"lg-container")(2,"lg-gap-row",0)(3,"lg-title"),m(4),r(),v(5,et,2,5,"lg-button",1),r(),l(6,"lg-card"),C(7,"lg-add-recipe-form"),r()()()),e&2&&(c(2),a("center",!0)("mobileMode",!0),c(2),M("",i.uuid()?"Edit":"Add"," Recipe"),c(),x(i.uuid()?5:-1))},dependencies:[oe,re,le,L,j,ae,ce],encapsulation:2})};export{Pe as AddRecipeComponent};
