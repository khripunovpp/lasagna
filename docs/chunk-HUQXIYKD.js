import{a as je}from"./chunk-G66WNF3G.js";import{a as Ae}from"./chunk-6MKBKDFP.js";import{a as Oe,b as ze}from"./chunk-2B6LUUIM.js";import{a as Ne}from"./chunk-IFILGF77.js";import{a as K}from"./chunk-ORO2D6DT.js";import{a as U,c as H}from"./chunk-77FLK76L.js";import{a as Ve}from"./chunk-CEPNEZXV.js";import"./chunk-CWUUYJTE.js";import{a as De}from"./chunk-C5H2I4FC.js";import{a as We}from"./chunk-TBBEROLX.js";import{a as F}from"./chunk-U5RG623K.js";import{a as L}from"./chunk-7C3OD2VZ.js";import{a as Fe}from"./chunk-VPY63KRA.js";import"./chunk-MPFUNZLY.js";import{a as J}from"./chunk-O2QGAP6D.js";import{d as xe,i as Re,l as Ee}from"./chunk-F7IPTZBX.js";import"./chunk-JIYA5WDW.js";import{C as O,E as be,I as R,J as we,K as z,M as E,N as G,O as Se,P as ke,R as Be,S as Te,U as Ie,X as W,Y as Me,c as ye,ma as Pe,o as ve,oa as q,z as S}from"./chunk-SCGAETAM.js";import"./chunk-J6CDYHKM.js";import"./chunk-CABIONZL.js";import"./chunk-EMIJRNYJ.js";import{m as he}from"./chunk-ZA7VU5CB.js";import{$a as n,Cc as p,Db as x,Dc as d,Ec as ne,Fb as b,Hb as se,Ib as j,Jb as A,Kb as s,Lb as a,Mb as l,Mc as ge,Nb as f,Nc as fe,Oc as _e,Qc as Ce,Rb as M,Rc as N,Vb as w,Wb as u,_ as re,ea as ae,eb as V,fc as pe,gc as ie,hc as ce,jc as m,kc as h,la as _,lb as v,lc as g,ma as C,oc as k,pc as B,qb as I,qc as T,ra as le,rc as de,sc as me,tc as ue,va as y,wc as P}from"./chunk-X5WXA3YI.js";import"./chunk-2RGDSI3Q.js";import"./chunk-FK6H3RFT.js";import{a as oe}from"./chunk-C6Q5SG76.js";function qe(i,e){if(i&1){let t=M();a(0,"lg-flex-column",0)(1,"lg-control",6),p(2,"translate"),a(3,"lg-input",4),p(4,"translate"),T("ngModelChange",function(r){_(t);let c=u(2);return B(c.product.name,r)||(c.product.name=r),C(r)}),l()(),a(5,"lg-control",6),p(6,"translate"),a(7,"lg-number-input",4),p(8,"translate"),T("ngModelChange",function(r){_(t);let c=u(2);return B(c.product.amount,r)||(c.product.amount=r),C(r)}),l()(),a(9,"lg-control",6),p(10,"translate"),a(11,"lg-number-input",4),p(12,"translate"),T("ngModelChange",function(r){_(t);let c=u(2);return B(c.product.price,r)||(c.product.price=r),C(r)}),l(),a(13,"div"),m(14),l()(),a(15,"lg-button",7),w("click",function(){_(t);let r=u(2);return C(r.addProduct())}),m(16),p(17,"translate"),l()()}if(i&2){let t=u(2);s("size","medium"),n(),s("label",d(2,12,"widgets.barcode.name")),n(2),k("ngModel",t.product.name),s("placeholder",d(4,14,"widgets.barcode.name")),n(2),s("label",d(6,16,"widgets.barcode.amount")),n(2),k("ngModel",t.product.amount),s("placeholder",d(8,18,"widgets.barcode.amount")),n(2),s("label",d(10,20,"widgets.barcode.price")),n(2),k("ngModel",t.product.price),s("placeholder",d(12,22,"widgets.barcode.price")),n(3),h(t.product.unit),n(2),h(d(17,24,"widgets.barcode.add-product"))}}function Ue(i,e){if(i&1){let t=M();f(0,"video",2),a(1,"lg-flex-column")(2,"lg-flex-row",3)(3,"lg-input",4),p(4,"translate"),T("ngModelChange",function(r){_(t);let c=u();return B(c.barcode,r)||(c.barcode=r),C(r)}),l(),a(5,"lg-button",5),w("click",function(){_(t);let r=u();return C(r.onBarcodeManualInput())}),m(6),p(7,"translate"),l(),a(8,"lg-button",5),w("click",function(){_(t);let r=u();return C(r.clear())}),m(9),p(10,"translate"),l()(),x(11,qe,18,26,"lg-flex-column",0),l()}if(i&2){let t=u();n(3),k("ngModel",t.barcode),s("placeholder",d(4,5,"widgets.barcode.placeholder")),n(3),h(d(7,7,"widgets.barcode.search")),n(3),h(d(10,9,"widgets.barcode.clear")),n(2),b(t.showProductForm()&&t.productResult()?11:-1)}}function He(i,e){if(i&1){let t=M();a(0,"lg-button",5),w("click",function(){_(t);let r=u();return C(r.openScanner())}),m(1),p(2,"translate"),l()}i&2&&(n(),h(d(2,1,"widgets.barcode.scan")))}var Q=class i{constructor(e,t,o,r){this._openFoodFactsService=e;this._arcodeReaderService=t;this._productRepository=o;this._notificationService=r}productAdded=Ce();barcode=y("");product={name:"",price:0,amount:0,unit:"gram"};lockRequest=!1;showFormInitially=N(!1);showScanerInitially=N(!1);showScanner=y(!1);showProductForm=y(!1);userResource=_e({params:()=>({id:this.barcode()}),loader:({params:e,abortSignal:t})=>this.lockRequest||!e.id?Promise.resolve(null):(this._notificationService.info("Barcode detected: "+e.id),this.lockRequest=!0,this._openFoodFactsService.getProductByBarcode(e.id).then(o=>(this.showProductForm.set(!0),o)))});productResult=ge(()=>{let e=this.userResource.value();if(e?.status===1){let t=e.product;return this.product.name=(t.product_name||"")+" ("+(t.brands||"")+")",this.product.amount=this.extractAmount(t),this.product.unit=this.detectUnit(t),oe({},this.product)}return null});onBarcodeManualInput(){this.lockRequest=!1}openScanner(){this.showScanner.set(!0),this.startCamera()}clear(){this.barcode.set(""),this.product={name:"",price:0,amount:0,unit:"gram"},this.showProductForm.set(!1),this.lockRequest=!1}closeScanner(){this.showScanner.set(!1),this.stopCamera()}extractAmount(e){if(e.quantity){let t=e.quantity.match(/\d+/);return t?+t[0]:0}return 0}stopCamera(){this._arcodeReaderService.stopCamera()}detectUnit(e){let t=(e.serving_quantity_unit||"").toLowerCase();return t.includes("g")||t.includes("ml")?"gram":t.includes("pc")||t.includes("\u0448\u0442")?"piece":"gram"}addProduct(){this._productRepository.addOne(ye.fromRaw({name:this.product.name,price:this.product.price,amount:this.product.amount,unit:this.product.unit,source:"openfoodfacts",category_id:"",tags:[],createdAt:Date.now()})).then(e=>{this.productAdded.emit({uuid:e,name:this.product.name}),this.product={name:"",price:0,amount:0,unit:"gram"},this.barcode.set(""),this.lockRequest=!1})}startCamera(){return this._arcodeReaderService.startCamera("video",e=>{e&&this.barcode.set(e)})}async ngAfterViewInit(){this.showScanerInitially()&&(this.showScanner.set(!0),await this.startCamera())}ngOnDestroy(){this.stopCamera()}static \u0275fac=function(t){return new(t||i)(V(Re),V(xe),V(Ee),V(Pe))};static \u0275cmp=v({type:i,selectors:[["lg-barcode-add-product-widget"]],inputs:{showFormInitially:[1,"showFormInitially"],showScanerInitially:[1,"showScanerInitially"]},outputs:{productAdded:"productAdded"},features:[P([])],decls:7,vars:7,consts:[[3,"size"],[3,"top","mobileMode"],["id","video"],["lgExpand",""],["lgExpand","","lgParseMath","",3,"ngModelChange","ngModel","placeholder"],[3,"click"],[3,"label"],["lgShrink","",3,"click"]],template:function(t,o){t&1&&(a(0,"lg-flex-column",0)(1,"lg-title"),m(2),p(3,"translate"),l(),a(4,"lg-flex-row",1),x(5,Ue,12,11)(6,He,3,3,"lg-button"),l()()),t&2&&(s("size","medium"),n(2),g(" \u{1F4F7} ",d(3,5,"widgets.barcode.title")," "),n(2),s("top",!0)("mobileMode",!0),n(),b(o.showScanner()?5:6))},dependencies:[W,R,G,L,Ne,J,q,De,H,F,U,Ae,K,S],encapsulation:2})};var Ke=(i,e)=>e.value;function Qe(i,e){if(i&1){let t=M();a(0,"lg-button",2),w("click",function(){let r=_(t),c=r.$implicit,D=r.$index,Le=u();return C(Le.onClickItem(c,D))}),m(1),p(2,"translate"),l()}if(i&2){let t=e.$implicit,o=e.$index,r=e.$count,c=u();ce(t.style||"default"),ie("buttons-group__item--active",c.activeIndex()==o),s("active",c.activeIndex()==o)("flat",c.flat)("noScale",!0)("size",t.size||"default")("noLeftRadius",o===r-1)("noRightRadius",o===0)("noRadius",o!==0&&o!==r-1),n(),g(" ",d(2,12,t.label)," ")}}var Z=class i{flat=!1;items=N();activeIndex=y(0);value=y("");effect=fe(()=>{let e=this.items()?.findIndex(t=>t.value===this.value())??-1;this.activeIndex.set(e===-1?0:e)});onClickItem(e,t){this.activeIndex.set(t),this.writeValue(e.value),e.onClick?.()}onChange=()=>{};onTouched=()=>{};writeValue(e){this._change(e)}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}onChangeInput(e){this._change(e.target.value)}_change(e){this.value.set(e),this.onChange(this.value())}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=v({type:i,selectors:[["lg-buttons-group"]],inputs:{flat:"flat",items:[1,"items"]},features:[P([{provide:O,useExisting:re(()=>i),multi:!0}])],decls:3,vars:2,consts:[[1,"buttons-group"],[1,"buttons-group__item",3,"active","flat","noScale","style","size","noLeftRadius","noRightRadius","noRadius","buttons-group__item--active"],[1,"buttons-group__item",3,"click","active","flat","noScale","size","noLeftRadius","noRightRadius","noRadius"]],template:function(t,o){t&1&&(a(0,"div",0),j(1,Qe,3,14,"lg-button",1,Ke),l()),t&2&&(ie("buttons-group--flat",o.flat),n(),A(o.items()))},dependencies:[q,S],styles:[`.buttons-group{display:flex}.buttons-group lg-button{flex:1}.buttons-group lg-button button{width:100%}.buttons-group--flat{gap:16px;width:100%}
`],encapsulation:2})};var Xe={powder:{mass:i=>i*5+i},leaf:{mass:i=>i*5+i},mass:{powder:i=>i/6,leaf:i=>i/6}},Ye=i=>i*5,Ze=i=>i*5/6,$e=(i,e)=>i/e,$=class{constructor(e,t=1){this.type=e;this.bloom=t}convertToBase(e,t,o=1){let r=$e(this.bloom,o);return(Xe[this.type]?.[e]?.(t)||t)*r}convertToWater(e,t){return this.type==="mass"&&e==="mass"||this.type==="leaf"||e==="leaf"?0:this.type==="mass"?Ye(t):e==="mass"?Ze(t):0}};function et(i,e){if(i&1&&(a(0,"div",4),f(1,"div",5),a(2,"div",6),m(3),l()()),i&2){let t=e.$implicit,o=u();pe("left",(t-o.min)/(o.max-o.min)*100,"%"),n(3),h(t)}}var ee=class i{constructor(){}min=0;max=100;step=1;tickInterval;customTicks;value="";get ticks(){if(this.customTicks)return this.customTicks;if(this.tickInterval){let e=[];for(let t=this.min;t<=this.max;t+=this.tickInterval)e.push(t);return e}return[]}onChange=()=>{};onTouched=()=>{};writeValue(e){this.changeValue(e)}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}changeValue(e){this.value=e,this.onChange(this.value)}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=v({type:i,selectors:[["lg-range"]],inputs:{min:"min",max:"max",step:"step",tickInterval:"tickInterval",customTicks:"customTicks"},features:[P([{provide:O,useExisting:i,multi:!0}])],decls:5,vars:4,consts:[[1,"range-wrapper"],["type","range",1,"custom-range",3,"ngModelChange","min","max","step","ngModel"],[1,"ticks"],[1,"tick",3,"left"],[1,"tick"],[1,"tick-line"],[1,"label"]],template:function(t,o){t&1&&(a(0,"div",0)(1,"input",1),T("ngModelChange",function(c){return B(o.value,c)||(o.value=c),c}),w("ngModelChange",function(c){return o.changeValue(c)}),l(),a(2,"div",2),j(3,et,4,3,"div",3,se),l()()),t&2&&(n(),s("min",o.min)("max",o.max)("step",o.step),k("ngModel",o.value),n(2),A(o.ticks))},dependencies:[W,be,ke,R,G],styles:[".range-wrapper[_ngcontent-%COMP%]{position:relative;width:100%;padding-bottom:30px}.custom-range[_ngcontent-%COMP%]{width:100%;-webkit-appearance:none;background:transparent;position:relative;z-index:2;margin:0}.custom-range[_ngcontent-%COMP%]::-webkit-slider-runnable-track{height:6px;background:#ddd;border-radius:3px}.custom-range[_ngcontent-%COMP%]::-moz-range-track{height:6px;background:#ddd;border-radius:3px}.custom-range[_ngcontent-%COMP%]::-webkit-slider-thumb{-webkit-appearance:none;height:20px;width:20px;background:var(--accent-color);border-radius:50%;margin-top:-7px;cursor:pointer}.custom-range[_ngcontent-%COMP%]::-moz-range-thumb{height:20px;width:20px;background:var(--accent-color);border-radius:50%;cursor:pointer}.ticks[_ngcontent-%COMP%]{position:absolute;top:28px;left:2.4%;right:2.4%;height:30px;pointer-events:none}.tick[_ngcontent-%COMP%]{position:absolute;text-align:center;transform:translate(-50%)}.tick-line[_ngcontent-%COMP%]{width:1px;height:10px;background-color:#666;margin:0 auto}.label[_ngcontent-%COMP%]{font-size:10px;color:#666;margin-top:2px;display:block}"]})};function tt(i,e){i&1&&(m(0),p(1,"translate")),i&2&&g(" ",d(1,1,"jelly.grams-of")," ")}function it(i,e){i&1&&m(0," \u{1F35A} ")}function nt(i,e){i&1&&m(0," \u{1F343} ")}function ot(i,e){i&1&&m(0," \u{1F9EB} ")}function rt(i,e){i&1&&(a(0,"div"),m(1),p(2,"translate"),l()),i&2&&(n(),g(" ",d(2,1,"jelly.with")," "))}function at(i,e){i&1&&(a(0,"div"),m(1),p(2,"translate"),l()),i&2&&(n(),g(" ",d(2,1,"jelly.and")," "))}function lt(i,e){i&1&&(a(0,"div"),m(1),p(2,"translate"),l()),i&2&&(n(),g(" ",d(2,1,"jelly.and")," "))}function st(i,e){i&1&&(f(0,"br"),m(1),p(2,"translate")),i&2&&(n(),g("",d(2,1,"jelly.included")," "))}function pt(i,e){if(i&1&&(a(0,"lg-flex-column",9)(1,"div"),x(2,rt,3,3,"div"),x(3,at,3,3,"div")(4,lt,3,3,"div"),l(),a(5,"lg-flex-row",10)(6,"div"),m(7),p(8,"number"),l(),m(9," \u{1F4A7} "),l(),a(10,"div"),m(11),p(12,"translate"),x(13,st,3,3),l()()),i&2){let t,o,r,c=u(),D=ue(11);s("size","small")("position","center"),n(2),b((t=D)==="mass"?2:-1),n(),b((o=D)==="powder"?3:o==="leaf"?4:-1),n(2),s("size","small"),n(2),h(ne(8,8,c.waterNeeded(),"1.0-2")),n(4),g(" ",d(12,11,"jelly.ml-of-water")," "),n(2),b((r=D)==="mass"?13:-1)}}var te=class i{constructor(){this.form.valueChanges.pipe(ve(this.destroyRef)).subscribe(e=>{let t=parseFloat(String(e?.from?.amount));if(isNaN(t))return;let o=new $(e?.from?.type,e?.from?.bloom),r=o.convertToBase(e?.to?.type,t,e?.to?.bloom),c=o.convertToWater(e?.to?.type,r);this.result.set(r),this.waterNeeded.set(c)})}result=y(0);waterNeeded=y(0);destroyRef=ae(le);form=new z({from:new z({type:new E("mass"),amount:new E(null),bloom:new E(140)}),to:new z({type:new E("powder"),bloom:new E(140)})});typeButtons=[{label:"jelly.type.powder",value:"powder",style:"secondary"},{label:"jelly.type.leaf",value:"leaf",style:"secondary"},{label:"jelly.type.mass",value:"mass",style:"secondary"}];static \u0275fac=function(t){return new(t||i)};static \u0275cmp=v({type:i,selectors:[["lg-jelly-widget"]],decls:30,vars:34,consts:[[3,"formGroup"],[3,"bottom","mobileMode"],["formGroupName","from"],["formControlName","amount","lgParseMath","",3,"placeholder"],["lgExtraTpl","","place","after"],["formControlName","bloom",3,"min","max","step","tickInterval"],["formControlName","type",3,"items"],["formGroupName","to"],[1,"text-center",3,"strictCenter"],["lgShrink","",3,"size","position"],[2,"font-size","2rem",3,"size"]],template:function(t,o){if(t&1&&(a(0,"lg-flex-column")(1,"form",0)(2,"lg-flex-row",1)(3,"lg-flex-column",2),m(4),p(5,"translate"),a(6,"lg-number-input",3),I(7,tt,2,3,"ng-template",4),l(),f(8,"lg-range",5)(9,"lg-buttons-group",6),l(),a(10,"lg-flex-column",7),de(11),a(12,"lg-flex-row",8)(13,"lg-flex-column",9)(14,"div"),m(15),p(16,"translate"),l(),a(17,"lg-flex-row",10)(18,"div"),m(19),p(20,"number"),l(),x(21,it,1,0)(22,nt,1,0)(23,ot,1,0),l(),a(24,"div"),m(25),p(26,"translate"),l()(),x(27,pt,14,13,"lg-flex-column",9),l(),f(28,"lg-range",5)(29,"lg-buttons-group",6),l()()()()),t&2){let r;n(),s("formGroup",o.form),n(),s("bottom",!0)("mobileMode",!0),n(2),g(" ",d(5,24,"jelly.in-recipe-you-have")," "),n(2),s("placeholder","Amount"),n(2),s("min",120)("max",220)("step",10)("tickInterval",20),n(),s("items",o.typeButtons),o.form.value==null||o.form.value.from==null||o.form.value.from.type,n(2);let c=me(o.form.value==null||o.form.value.to==null?null:o.form.value.to.type);n(),s("strictCenter",!0),n(),s("size","small")("position","center"),n(2),g(" ",d(16,27,"jelly.you-need")," "),n(2),s("size","small"),n(2),h(ne(20,29,o.result(),"1.0-2")),n(2),b((r=c)==="powder"?21:r==="leaf"?22:r==="mass"?23:-1),n(4),g(" ",d(26,32,"jelly.grams-of")," "),n(2),b(o.waterNeeded()?27:-1),n(),s("min",120)("max",220)("step",10)("tickInterval",20),n(),s("items",o.typeButtons)}},dependencies:[W,Se,R,we,Me,Be,Ie,Te,L,F,Z,he,K,ee,U,H,Ve,S],styles:[`:host{--control-bg: #fcfcfc}lg-eggs-widget{display:flex}.eggs-widget{display:flex;flex-direction:column}.eggs-widget__eggs{display:flex;align-items:flex-end;gap:8px}.eggs-widget__eggs img{width:40px}.eggs-widget__egg{display:flex;align-items:center;justify-content:center;flex:1;flex-direction:column;white-space:nowrap;gap:8px;background-color:var(--control-bg);border-radius:24px;padding:16px}.eggs-widget__egg:first-child img{transform:scale(.8)}.eggs-widget__egg:last-child img{transform:scale(1.2)}.eggs-widget__egg.selected{background-color:#61b789}.eggs-widget__egg.selected:first-child{background-color:#b4b8f8}.eggs-widget__egg.selected:last-child{background-color:#ff8080}
`],encapsulation:2})};function ct(i,e){i&1&&f(0,"lg-jelly-widget")}function dt(i,e){i&1&&f(0,"lg-eggs-widget")}function mt(i,e){i&1&&f(0,"lg-barcode-add-product-widget")}var Je=class i{static \u0275fac=function(t){return new(t||i)};static \u0275cmp=v({type:i,selectors:[["lg-widgets-page"]],decls:13,vars:13,consts:[[3,"center"],["alias","jelly-calculator","lgTab","",3,"label"],["alias","eggs-calculator","lgTab","",3,"label"],["alias","barcode-seeker","lgTab","",3,"label"]],template:function(t,o){t&1&&(a(0,"lg-fade-in")(1,"lg-container")(2,"lg-flex-row",0)(3,"lg-title"),m(4),p(5,"translate"),l()(),a(6,"lg-tabs"),I(7,ct,1,0,"ng-template",1),p(8,"translate"),I(9,dt,1,0,"ng-template",2),p(10,"translate"),I(11,mt,1,0,"ng-template",3),p(12,"translate"),l()()()),t&2&&(n(2),s("center",!0),n(2),g(" ",d(5,5,"widgets.page.title")," "),n(3),s("label",d(8,7,"widgets.page.jelly-calculator")),n(2),s("label",d(10,9,"widgets.page.eggs-calculator")),n(2),s("label",d(12,11,"widgets.page.barcode-seeker")))},dependencies:[je,We,F,J,Q,Fe,Oe,ze,te,S],encapsulation:2})};export{Je as WidgetsPageComponent};
