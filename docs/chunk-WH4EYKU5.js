import{l}from"./chunk-AGDD4VEX.js";import{A as S}from"./chunk-D66Q4FT5.js";import{W as s,_ as r,na as c}from"./chunk-CG2HRCOU.js";import{f as g}from"./chunk-2WH2EVR6.js";var o=class i{constructor(t){t&&Array.isArray(t)}settings=new Map;static empty(){return new i}static fromRaw(t){if(t instanceof i)return t;let e=new i;return Array.isArray(t)?t.forEach(n=>{e.addSetting(n.key,n.data)}):Object.entries(t).forEach(([n,d])=>{e.addSetting(n,d)}),e}addSetting(t,e){this.settings.set(t,{key:t,data:e})}getSetting(t){return this.settings.get(t)}getAllSettings(){return Array.from(this.settings.values())}removeSetting(t){this.settings.delete(t)}toDTO(){return{settings:Array.from(this.settings.values())}}};var a=class i{constructor(t){this._indexDbService=t}updateSettings(t){return g(this,null,function*(){return yield this._indexDbService.clear("settings"),this._indexDbService.balkAdd("settings",t.toDTO().settings)})}getOne(t){return this._indexDbService.search("settings","key",t).then(e=>e?e[0]:null)}getAll(){return this._indexDbService.getAll("settings").then(t=>o.fromRaw(t))}static \u0275fac=function(e){return new(e||i)(r(S))};static \u0275prov=s({token:i,factory:i.\u0275fac,providedIn:"root"})};var u=class i{constructor(t,e){this._settingsRepository=t;this._localisationService=e}settingsModel;settingsSignal=c(void 0);get lang(){return this._localisationService.lang}get languages(){return this._localisationService.languages}loadSettings(){return this._settingsRepository.getAll().then(t=>(this.settingsModel=t,this.settingsSignal.set(t),t))}saveSettings(){if(this.settingsModel){debugger;return this.settingsSignal.set(this.settingsModel),this._settingsRepository.updateSettings(this.settingsModel)}else return Promise.resolve()}changeLang(t){this._localisationService.changeLang(t),this.settingsModel?.addSetting("lang",t),this.saveSettings()}changeCurrency(t){this.settingsModel?.addSetting("currency",t),this.saveSettings()}static \u0275fac=function(e){return new(e||i)(r(a),r(l))};static \u0275prov=s({token:i,factory:i.\u0275fac,providedIn:"root"})};export{u as a};
