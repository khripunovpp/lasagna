import{a as Te}from"./chunk-JL4AOETJ.js";import{a as Ve}from"./chunk-XW7PSHXX.js";import{a as ye,b as be,c as Re,d as Se,e as Ee}from"./chunk-2MQQJLC4.js";import{a as Fe,b as Ae}from"./chunk-UNGG2BEL.js";import{b as N}from"./chunk-B554CIE5.js";import{a as he}from"./chunk-UZBYRUYP.js";import{a as ve}from"./chunk-KYYDJ2CN.js";import{a as ce,c as se,e as pe,f as me,g as M,h as x,j as de,k as ue,l as _e,m as fe,n as ge,o as j,p as Ce,q as xe}from"./chunk-32O7IJMM.js";import{a as we}from"./chunk-NTM2FENS.js";import{a as O}from"./chunk-NEKHWACR.js";import{a as Ie}from"./chunk-XVXTNF3J.js";import{a as le,b as ae}from"./chunk-AYZPP7UL.js";import{f as ie,h as oe}from"./chunk-VHR6F3YK.js";import{Ab as S,Bb as A,Db as g,Dc as ne,Eb as u,Fb as s,Gb as G,Hb as T,Kb as X,L as K,Lb as Z,Mb as ee,Nc as re,Pb as I,Qb as _,Sb as P,Ta as a,Xb as D,Ya as R,_ as Q,a as v,ab as C,b as h,ca as U,ja as m,jc as te,ka as d,lb as c,mc as b,nb as Y,ob as E,pa as V,rb as w,sb as y,vb as W,wb as J,xb as r,yb as l,zb as F}from"./chunk-EXR2ZECX.js";var ke=["*"];function Ge(o,t){if(o&1&&(r(0,"p",1),_(1),l()),o&2){let e=s();a(),P(" ",e.label()," ")}}var $=class o{constructor(){}label=b("");static \u0275fac=function(e){return new(e||o)};static \u0275cmp=C({type:o,selectors:[["lg-control-group"]],inputs:{label:[1,"label"]},ngContentSelectors:ke,decls:4,vars:1,consts:[[1,"control-group"],[1,"control-group__label"],[1,"control-group__content"]],template:function(e,n){e&1&&(G(),r(0,"div",0),w(1,Ge,2,1,"p",1),r(2,"div",2),T(3),l()()),e&2&&(a(),y(n.label()?1:-1))},styles:["[_nghost-%COMP%]{display:flex;flex:1}.control-group[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:16px}.control-group__label[_ngcontent-%COMP%]{font-size:1.2rem;margin:0}.control-group__content[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:flex-end}.control-group__content[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{flex:1}"]})};var Pe=["input"],z=class o{constructor(){}input;value="";placeholder=b("Enter text here");onChange=()=>{};onTouched=()=>{};writeValue(t){this.changeValue(t)}registerOnChange(t){this.onChange=t}focus(){this.input?.nativeElement.focus()}registerOnTouched(t){this.onTouched=t}changeValue(t){this.value=t,this.onChange(this.value)}onChangeInput(t){this.changeValue(t.target.value)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=C({type:o,selectors:[["lg-textarea"]],viewQuery:function(e,n){if(e&1&&X(Pe,7),e&2){let i;Z(i=ee())&&(n.input=i.first)}},inputs:{placeholder:[1,"placeholder"]},features:[D([{provide:ce,useExisting:o,multi:!0}])],decls:2,vars:2,consts:[["input",""],["rows","5",1,"textarea",3,"input","placeholder","value"]],template:function(e,n){if(e&1){let i=g();r(0,"textarea",1,0),u("input",function(f){return m(i),d(n.onChangeInput(f))}),l()}e&2&&c("placeholder",n.placeholder())("value",n.value)},dependencies:[Ce],styles:["[_nghost-%COMP%]{display:flex;flex:1}.textarea[_ngcontent-%COMP%]{flex:1;border:none;border-radius:12px;padding:16px;background-color:var(--control-bg);font-family:inherit;font-size:inherit}.textarea[_ngcontent-%COMP%]::placeholder{color:var(--placeholder)}.textarea[_ngcontent-%COMP%]:focus{outline:none;box-shadow:var(--focus-shadow)}"]})};var De=["*",[["rowActions"]]],je=["*","rowActions"],H=class o{constructor(){}mobileMode=b(!1);static \u0275fac=function(e){return new(e||o)};static \u0275cmp=C({type:o,selectors:[["lg-controls-row"]],inputs:{mobileMode:[1,"mobileMode"]},ngContentSelectors:je,decls:5,vars:2,consts:[[1,"controls-row"],[1,"controls-row__controls"],[1,"controls-row__actions"]],template:function(e,n){e&1&&(G(De),r(0,"div",0)(1,"div",1),T(2),l(),r(3,"div",2),T(4,1),l()()),e&2&&Y("controls-row__mobile",n.mobileMode())},styles:[`:host{display:flex;gap:16px}.controls-row{width:100%;display:flex;align-items:flex-end;gap:16px;flex:1}.controls-row__controls,.controls-row__actions{display:flex;align-items:flex-end;gap:16px}.controls-row__controls{flex:1}.controls-row__actions{flex:0;white-space:nowrap}.controls-row__controls>*,.controls-row__actions>*{flex:1}@media (max-width: 600px){.controls-row__mobile,.controls-row__mobile .controls-row__controls{flex-direction:column;align-items:stretch}}
`],encapsulation:2})};var B=class o{constructor(t){this._toast=t}success(t){this._toast.success(t)}error(t){this._toast.error(t)}warning(t){this._toast.warning(t)}info(t){this._toast.info(t)}show(t){this._toast.show(t)}loading(t){this._toast.loading(t)}parseFormErrors(t){let e=[];for(let n in t.controls){let i=t.controls[n];(i instanceof M||i instanceof j)&&e.push(...this.parseFormErrors(i)),i.errors&&e.push(...Object.entries(i.errors).map(([p,f])=>`${n}: ${p}`))}return e}static \u0275fac=function(e){return new(e||o)(U(Te))};static \u0275prov=Q({token:o,factory:o.\u0275fac,providedIn:"root"})};var Le=(o,t)=>(t.value.product_id==null?null:t.value.product_id.id)||t.value.name||t.value.amount;function ze(o,t){if(o&1){let e=g();r(0,"lg-gap-column",17)(1,"lg-control",22),S(2,23),r(3,"span",24),u("click",function(){m(e);let i=s().$index,p=s();return d(p.closeTextField(i))}),_(4,"Hide"),l(),A(),r(5,"lg-input",5),u("onInputChanged",function(){m(e);let i=s().$index,p=I(6),f=s();return d(f.onIngredientSelected(p,i,["product_id","recipe_id"]))}),l()()()}o&2&&(c("size","small"),a(5),c("placeholder","Here you can write the name of the ingredient"))}function He(o,t){if(o&1){let e=g();r(0,"lg-multiselect",30),u("onSelected",function(){m(e);let i=s(2).$index,p=I(6),f=s();return d(f.onIngredientSelected(p,i,["product_id","name"]))}),l()}o&2&&c("resource","recipes")("autoLoad",!0)}function Be(o,t){if(o&1){let e=g();r(0,"lg-multiselect",31),u("onSelected",function(){m(e);let i=s(2).$index,p=I(6),f=s();return d(f.onIngredientSelected(p,i,["recipe_id","name"]))}),l()}o&2&&c("resource","products")("autoLoad",!0)}function qe(o,t){if(o&1){let e=g();r(0,"lg-gap-column",17)(1,"lg-control"),S(2,25),r(3,"span",26),u("click",function(){m(e);let i=s().$index,p=s();return d(p.closeRecipeField(i))}),_(4," Product "),l(),A(),S(5,27),r(6,"span",26),u("click",function(){m(e);let i=s().$index,p=s();return d(p.openRecipeField(i))}),_(7,"Recipe"),l(),A(),S(8,23),r(9,"span",24),u("click",function(){m(e);let i=s().$index,p=s();return d(p.openTextField(i))}),_(10,"As text"),l(),A(),w(11,He,1,2,"lg-multiselect",28)(12,Be,1,2,"lg-multiselect",29),l()()}if(o&2){let e=s().$index,n=s();c("size","small"),a(3),c("ngClass",n.recipeFieldState()[e]?"":"text-active text-bold"),a(3),c("ngClass",n.recipeFieldState()[e]?"text-active text-bold":""),a(5),y(n.recipeFieldState()[e]?11:12)}}function Ke(o,t){if(o&1){let e=g();S(0,14),r(1,"lg-controls-row",16),w(2,ze,6,2,"lg-gap-column",17)(3,qe,13,4,"lg-gap-column",17),r(4,"lg-control",18)(5,"lg-number-input",19,1),u("onKeydown",function(){m(e);let i=s();return d(i.addLast())}),l()(),F(7,"lg-buttons-group",20),S(8,21),r(9,"lg-button",15),u("click",function(){let i=m(e).$index,p=s();return d(p.deleteIngredient(i))}),_(10," Delete Ingredient "),l(),A(),l(),A()}if(o&2){let e=t.$index,n=s();c("formGroupName",e),a(),c("mobileMode",!0),a(),y(n.textFieldState()[e]?2:3),a(3),c("placeholder","In "+((n.form.value.ingredients==null||n.form.value.ingredients[e]==null?null:n.form.value.ingredients[e].unit)||"gram")),a(2),c("items",n.buttons),a(2),E("danger"),c("size","small")}}function Qe(o,t){if(o&1){let e=g();r(0,"lg-button",24),u("click",function(){m(e);let i=s();return d(i.editRecipe(i.value))}),_(1," Edit Recipe "),l()}}function Ue(o,t){if(o&1){let e=g();r(0,"lg-button",24),u("click",function(){m(e);let i=s();return d(i.addRecipe(i.value))}),_(1," Add Recipe "),l()}}var q=class o{constructor(t,e,n,i){this._recipesRepository=t;this._selectResourcesService=e;this._router=n;this._notificationsService=i}form=new M({name:new x(null,se.required),description:new x(""),outcome_amount:new x(null),outcome_unit:new x(""),ingredients:new j([this._getIngredientGroup()])});uuid=b("");textFieldState=V({});recipeFieldState=V({});buttons=[{label:"Grams",value:"gram",style:"secondary",onClick:()=>{console.log("Grams")}},{label:"Pieces",value:"piece",style:"secondary",onClick:()=>{console.log("Piece")}}];uuidEffect=te(()=>{this.uuid()&&this._recipesRepository.getOne(this.uuid()).then(t=>{this.form.reset(h(v({},t),{ingredients:[]})),this.form.get("ingredients").clear(),t?.ingredients.forEach((e,n)=>{this.ingredients.push(this._getIngredientGroup(e)),e.recipe_id&&this.openRecipeField(n),e.name&&this.openTextField(n)}),this.form.updateValueAndValidity()})});get ingredients(){return this.form.get("ingredients")}get value(){return this.form.value}get _values(){let t=this.form.value;return Re(be(t))}get _formValid(){return this.form.valid&&!this.checkCycleRecipe(this.form.value.ingredients,this.uuid())}addLast(){let t=this.ingredients.at(this.ingredients.length-1);(t.value.name||t.value.amount||t.value.product_id)&&this.addIngredient()}ngOnInit(){this.form.valueChanges.pipe(K(100)).subscribe({next:t=>{this.checkCycleRecipe(t.ingredients,this.uuid())&&this._notificationsService.error("You cannot add a recipe to itself"),console.log(t)}})}ngAfterViewInit(){this._selectResourcesService.load().then(t=>{})}addIngredient(){this.ingredients.push(this._getIngredientGroup())}deleteIngredient(t){this.ingredients.removeAt(t)}addRecipe(t){if(!this._formValid){this._notificationsService.error(this._notificationsService.parseFormErrors(this.form).join(", "));return}this._recipesRepository.addRecipe(this._values).then(()=>{this._router.navigate(["/recipes"])})}editRecipe(t){if(!this._formValid){this._notificationsService.error(this._notificationsService.parseFormErrors(this.form).join(", "));return}this._recipesRepository.editRecipe(this.uuid(),this._values).then(()=>{this._router.navigate(["/recipes"])}).catch(e=>{console.error(e)})}onIngredientSelected(t,e,n){t.focus();let i=this.ingredients.at(e).value,p=i.product_id?.unit==="gram"||i.recipe_id?.unit==="gram";console.log({value:i}),this.ingredients.at(e).patchValue(h(v({},Array.isArray(n)?n.reduce((f,Ne)=>h(v({},f),{[Ne]:null}),{}):{[n]:null}),{unit:i.product_id?.unit||i.recipe_id?.unit||"gram"}))}openTextField(t){this.textFieldState.update(e=>h(v({},e),{[t]:!0}))}closeTextField(t){this.textFieldState.update(e=>h(v({},e),{[t]:!1}))}openRecipeField(t){this.recipeFieldState.update(e=>h(v({},e),{[t]:!0}))}closeRecipeField(t){this.recipeFieldState.update(e=>h(v({},e),{[t]:!1}))}checkCycleRecipe(t,e){let n=!1;for(let i of t){let p=i.recipe_id?.uuid;if(p&&p===e){n=!0;break}}return n}_getIngredientGroup(t){return new M({name:new x(t?.name),amount:new x(t?.amount?.toString()??null),product_id:new x(t?.product_id?{uuid:t.product_id}:null),recipe_id:new x(t?.recipe_id?{uuid:t.recipe_id}:null),unit:new x(t?.unit??"gram")},e=>{if(!e.value.product_id&&!e.value.name&&!e.value.recipe_id&&!parseInt(e.value.amount))return null;if((e.value.product_id||e.value.name||e.value.recipe_id)&&!parseInt(e.value.amount))return{ingredientAmountRequired:!0};if(!this.uuid)return null;let n=this.uuid();return this.checkCycleRecipe([e.value],n)?{cycleRecipe:!0}:!e.value.product_id&&!e.value.name&&!e.value.recipe_id?{ingredientRequired:!0}:null})}static \u0275fac=function(e){return new(e||o)(R(Ve),R(N),R(oe),R(B))};static \u0275cmp=C({type:o,selectors:[["lg-add-recipe-form"]],inputs:{uuid:[1,"uuid"]},features:[D([{provide:N,useClass:N}])],decls:21,vars:12,consts:[["desc",""],["amount",""],[3,"formGroup"],[3,"position"],["label","Name","lgExpand",""],["formControlName","name",3,"onInputChanged","placeholder"],["label","Description","lgExpand",""],["formControlName","description",3,"placeholder"],["lgExpand","",3,"mobileMode"],["label","Amount of the outcome","lgExpand",""],["formControlName","outcome_amount","lgParseMath","",3,"placeholder"],["formControlName","outcome_unit",3,"items"],["label","Ingredients","lgExpand",""],["formArrayName","ingredients","lgExpand",""],[3,"formGroupName"],[3,"click","size"],[3,"mobileMode"],[3,"size"],["label","Amount"],["lgParseMath","","formControlName","amount",3,"onKeydown","placeholder"],["formControlName","unit",3,"items"],["ngProjectAs","rowActions",5,["rowActions"]],["label","Name"],["ngProjectAs","endLabelTpl",5,["endLabelTpl"]],[3,"click"],["ngProjectAs","labelTpl",5,["labelTpl"]],[3,"click","ngClass"],["ngProjectAs","afterLabelTpl",5,["afterLabelTpl"]],["formControlName","recipe_id",3,"resource","autoLoad"],["formControlName","product_id",3,"resource","autoLoad"],["formControlName","recipe_id",3,"onSelected","resource","autoLoad"],["formControlName","product_id",3,"onSelected","resource","autoLoad"]],template:function(e,n){if(e&1){let i=g();r(0,"form",2)(1,"lg-gap-column",3)(2,"lg-control",4)(3,"lg-input",5),u("onInputChanged",function(){m(i);let f=I(6);return d(f.focus())}),l()(),r(4,"lg-control",6),F(5,"lg-textarea",7,0),l(),r(7,"lg-controls-row",8)(8,"lg-control",9),F(9,"lg-number-input",10,1),l(),F(11,"lg-buttons-group",11),l(),r(12,"lg-control-group",12)(13,"lg-gap-column",3)(14,"lg-gap-column",13),W(15,Ke,11,8,"ng-container",14,Le),l(),r(17,"lg-button",15),u("click",function(){return m(i),d(n.addIngredient())}),_(18," Add Ingredient "),l()()(),w(19,Qe,2,0,"lg-button")(20,Ue,2,0,"lg-button"),l()()}e&2&&(c("formGroup",n.form),a(),c("position","start"),a(2),c("placeholder","Your recipe name"),a(2),c("placeholder","Describe your recipe, how to make it, what to pay attention to, etc."),a(2),c("mobileMode",!0),a(2),c("placeholder",n.form.value.outcome_unit||"Here you can write the amount of the outcome (e.g. 100, 12, etc.)"),a(2),c("items",n.buttons),a(2),c("position","start"),a(2),J(n.ingredients.controls),a(2),E("success"),c("size","small"),a(2),y(n.uuid()?19:20))},dependencies:[xe,de,pe,me,ue,ge,_e,fe,ve,he,$,we,O,z,ye,Fe,H,Se,ne,Ae,Ee],encapsulation:2})};function Ye(o,t){if(o&1&&(r(0,"lg-button",2),_(1," Calculate "),l()),o&2){let e=s();E("primary"),c("flat",!0)("link","/calc-recipe/"+e.uuid())("size","small")}}var Me=class o{constructor(t){this._aRoute=t}uuid=V("");ngOnInit(){this._aRoute.params.subscribe(t=>{this.uuid.set(t.uuid)})}static \u0275fac=function(e){return new(e||o)(R(ie))};static \u0275cmp=C({type:o,selectors:[["app-add-recipe"]],decls:9,vars:10,consts:[[3,"center","mobileMode"],[3,"flat","link","size","style"],[3,"flat","link","size"],[3,"uuid"]],template:function(e,n){e&1&&(r(0,"lg-container")(1,"lg-gap-row",0)(2,"lg-title"),_(3),l(),w(4,Ye,2,5,"lg-button",1),r(5,"lg-button",2),_(6," Back to list "),l()(),r(7,"lg-card"),F(8,"lg-add-recipe-form",3),l()()),e&2&&(a(),c("center",!0)("mobileMode",!0),a(2),P("",n.uuid()?"Edit":"Add"," Recipe"),a(),y(n.uuid()?4:-1),a(),E("warning"),c("flat",!0)("link","/recipes")("size","small"),a(3),c("uuid",n.uuid()))},dependencies:[re,le,ae,q,O,Ie],encapsulation:2})};export{Me as AddRecipeComponent};
