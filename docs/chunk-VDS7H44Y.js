import{a as Je}from"./chunk-4WXVQTO3.js";import{a as Xe}from"./chunk-H6QPV2YD.js";import{a as qe,b as Ye,c as ze}from"./chunk-7YXDRMC2.js";import{a as Le,b as Be,c as je,e as j,f as Ge}from"./chunk-X5RNHUB6.js";import{a as G}from"./chunk-BRBPHBEH.js";import{a as He,b as Qe,c as Ke}from"./chunk-IP4PHEBX.js";import{a as We}from"./chunk-OW4OSQWU.js";import"./chunk-6FEXET2L.js";import{a as Ne}from"./chunk-6BVDG3RH.js";import{a as Ue}from"./chunk-UZ4ZOUQK.js";import{a as B}from"./chunk-F6M2S2BE.js";import"./chunk-H46Y7ZP7.js";import{a as Te}from"./chunk-GMS3E2FY.js";import{a as Re,b as Ae,e as F,g as L,h as Ie,i as De,j as A,k as Ee,l as ke,n as Me,q as Fe,s as Ve,t as Oe}from"./chunk-TP72K2HT.js";import{a as Se}from"./chunk-C3YIVVSQ.js";import{a as we,b as Pe,c as W}from"./chunk-UYEJDPNH.js";import{c as oe,g as U}from"./chunk-VPC2COZP.js";import"./chunk-YSLWWUVN.js";import{a as xe}from"./chunk-LVIA722N.js";import{a as be}from"./chunk-2ZEJWSE3.js";import"./chunk-SNDQO5FA.js";import{o as ye,r as N}from"./chunk-B3CZXN5N.js";import{f as he,k as ve}from"./chunk-IZT3LVRQ.js";import{Ab as l,Bb as i,Cb as y,F as V,Gb as w,H as le,Jb as p,Kb as u,Lb as pe,Mb as ee,Sa as J,Ta as r,Tb as S,U as ae,Ub as T,Vb as I,Wb as d,Ya as v,Yb as D,Zb as ue,bb as P,bc as me,fa as g,ga as f,gb as se,hc as te,ic as ge,jc as fe,ma as m,ob as s,pb as Z,qb as O,qc as _e,r as re,rb as $,rc as Ce,ub as _,uc as k,vb as C,vc as b,wc as R,yb as ce,zb as de}from"./chunk-PNZYYIKS.js";import"./chunk-DELOOZDJ.js";import"./chunk-2WH2EVR6.js";var $e=["element"],et=["*",[["content"]]],tt=["*","content"];function ot(n,t){if(n&1&&(l(0,"div",4,0),ee(2,1),i(),y(3,"lg-portal",5)),n&2){let e=I(1),o=u();Z("left",o.coordinates().x,"px")("top",o.coordinates().y,"px"),r(3),s("appendTarget","body")("targetElement",e)("wrapClass","tooltip")}}var H=class n{constructor(){}gap=b(16);displayed=m(!1);full=b(!1);position=b("top");element=R("element");onClose=k();coordinates=m({x:0,y:0});toggle(t){if(this.displayed.set(!this.displayed()),this.displayed()||this.onClose.emit(),t){t.stopPropagation();let[e,o]=[t.clientX,t.clientY];setTimeout(()=>{let c=(this.element()?.nativeElement).getBoundingClientRect(),h=c.width,E=c.height,ne=window.innerWidth,ie=window.innerHeight,x=16,K=e,X=o;e+h+x>ne&&(K=ne-h-x),o+E+x>ie&&(X=ie-E-x),e-h-x<0&&(K=x),o-E-x<0&&(X=x),this.coordinates.set({x:K,y:X})})}}close(){this.displayed.set(!1),this.onClose.emit()}onClick(t){t.target instanceof HTMLElement&&(t.target.closest(".tooltip")||(this.displayed.set(!1),this.onClose.emit()))}onKeydown(t){t.key==="Escape"&&(this.displayed.set(!1),this.onClose.emit())}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=P({type:n,selectors:[["lg-tooltip"]],viewQuery:function(e,o){e&1&&S(o.element,$e,5),e&2&&T()},hostBindings:function(e,o){e&1&&p("click",function(c){return o.onClick(c)},J)("keydown",function(c){return o.onKeydown(c)},J)},inputs:{gap:[1,"gap"],full:[1,"full"],position:[1,"position"]},outputs:{onClose:"onClose"},ngContentSelectors:tt,decls:5,vars:6,consts:[["element",""],[1,"tooltip",3,"ngClass"],[1,"tooltip__anchor"],[3,"click"],[1,"tooltip__content"],[3,"appendTarget","targetElement","wrapClass"]],template:function(e,o){e&1&&(pe(et),l(0,"div",1)(1,"div",2)(2,"div",3),p("click",function(c){return o.toggle(c)}),ee(3),i(),_(4,ot,4,7),i()()),e&2&&(Z("--gap",o.gap(),"px"),O("fullscreen",o.full()),s("ngClass",o.position()),r(4),C(o.displayed()?4:-1))},dependencies:[he,Ne],styles:[".tooltip[_ngcontent-%COMP%]{position:relative;display:inline-block}.tooltip__anchor[_ngcontent-%COMP%]{position:relative}.tooltip__content[_ngcontent-%COMP%]{position:absolute;background-color:#fff;border-radius:16px;padding:16px;box-shadow:0 4px 8px #0000001a;z-index:100}.tooltip.top[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%], .tooltip.bottom[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%]{bottom:calc(100% + var(--gap));right:50%;transform:translate(50%)}.tooltip.left[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%]{bottom:50%;right:calc(100% + var(--gap));transform:translateY(50%)}.tooltip.right[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%]{bottom:50%;left:calc(100% + var(--gap));transform:translateY(-50%)}.tooltip.fullscreen[_ngcontent-%COMP%]   .tooltip__content[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#fff;border-radius:0;padding:32px;transform:none;overflow-y:auto}"]})};function nt(n,t){if(n&1){let e=w();l(0,"div",3)(1,"lg-eggs-widget",4),p("changed",function(a){g(e);let c=u();return f(c.onEggsChanged(a))}),i()()}}var Y=class n{constructor(){}eggsChanged=k();selectedWidget=m(null);onWidgetSelect(t){this.selectedWidget.set(t)}onEggsChanged(t){t&&this.eggsChanged.emit(t)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=P({type:n,selectors:[["lg-amount-widgets"]],outputs:{eggsChanged:"eggsChanged"},decls:5,vars:3,consts:[[1,"amount-widgets"],[1,"amount-widgets__buttons"],[1,"amount-widgets__button",3,"click"],[1,"amount-widgets__wrapper"],[3,"changed"]],template:function(e,o){e&1&&(l(0,"div",0)(1,"div",1)(2,"button",2),p("click",function(){return o.onWidgetSelect("eggs")}),d(3,"Eggs "),i()(),_(4,nt,2,0,"div",3),i()),e&2&&(O("selected",o.selectedWidget()!=null),r(4),C(o.selectedWidget()==="eggs"?4:-1))},dependencies:[Xe],styles:[".amount-widgets[_ngcontent-%COMP%]{display:flex;gap:16px;flex-direction:column}.amount-widgets__input[_ngcontent-%COMP%]{flex:1}.amount-widgets__buttons[_ngcontent-%COMP%]{display:flex;gap:16px;flex-wrap:wrap;padding:16px;background-color:#fafafa;border-radius:12px;margin:-16px}.amount-widgets.selected[_ngcontent-%COMP%]   .amount-widgets__buttons[_ngcontent-%COMP%]{margin-bottom:0}.amount-widgets__button[_ngcontent-%COMP%]{display:flex;padding:8px 16px;border-radius:16px;background-color:#e5de38;appearance:none;border:none;font-family:inherit;font-size:inherit}"]})};var lt=(n,t)=>(t==null?null:t.name)??(t==null?null:t.label)??t;function at(n,t){if(n&1&&d(0),n&2){let e=t.item;D(" ",(e==null?null:e.name)??(e==null?null:e.label)??e," ")}}function st(n,t){if(n&1&&d(0),n&2){let e=t.item;D(" ",(e==null?null:e.name)??(e==null?null:e.label)??e," ")}}function ct(n,t){if(n&1){let e=w();l(0,"div",5)(1,"span",6),d(2),i(),l(3,"span",7),p("click",function(){let a=g(e).$implicit,c=u().clear;return f(c(a))}),d(4,"\xD7"),i()()}if(n&2){let e=t.$implicit;r(2),D(" ",(e==null?null:e.name)??(e==null?null:e.label)??e," ")}}function dt(n,t){if(n&1&&ce(0,ct,5,1,"div",5,lt),n&2){let e=t.items;de(e)}}var z=class n{constructor(t){this._selectResourcesService=t}resource=b("");autoLoad=b(!1);multi=b(!1);loadedList=m([]);onSelected=k();value=null;selectComponent=R(j);onChange=()=>{};onTouched=()=>{};searchFn=(t,e)=>e?.toString().toLowerCase().includes(t.toLowerCase());compareWith=(t,e)=>t===e;writeValue(t){this.change(t)}change(t){this.value=t,this.onChange(this.value)}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}onChangeInput(t){this.change(t)}onChangeSelect(t){this.change(t),this.onSelected.emit(t)}ngOnInit(){this._selectResourcesService.register(this.resource()),this.autoLoad()&&this._selectResourcesService.load([this.resource()]),this._selectResourcesService.subscribe(t=>{let e=t.get(this.resource())?.list??[];this.loadedList.set(e)})}reload(){return this._selectResourcesService.load([this.resource()],!0)}static \u0275fac=function(e){return new(e||n)(v(G,8))};static \u0275cmp=P({type:n,selectors:[["lg-tags-control"]],viewQuery:function(e,o){e&1&&S(o.selectComponent,j,5),e&2&&T()},inputs:{resource:[1,"resource"],autoLoad:[1,"autoLoad"],multi:[1,"multi"]},outputs:{onSelected:"onSelected"},features:[me([{provide:Ae,useExisting:ae(()=>n),multi:!0}])],decls:5,vars:7,consts:[[1,"tags-control"],[3,"change","ngModelChange","addTag","bindValue","compareWith","items","multiple","ngModel","searchFn"],["ng-label-tmp",""],["ng-option-tmp",""],["ng-multi-label-tmp",""],[1,"ng-value"],[1,"ng-value-label"],["aria-hidden","true",1,"ng-value-icon","right",3,"click"]],template:function(e,o){e&1&&(l(0,"div",0)(1,"ng-select",1),p("change",function(c){return o.onChangeSelect(c)})("ngModelChange",function(c){return o.onChangeInput(c)}),se(2,at,1,1,"ng-template",2)(3,st,1,1,"ng-template",3)(4,dt,2,0,"ng-template",4),i()()),e&2&&(r(),s("addTag",!0)("bindValue","name")("compareWith",o.compareWith)("items",o.loadedList())("multiple",o.multi())("ngModel",o.value)("searchFn",o.searchFn))},dependencies:[j,Ve,L,Ee,Le,Be,je],styles:[`lg-tags-control{display:flex;flex:1;min-width:150px}.tags-control{flex:1}.tags-control .ng-select .ng-select-container{height:51px}.tags-control .ng-select .ng-select-container{border:none;border-radius:12px;background-color:var(--control-bg)}.tags-control .ng-select .ng-select-container .ng-input{top:16px!important}.tags-control .ng-select .ng-select-container .ng-input>input{color:var(--text);font-family:inherit;font-size:inherit}.tags-control .ng-dropdown-panel{border:none;box-shadow:0 4px 16px #0000001a;border-radius:12px;overflow:hidden}.tags-control .ng-dropdown-panel .ng-option{padding:16px;border-radius:12px}
`],encapsulation:2})};var gt=["nameField"];function ft(n,t){if(n&1&&y(0,"lg-chips-list",10),n&2){let e=u(),o=I(8);s("control",o)("items",e.topCategories())}}var M=class n{constructor(t,e,o,a){this._productsRepository=t;this._selectResourcesService=e;this._router=o;this._notificationsService=a}form=new De({name:new A(null,F.required),amount:new A(null,F.required),price:new A(null,F.required),unit:new A("gram"),source:new A(null),category_id:new A(null,F.required),tags:new A([])});buttons=[{label:"Grams",value:"gram",style:"secondary",onClick:()=>{console.log("Grams")}},{label:"Pieces",value:"piece",style:"secondary",onClick:()=>{console.log("Piece")}}];product=b(null);topCategories=m([]);topSources=m([]);nameField=R("nameField");productEffect=Ce(()=>{!this.product()||this.form.dirty||(this.form.reset(Je(this.product())),this.form.markAsPristine())});get _defFormValue(){return{name:null,amount:null,price:null,source:null,category_id:null,unit:"gram",tags:[]}}get _formValid(){return this.form.valid}eggsChanged(t){this.form.patchValue({amount:t})}ngOnInit(){this._loadUsingHistory(),this.form.valueChanges.pipe(V(100)).subscribe(t=>{this.form.dirty&&this.product()?.update(t)})}resetForm(t){this.form.reset(t?t?.toDTO():this._defFormValue),this.form.markAsPristine(),this._loadUsingHistory()}validateForm(){return this._formValid?!0:(this._notificationsService.error(this._notificationsService.parseFormErrors(this.form).join(", ")),!1)}ngAfterViewInit(){this._selectResourcesService.load().then(t=>{}),this.form.markAsPristine()}_loadUsingHistory(){this._productsRepository.getTopCategories().then(t=>{this.topCategories.set(t.map(e=>({label:e.name,value:e.uuid})))}),this._productsRepository.getTopSources().then(t=>{this.topSources.set(t.map(e=>({label:e,value:e})))})}static \u0275fac=function(e){return new(e||n)(v(U),v(G),v(N),v(B))};static \u0275cmp=P({type:n,selectors:[["lg-add-product-form"]],viewQuery:function(e,o){e&1&&S(o.nameField,gt,5),e&2&&T()},inputs:{product:[1,"product"]},decls:31,vars:18,consts:[["nameField",""],["categorySelect",""],["priceInput",""],["sourceInput",""],["sourceChips",""],[3,"formGroup"],["label","Name"],["formControlName","name",3,"key","resource"],["label","Category"],["formControlName","category_id",3,"resource"],[3,"control","items"],[3,"bottom","mobileMode"],["label","Amount","lgExpand",""],["formControlName","amount","lgParseMath","",3,"onInputChange","placeholder"],["ngProjectAs","after",5,["after"]],[3,"position"],["ngProjectAs","content",5,["content"]],[3,"eggsChanged"],["formControlName","unit",3,"items"],["label","Price"],["formControlName","price","lgParseMath","",3,"placeholder"],["label","Source"],["formControlName","source",3,"onSelected","noLoad","resource"],[3,"hidden"],["label","Tags"],["formControlName","tags",3,"multi","resource"]],template:function(e,o){if(e&1){let a=w();l(0,"form",5)(1,"lg-gap-column")(2,"lg-control",6),y(3,"lg-autocomplete",7,0),i(),l(5,"lg-gap-column")(6,"lg-control",8),y(7,"lg-multiselect",9,1),i(),_(9,ft,1,2,"lg-chips-list",10),i(),l(10,"lg-gap-row",11)(11,"lg-control",12)(12,"lg-number-input",13),p("onInputChange",function(){g(a);let h=I(21);return f(h.focus())}),l(13,"div",14)(14,"lg-tooltip",15),d(15," Widgets "),l(16,"div",16)(17,"lg-amount-widgets",17),p("eggsChanged",function(h){return g(a),f(o.eggsChanged(h))}),i()()()()()(),y(18,"lg-buttons-group",18),i(),l(19,"lg-control",19),y(20,"lg-number-input",20,2),i(),l(22,"lg-gap-column")(23,"lg-control",21)(24,"lg-autocomplete",22,3),p("onSelected",function(){g(a);let h=I(28);return f(h.clearSelected())}),i()(),l(26,"div",23),y(27,"lg-chips-list",10,4),i()(),l(29,"lg-control",24),y(30,"lg-tags-control",25),i()()()}if(e&2){let a=I(25);s("formGroup",o.form),r(3),s("key","name")("resource","products-names"),r(4),s("resource","categories"),r(2),C(o.topCategories().length?9:-1),r(),s("bottom",!0)("mobileMode",!0),r(2),s("placeholder","In "+o.form.value.unit),r(2),s("position","left"),r(4),s("items",o.buttons),r(2),s("placeholder","For the entire product in your currency"),r(4),s("noLoad",!0)("resource","sources"),r(2),s("hidden",!o.topSources().length),r(),s("control",a)("items",o.topSources()),r(3),s("multi",!0)("resource","tags")}},dependencies:[Oe,ke,L,Ie,Me,Fe,We,Se,Ge,He,H,Y,Qe,W,qe,Ue,Ye,ze,z],styles:[`lg-eggs-widget{min-width:300px}
`],encapsulation:2})};function _t(n,t){if(n&1&&(l(0,"lg-title"),d(1," Edit "),l(2,"span",5),d(3),i()()),n&2){let e,o=u();r(3),D(" ",(e=o.product())==null?null:e.name," ")}}function Ct(n,t){n&1&&(l(0,"lg-title"),d(1,"Add Product"),i())}function ht(n,t){n&1&&d(0," (saved as draft) ")}function vt(n,t){if(n&1&&(d(0),te(1,"timeAgo")),n&2){let e,o=u();D(" (last edited ",ge(1,1,(e=o.product())==null?null:e.updatedAt),") ")}}function yt(n,t){if(n&1&&(d(0),te(1,"number")),n&2){let e,o=u();ue(" (",(e=o.product())==null?null:e.perUnitLabel," ",fe(1,2,(e=o.product())==null?null:e.pricePerUnit,"1.2-5"),") ")}}function wt(n,t){if(n&1){let e=w();l(0,"lg-button",6),p("click",function(){g(e);let a=u();return f(a.onEditProduct())}),d(1," Edit Product "),i()}}function Pt(n,t){if(n&1){let e=w();l(0,"lg-button",6),p("click",function(){g(e);let a=u();return f(a.onAddProduct())}),d(1," Add Product "),i()}}function bt(n,t){if(n&1){let e=w();l(0,"lg-button",6),p("click",function(){g(e);let a=u();return f(a.onRemoveDraft())}),d(1," Delete this draft "),i()}n&2&&$("danger")}function xt(n,t){if(n&1){let e=w();l(0,"lg-button",6),p("click",function(){g(e);let a=u();return f(a.onDeleteProduct())}),d(1," Delete Product "),i()}n&2&&$("danger")}var Ze=class n{constructor(t,e,o,a){this._router=t;this._aRoute=e;this._productsRepository=o;this._notificationsService=a}draftOrProductUUID=m(void 0);product=m(null);formComponent=R(M);draftRef=m(null);draftByExistingProduct=_e(()=>this.draftRef().meta?.uuid);isDraftRoute=m(!1);ngOnInit(){re([this._aRoute.params,this._aRoute.data]).pipe(le(1)).subscribe(([t,e])=>{this.draftOrProductUUID.set(t.uuid),e.draft?(this.draftRef.set(e.draft),this.product.set(oe.fromRaw(e.draft.data))):this.draftOrProductUUID()?this._loadProduct(this.draftOrProductUUID()):this.product.set(oe.empty()),this.isDraftRoute.set(!!e.draftRoute)})}ngAfterViewInit(){this.formComponent()?.form.valueChanges.pipe(V(500)).subscribe(t=>{!this.formComponent().form.dirty||!this.product()||(this.draftRef()?.uuid?this._productsRepository.updateDraftProduct(this.draftRef().uuid,this.product(),this.draftRef().meta?.uuid):this.draftRef.set(this._productsRepository.saveDraftProduct(this.product(),this.draftOrProductUUID()??"")))})}onAddProduct(){!this.formComponent()?.validateForm()||!this.product()||this._addProduct(this.product())}onEditProduct(){!this.formComponent()?.validateForm()||!this.product()||this._editProduct(this.product())}onRemoveDraft(){this._removeDraft(),this._router.navigate(["products"])}onDeleteProduct(){this.product()?.uuid&&this._productsRepository.deleteProduct(this.product().uuid).then(()=>{this._notificationsService.success("Product deleted"),this._router.navigate(["products"])})}_addProduct(t){this._productsRepository.addOne(t).then(()=>{this.formComponent()?.resetForm(),this._notificationsService.success("Product added"),this.product.set(null),this.draftRef()&&this._removeDraft(),this.isDraftRoute()&&this._router.navigate(["products"])})}_editProduct(t){if(!this.draftOrProductUUID())return;let e=this.draftRef()?.meta?.uuid??this.draftOrProductUUID();this._productsRepository.updateOne(e,t).then(()=>{this.formComponent()?.resetForm(t),this._notificationsService.success("Product edited"),this.draftRef()&&this._removeDraft(),this.isDraftRoute()&&this._router.navigate(["products","edit",e])})}_removeDraft(){this.draftRef()&&(this._productsRepository.removeDraftProduct(this.draftRef().uuid),this.draftRef.set(null))}_loadProduct(t){t&&this._productsRepository.getOne(t).then(e=>{e&&this.product.set(e)})}static \u0275fac=function(e){return new(e||n)(v(N),v(ye),v(U),v(B))};static \u0275cmp=P({type:n,selectors:[["app-add-recipe"]],viewQuery:function(e,o){e&1&&S(o.formComponent,M,5),e&2&&T()},decls:16,vars:10,consts:[[3,"center"],[3,"product"],[3,"mobileMode","relaxed"],["lgShrink",""],["lgShrink","",3,"style"],[1,"text-active"],["lgShrink","",3,"click"]],template:function(e,o){if(e&1&&(l(0,"lg-fade-in")(1,"lg-container")(2,"lg-gap-row",0),_(3,_t,4,1,"lg-title")(4,Ct,2,0,"lg-title"),_(5,ht,1,0),i(),l(6,"div"),_(7,vt,2,3),_(8,yt,2,5),i(),l(9,"lg-card"),y(10,"lg-add-product-form",1),i(),l(11,"lg-gap-row",2),_(12,wt,2,0,"lg-button",3)(13,Pt,2,0,"lg-button",3),_(14,bt,2,2,"lg-button",4)(15,xt,2,2,"lg-button",4),i()()()),e&2){let a,c,h,E;r(2),s("center",!0),r(),C((a=o.product())!=null&&a.uuid&&!o.draftRef()||o.draftRef()&&o.draftByExistingProduct()?3:4),r(2),C(o.draftRef()?5:-1),r(2),C((c=o.product())!=null&&c.updatedAt?7:-1),r(),C((h=o.product())!=null&&h.pricePerUnit?8:-1),r(2),s("product",o.product()),r(),s("mobileMode",!0)("relaxed",!0),r(),C(o.product()&&!o.draftRef()||o.draftRef()&&o.draftByExistingProduct()?12:13),r(2),C(o.isDraftRoute()?14:(E=o.product())!=null&&E.uuid?15:-1)}},dependencies:[we,Pe,be,M,W,xe,Re,Ke,Te,ve],encapsulation:2})};export{Ze as AddProductComponent};
