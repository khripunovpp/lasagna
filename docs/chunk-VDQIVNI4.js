import"./chunk-I4TJ6JFG.js";import"./chunk-PPQZDSX7.js";import"./chunk-EO5SYJ34.js";import"./chunk-SCYWH7FS.js";import{a as de}from"./chunk-PM7YWHQO.js";import"./chunk-3VQI7J3E.js";import{a as pe}from"./chunk-USIJWNW5.js";import"./chunk-NECHCYOO.js";import"./chunk-P7L2C53Q.js";import"./chunk-YM6NCI7Q.js";import"./chunk-5AOZZ2NF.js";import{a as z,b as re,c as ne}from"./chunk-ZGERB7Y6.js";import{a as oe}from"./chunk-3QIAGCJF.js";import{a as U}from"./chunk-PHGQT4GW.js";import"./chunk-DKKRBT3L.js";import{a as ce,b as le,c as ue}from"./chunk-67BCPUJW.js";import{a as me}from"./chunk-OW4OSQWU.js";import{a as se}from"./chunk-W6VMIXDL.js";import"./chunk-CR46UX4Z.js";import{a as ae}from"./chunk-TOH5IIUM.js";import"./chunk-H46Y7ZP7.js";import{a as L,g as J,h as q,i as S,j as l,n as K,o as Q,p as Y,q as Z,r as ee,s as te,t as ie}from"./chunk-E5I57XC6.js";import{a as B,c as H}from"./chunk-UYEJDPNH.js";import"./chunk-5ZHT4QO7.js";import"./chunk-Z2KUFMIF.js";import{z as X}from"./chunk-K7R7MOA3.js";import"./chunk-IZT3LVRQ.js";import{Ab as s,Bb as m,Cb as _,Db as V,Eb as M,Gb as W,Jb as u,Kb as p,Ta as r,V as b,Wb as T,Ya as y,Z as D,bb as F,db as k,fa as f,ga as g,gb as A,ma as w,ob as n,pb as N,qb as O,qc as P,rb as h,rc as $,ub as R,vb as E,vc as j,yb as I,zb as G}from"./chunk-PNZYYIKS.js";import"./chunk-DELOOZDJ.js";import{f as x}from"./chunk-2WH2EVR6.js";var c=class t{constructor(e){this.name=String(e.name).trim(),this.amount=parseFloat(String(e.amount)),this.percentage=e.percentage,this.description=String(e.description||"").trim(),this.items=e.items,this.uuid=e.uuid}name;amount;percentage;description;items;uuid;static fromRaw(e){debugger;return new t({name:e?.name||"",amount:e?.amount||0,percentage:e?.percentage||!1,description:e?.description||"",items:e?.items||[],uuid:e?.uuid||""})}static empty(){return new t({name:"",amount:0,percentage:!0,description:"",items:[],uuid:""})}update(e){return this.name=e.name||this.name,this.amount=e.amount||this.amount,this.percentage=e.percentage||this.percentage,this.description=e.description||this.description,this.items=e.items||this.items,this.uuid=e.uuid||this.uuid,this}toDTO(){return{name:this.name||"",amount:this.amount||0,percentage:this.percentage||!1,description:this.description||"",items:this.items||[],uuid:this.uuid||""}}};var xe=t=>t instanceof Error?t.message:typeof t=="string"?t:typeof t=="object"&&t!==null?JSON.stringify(t):"Unknown error";var C=class t{constructor(){}lgWidth=j(0);get maxWidth(){return this.lgWidth()}get flex(){return`1 0 ${this.lgWidth()}px`}static \u0275fac=function(i){return new(i||t)};static \u0275dir=k({type:t,selectors:[["","lgWidth",""]],hostVars:4,hostBindings:function(i,o){i&2&&N("max-width",o.maxWidth,"px")("flex",o.flex)},inputs:{lgWidth:[1,"lgWidth"]}})};var ge=t=>({name:t.name,description:t.description,amount:t.value,percentage:t.percentage,uuid:t.uuid});var v=class t{constructor(e){this._indexDbService=e}addOne(e){return this._indexDbService.addData("taxes",e.toDTO())}updateOne(e,i){return this._indexDbService.replaceData("taxes",e,i.toDTO())}getOne(e){return x(this,null,function*(){return new Promise((i,o)=>x(this,null,function*(){if(e=typeof e=="string"?e:e.uuid,!e){i(void 0);return}yield this._indexDbService.getOne("taxes",e).then(a=>{i(c.fromRaw(a))})}))})}getAll(){return this._indexDbService.getAll("taxes").then(e=>e.map(i=>c.fromRaw(i)))}addMany(e){return this._indexDbService.balkAdd("taxes",e.map(i=>i.toDTO()),!1)}deleteOne(e){return this._indexDbService.remove("taxes",e)}static \u0275fac=function(i){return new(i||t)(D(X))};static \u0275prov=b({token:t,factory:t.\u0275fac,providedIn:"root"})};var Ce=(t,e)=>e.value.name+e.value.value;function ve(t,e){if(t&1){let i=W();s(0,"section",5)(1,"div",6)(2,"lg-gap-row",7)(3,"lg-control",8),_(4,"lg-input",9),m(),s(5,"lg-control",8),_(6,"lg-textarea",10),m(),s(7,"lg-control",8)(8,"lg-checkbox",11),u("onCheckboxChanged",function(){f(i);let a=p().$index,d=p();return g(d.onTaxValueChange(a))}),m()(),s(9,"lg-control",12)(10,"lg-number-input",13),u("onInputChange",function(){f(i);let a=p().$index,d=p();return g(d.onTaxValueChange(a))}),m()(),s(11,"lg-button",14),u("click",function(){f(i);let a=p().$index,d=p();return g(d.deleteTxRow(a))}),_(12,"mat-icon",15),m()()()()}if(t&2){let i=p().$index;n("formGroupName",i),r(),O("taxes__row--odd",i%2!==0),r(),n("bottom",!0)("fit",!0),r(),n("label","Name"),r(),n("placeholder","Name"),r(),n("label","Description"),r(),n("rows",3)("placeholder","Description"),r(),n("label","Use percentage"),r(),n("customMark","%"),r(),n("label","Value")("lgWidth",200),r(),n("placeholder","Value"),r(),h("danger"),n("size","tiny")("icon",!0)}}function we(t,e){t&1&&A(0,ve,13,19,"ng-template",2)}function ye(t,e){t&1&&T(0," Save changes ")}function Se(t,e){t&1&&T(0," No changes ")}var he=class t{constructor(e,i){this._taxesRepository=e;this._notificationService=i}taxes=w([]);rows=P(()=>this.taxes().map(e=>c.fromRaw(e)));taxesForm=new S({rows:new ee([this._getRowGroup()])});rowsEffect=$(()=>{this._rowsFormArray.clear(),this.rows().forEach((e,i)=>{this._rowsFormArray.push(this._getRowGroup(e))}),this.taxesForm.updateValueAndValidity(),this.taxesForm.markAsPristine()});totalTaxes=w(0);formValues=this.taxesForm.valueChanges.pipe(oe());get _rowsFormArray(){return this.taxesForm.get("rows")}ngOnInit(){this._taxesRepository.getAll().then(e=>{this.taxes.set(e)})}onTaxValueChange(e){}deleteTxRow(e){let i=this.taxesForm.value.rows?.[e]?.uuid;this._rowsFormArray.removeAt(e),this.taxesForm.markAsDirty(),i&&this._taxesRepository.deleteOne(i)}addTaxRow(){this._rowsFormArray.push(this._getRowGroup()),this.taxesForm.markAsDirty()}saveTaxes(){return x(this,null,function*(){try{let e=this.taxesForm.value.rows?.map(i=>c.fromRaw(ge(i)))??[];yield this._taxesRepository.addMany(e),this._notificationService.success("Taxes saved successfully"),this.taxesForm.markAsPristine()}catch(e){this._notificationService.error(xe(e))}})}_getRowGroup(e){return new S({name:new l(e?.name||""),description:new l(e?.description||""),value:new l(e?.amount||0),amount:new l(0),percentage:new l(e?.percentage||!1),uuid:new l(e?.uuid||"")})}static \u0275fac=function(i){return new(i||t)(y(v),y(ae))};static \u0275cmp=F({type:t,selectors:[["lg-backup-settings"]],decls:11,vars:7,consts:[[3,"formGroup"],["formArrayName","rows"],["lgCardListItem",""],["lgSelfCenter","","lgShrink","",3,"click","disabled"],["lgSelfCenter","","lgShrink","",3,"click"],[1,"taxes",3,"formGroupName"],[1,"taxes__row"],[3,"bottom","fit"],[3,"label"],["formControlName","name",3,"placeholder"],["formControlName","description",3,"rows","placeholder"],["formControlName","percentage",3,"onCheckboxChanged","customMark"],[3,"label","lgWidth"],["lgParseMath","","formControlName","value",3,"onInputChange","placeholder"],["lgSelfCenter","","lgShrink","",3,"click","size","icon"],["aria-hidden","false","aria-label","Example home icon","fontIcon","close"]],template:function(i,o){i&1&&(s(0,"lg-container")(1,"lg-card-list",0),V(2,1),I(3,we,1,0,null,2,Ce),M(),m(),s(5,"lg-gap-row")(6,"lg-button",3),u("click",function(){return o.saveTaxes()}),R(7,ye,1,0)(8,Se,1,0),m(),s(9,"lg-button",4),u("click",function(){return o.addTaxRow()}),T(10," Add tax "),m()()()),i&2&&(r(),n("formGroup",o.taxesForm),r(2),G(o.taxesForm.controls.rows.controls),r(3),h("success"),n("disabled",!o.taxesForm.dirty),r(),E(o.taxesForm.dirty?7:8),r(2),h("warning"))},dependencies:[H,re,te,J,q,L,B,ne,z,me,se,U,ce,le,ie,K,Z,Q,Y,de,ue,pe,C],encapsulation:2})};export{he as TaxesSettingsComponent};
