import{a as ce,b as pe}from"./chunk-MMARXXBE.js";import{a as oe}from"./chunk-LYK3TVFL.js";import{a as Z,b as ee,c as te}from"./chunk-P5B2PAQA.js";import{a as ie}from"./chunk-E4DOWUUR.js";import{a as ae,b as se,c as me}from"./chunk-AT4M6DLN.js";import{a as re}from"./chunk-AX7OPYRI.js";import{a as ne}from"./chunk-27EDASFX.js";import{a as Y}from"./chunk-XQWFJXAQ.js";import{a as Q}from"./chunk-GD35DILB.js";import{a as q,b as K}from"./chunk-C3TWNGHF.js";import"./chunk-E7PMWA7O.js";import"./chunk-TZ6AACHZ.js";import"./chunk-5KSZNU56.js";import"./chunk-WLVDGM7I.js";import"./chunk-UTON52JF.js";import{f as j,g as P,h as y,i as l,m as X,n as L,o as U,p as W,q as z,r as H,s as B,u as J}from"./chunk-BVNLWVVY.js";import"./chunk-GEHL2P5P.js";import{A as $}from"./chunk-HDKQOM4M.js";import"./chunk-652DFWNF.js";import"./chunk-RUQPARWX.js";import{Ab as O,Bb as R,Cb as s,Db as m,Eb as _,Fb as E,Gb as I,Ib as G,Lb as u,Mb as c,Va as n,W as S,Yb as T,_ as b,_a as w,db as D,ga as x,ha as f,ib as F,na as v,qb as r,sb as k,sc as M,tb as h,tc as V,wb as A,xb as N}from"./chunk-FSGSBBFI.js";import"./chunk-DELOOZDJ.js";import{f as g}from"./chunk-2WH2EVR6.js";var p=class t{constructor(e){this.name=String(e.name).trim(),this.amount=parseFloat(String(e.amount)),this.percentage=e.percentage,this.description=String(e.description||"").trim(),this.items=e.items,this.uuid=e.uuid}name;amount;percentage;description;items;uuid;static fromRaw(e){debugger;return new t({name:e?.name||"",amount:e?.amount||0,percentage:e?.percentage||!1,description:e?.description||"",items:e?.items||[],uuid:e?.uuid||""})}static empty(){return new t({name:"",amount:0,percentage:!0,description:"",items:[],uuid:""})}update(e){return this.name=e.name||this.name,this.amount=e.amount||this.amount,this.percentage=e.percentage||this.percentage,this.description=e.description||this.description,this.items=e.items||this.items,this.uuid=e.uuid||this.uuid,this}toDTO(){return{name:this.name||"",amount:this.amount||0,percentage:this.percentage||!1,description:this.description||"",items:this.items||[],uuid:this.uuid||""}}};var le=t=>t instanceof Error?t.message:typeof t=="string"?t:typeof t=="object"&&t!==null?JSON.stringify(t):"Unknown error";var ue=t=>({name:t.name,description:t.description,amount:t.value,percentage:t.percentage,uuid:t.uuid});var C=class t{constructor(e){this._indexDbService=e}addOne(e){return this._indexDbService.addData("taxes",e.toDTO())}updateOne(e,i){return this._indexDbService.replaceData("taxes",e,i.toDTO())}getOne(e){return g(this,null,function*(){return new Promise((i,o)=>g(this,null,function*(){if(e=typeof e=="string"?e:e.uuid,!e){i(void 0);return}yield this._indexDbService.getOne("taxes",e).then(a=>{i(p.fromRaw(a))})}))})}getAll(){return this._indexDbService.getAll("taxes").then(e=>e.map(i=>p.fromRaw(i)))}addMany(e){return this._indexDbService.balkAdd("taxes",e.map(i=>i.toDTO()),!1)}deleteOne(e){return this._indexDbService.remove("taxes",e)}static \u0275fac=function(i){return new(i||t)(b($))};static \u0275prov=S({token:t,factory:t.\u0275fac,providedIn:"root"})};var fe=(t,e)=>e.value.name+e.value.value;function he(t,e){if(t&1){let i=G();s(0,"section",5)(1,"div",6)(2,"lg-gap-row",7)(3,"lg-control",8),_(4,"lg-input",9),m(),s(5,"lg-control",8),_(6,"lg-textarea",10),m(),s(7,"lg-control",8)(8,"lg-checkbox",11),u("onCheckboxChanged",function(){x(i);let a=c().$index,d=c();return f(d.onTaxValueChange(a))}),m()(),s(9,"lg-control",12)(10,"lg-number-input",13),u("onInputChange",function(){x(i);let a=c().$index,d=c();return f(d.onTaxValueChange(a))}),m()(),s(11,"lg-button",14),u("click",function(){x(i);let a=c().$index,d=c();return f(d.deleteTxRow(a))}),_(12,"mat-icon",15),m()()()()}if(t&2){let i=c().$index;r("formGroupName",i),n(),k("taxes__row--odd",i%2!==0),n(),r("bottom",!0)("fit",!0),n(),r("label","Name"),n(),r("placeholder","Name"),n(),r("label","Description"),n(),r("rows",3)("placeholder","Description"),n(),r("label","Use percentage"),n(),r("customMark","%"),n(),r("label","Value")("lgWidth","200px"),n(),r("placeholder","Value"),n(),h("danger"),r("size","tiny")("icon",!0)}}function _e(t,e){t&1&&F(0,he,13,19,"ng-template",2)}function Te(t,e){t&1&&T(0," Save changes ")}function Ce(t,e){t&1&&T(0," No changes ")}var de=class t{constructor(e,i){this._taxesRepository=e;this._notificationService=i}taxes=v([]);rows=M(()=>this.taxes().map(e=>p.fromRaw(e)));taxesForm=new y({rows:new z([this._getRowGroup()])});rowsEffect=V(()=>{this._rowsFormArray.clear(),this.rows().forEach((e,i)=>{this._rowsFormArray.push(this._getRowGroup(e))}),this.taxesForm.updateValueAndValidity(),this.taxesForm.markAsPristine()});totalTaxes=v(0);formValues=this.taxesForm.valueChanges.pipe(ie());get _rowsFormArray(){return this.taxesForm.get("rows")}ngOnInit(){this._taxesRepository.getAll().then(e=>{this.taxes.set(e)})}onTaxValueChange(e){}deleteTxRow(e){let i=this.taxesForm.value.rows?.[e]?.uuid;this._rowsFormArray.removeAt(e),this.taxesForm.markAsDirty(),i&&this._taxesRepository.deleteOne(i)}addTaxRow(){this._rowsFormArray.push(this._getRowGroup()),this.taxesForm.markAsDirty()}saveTaxes(){return g(this,null,function*(){try{let e=this.taxesForm.value.rows?.map(i=>p.fromRaw(ue(i)))??[];yield this._taxesRepository.addMany(e),this._notificationService.success("Taxes saved successfully"),this.taxesForm.markAsPristine()}catch(e){this._notificationService.error(le(e))}})}_getRowGroup(e){return new y({name:new l(e?.name||""),description:new l(e?.description||""),value:new l(e?.amount||0),amount:new l(0),percentage:new l(e?.percentage||!1),uuid:new l(e?.uuid||"")})}static \u0275fac=function(i){return new(i||t)(w(C),w(J))};static \u0275cmp=D({type:t,selectors:[["lg-backup-settings"]],decls:11,vars:7,consts:[[3,"formGroup"],["formArrayName","rows"],["lgCardListItem",""],["lgSelfCenter","","lgShrink","",3,"click","disabled"],["lgSelfCenter","","lgShrink","",3,"click"],[1,"taxes",3,"formGroupName"],[1,"taxes__row"],[3,"bottom","fit"],[3,"label"],["formControlName","name",3,"placeholder"],["formControlName","description",3,"rows","placeholder"],["formControlName","percentage",3,"onCheckboxChanged","customMark"],[3,"label","lgWidth"],["lgParseMath","","formControlName","value",3,"onInputChange","placeholder"],["lgSelfCenter","","lgShrink","",3,"click","size","icon"],["aria-hidden","false","aria-label","Example home icon","fontIcon","close"]],template:function(i,o){i&1&&(s(0,"lg-container")(1,"lg-card-list",0),E(2,1),O(3,_e,1,0,null,2,fe),I(),m(),s(5,"lg-gap-row")(6,"lg-button",3),u("click",function(){return o.saveTaxes()}),A(7,Te,1,0)(8,Ce,1,0),m(),s(9,"lg-button",4),u("click",function(){return o.addTaxRow()}),T(10," Add tax "),m()()()),i&2&&(n(),r("formGroup",o.taxesForm),n(2),R(o.taxesForm.controls.rows.controls),n(3),h("success"),r("disabled",!o.taxesForm.dirty),n(),N(o.taxesForm.dirty?7:8),n(2),h("warning"))},dependencies:[K,ee,H,j,P,Q,q,te,Z,re,ne,Y,ae,se,B,X,W,L,U,ce,me,oe,pe],encapsulation:2})};export{de as TaxesSettingsComponent};
