import{a as ne,b as re,c as ce,d as ae,e as le,f as pe,g as me}from"./chunk-3CXEBPFR.js";import{a as te,c as ie}from"./chunk-OPWIYIGK.js";import{a as ee}from"./chunk-65PCG7KQ.js";import{b as oe}from"./chunk-UKAU3626.js";import{a as se}from"./chunk-ZBULITSO.js";import"./chunk-7JNSNANE.js";import{a as k,b as H,c as L}from"./chunk-GPHXVYDI.js";import{a as J}from"./chunk-KWYRKVA4.js";import"./chunk-RFEBMF6P.js";import"./chunk-Q24HNGKZ.js";import"./chunk-FG5PJ7WR.js";import{a as q,d as Y}from"./chunk-6CXN2K45.js";import"./chunk-E64ZE4KI.js";import{a as X}from"./chunk-5PVAHMKX.js";import{a as K,c as Q}from"./chunk-PXM5XOY4.js";import{f as G,t as U,w as W}from"./chunk-JUGNCNLY.js";import{$b as T,Ab as g,Bb as x,Cb as z,Eb as b,Fb as h,Gb as r,Hb as c,Ib as j,Mb as I,Pb as v,Qb as s,W as M,Za as o,ac as a,bc as w,ca as N,cb as C,cc as d,dc as F,ea as u,f as O,hb as $,la as _,ma as f,mb as D,nc as Z,pc as B,r as V,ub as p,x as E,xb as S,z as A}from"./chunk-46OIECST.js";var de=new N("CategorizedProductsList",{factory:()=>{let t=u(L),i=u(J);return V(t.loadRecipes()).pipe(M(()=>t.products$)).pipe(E(n=>n.toSorted((l,m)=>l.name.localeCompare(m.name))),E(n=>ae(n,"category_id")),A(n=>O(void 0,null,function*(){let l=[];for(let y in n){let R=n[y],_e=yield i.getOne(y);l.push({category:_e?.name,products:R})}if(!l.length)return[];let[m,...P]=l.toSorted((y,R)=>y.category>R.category?1:-1);return m?.category?[m].concat(P):P.concat([m])})))}});var fe=(t,i)=>i==null?null:i.category;function Ce(t,i){if(t&1&&(r(0,"span"),a(1),c()),t&2){let e=s(2).$implicit;o(),d("from ",e.source)}}function ge(t,i){if(t&1&&(r(0,"span"),a(1),c(),r(2,"span"),a(3),c(),g(4,Ce,2,1,"span")),t&2){let e=s().$implicit;o(),w(e.name),o(2),F("",e.amount,"gr for ",e.price),o(),x(e.source?4:-1)}}function xe(t,i){if(t&1&&(r(0,"span"),a(1),c()),t&2){let e=s(2).$implicit;o(),d("from ",e==null?null:e.source)}}function ve(t,i){if(t&1&&(r(0,"span"),a(1),c(),r(2,"span"),a(3),c(),g(4,xe,2,1,"span")),t&2){let e=s().$implicit;o(),w(e==null?null:e.name),o(2),F("",e==null?null:e.amount," gr for ",e==null?null:e.price),o(),x(e!=null&&e.source?4:-1)}}function Pe(t,i){if(t&1&&g(0,ge,5,4)(1,ve,5,4),t&2){let e=i.flow;x(e==="new"?0:1)}}function ye(t,i){t&1&&a(0," per gram ")}function Se(t,i){if(t&1&&a(0),t&2){let e=s(2).$implicit;d(" per ",e.unit," ")}}function Ie(t,i){if(t&1){let e=I();r(0,"lg-gap-row",5)(1,"div",9)(2,"lg-gap-row",5)(3,"div",10)(4,"a",11),a(5),c()(),r(6,"div",12),a(7),c(),r(8,"div",13),a(9),Z(10,"number"),g(11,ye,1,0)(12,Se,1,1),c()()(),r(13,"lg-button",14),v("click",function(){_(e);let l=s().$implicit,m=s(2);return f(m.deleteProduct(l))}),j(14,"mat-icon",15),c()()}if(t&2){let e=s().$implicit,n=s(2);p("center",!0),o(2),p("center",!0),o(2),p("routerLink","/products/edit/"+e.uuid),o(),w(e.name),o(2),d(" ",e.source??""),o(2),d(" ",B(10,11,n.getPricePerGram(e),"1.2-5")," "),o(2),x(!e.unit||e.unit==="gram"?11:12),o(2),S("danger"),p("size","small")("icon",!0)}}function Te(t,i){if(t&1&&D(0,Ie,15,14,"ng-template",8),t&2){let e=i.$implicit;p("uuid",e.uuid)}}function we(t,i){if(t&1){let e=I();r(0,"lg-title",6),a(1),c(),r(2,"lg-card-list",7),v("onSelected",function(l){_(e),s();let m=T(12);return f(m.putSelected(l))}),b(3,Te,1,1,null,8,z),c()}if(t&2){let e=i.$implicit;s();let n=T(12);p("level",3),o(),d(" ",(e==null?null:e.category)||"Uncategorized"," "),o(),p("mode",n.selectionMode())("selectAll",n.selectAll())("deselectAll",n.deselectAll()),o(),h(e.products)}}function Le(t,i){t&1&&(r(0,"lg-gap-row",5)(1,"lg-title",6),a(2," No products found "),c()()),t&2&&(p("center",!0),o(),p("level",5))}var ue=class t{constructor(i,e,n,l){this._productsRepository=i;this._csvReaderService=e;this._transferDataService=n;this._notificationsService=l}products=oe(u(de));ProductDbInputScheme=H;Stores=q;getPricePerGram(i){return(k(i.price)||1)/(k(i.amount)||1)}exportProducts(i){this._transferDataService.exportTable("productsStore","json",{selected:Array.from(i)})}deleteProduct(i){i.uuid&&this._productsRepository.deleteProduct(i.uuid).then(()=>{this._notificationsService.success("Product deleted"),this.loadProducts()})}ngOnInit(){this.loadProducts()}loadProducts(){this._productsRepository.loadRecipes()}static \u0275fac=function(e){return new(e||t)(C(L),C(re),C(me),C(se))};static \u0275cmp=$({type:t,selectors:[["lg-product-list"]],decls:16,vars:12,consts:[["selectionZone",""],[3,"flat","link","size"],[3,"click","flat","size"],[3,"onDone","schema","storeName"],["lgImportRowTpl",""],[3,"center"],[3,"level"],[3,"onSelected","mode","selectAll","deselectAll"],["lgCardListItem","",3,"uuid"],[1,"expand"],[2,"flex","20%"],[3,"routerLink"],[2,"flex","10%"],[2,"flex","70%"],[3,"click","size","icon"],["aria-hidden","false","aria-label","Example home icon","fontIcon","close"]],template:function(e,n){if(e&1){let l=I();r(0,"lg-controls-bar")(1,"lg-button",1),a(2," Add "),c(),r(3,"lg-button",2),v("click",function(){_(l);let P=T(12);return f(n.exportProducts(P.selected()))}),a(4," Export "),c(),r(5,"lg-import",3),v("onDone",function(){return _(l),f(n.loadProducts())}),D(6,Pe,2,1,"ng-template",4),c()(),r(7,"lg-fade-in")(8,"lg-container")(9,"lg-title"),a(10," Products "),c(),r(11,"lg-selection-zone",null,0),b(13,we,5,5,null,null,fe,!1,Le,3,2,"lg-gap-row",5),c()()()}e&2&&(o(),S("primary"),p("flat",!0)("link","/products/add")("size","small"),o(2),S("info"),p("flat",!0)("size","small"),o(2),p("schema",n.ProductDbInputScheme)("storeName",n.Stores.PRODUCTS),o(8),h(n.products()))},dependencies:[X,Y,ee,K,Q,G,ie,te,ce,U,ne,le,W,pe],styles:["[_nghost-%COMP%]{display:block}"]})};export{ue as ProductListComponent};
