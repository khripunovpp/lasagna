import{a as de,b as ue,c as fe,d as ge,e as Re,f as n,g as ye,h as Ce}from"./chunk-DR2FMDZ7.js";import"./chunk-SBEFIX5R.js";import{a as _e}from"./chunk-PRC2TUST.js";import{a as le}from"./chunk-HE3R4OYU.js";import{a as ae,c as se}from"./chunk-MY6KHXHO.js";import{b as me}from"./chunk-XWIK56RR.js";import"./chunk-HHXJ7M2I.js";import{a as oe}from"./chunk-K2T7WYSM.js";import{a as Se}from"./chunk-W7F36SB2.js";import{a as ce}from"./chunk-R3RPCOKV.js";import{a as pe}from"./chunk-U5EBB5PJ.js";import"./chunk-HMU5FZIU.js";import"./chunk-O7M42S4C.js";import{a as te,b as re}from"./chunk-WR2UF3SH.js";import{a as ne}from"./chunk-ALZEZ7BP.js";import{a as ie}from"./chunk-BC325NGK.js";import"./chunk-SNDQO5FA.js";import{d as K,k as X,o as E,p as ee,r as w}from"./chunk-HY6TZTL2.js";import"./chunk-M3F6BOZF.js";import"./chunk-5KSZNU56.js";import"./chunk-L3DC7GP3.js";import{b as W}from"./chunk-WZGWS77O.js";import{u as Y}from"./chunk-ODQSNCKZ.js";import"./chunk-2SYRDFEF.js";import{s as H,w as J}from"./chunk-UQJ3VPU4.js";import"./chunk-652DFWNF.js";import"./chunk-QHW4G2KK.js";import{$ as y,$b as B,Ab as h,Bb as L,Cb as c,Db as a,Eb as T,Ib as I,Lb as g,Mb as _,R as j,Va as r,Yb as m,Z as $,Zb as z,_a as v,_b as f,db as G,dc as U,ec as q,ga as C,ha as S,ib as x,jc as d,k as M,kc as u,na as N,q as b,qb as p,s as V,tb as R,wb as F,xb as O,yb as Q}from"./chunk-VF5EQBCE.js";import"./chunk-DELOOZDJ.js";import{f as Z}from"./chunk-2WH2EVR6.js";var ve=new $("CategorizedRecipesList",{factory:()=>{let t=y(w),i=y(W);return M(t.loadRecipes()).pipe(j(()=>t.recipes$),b(o=>o.map(l=>l.toDTO()))).pipe(b(o=>o.toSorted((l,s)=>l.name.localeCompare(s.name))),b(o=>_e(o,"category_id")),V(o=>Z(void 0,null,function*(){let l=[];for(let D in o){let k=o[D],Ie=yield i.getOne(D);l.push({category:Ie?.name,recipes:k.map(De=>K.fromRaw(De))})}if(!l.length)return[];let[s,...P]=l.toSorted((D,k)=>D.category>k.category?1:-1);return s?.category?[s].concat(P):P.concat([s])})))}});var xe=n.object({name:n.string(),amount:n.number().or(n.string()),uuid:n.string().optional(),product_id:Ce,recipe_id:n.lazy(()=>A),unit:n.enum(["gram","portion","piece"])});var A=n.object({name:n.string(),uuid:n.string().optional(),description:n.string(),ingredients:n.array(n.lazy(()=>xe)),outcome_unit:ye,outcome_amount:n.number().or(n.string()),taxTemplateName:n.string().optional(),category_id:n.string().nullable().optional(),createdAt:n.union([n.string(),n.number()]).optional(),updatedAt:n.union([n.string(),n.number()]).optional(),tags:n.array(n.string()).optional(),color:n.string().optional()});var be=()=>["draft","recipe"],he=(t,i)=>i==null?null:i.category,Le=(t,i)=>i.uuid;function Ee(t,i){t&1&&(c(0,"lg-button",7),T(1,"mat-icon",8),a()),t&2&&(R("success"),p("icon",!0)("link","/recipes/add")("size","medium"))}function we(t,i){if(t&1&&(c(0,"span"),m(1),a()),t&2){let e=i.$implicit;r(),z(e==null?null:e.name)}}function Ae(t,i){t&1&&(m(0),d(1,"translate")),t&2&&f(" ",u(1,1,"draft.list-prefix.existing")," ")}function ke(t,i){t&1&&(m(0),d(1,"translate")),t&2&&f(" ",u(1,1,"draft.list-prefix.new")," ")}function Fe(t,i){if(t&1){let e=I();c(0,"lg-gap-row",5)(1,"a",11),F(2,Ae,2,3)(3,ke,2,3),m(4),a(),c(5,"small",12),m(6),d(7,"translate"),d(8,"timeAgo"),a(),c(9,"lg-button",13),g("click",function(){C(e);let l=_().$implicit,s=_(2);return S(s.deleteDraft(l))}),T(10,"mat-icon",14),a()()}if(t&2){let e=_().$implicit;p("center",!0),r(),p("routerLink","/recipes/draft/"+(e==null?null:e.uuid)),r(),O(!(e==null||e.meta==null)&&e.meta.uuid?2:3),r(2),f(" ",(e==null||e.data==null?null:e.data.name)??""," "),r(2),B(" ",u(7,10,"edited-at-label")," ",u(8,12,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," "),r(3),R("danger"),p("size","tiny")("icon",!0)}}function Oe(t,i){if(t&1&&x(0,Fe,11,14,"ng-template",10),t&2){let e=i.$implicit;p("uuid",e.uuid)}}function ze(t,i){if(t&1){let e=I();c(0,"lg-card-list",9),g("onSelected",function(l){C(e);let s=_();return S(s.selectionZoneService.putSelected(l))}),h(1,Oe,1,1,null,10,Le),a()}if(t&2){let e=_();p("mode",e.selectionZoneService.selectionMode())("selectAll",e.selectionZoneService.selectAll().draft)("deselectAll",e.selectionZoneService.deselectAll().draft),r(),L(e.draft())}}function Be(t,i){if(t&1){let e=I();c(0,"lg-gap-row",5)(1,"a",18),m(2),a(),c(3,"lg-button",19),m(4),d(5,"translate"),a(),c(6,"small",20),m(7),d(8,"translate"),d(9,"timeAgo"),a(),c(10,"lg-button",13),g("click",function(){C(e);let l=_().$implicit,s=_(2);return S(s.deleteRecipe(l))}),T(11,"mat-icon",14),a()()}if(t&2){let e=_().$implicit;p("center",!0),r(),p("routerLink","/recipes/edit/"+e.uuid),r(),z(e.name),r(),R("primary"),p("size","small")("link","/recipes/calculate/"+e.uuid)("flat",!0),r(),f(" ",u(5,15,"recipes.calculate-btn")," "),r(3),B(" ",u(8,17,"edited-at-label")," ",u(9,19,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," "),r(3),R("danger"),p("size","tiny")("icon",!0)}}function Pe(t,i){if(t&1&&x(0,Be,12,21,"ng-template",17),t&2){let e=i.$implicit;p("uuid",e.uuid)}}function Ze(t,i){if(t&1){let e=I();c(0,"lg-title",15),m(1),d(2,"translate"),a(),c(3,"lg-card-list",16),g("onSelected",function(l){C(e);let s=_();return S(s.selectionZoneService.putSelected(l))}),h(4,Pe,1,1,null,17,Q),a()}if(t&2){let e=i.$implicit,o=_();p("level",3),r(),f(" ",(e==null?null:e.category)||u(2,5,"without-category-label")," "),r(2),p("mode",o.selectionZoneService.selectionMode())("selectAll",o.selectionZoneService.selectAll().recipe)("deselectAll",o.selectionZoneService.deselectAll().recipe),r(),L(e.recipes)}}function Me(t,i){t&1&&(c(0,"lg-gap-row",5)(1,"lg-title",15),m(2),d(3,"translate"),a()()),t&2&&(p("center",!0),r(),p("level",5),r(),f(" ",u(3,3,"no-recipes")," "))}var Te=class t{constructor(i,e,o,l){this._recipesRepository=i;this._notificationsService=e;this._transferDataService=o;this.selectionZoneService=l}draft=N([]);recipes=me(y(ve));Stores=J;ngOnInit(){this.loadRecipes();let i=this._recipesRepository.getDraftRecipe();i&&this.draft.set(i)}deleteRecipe(i){return i.uuid?this._recipesRepository.deleteRecipe(i.uuid).then(()=>{this.loadRecipes(),this._notificationsService.success("Recipe deleted")}):Promise.resolve()}loadRecipes(){this._recipesRepository.loadRecipes()}exportRecipes(i){this._transferDataService.exportTable("recipesStore","json",{selected:Array.from(i||[])})}deleteDraft(i){this._recipesRepository.removeDraftRecipe(i.uuid),this.draft.update(e=>e.filter(o=>o?.uuid!==i.uuid))}RecipeScheme=A;static \u0275fac=function(e){return new(e||t)(v(w),v(Y),v(ee),v(E))};static \u0275cmp=G({type:t,selectors:[["lg-recipes-list"]],features:[U([E])],decls:19,vars:20,consts:[["lgQuickActionsTpl",""],[3,"selectionTypes"],[3,"click","flat","size"],[3,"onDone","label","schema","storeName"],["lgImportRowTpl",""],[3,"center"],[2,"--card-bg","#bee5ff",3,"mode","selectAll","deselectAll"],[3,"icon","link","size"],["aria-hidden","false","fontIcon","add"],[2,"--card-bg","#bee5ff",3,"onSelected","mode","selectAll","deselectAll"],["lgCardListItem","","type","draft",3,"uuid"],["lgExpand","",3,"routerLink"],[1,"text-muted","text-cursive"],[3,"click","size","icon"],["aria-hidden","false","fontIcon","close"],[3,"level"],[3,"onSelected","mode","selectAll","deselectAll"],["lgCardListItem","","type","recipe",3,"uuid"],[3,"routerLink"],[3,"size","link","flat"],["lgPull","",1,"text-muted","text-cursive"]],template:function(e,o){if(e&1&&(c(0,"lg-controls-bar"),x(1,Ee,2,5,"ng-template",0),T(2,"lg-selection-tools",1),c(3,"lg-button",2),g("click",function(){return o.exportRecipes(o.selectionZoneService.selected().recipe)}),m(4),d(5,"translate"),a(),c(6,"lg-import",3),d(7,"translate"),g("onDone",function(){return o.loadRecipes()}),x(8,we,2,1,"ng-template",4),a()(),c(9,"lg-fade-in")(10,"lg-container")(11,"lg-gap-row",5)(12,"lg-title"),m(13),d(14,"translate"),a()(),F(15,ze,3,3,"lg-card-list",6),h(16,Ze,6,7,null,null,he,!1,Me,4,5,"lg-gap-row",5),a()()),e&2){let l;r(2),p("selectionTypes",q(19,be)),r(),R("info"),p("flat",!0)("size","small"),r(),f(" ",u(5,13,"export-label")," recipes "),r(2),p("label",u(7,15,"import-label")+" products")("schema",o.RecipeScheme)("storeName",o.Stores.RECIPES),r(5),p("center",!0),r(2),f(" ",u(14,17,"recipes.list-title")," "),r(2),O((l=o.draft())!=null&&l.length?15:-1),r(),L(o.recipes())}},dependencies:[re,pe,H,ce,te,ie,se,ae,ue,de,ne,ge,fe,Re,oe,Se,le,X],styles:["[_nghost-%COMP%]{display:block}"]})};export{Te as RecipesListComponent};
