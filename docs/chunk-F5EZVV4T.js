import{a as re,b as ce,c as le,d as ae,e as pe,f as me,g as T,h as se,i as ue}from"./chunk-4KQZD3NQ.js";import{a as oe,c as ie}from"./chunk-ME7NF7KD.js";import{a as te}from"./chunk-65PCG7KQ.js";import{b as ne}from"./chunk-UKAU3626.js";import"./chunk-G42TUXVK.js";import{b as de}from"./chunk-JAKY7DS2.js";import{a as F,b as H,c as I}from"./chunk-BDPXLT5D.js";import{a as J}from"./chunk-XVOV5GZT.js";import"./chunk-RFEBMF6P.js";import"./chunk-FG5PJ7WR.js";import{a as q,d as ee}from"./chunk-KQ2U72DB.js";import"./chunk-E64ZE4KI.js";import{a as Y}from"./chunk-5PVAHMKX.js";import{a as K,c as W}from"./chunk-PXM5XOY4.js";import{f as U,t as Q,w as X}from"./chunk-JUGNCNLY.js";import{Ab as f,Bb as C,Cb as z,Eb as D,Fb as b,Gb as r,Hb as c,Ib as P,Mb as h,Pb as g,Qb as m,W as N,Za as i,ac as l,bc as y,ca as $,cb as u,cc as d,dc as k,ea as _,f as A,hb as j,hc as G,la as w,ma as E,mb as x,nc as V,pc as B,r as Z,ub as a,x as R,xb as S,z as M}from"./chunk-46OIECST.js";var _e=new $("CategorizedProductsList",{factory:()=>{let t=_(I),o=_(J);return Z(t.loadRecipes()).pipe(N(()=>t.products$)).pipe(R(n=>n.toSorted((p,s)=>p.name.localeCompare(s.name))),R(n=>ae(n,"category_id")),M(n=>A(void 0,null,function*(){let p=[];for(let v in n){let L=n[v],Ce=yield o.getOne(v);p.push({category:Ce?.name,products:L})}if(!p.length)return[];let[s,...O]=p.toSorted((v,L)=>v.category>L.category?1:-1);return s?.category?[s].concat(O):O.concat([s])})))}});var ge=(t,o)=>o==null?null:o.category;function ve(t,o){t&1&&(r(0,"lg-button",5),P(1,"mat-icon",6),c()),t&2&&(S("success"),a("icon",!0)("link","/products/add")("size","medium"))}function xe(t,o){if(t&1&&(r(0,"span"),l(1),c()),t&2){let e=m(2).$implicit;i(),d("from ",e.source)}}function Se(t,o){if(t&1&&(r(0,"span"),l(1),c(),r(2,"span"),l(3),c(),f(4,xe,2,1,"span")),t&2){let e=m().$implicit;i(),y(e.name),i(2),k("",e.amount,"gr for ",e.price),i(),C(e.source?4:-1)}}function Pe(t,o){if(t&1&&(r(0,"span"),l(1),c()),t&2){let e=m(2).$implicit;i(),d("from ",e==null?null:e.source)}}function ye(t,o){if(t&1&&(r(0,"span"),l(1),c(),r(2,"span"),l(3),c(),f(4,Pe,2,1,"span")),t&2){let e=m().$implicit;i(),y(e==null?null:e.name),i(2),k("",e==null?null:e.amount," gr for ",e==null?null:e.price),i(),C(e!=null&&e.source?4:-1)}}function Ie(t,o){if(t&1&&f(0,Se,5,4)(1,ye,5,4),t&2){let e=o.flow;C(e==="new"?0:1)}}function Te(t,o){t&1&&l(0," per gram ")}function Le(t,o){if(t&1&&l(0),t&2){let e=m(2).$implicit;d(" per ",e.unit," ")}}function Re(t,o){if(t&1){let e=h();r(0,"lg-gap-row",4)(1,"div",10)(2,"lg-gap-row",4)(3,"div",11)(4,"a",12),l(5),c()(),r(6,"div",13),l(7),c(),r(8,"div",14),l(9),V(10,"number"),f(11,Te,1,0)(12,Le,1,1),c()()(),r(13,"lg-button",15),g("click",function(){w(e);let p=m().$implicit,s=m(2);return E(s.deleteProduct(p))}),P(14,"mat-icon",16),c()()}if(t&2){let e=m().$implicit,n=m(2);a("center",!0),i(2),a("center",!0),i(2),a("routerLink","/products/edit/"+e.uuid),i(),y(e.name),i(2),d(" ",e.source??""),i(2),d(" ",B(10,11,n.getPricePerGram(e),"1.2-5")," "),i(2),C(!e.unit||e.unit==="gram"?11:12),i(2),S("danger"),a("size","tiny")("icon",!0)}}function we(t,o){if(t&1&&x(0,Re,15,14,"ng-template",9),t&2){let e=o.$implicit;a("uuid",e.uuid)}}function Ee(t,o){if(t&1){let e=h();r(0,"lg-title",7),l(1),c(),r(2,"lg-card-list",8),g("onSelected",function(p){w(e);let s=m();return E(s.selectionZoneService.putSelected(p))}),D(3,we,1,1,null,9,z),c()}if(t&2){let e=o.$implicit,n=m();a("level",3),i(),d(" ",(e==null?null:e.category)||"Uncategorized"," "),i(),a("mode",n.selectionZoneService.selectionMode())("selectAll",n.selectionZoneService.selectAll())("deselectAll",n.selectionZoneService.deselectAll()),i(),b(e.products)}}function De(t,o){t&1&&(r(0,"lg-gap-row",4)(1,"lg-title",7),l(2," No products found "),c()()),t&2&&(a("center",!0),i(),a("level",5))}var fe=class t{constructor(o,e,n,p,s){this._productsRepository=o;this._csvReaderService=e;this._transferDataService=n;this._notificationsService=p;this.selectionZoneService=s}products=ne(_(_e));ProductDbInputScheme=H;Stores=q;getPricePerGram(o){return(F(o.price)||1)/(F(o.amount)||1)}exportProducts(o){this._transferDataService.exportTable("productsStore","json",{selected:Array.from(o)})}deleteProduct(o){o.uuid&&this._productsRepository.deleteProduct(o.uuid).then(()=>{this._notificationsService.success("Product deleted"),this.loadProducts()})}ngOnInit(){this.loadProducts()}loadProducts(){this._productsRepository.loadRecipes()}static \u0275fac=function(e){return new(e||t)(u(I),u(ce),u(ue),u(de),u(T))};static \u0275cmp=j({type:t,selectors:[["lg-product-list"]],features:[G([T])],decls:14,vars:7,consts:[["lgQuickActionsTpl",""],[3,"click","flat","size"],[3,"onDone","schema","storeName"],["lgImportRowTpl",""],[3,"center"],[3,"icon","link","size"],["aria-hidden","false","fontIcon","add"],[3,"level"],[3,"onSelected","mode","selectAll","deselectAll"],["lgCardListItem","",3,"uuid"],[1,"expand"],[2,"flex","20%"],[3,"routerLink"],[2,"flex","10%"],[2,"flex","70%"],[3,"click","size","icon"],["aria-hidden","false","aria-label","Example home icon","fontIcon","close"]],template:function(e,n){e&1&&(r(0,"lg-controls-bar"),x(1,ve,2,5,"ng-template",0),P(2,"lg-selection-tools"),r(3,"lg-button",1),g("click",function(){return n.exportProducts(n.selectionZoneService.selected())}),l(4," Export "),c(),r(5,"lg-import",2),g("onDone",function(){return n.loadProducts()}),x(6,Ie,2,1,"ng-template",3),c()(),r(7,"lg-fade-in")(8,"lg-container")(9,"lg-title"),l(10," Products "),c(),D(11,Ee,5,5,null,null,ge,!1,De,3,2,"lg-gap-row",4),c()()),e&2&&(i(3),S("info"),a("flat",!0)("size","small"),i(2),a("schema",n.ProductDbInputScheme)("storeName",n.Stores.PRODUCTS),i(6),b(n.products()))},dependencies:[Y,ee,te,K,W,U,ie,oe,le,Q,re,X,me,pe,se],styles:["[_nghost-%COMP%]{display:block}"]})};export{fe as ProductListComponent};
