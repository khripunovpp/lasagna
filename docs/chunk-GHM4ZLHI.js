import{a as me}from"./chunk-HXFWMFTO.js";import{a as ce}from"./chunk-DCCYGEBO.js";import{a as re}from"./chunk-J3NKL7XN.js";import{a as ne}from"./chunk-FGH36LQQ.js";import{a as se}from"./chunk-ACC6FC2Y.js";import{a as oe,c as ae}from"./chunk-QAREZ4J2.js";import{v as ie}from"./chunk-LFB4VQ35.js";import{a as Z}from"./chunk-FZ3H6YRY.js";import{a as ee}from"./chunk-RRWYN2FF.js";import{C as H,D as W,E as v,G as c,L as z,M as U,N as q,O as J,Q as K,R as L,S as Q,U as Y,W as te,g as $,o as j,s as X}from"./chunk-JT4J3WSG.js";import{B}from"./chunk-C44U6DMN.js";import{Cb as k,Eb as A,Hb as R,Ib as N,Jb as o,Kb as s,Lb as p,Lc as G,Mb as S,Mc as P,Nb as O,Ob as I,Qb as V,Ub as l,Vb as d,_ as y,_a as n,ca as F,db as C,ec as E,fc as M,gc as g,ic as h,ka as x,kb as D,la as f,mb as b,ua as w}from"./chunk-NHWKWTII.js";var _=class i{constructor(){}selfAlign="center";static \u0275fac=function(t){return new(t||i)};static \u0275dir=b({type:i,selectors:[["","lgSelfCenter",""]],hostVars:2,hostBindings:function(t,r){t&2&&E("align-self",r.selfAlign)}})};var m=class i{constructor(e){this.name=String(e.name).trim(),this.amount=parseFloat(String(e.amount)),this.percentage=e.percentage,this.description=String(e.description||"").trim(),this.items=e.items,this.uuid=e.uuid}name;amount;percentage;description;items;uuid;static fromRaw(e){return new i({name:e?.name||"",amount:e?.amount||0,percentage:e?.percentage||!1,description:e?.description||"",items:e?.items||[],uuid:e?.uuid||""})}static empty(){return new i({name:"",amount:0,percentage:!0,description:"",items:[],uuid:""})}update(e){return this.name=e.name||this.name,this.amount=e.amount||this.amount,this.percentage=e.percentage||this.percentage,this.description=e.description||this.description,this.items=e.items||this.items,this.uuid=e.uuid||this.uuid,this}toDTO(){return{name:this.name||"",amount:this.amount||0,percentage:this.percentage||!1,description:this.description||"",items:this.items||[],uuid:this.uuid||""}}};var T=class i{constructor(e){this._indexDbService=e}addOne(e){return this._indexDbService.addData("taxes",e.toDTO())}updateOne(e,t){return this._indexDbService.replaceData("taxes",e,t.toDTO())}async getOne(e){return new Promise(async(t,r)=>{if(e=typeof e=="string"?e:e.uuid,!e){t(void 0);return}await this._indexDbService.getOne("taxes",e).then(a=>{t(m.fromRaw(a))})})}getAll(){return this._indexDbService.getAll("taxes").then(e=>e.map(t=>m.fromRaw(t)))}addMany(e){return this._indexDbService.balkAdd("taxes",e.map(t=>t.toDTO()),!1)}deleteOne(e){return this._indexDbService.remove("taxes",e)}static \u0275fac=function(t){return new(t||i)(F(B))};static \u0275prov=y({token:i,factory:i.\u0275fac,providedIn:"root"})};var de=(i,e)=>e.name+e.uuid;function xe(i,e){if(i&1){let t=V();s(0,"section",2)(1,"div",5)(2,"lg-flex-row",6),S(3,"lg-input",7)(4,"lg-textarea",8),s(5,"lg-checkbox",9),l("onCheckboxChanged",function(){let a=x(t).$index,u=d();return f(u.onTaxValueChange(a))}),p(),s(6,"lg-number-input",10),l("onInputChange",function(){let a=x(t).$index,u=d();return f(u.onTaxValueChange(a))}),p(),s(7,"lg-button",11),l("click",function(){let a=x(t).$index,u=d();return f(u.deleteTxRow(a))}),S(8,"mat-icon",12),p()()()()}if(i&2){let t=e.$index;d().taxesForm.controls.rows.controls[t],o("formGroupName",t),n(),M("taxes__row--odd",t%2!==0),n(),o("top",!0)("fit",!0),n(),o("placeholder","Name"),n(),o("rows",3)("placeholder","Description"),n(),o("customMark","%"),n(),o("placeholder","Value"),n(),g("danger"),o("size","tiny")("icon",!0)}}function fe(i,e){i&1&&h(0," Save changes ")}function ge(i,e){i&1&&h(0," No changes ")}var le=class i{constructor(e,t){this._taxesRepository=e;this._notificationService=t}taxes=w([]);rows=G(()=>this.taxes().map(e=>m.fromRaw(e)));taxesForm=new v({rows:new K([this._getRowGroup()])});rowsEffect=P(()=>{this._rowsFormArray.clear(),this.rows().forEach((e,t)=>{this._rowsFormArray.push(this._getRowGroup(e))}),this.taxesForm.updateValueAndValidity(),this.taxesForm.markAsPristine()});totalTaxes=w(0);formValues=this.taxesForm.valueChanges.pipe(j());get _rowsFormArray(){return this.taxesForm.get("rows")}ngOnInit(){this._taxesRepository.getAll().then(e=>{this.taxes.set(e)})}onTaxValueChange(e){}deleteTxRow(e){let t=this.taxesForm.value.rows?.[e]?.uuid;this._rowsFormArray.removeAt(e),this.taxesForm.markAsDirty(),t&&this._taxesRepository.deleteOne(t)}addTaxRow(){this._rowsFormArray.push(this._getRowGroup()),this.taxesForm.markAsDirty()}async saveTaxes(){try{let e=this.taxesForm.value.rows?.map(t=>m.fromRaw(X(t)))??[];await this._taxesRepository.addMany(e),this._notificationService.success("Taxes saved successfully"),this.taxesForm.markAsPristine()}catch(e){this._notificationService.error($(e))}}_getRowGroup(e){return new v({name:new c(e?.name||""),description:new c(e?.description||""),value:new c(e?.amount||0),amount:new c(0),percentage:new c(e?.percentage||!1),uuid:new c(e?.uuid||"")})}static \u0275fac=function(t){return new(t||i)(C(T),C(Y))};static \u0275cmp=D({type:i,selectors:[["lg-taxes-settings"]],decls:11,vars:7,consts:[[3,"formGroup"],["formArrayName","rows"],[1,"taxes",3,"formGroupName"],["lgSelfCenter","","lgShrink","",3,"click","disabled"],["lgSelfCenter","","lgShrink","",3,"click"],[1,"taxes__row"],[3,"top","fit"],["formControlName","name","lgWidth","35%",3,"placeholder"],["lgWidth","35%","formControlName","description",3,"rows","placeholder"],["lgShrink","","formControlName","percentage",3,"onCheckboxChanged","customMark"],["lgParseMath","","formControlName","value",3,"onInputChange","placeholder"],["lgShrink","",3,"click","size","icon"],["aria-hidden","false","aria-label","Example home icon","fontIcon","close"]],template:function(t,r){t&1&&(s(0,"lg-flex-column"),O(1,0)(2,1),R(3,xe,9,14,"section",2,de),I()(),s(5,"lg-flex-row")(6,"lg-button",3),l("click",function(){return r.saveTaxes()}),k(7,fe,1,0)(8,ge,1,0),p(),s(9,"lg-button",4),l("click",function(){return r.addTaxRow()}),h(10," Add tax "),p()()()),t&2&&(n(),o("formGroup",r.taxesForm),n(2),N(r.taxes()),n(3),g("success"),o("disabled",!r.taxesForm.dirty),n(),A(r.taxesForm.dirty?7:8),n(2),g("warning"))},dependencies:[ee,re,L,H,W,te,ce,ie,oe,ae,Q,z,J,U,q,_,se,ne,me,Z],encapsulation:2})};export{_ as a,le as b};
