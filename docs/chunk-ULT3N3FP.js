import{a as Ee}from"./chunk-RFALABBJ.js";import{b as ze}from"./chunk-VKWU2J5T.js";import{a as ke,b as Ie,c as Le,d as Oe,e as a,f as Be,g as Ae,h as Pe}from"./chunk-VKWWG2RQ.js";import"./chunk-6ZKMU4GX.js";import{a as we}from"./chunk-WHV6YTRB.js";import"./chunk-QACA2TAM.js";import{a as $,c as Q}from"./chunk-LNWZEE46.js";import{b as Te}from"./chunk-DECIG3UW.js";import"./chunk-KVVEVKET.js";import{a as q,b as J}from"./chunk-LLOITE6A.js";import{a as H}from"./chunk-Q3MS5KTD.js";import{a as Me}from"./chunk-MTKE3TKK.js";import{a as be}from"./chunk-VNTOICFK.js";import{a as he}from"./chunk-KB5VWG36.js";import"./chunk-ACHQGNI7.js";import{a as ye,b}from"./chunk-4GMAHVOM.js";import{a as Re}from"./chunk-2AG3W6NR.js";import{a as De}from"./chunk-6OA5NOZV.js";import"./chunk-SNDQO5FA.js";import{j as Z,n as h,o as Se,q as N}from"./chunk-EKJQYQH6.js";import"./chunk-PPZB7COH.js";import"./chunk-5KSZNU56.js";import"./chunk-TCTFHDUI.js";import"./chunk-H5OOR6F4.js";import{v as j,w as T}from"./chunk-N4C567K3.js";import"./chunk-6D4L3YT6.js";import{o as ve,r as xe,s as V,w as G}from"./chunk-2UE5YCBQ.js";import"./chunk-652DFWNF.js";import"./chunk-GM4BKM5X.js";import{$ as k,$b as ne,Bb as L,Cb as O,Db as l,Ea as I,Eb as p,Fb as te,Jb as y,Mb as u,Nb as _,Ob as ce,Pb as ie,Sb as me,Ua as E,Ub as de,Va as r,Vb as ue,Xa as le,_a as g,_b as m,ac as C,bc as z,db as D,fb as A,ga as v,ha as x,ib as R,ic as F,jc as fe,kc as _e,na as w,oc as d,pb as pe,pc as f,qb as s,qc as ge,sb as se,tb as S,ua as re,wb as M,yb as P,zb as ae,zc as Ce}from"./chunk-ESI6QU3H.js";import"./chunk-DELOOZDJ.js";import"./chunk-2WH2EVR6.js";var Fe=a.object({name:a.string(),amount:a.number().or(a.string()),uuid:a.string().optional(),product_id:Ae,recipe_id:a.lazy(()=>K),unit:a.enum(["gram","portion","piece"])});var K=a.object({name:a.string(),uuid:a.string().optional(),description:a.string(),ingredients:a.array(a.lazy(()=>Fe)),outcome_unit:Be,outcome_amount:a.number().or(a.string()),taxTemplateName:a.string().optional(),category_id:a.string().nullable().optional(),createdAt:a.union([a.string(),a.number()]).optional(),updatedAt:a.union([a.string(),a.number()]).optional(),tags:a.array(a.string()).optional(),color:a.string().optional()});var Ge=i=>({length:i}),Ze=(i,t)=>t.uuid;function je(i,t){if(i&1){let e=y();l(0,"lg-button",4),u("click",function(){v(e);let o=_(2);return x(o.selectionZoneService.onSelection())}),m(1),d(2,"translate"),p()}i&2&&(S("success"),s("flat",!0)("size","small"),r(),C(" ",f(2,5,"select-many-label")," "))}function Ne(i,t){if(i&1){let e=y();l(0,"lg-button",4),u("click",function(){v(e);let o=_(2);return x(o.deleteAllDrafts())}),m(1),d(2,"translate"),p()}i&2&&(S("danger"),s("flat",!0)("size","small"),r(),C(" ",f(2,5,"delete-all-label")," "))}function He(i,t){if(i&1){let e=y();l(0,"lg-button",5),u("click",function(){v(e);let o=_(3);return x(o.deletedSelectedDrafts())}),m(1),d(2,"translate"),p()}if(i&2){let e=_();S("danger"),s("flat",!0)("disabled",!(e.draft!=null&&e.draft.size))("size","small"),r(),C(" ",f(2,6,"delete-selected-label")," ")}}function $e(i,t){i&1&&R(0,He,3,8,"ng-template",1)}function Qe(i,t){i&1&&(m(0),d(1,"translate")),i&2&&C(" ",f(1,1,"draft.list-prefix.existing")," ")}function qe(i,t){i&1&&(m(0),d(1,"translate")),i&2&&C(" ",f(1,1,"draft.list-prefix.new")," ")}function Je(i,t){if(i&1&&(l(0,"lg-gap-row",6)(1,"a",7),M(2,Qe,2,3)(3,qe,2,3),m(4),p(),l(5,"small",8),m(6),d(7,"translate"),d(8,"timeAgo"),p()()),i&2){let e=_().$implicit;s("center",!0),r(),s("routerLink","/recipes/draft/"+(e==null?null:e.uuid)),r(),P(!(e==null||e.meta==null)&&e.meta.uuid?2:3),r(2),C(" ",(e==null||e.data==null?null:e.data.name)??""," "),r(2),z(" ",f(7,6,"edited-at-label")," ",f(8,8,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," ")}}function Ke(i,t){if(i&1&&R(0,Je,9,10,"ng-template",3),i&2){let e=t.$implicit;s("uuid",e.uuid)}}function We(i,t){if(i&1){let e=y();l(0,"lg-expander",0),d(1,"translate"),d(2,"translate"),l(3,"lg-inline-separated-group"),R(4,je,3,7,"ng-template",1)(5,Ne,3,7,"ng-template",1),M(6,$e,1,0,null,1),p(),l(7,"lg-card-list",2),u("onDeleteOne",function(o){v(e);let c=_();return x(c.deleteDraft(o==null?null:o.uuid))})("onSelected",function(o){v(e);let c=_();return x(c.selectionZoneService.putSelected(o))}),L(8,Ke,1,1,null,3,Ze),p()()}if(i&2){let e,n,o=_();s("closeLabel",f(1,6,"drafts-close-label"))("openLabel",ge(2,8,"drafts-label",_e(11,Ge,(e=o.drafts())==null?null:e.length))),r(6),P((n=o.selectionZoneService.selected())?6:-1,n),r(),s("mode",o.selectionZoneService.selectionMode())("selectAll",o.selectionZoneService.selectAll().draft)("deselectAll",o.selectionZoneService.deselectAll().draft),r(),O(o.drafts())}}var W=class i{constructor(t,e,n){this._recipesRepository=t;this._notificationsService=e;this.selectionZoneService=n}drafts=w([]);Stores=G;get hidden(){return this.drafts()?.length===0?!0:null}ngOnInit(){let t=this._recipesRepository.getDraftRecipe();t&&this.drafts.set(t)}deleteAllDrafts(){this._recipesRepository.removeDraftMany(this.drafts().map(t=>t.uuid)).then(()=>{this.drafts.set([]),this._notificationsService.success("Drafts deleted")})}deletedSelectedDrafts(){let t=this.selectionZoneService.selected().draft;t&&this._recipesRepository.removeDraftMany(Array.from(t)).then(()=>{this.drafts.update(e=>e.filter(n=>!t.has(n.uuid))),this._notificationsService.success("Drafts deleted")})}deleteDraft(t){t&&(this._recipesRepository.removeDraftRecipe(t),this.drafts.update(e=>e.filter(n=>n?.uuid!==t)))}static \u0275fac=function(e){return new(e||i)(g(N),g(j),g(h))};static \u0275cmp=D({type:i,selectors:[["lg-draft-recipes-list"]],hostVars:1,hostBindings:function(e,n){e&2&&pe("hidden",n.hidden)},features:[F([h])],decls:1,vars:1,consts:[[3,"closeLabel","openLabel"],["lgInlineSeparatedGroup",""],[2,"--card-bg","#bee5ff",3,"onDeleteOne","onSelected","mode","selectAll","deselectAll"],["lgCardListItem","","type","draft",3,"uuid"],[3,"click","flat","size"],[3,"click","flat","disabled","size"],[3,"center"],["lgExpand","",3,"routerLink"],[1,"text-muted","text-cursive"]],template:function(e,n){if(e&1&&M(0,We,10,13,"lg-expander",0),e&2){let o;P((o=n.drafts())!=null&&o.length?0:-1)}},dependencies:[b,T,Q,$,V,H,Me,Z,Pe,J,q],encapsulation:2})};var X=class i{constructor(t){this.elementRef=t}lgClickOutside=new I;onClick(t){this.elementRef.nativeElement.contains(t.target)||this.lgClickOutside.emit(t)}static \u0275fac=function(e){return new(e||i)(g(re))};static \u0275dir=A({type:i,selectors:[["","lgClickOutside",""]],hostBindings:function(e,n){e&1&&u("click",function(c){return n.onClick(c)},E)("touchstart",function(c){return n.onClick(c)},E)("mousedown",function(c){return n.onClick(c)},E)("mouseup",function(c){return n.onClick(c)},E)},outputs:{lgClickOutside:"lgClickOutside"}})};var Xe=[[["","lgDropdownAnchor",""]],"*"],Ye=["[lgDropdownAnchor]","*"],Y=class i{constructor(){}display=w(!1);onClick(t){t.stopPropagation()}toggleDropdown(){this.display.set(!this.display())}closeDropdown(){this.display.set(!1)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=D({type:i,selectors:[["lg-dropdown"]],hostBindings:function(e,n){e&1&&u("click",function(c){return n.onClick(c)})},ngContentSelectors:Ye,decls:5,vars:2,consts:[[1,"lg-dropdown",3,"lgClickOutside"],[1,"lg-dropdown-anchor",3,"click"],[1,"lg-dropdown-content"]],template:function(e,n){e&1&&(ce(Xe),l(0,"div",0),u("lgClickOutside",function(){return n.closeDropdown()}),l(1,"div",1),u("click",function(){return n.toggleDropdown()}),ie(2),p(),l(3,"div",2),ie(4,1),p()()),e&2&&se("lg-dropdown-open",n.display())},dependencies:[X],styles:["[_nghost-%COMP%]{display:block;position:relative;z-index:2}.lg-dropdown[_ngcontent-%COMP%]{position:relative;display:inline-block}.lg-dropdown-content[_ngcontent-%COMP%]{display:none;position:absolute;top:calc(100% + 8px);background-color:#f9f9f9;min-width:160px;box-shadow:0 8px 16px #0003;z-index:1;border-radius:16px;padding:16px}.lg-dropdown-open[_ngcontent-%COMP%]   .lg-dropdown-content[_ngcontent-%COMP%]{display:block}.lg-dropdown-item[_ngcontent-%COMP%]{color:#000;padding:12px 16px;text-decoration:none;display:block}.lg-dropdown-item[_ngcontent-%COMP%]:hover{background-color:#f1f1f1}"]})};var U=class i{constructor(t){this.templateRef=t}static \u0275fac=function(e){return new(e||i)(g(le))};static \u0275dir=A({type:i,selectors:[["","lgGroupingSortingContainer",""]]})};var ee=class i{constructor(){}router=k(xe);aRouter=k(ve);context;sortChange=new I;groupChange=new I;sorting=w({field:"name",direction:"asc",group:"category"});sortingEffect=Ce(()=>{let t=this.sorting();this.sortChange.emit(t)});onSortChange(t){this.sortChange.emit(this.sorting()),this.router.navigate([],{queryParams:{sortField:this.sorting().field,sortDirection:this.sorting().direction,groupBy:t.group||this.sorting().group},relativeTo:this.aRouter}).then(()=>{window.location.reload()})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=D({type:i,selectors:[["lg-grouping-sorting"]],contentQueries:function(e,n,o){if(e&1&&me(o,U,5),e&2){let c;de(c=ue())&&(n.context=c.first)}},outputs:{sortChange:"sortChange",groupChange:"groupChange"},decls:9,vars:10,consts:[["lgDropdownAnchor","",3,"size"],[3,"size"],[3,"click","size","flat"]],template:function(e,n){e&1&&(l(0,"lg-gap-row")(1,"lg-dropdown")(2,"lg-button",0),m(3," Group by "),p(),l(4,"lg-gap-column",1)(5,"lg-button",2),u("click",function(){return n.onSortChange({group:"category"})}),m(6," Category "),p(),l(7,"lg-button",2),u("click",function(){return n.onSortChange({group:"createdAt"})}),m(8," Date "),p()()()()),e&2&&(r(2),s("size","small"),r(2),s("size","small"),r(),S("warning"),s("size","small")("flat",!0),r(2),S("warning"),s("size","small")("flat",!0))},dependencies:[b,T,Y,he],encapsulation:2})};var Ue=()=>["recipe"],et=(i,t)=>t==null?null:t.category;function tt(i,t){if(i&1){let e=y();l(0,"lg-button",5),u("click",function(){v(e);let o=_();return x(o.exportRecipes(o.selectionZoneService.selected().recipe))}),m(1),d(2,"translate"),p()}i&2&&(S("info"),s("flat",!0)("size","small"),r(),C(" ",f(2,5,"export-label")," recipes "))}function it(i,t){if(i&1&&(l(0,"span"),m(1),p()),i&2){let e=t.$implicit;r(),ne(e==null?null:e.name)}}function nt(i,t){if(i&1){let e=y();l(0,"lg-import",6),d(1,"translate"),u("onDone",function(){v(e);let o=_();return x(o.loadRecipes())}),R(2,it,2,1,"ng-template",7),p()}if(i&2){let e=_();s("label",f(1,3,"import-label")+" products")("schema",e.RecipeScheme)("storeName",e.Stores.RECIPES)}}function ot(i,t){if(i&1&&(l(0,"lg-gap-row",3)(1,"a",11),m(2),p(),l(3,"lg-button",12),m(4),d(5,"translate"),p(),l(6,"small",13),m(7),d(8,"translate"),d(9,"timeAgo"),p()()),i&2){let e=_().$implicit;s("center",!0),r(),s("routerLink","/recipes/edit/"+e.uuid),r(),ne(e.name),r(),S("primary"),s("size","small")("link","/recipes/calculate/"+e.uuid)("flat",!0),r(),C(" ",f(5,11,"recipes.calculate-btn")," "),r(3),z(" ",f(8,13,"edited-at-label")," ",f(9,15,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," ")}}function rt(i,t){if(i&1&&R(0,ot,10,17,"ng-template",10),i&2){let e=t.$implicit;s("uuid",e.uuid)}}function lt(i,t){if(i&1){let e=y();l(0,"lg-title",8),m(1),d(2,"translate"),p(),l(3,"lg-card-list",9),u("onSelected",function(o){v(e);let c=_();return x(c.selectionZoneService.putSelected(o))})("onDeleteOne",function(o){v(e);let c=_();return x(c.deleteRecipe(o))}),L(4,rt,1,1,null,10,ae),p()}if(i&2){let e=t.$implicit,n=_();s("level",3),r(),C(" ",(e==null?null:e.category)||f(2,5,"without-category-label")," "),r(2),s("mode",n.selectionZoneService.selectionMode())("selectAll",n.selectionZoneService.selectAll().recipe)("deselectAll",n.selectionZoneService.deselectAll().recipe),r(),O(e.recipes)}}function pt(i,t){i&1&&(l(0,"lg-gap-row",3)(1,"lg-title",8),m(2),d(3,"translate"),p()()),i&2&&(s("center",!0),r(),s("level",5),r(),C(" ",f(3,3,"no-recipes")," "))}var Ve=class i{constructor(t,e,n,o){this._recipesRepository=t;this._notificationsService=e;this._transferDataService=n;this.selectionZoneService=o;this._recipesRepository.recipes$.subscribe({next:c=>{console.log("recipes loaded",c)},error:c=>{}})}groupingParam=ze("groupBy");recipes=Te(k(Ee));Stores=G;RecipeScheme=K;ngOnInit(){this.loadRecipes()}deleteRecipe(t){t?.uuid&&this._recipesRepository.deleteOne(t.uuid).then(()=>{this._notificationsService.success("Recipe deleted"),this.loadRecipes()})}loadRecipes(){this._recipesRepository.loadRecipes()}exportRecipes(t){this._transferDataService.exportTable("recipesStore","json",{selected:Array.from(t||[])})}static \u0275fac=function(e){return new(e||i)(g(N),g(j),g(Se),g(h))};static \u0275cmp=D({type:i,selectors:[["lg-recipes-list"]],features:[F([h])],decls:18,vars:12,consts:[[3,"icon","link","size"],["aria-hidden","false","fontIcon","add"],["lgInlineSeparatedGroup",""],[3,"center"],[3,"selectionTypes"],[3,"click","flat","size"],[3,"onDone","label","schema","storeName"],["lgImportRowTpl",""],[3,"level"],[3,"onSelected","onDeleteOne","mode","selectAll","deselectAll"],["lgCardListItem","","type","recipe",3,"uuid"],[3,"routerLink"],[3,"size","link","flat"],["lgPull","",1,"text-muted","text-cursive"]],template:function(e,n){e&1&&(l(0,"lg-controls-bar")(1,"lg-button",0),te(2,"mat-icon",1),p(),l(3,"lg-inline-separated-group"),R(4,tt,3,7,"ng-template",2)(5,nt,3,5,"ng-template",2),p()(),l(6,"lg-fade-in")(7,"lg-container")(8,"lg-gap-row",3)(9,"lg-title"),m(10),d(11,"translate"),p()(),te(12,"lg-draft-recipes-list")(13,"lg-grouping-sorting")(14,"lg-selection-tools",4),L(15,lt,6,7,null,null,et,!1,pt,4,5,"lg-gap-row",3),p()()),e&2&&(r(),S("success"),s("icon",!0)("link","/recipes/add")("size","medium"),r(7),s("center",!0),r(2),C(" ",f(11,9,"recipes.list-title")," "),r(4),s("selectionTypes",fe(11,Ue)),r(),O(n.recipes()))},dependencies:[b,T,V,be,ye,De,Q,$,Ie,ke,Re,Le,Oe,H,we,Z,W,J,q,ee],styles:["[_nghost-%COMP%]{display:block}"]})};export{Ve as RecipesListComponent};
