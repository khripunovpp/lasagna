import{a as _e,b as fe,c as Re,d as ye,e as Se,f as o,g as Ce,h as ve,i as Te}from"./chunk-X2YMXIY5.js";import"./chunk-SBEFIX5R.js";import{a as ge}from"./chunk-PRC2TUST.js";import{a as ce}from"./chunk-HE3R4OYU.js";import{a as me,c as de}from"./chunk-MY6KHXHO.js";import{b as ue}from"./chunk-XWIK56RR.js";import"./chunk-HHXJ7M2I.js";import{a as le}from"./chunk-XKLMDYQ6.js";import{a as xe}from"./chunk-W7F36SB2.js";import{a as se}from"./chunk-R3RPCOKV.js";import{a as ae}from"./chunk-NCTFFSWN.js";import"./chunk-OTURUDYJ.js";import"./chunk-O7M42S4C.js";import{a as ne,b as pe}from"./chunk-WR2UF3SH.js";import{a as oe}from"./chunk-ALZEZ7BP.js";import{a as re}from"./chunk-BC325NGK.js";import"./chunk-SNDQO5FA.js";import{c as X,j as ee,n as E,o as ie,q as w}from"./chunk-VFJHO4T2.js";import"./chunk-CBVWR65Z.js";import"./chunk-5KSZNU56.js";import"./chunk-L3DC7GP3.js";import{b as Y}from"./chunk-WZGWS77O.js";import{u as te}from"./chunk-ODQSNCKZ.js";import"./chunk-2SYRDFEF.js";import{s as K,w as W}from"./chunk-UQJ3VPU4.js";import"./chunk-652DFWNF.js";import"./chunk-QHW4G2KK.js";import{$ as y,$b as z,Ab as L,Bb as h,Cb as c,Db as a,Eb as T,Ib as b,Lb as g,Mb as _,R as j,Va as r,Yb as u,Z as $,Zb as B,_a as v,_b as f,db as G,dc as U,ec as q,fc as H,ga as S,ha as C,ib as x,jc as m,k as M,kc as d,lc as J,na as N,q as D,qb as p,s as V,tb as R,wb as F,xb as O,yb as Q}from"./chunk-VF5EQBCE.js";import"./chunk-DELOOZDJ.js";import{f as Z}from"./chunk-2WH2EVR6.js";var be=new $("CategorizedRecipesList",{factory:()=>{let t=y(w),i=y(Y);return M(t.loadRecipes()).pipe(j(()=>t.recipes$),D(n=>n.map(l=>l.toDTO()))).pipe(D(n=>n.toSorted((l,s)=>l.name.localeCompare(s.name))),D(n=>ge(n,"category_id")),V(n=>Z(void 0,null,function*(){let l=[];for(let I in n){let k=n[I],Le=yield i.getOne(I);l.push({category:Le?.toString(),recipes:k.map(he=>X.fromRaw(he))})}if(!l.length)return[];let[s,...P]=l.toSorted((I,k)=>I.category>k.category?1:-1);return s?.category?[s].concat(P):P.concat([s])})))}});var Ie=o.object({name:o.string(),amount:o.number().or(o.string()),uuid:o.string().optional(),product_id:ve,recipe_id:o.lazy(()=>A),unit:o.enum(["gram","portion","piece"])});var A=o.object({name:o.string(),uuid:o.string().optional(),description:o.string(),ingredients:o.array(o.lazy(()=>Ie)),outcome_unit:Ce,outcome_amount:o.number().or(o.string()),taxTemplateName:o.string().optional(),category_id:o.string().nullable().optional(),createdAt:o.union([o.string(),o.number()]).optional(),updatedAt:o.union([o.string(),o.number()]).optional(),tags:o.array(o.string()).optional(),color:o.string().optional()});var Ee=()=>["draft","recipe"],we=t=>({length:t}),Ae=(t,i)=>i==null?null:i.category,ke=(t,i)=>i.uuid;function Fe(t,i){t&1&&(c(0,"lg-button",8),T(1,"mat-icon",9),a()),t&2&&(R("success"),p("icon",!0)("link","/recipes/add")("size","medium"))}function Oe(t,i){if(t&1&&(c(0,"span"),u(1),a()),t&2){let e=i.$implicit;r(),B(e==null?null:e.name)}}function Be(t,i){t&1&&(u(0),m(1,"translate")),t&2&&f(" ",d(1,1,"draft.list-prefix.existing")," ")}function ze(t,i){t&1&&(u(0),m(1,"translate")),t&2&&f(" ",d(1,1,"draft.list-prefix.new")," ")}function Pe(t,i){if(t&1){let e=b();c(0,"lg-gap-row",5)(1,"a",12),F(2,Be,2,3)(3,ze,2,3),u(4),a(),c(5,"small",13),u(6),m(7,"translate"),m(8,"timeAgo"),a(),c(9,"lg-button",14),g("click",function(){S(e);let l=_().$implicit,s=_(2);return C(s.deleteDraft(l))}),T(10,"mat-icon",15),a()()}if(t&2){let e=_().$implicit;p("center",!0),r(),p("routerLink","/recipes/draft/"+(e==null?null:e.uuid)),r(),O(!(e==null||e.meta==null)&&e.meta.uuid?2:3),r(2),f(" ",(e==null||e.data==null?null:e.data.name)??""," "),r(2),z(" ",d(7,10,"edited-at-label")," ",d(8,12,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," "),r(3),R("danger"),p("size","tiny")("icon",!0)}}function Ze(t,i){if(t&1&&x(0,Pe,11,14,"ng-template",11),t&2){let e=i.$implicit;p("uuid",e.uuid)}}function Me(t,i){if(t&1){let e=b();c(0,"lg-card-list",10),g("onSelected",function(l){S(e);let s=_();return C(s.selectionZoneService.putSelected(l))}),L(1,Ze,1,1,null,11,ke),a()}if(t&2){let e=_();p("mode",e.selectionZoneService.selectionMode())("selectAll",e.selectionZoneService.selectAll().draft)("deselectAll",e.selectionZoneService.deselectAll().draft),r(),h(e.draft())}}function Ve(t,i){if(t&1){let e=b();c(0,"lg-gap-row",5)(1,"a",19),u(2),a(),c(3,"lg-button",20),u(4),m(5,"translate"),a(),c(6,"small",21),u(7),m(8,"translate"),m(9,"timeAgo"),a(),c(10,"lg-button",14),g("click",function(){S(e);let l=_().$implicit,s=_(2);return C(s.deleteRecipe(l))}),T(11,"mat-icon",15),a()()}if(t&2){let e=_().$implicit;p("center",!0),r(),p("routerLink","/recipes/edit/"+e.uuid),r(),B(e.name),r(),R("primary"),p("size","small")("link","/recipes/calculate/"+e.uuid)("flat",!0),r(),f(" ",d(5,15,"recipes.calculate-btn")," "),r(3),z(" ",d(8,17,"edited-at-label")," ",d(9,19,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," "),r(3),R("danger"),p("size","tiny")("icon",!0)}}function je(t,i){if(t&1&&x(0,Ve,12,21,"ng-template",18),t&2){let e=i.$implicit;p("uuid",e.uuid)}}function $e(t,i){if(t&1){let e=b();c(0,"lg-title",16),u(1),m(2,"translate"),a(),c(3,"lg-card-list",17),g("onSelected",function(l){S(e);let s=_();return C(s.selectionZoneService.putSelected(l))}),L(4,je,1,1,null,18,Q),a()}if(t&2){let e=i.$implicit,n=_();p("level",3),r(),f(" ",(e==null?null:e.category)||d(2,5,"without-category-label")," "),r(2),p("mode",n.selectionZoneService.selectionMode())("selectAll",n.selectionZoneService.selectAll().recipe)("deselectAll",n.selectionZoneService.deselectAll().recipe),r(),h(e.recipes)}}function Ne(t,i){t&1&&(c(0,"lg-gap-row",5)(1,"lg-title",16),u(2),m(3,"translate"),a()()),t&2&&(p("center",!0),r(),p("level",5),r(),f(" ",d(3,3,"no-recipes")," "))}var De=class t{constructor(i,e,n,l){this._recipesRepository=i;this._notificationsService=e;this._transferDataService=n;this.selectionZoneService=l}draft=N([]);recipes=ue(y(be));Stores=W;ngOnInit(){this.loadRecipes();let i=this._recipesRepository.getDraftRecipe();i&&this.draft.set(i)}deleteRecipe(i){return i.uuid?this._recipesRepository.deleteRecipe(i.uuid).then(()=>{this.loadRecipes(),this._notificationsService.success("Recipe deleted")}):Promise.resolve()}loadRecipes(){this._recipesRepository.loadRecipes()}exportRecipes(i){this._transferDataService.exportTable("recipesStore","json",{selected:Array.from(i||[])})}deleteDraft(i){this._recipesRepository.removeDraftRecipe(i.uuid),this.draft.update(e=>e.filter(n=>n?.uuid!==i.uuid))}RecipeScheme=A;static \u0275fac=function(e){return new(e||t)(v(w),v(te),v(ie),v(E))};static \u0275cmp=G({type:t,selectors:[["lg-recipes-list"]],features:[U([E])],decls:22,vars:29,consts:[["lgQuickActionsTpl",""],[3,"selectionTypes"],[3,"click","flat","size"],[3,"onDone","label","schema","storeName"],["lgImportRowTpl",""],[3,"center"],[3,"closeLabel","openLabel"],[2,"--card-bg","#bee5ff",3,"mode","selectAll","deselectAll"],[3,"icon","link","size"],["aria-hidden","false","fontIcon","add"],[2,"--card-bg","#bee5ff",3,"onSelected","mode","selectAll","deselectAll"],["lgCardListItem","","type","draft",3,"uuid"],["lgExpand","",3,"routerLink"],[1,"text-muted","text-cursive"],[3,"click","size","icon"],["aria-hidden","false","fontIcon","close"],[3,"level"],[3,"onSelected","mode","selectAll","deselectAll"],["lgCardListItem","","type","recipe",3,"uuid"],[3,"routerLink"],[3,"size","link","flat"],["lgPull","",1,"text-muted","text-cursive"]],template:function(e,n){if(e&1&&(c(0,"lg-controls-bar"),x(1,Fe,2,5,"ng-template",0),T(2,"lg-selection-tools",1),c(3,"lg-button",2),g("click",function(){return n.exportRecipes(n.selectionZoneService.selected().recipe)}),u(4),m(5,"translate"),a(),c(6,"lg-import",3),m(7,"translate"),g("onDone",function(){return n.loadRecipes()}),x(8,Oe,2,1,"ng-template",4),a()(),c(9,"lg-fade-in")(10,"lg-container")(11,"lg-gap-row",5)(12,"lg-title"),u(13),m(14,"translate"),a()(),c(15,"lg-expander",6),m(16,"translate"),m(17,"translate"),F(18,Me,3,3,"lg-card-list",7),a(),L(19,$e,6,7,null,null,Ae,!1,Ne,4,5,"lg-gap-row",5),a()()),e&2){let l,s;r(2),p("selectionTypes",q(26,Ee)),r(),R("info"),p("flat",!0)("size","small"),r(),f(" ",d(5,15,"export-label")," recipes "),r(2),p("label",d(7,17,"import-label")+" products")("schema",n.RecipeScheme)("storeName",n.Stores.RECIPES),r(5),p("center",!0),r(2),f(" ",d(14,19,"recipes.list-title")," "),r(2),p("closeLabel",d(16,21,"drafts-close-label"))("openLabel",J(17,23,"drafts-label",H(27,we,(l=n.draft())==null?null:l.length))),r(3),O((s=n.draft())!=null&&s.length?18:-1),r(),h(n.recipes())}},dependencies:[pe,ae,K,se,ne,re,de,me,fe,_e,oe,ye,Re,Se,le,xe,ce,ee,Te],styles:["[_nghost-%COMP%]{display:block}"]})};export{De as RecipesListComponent};
