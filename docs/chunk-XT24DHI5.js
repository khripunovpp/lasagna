import{a as Ve}from"./chunk-ZZ7RMZQH.js";import{b as Ne}from"./chunk-VKWU2J5T.js";import{a as Ee,b as Oe,c as Le,d as Me,e as a,f as Ge,g as Be,h as Fe}from"./chunk-VKWWG2RQ.js";import"./chunk-6ZKMU4GX.js";import{a as be}from"./chunk-WHV6YTRB.js";import"./chunk-QACA2TAM.js";import{a as Pe,c as ze}from"./chunk-M47ACRCX.js";import{b as Ie}from"./chunk-DECIG3UW.js";import"./chunk-KVVEVKET.js";import{a as U,b as ee}from"./chunk-LLOITE6A.js";import{a as Y}from"./chunk-Q3MS5KTD.js";import{a as Ae}from"./chunk-MTKE3TKK.js";import{a as ke}from"./chunk-VNTOICFK.js";import{a as X}from"./chunk-KB5VWG36.js";import"./chunk-ACHQGNI7.js";import{a as we,b as k}from"./chunk-4GMAHVOM.js";import{a as Te}from"./chunk-2AG3W6NR.js";import{a as W}from"./chunk-6OA5NOZV.js";import"./chunk-SNDQO5FA.js";import{j as q,n as h,o as he,q as K}from"./chunk-EKJQYQH6.js";import"./chunk-PPZB7COH.js";import"./chunk-5KSZNU56.js";import"./chunk-TCTFHDUI.js";import"./chunk-H5OOR6F4.js";import{v as J,w as I}from"./chunk-N4C567K3.js";import"./chunk-6D4L3YT6.js";import{o as De,r as Re,s as Q,w as $}from"./chunk-2UE5YCBQ.js";import"./chunk-652DFWNF.js";import{h as Se}from"./chunk-GM4BKM5X.js";import{$ as O,$b as me,Ab as ge,Bb as G,Cb as B,Db as l,Ea as L,Eb as p,Fb as se,Ib as _e,Jb as R,Mb as d,Nb as _,Ob as Ce,Pb as ce,Sb as F,Ua as M,Ub as N,Va as r,Vb as V,Xa as P,_a as g,_b as m,ac as C,bc as j,db as x,fb as b,ga as y,ha as S,ib as D,ic as Z,jc as ve,kc as H,na as T,oc as u,pb as ue,pc as f,qb as s,qc as xe,sb as fe,tb as v,ua as de,wb as z,yb as A,zc as ye}from"./chunk-ESI6QU3H.js";import"./chunk-DELOOZDJ.js";import"./chunk-2WH2EVR6.js";var je=a.object({name:a.string(),amount:a.number().or(a.string()),uuid:a.string().optional(),product_id:Be,recipe_id:a.lazy(()=>te),unit:a.enum(["gram","portion","piece"])});var te=a.object({name:a.string(),uuid:a.string().optional(),description:a.string(),ingredients:a.array(a.lazy(()=>je)),outcome_unit:Ge,outcome_amount:a.number().or(a.string()),taxTemplateName:a.string().optional(),category_id:a.string().nullable().optional(),createdAt:a.union([a.string(),a.number()]).optional(),updatedAt:a.union([a.string(),a.number()]).optional(),tags:a.array(a.string()).optional(),color:a.string().optional()});var He=i=>({length:i}),Qe=(i,t)=>t.uuid;function $e(i,t){if(i&1){let e=R();l(0,"lg-button",4),d("click",function(){y(e);let o=_(2);return S(o.selectionZoneService.onSelection())}),m(1),u(2,"translate"),p()}i&2&&(v("success"),s("flat",!0)("size","small"),r(),C(" ",f(2,5,"select-many-label")," "))}function qe(i,t){if(i&1){let e=R();l(0,"lg-button",4),d("click",function(){y(e);let o=_(2);return S(o.deleteAllDrafts())}),m(1),u(2,"translate"),p()}i&2&&(v("danger"),s("flat",!0)("size","small"),r(),C(" ",f(2,5,"delete-all-label")," "))}function Je(i,t){if(i&1){let e=R();l(0,"lg-button",5),d("click",function(){y(e);let o=_(3);return S(o.deletedSelectedDrafts())}),m(1),u(2,"translate"),p()}if(i&2){let e=_();v("danger"),s("flat",!0)("disabled",!(e.draft!=null&&e.draft.size))("size","small"),r(),C(" ",f(2,6,"delete-selected-label")," ")}}function Ke(i,t){i&1&&D(0,Je,3,8,"ng-template",1)}function We(i,t){i&1&&(m(0),u(1,"translate")),i&2&&C(" ",f(1,1,"draft.list-prefix.existing")," ")}function Xe(i,t){i&1&&(m(0),u(1,"translate")),i&2&&C(" ",f(1,1,"draft.list-prefix.new")," ")}function Ye(i,t){if(i&1&&(l(0,"lg-gap-row",6)(1,"a",7),z(2,We,2,3)(3,Xe,2,3),m(4),p(),l(5,"small",8),m(6),u(7,"translate"),u(8,"timeAgo"),p()()),i&2){let e=_().$implicit;s("center",!0),r(),s("routerLink","/recipes/draft/"+(e==null?null:e.uuid)),r(),A(!(e==null||e.meta==null)&&e.meta.uuid?2:3),r(2),C(" ",(e==null||e.data==null?null:e.data.name)??""," "),r(2),j(" ",f(7,6,"edited-at-label")," ",f(8,8,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," ")}}function Ue(i,t){if(i&1&&D(0,Ye,9,10,"ng-template",3),i&2){let e=t.$implicit;s("uuid",e.uuid)}}function et(i,t){if(i&1){let e=R();l(0,"lg-expander",0),u(1,"translate"),u(2,"translate"),l(3,"lg-inline-separated-group"),D(4,$e,3,7,"ng-template",1)(5,qe,3,7,"ng-template",1),z(6,Ke,1,0,null,1),p(),l(7,"lg-card-list",2),d("onDeleteOne",function(o){y(e);let c=_();return S(c.deleteDraft(o==null?null:o.uuid))})("onSelected",function(o){y(e);let c=_();return S(c.selectionZoneService.putSelected(o))}),G(8,Ue,1,1,null,3,Qe),p()()}if(i&2){let e,n,o=_();s("closeLabel",f(1,6,"drafts-close-label"))("openLabel",xe(2,8,"drafts-label",H(11,He,(e=o.drafts())==null?null:e.length))),r(6),A((n=o.selectionZoneService.selected())?6:-1,n),r(),s("mode",o.selectionZoneService.selectionMode())("selectAll",o.selectionZoneService.selectAll().draft)("deselectAll",o.selectionZoneService.deselectAll().draft),r(),B(o.drafts())}}var ie=class i{constructor(t,e,n){this._recipesRepository=t;this._notificationsService=e;this.selectionZoneService=n}drafts=T([]);Stores=$;get hidden(){return this.drafts()?.length===0?!0:null}ngOnInit(){let t=this._recipesRepository.getDraftRecipe();t&&this.drafts.set(t)}deleteAllDrafts(){this._recipesRepository.removeDraftMany(this.drafts().map(t=>t.uuid)).then(()=>{this.drafts.set([]),this._notificationsService.success("Drafts deleted")})}deletedSelectedDrafts(){let t=this.selectionZoneService.selected().draft;t&&this._recipesRepository.removeDraftMany(Array.from(t)).then(()=>{this.drafts.update(e=>e.filter(n=>!t.has(n.uuid))),this._notificationsService.success("Drafts deleted")})}deleteDraft(t){t&&(this._recipesRepository.removeDraftRecipe(t),this.drafts.update(e=>e.filter(n=>n?.uuid!==t)))}static \u0275fac=function(e){return new(e||i)(g(K),g(J),g(h))};static \u0275cmp=x({type:i,selectors:[["lg-draft-recipes-list"]],hostVars:1,hostBindings:function(e,n){e&2&&ue("hidden",n.hidden)},features:[Z([h])],decls:1,vars:1,consts:[[3,"closeLabel","openLabel"],["lgInlineSeparatedGroup",""],[2,"--card-bg","#bee5ff",3,"onDeleteOne","onSelected","mode","selectAll","deselectAll"],["lgCardListItem","","type","draft",3,"uuid"],[3,"click","flat","size"],[3,"click","flat","disabled","size"],[3,"center"],["lgExpand","",3,"routerLink"],[1,"text-muted","text-cursive"]],template:function(e,n){if(e&1&&z(0,et,10,13,"lg-expander",0),e&2){let o;A((o=n.drafts())!=null&&o.length?0:-1)}},dependencies:[k,I,ze,Pe,Q,Y,Ae,q,Fe,ee,U],encapsulation:2})};var oe=class i{constructor(t){this.elementRef=t}lgClickOutside=new L;onClick(t){this.elementRef.nativeElement.contains(t.target)||this.lgClickOutside.emit(t)}static \u0275fac=function(e){return new(e||i)(g(de))};static \u0275dir=b({type:i,selectors:[["","lgClickOutside",""]],hostBindings:function(e,n){e&1&&d("click",function(c){return n.onClick(c)},M)("touchstart",function(c){return n.onClick(c)},M)("mousedown",function(c){return n.onClick(c)},M)("mouseup",function(c){return n.onClick(c)},M)},outputs:{lgClickOutside:"lgClickOutside"}})};var tt=[[["","lgDropdownAnchor",""]],"*"],it=["[lgDropdownAnchor]","*"],re=class i{constructor(){}display=T(!1);onClick(t){t.stopPropagation()}toggleDropdown(){this.display.set(!this.display())}closeDropdown(){this.display.set(!1)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=x({type:i,selectors:[["lg-dropdown"]],hostBindings:function(e,n){e&1&&d("click",function(c){return n.onClick(c)})},ngContentSelectors:it,decls:5,vars:2,consts:[[1,"lg-dropdown",3,"lgClickOutside"],[1,"lg-dropdown-anchor",3,"click"],[1,"lg-dropdown-content"]],template:function(e,n){e&1&&(Ce(tt),l(0,"div",0),d("lgClickOutside",function(){return n.closeDropdown()}),l(1,"div",1),d("click",function(){return n.toggleDropdown()}),ce(2),p(),l(3,"div",2),ce(4,1),p()()),e&2&&fe("lg-dropdown-open",n.display())},dependencies:[oe],styles:["[_nghost-%COMP%]{display:block;position:relative;z-index:2}.lg-dropdown[_ngcontent-%COMP%]{position:relative;display:inline-block}.lg-dropdown-content[_ngcontent-%COMP%]{display:none;position:absolute;top:calc(100% + 8px);background-color:#f9f9f9;min-width:160px;box-shadow:0 8px 16px #0003;z-index:1;border-radius:16px;padding:16px}.lg-dropdown-open[_ngcontent-%COMP%]   .lg-dropdown-content[_ngcontent-%COMP%]{display:block}.lg-dropdown-item[_ngcontent-%COMP%]{color:#000;padding:12px 16px;text-decoration:none;display:block}.lg-dropdown-item[_ngcontent-%COMP%]:hover{background-color:#f1f1f1}"]})};var le=class i{constructor(t){this.templateRef=t}static \u0275fac=function(e){return new(e||i)(g(P))};static \u0275dir=b({type:i,selectors:[["","lgGroupingSortingContainer",""]]})};var pe=class i{constructor(){}router=O(Re);aRouter=O(De);context;sortChange=new L;groupChange=new L;sorting=T({field:"name",direction:"asc",group:"category"});sortingEffect=ye(()=>{let t=this.sorting();this.sortChange.emit(t)});onSortChange(t){this.sortChange.emit(this.sorting()),this.router.navigate([],{queryParams:{sortField:this.sorting().field,sortDirection:this.sorting().direction,groupBy:t.group||this.sorting().group},relativeTo:this.aRouter}).then(()=>{window.location.reload()})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=x({type:i,selectors:[["lg-grouping-sorting"]],contentQueries:function(e,n,o){if(e&1&&F(o,le,5),e&2){let c;N(c=V())&&(n.context=c.first)}},outputs:{sortChange:"sortChange",groupChange:"groupChange"},decls:9,vars:10,consts:[["lgDropdownAnchor","",3,"size"],[3,"size"],[3,"click","size","flat"]],template:function(e,n){e&1&&(l(0,"lg-gap-row")(1,"lg-dropdown")(2,"lg-button",0),m(3," Group by "),p(),l(4,"lg-gap-column",1)(5,"lg-button",2),d("click",function(){return n.onSortChange({group:"category"})}),m(6," Category "),p(),l(7,"lg-button",2),d("click",function(){return n.onSortChange({group:"createdAt"})}),m(8," Date "),p()()()()),e&2&&(r(2),s("size","small"),r(2),s("size","small"),r(),v("warning"),s("size","small")("flat",!0),r(2),v("warning"),s("size","small")("flat",!0))},dependencies:[k,I,re,X],encapsulation:2})};var E=class i{constructor(t){this.templateRef=t}static \u0275fac=function(e){return new(e||i)(g(P))};static \u0275dir=b({type:i,selectors:[["","lgGroupingTail",""]]})};var nt=i=>({$implicit:i}),ot=(i,t)=>t==null?null:t.field;function rt(i,t){if(i&1&&(l(0,"div",5),_e(1,6),p()),i&2){let e=t.$implicit,n=_(2);r(),s("ngTemplateOutlet",n.groupingTailDirective.templateRef)("ngTemplateOutletContext",H(2,nt,e))}}function lt(i,t){if(i&1&&(l(0,"section",1)(1,"header",2)(2,"lg-title",3),m(3),p()(),l(4,"div",4),G(5,rt,2,4,"div",5,ge),p()()),i&2){let e=t.$implicit;r(2),s("level",3),r(),C(" ",e==null?null:e.field," "),r(2),B(e==null?null:e.items)}}var ae=class i{constructor(){}sortResult;groupingTailDirective;static \u0275fac=function(e){return new(e||i)};static \u0275cmp=x({type:i,selectors:[["lg-grouping-tails"]],contentQueries:function(e,n,o){if(e&1&&F(o,E,5),e&2){let c;N(c=V())&&(n.groupingTailDirective=c.first)}},inputs:{sortResult:"sortResult"},decls:3,vars:0,consts:[[1,"grouping-tails"],[1,"grouping-tails__section"],[1,"grouping-tails__header"],[3,"level"],[1,"grouping-tails__content"],[1,"grouping-tails__item"],[3,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(e,n){e&1&&(l(0,"section",0),G(1,lt,7,2,"section",1,ot),p()),e&2&&(r(),B(n.sortResult==null?null:n.sortResult.groups))},dependencies:[W,Se],styles:[".grouping-tails[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:32px}.grouping-tails__section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}.grouping-tails__content[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:16px}.grouping-tails__item[_ngcontent-%COMP%]{padding:16px;border-radius:32px;background-color:var(--accent-sahde-color)}"]})};var pt=()=>["recipe"];function at(i,t){if(i&1){let e=R();l(0,"lg-button",7),d("click",function(){y(e);let o=_();return S(o.exportRecipes(o.selectionZoneService.selected().recipe))}),m(1),u(2,"translate"),p()}i&2&&(v("info"),s("flat",!0)("size","small"),r(),C(" ",f(2,5,"export-label")," recipes "))}function st(i,t){if(i&1&&(l(0,"span"),m(1),p()),i&2){let e=t.$implicit;r(),me(e==null?null:e.name)}}function ct(i,t){if(i&1){let e=R();l(0,"lg-import",8),u(1,"translate"),d("onDone",function(){y(e);let o=_();return S(o.loadRecipes())}),D(2,st,2,1,"ng-template",9),p()}if(i&2){let e=_();s("label",f(1,3,"import-label")+" products")("schema",e.RecipeScheme)("storeName",e.Stores.RECIPES)}}function mt(i,t){if(i&1&&(l(0,"lg-gap-column")(1,"a",10),m(2),p(),l(3,"lg-gap-row")(4,"lg-button",11),m(5),u(6,"translate"),p(),l(7,"small",12),m(8),u(9,"translate"),u(10,"timeAgo"),p()()()),i&2){let e=t.$implicit;r(),s("routerLink","/recipes/edit/"+e.uuid),r(),me(e.name),r(2),v("primary"),s("size","small")("link","/recipes/calculate/"+e.uuid)("flat",!0),r(),C(" ",f(6,10,"recipes.calculate-btn")," "),r(3),j(" ",f(9,12,"edited-at-label")," ",f(10,14,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," ")}}var Ze=class i{constructor(t,e,n,o){this._recipesRepository=t;this._notificationsService=e;this._transferDataService=n;this.selectionZoneService=o;this._recipesRepository.recipes$.subscribe({next:c=>{console.log("recipes loaded",c)},error:c=>{}})}groupingParam=Ne("groupBy");recipes=Ie(O(Ve));Stores=$;RecipeScheme=te;ngOnInit(){this.loadRecipes()}deleteRecipe(t){t?.uuid&&this._recipesRepository.deleteOne(t.uuid).then(()=>{this._notificationsService.success("Recipe deleted"),this.loadRecipes()})}loadRecipes(){this._recipesRepository.loadRecipes()}exportRecipes(t){this._transferDataService.exportTable("recipesStore","json",{selected:Array.from(t||[])})}static \u0275fac=function(e){return new(e||i)(g(K),g(J),g(he),g(h))};static \u0275cmp=x({type:i,selectors:[["lg-recipes-list"]],features:[Z([h])],decls:17,vars:12,consts:[[3,"icon","link","size"],["aria-hidden","false","fontIcon","add"],["lgInlineSeparatedGroup",""],[3,"center"],[3,"selectionTypes"],[3,"sortResult"],["lgGroupingTail",""],[3,"click","flat","size"],[3,"onDone","label","schema","storeName"],["lgImportRowTpl",""],[3,"routerLink"],[3,"size","link","flat"],["lgPull","",1,"text-muted","text-cursive"]],template:function(e,n){e&1&&(l(0,"lg-controls-bar")(1,"lg-button",0),se(2,"mat-icon",1),p(),l(3,"lg-inline-separated-group"),D(4,at,3,7,"ng-template",2)(5,ct,3,5,"ng-template",2),p()(),l(6,"lg-fade-in")(7,"lg-container")(8,"lg-gap-row",3)(9,"lg-title"),m(10),u(11,"translate"),p()(),se(12,"lg-draft-recipes-list")(13,"lg-grouping-sorting")(14,"lg-selection-tools",4),l(15,"lg-grouping-tails",5),D(16,mt,11,16,"ng-template",6),p()()()),e&2&&(r(),v("success"),s("icon",!0)("link","/recipes/add")("size","medium"),r(7),s("center",!0),r(2),C(" ",f(11,9,"recipes.list-title")," "),r(4),s("selectionTypes",ve(11,pt)),r(),s("sortResult",n.recipes()))},dependencies:[k,I,Q,ke,we,W,Oe,Ee,Te,Le,Me,Y,be,q,ie,ee,U,pe,ae,E,X],styles:["[_nghost-%COMP%]{display:block}"]})};export{Ze as RecipesListComponent};
