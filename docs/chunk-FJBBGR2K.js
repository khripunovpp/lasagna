import{a as I}from"./chunk-MQURMJGL.js";import{a as H}from"./chunk-LB3TUETV.js";import{a as oe,c as re,d as pe,e as le,f as T,g as ae,h as me}from"./chunk-Z3Y6NVFO.js";import{a as ce}from"./chunk-PRC2TUST.js";import{a as te,c as ie}from"./chunk-I6ZAJOHJ.js";import{a as ee}from"./chunk-BR4H3P2L.js";import{b as ne}from"./chunk-46D6NM5C.js";import"./chunk-67XZZGJY.js";import{b as se}from"./chunk-AXQKNJQU.js";import{a as o}from"./chunk-BBWM53XJ.js";import{a as Y}from"./chunk-SVQANG7A.js";import"./chunk-4J6QSXGQ.js";import{a as J,c as X}from"./chunk-OPLK3PQA.js";import"./chunk-IPKCCBOY.js";import{a as q}from"./chunk-LT4T7YA7.js";import{A as W,g as Q,w as U,z as K}from"./chunk-UAPQ4Z4N.js";import{Ab as l,Bb as S,Fb as w,Ib as R,Jb as d,P as j,Sa as r,Vb as s,Wb as F,X as N,Xa as u,Xb as x,Z as _,ab as O,ac as V,ea as b,fa as D,fb as f,gc as B,ic as G,k as M,la as P,nb as c,q as L,qb as g,s as Z,tb as h,ub as k,vb as $,xb as y,yb as v,zb as p}from"./chunk-SYQBEC7E.js";import"./chunk-DELOOZDJ.js";import{f as z}from"./chunk-2WH2EVR6.js";var de=o.object({uuid:o.string().optional(),name:o.string().min(1).optional(),description:o.string().optional(),ingredients:o.array(o.object({name:o.string().min(1).optional(),uuid:o.string().optional(),amount:o.union([o.string(),o.number()]).optional(),product_id:o.string().optional(),recipe_id:o.string().optional(),unit:o.string().optional()})),outcome_amount:o.union([o.string(),o.number()]).optional(),outcome_unit:o.string().optional(),taxTemplateName:o.string().optional(),category_id:o.string().optional()});var _e=new N("CategorizedRecipesList",{factory:()=>{let e=_(I),i=_(H);return M(e.loadRecipes()).pipe(j(()=>e.recipes$)).pipe(L(n=>n.toSorted((a,m)=>a.name.localeCompare(m.name))),L(n=>ce(n,"category_id")),Z(n=>z(void 0,null,function*(){let a=[];for(let C in n){let E=n[C],fe=yield i.getOne(C);a.push({category:fe?.name,recipes:E})}if(!a.length)return[];let[m,...A]=a.toSorted((C,E)=>C.category>E.category?1:-1);return m?.category?[m].concat(A):A.concat([m])})))}});var ge=(e,i)=>i==null?null:i.category,Re=(e,i)=>i==null?null:i.createdAt;function Ce(e,i){e&1&&(p(0,"lg-button",6),S(1,"mat-icon",7),l()),e&2&&(g("success"),c("icon",!0)("link","/recipes/add")("size","medium"))}function ye(e,i){if(e&1&&(p(0,"span"),s(1),l()),e&2){let t=i.$implicit;r(),F(t==null?null:t.name)}}function ve(e,i){e&1&&s(0," Unsaved existing recipe: ")}function Se(e,i){e&1&&s(0," Draft recipe: ")}function xe(e,i){if(e&1&&(p(0,"a",9)(1,"lg-gap-row",4)(2,"div"),h(3,ve,1,0)(4,Se,1,0),s(5),l(),p(6,"div"),s(7),B(8,"date"),l()()()),e&2){let t=d().$implicit;c("routerLink","/recipes/draft/"+(t==null?null:t.uuid)),r(),c("center",!0),r(2),k(!(t==null||t.meta==null)&&t.meta.uuid?3:4),r(2),x(" ",(t==null||t.data==null?null:t.data.name)??""," "),r(2),x("Created at: ",G(8,5,t==null?null:t.createdAt,"medium"))}}function Ie(e,i){e&1&&f(0,xe,9,8,"ng-template",8)}function Te(e,i){if(e&1&&(p(0,"lg-card-list",5),y(1,Ie,1,0,null,8,Re),l()),e&2){let t=d();r(),v(t.draft())}}function Ee(e,i){if(e&1){let t=w();p(0,"lg-gap-row",4)(1,"div",13)(2,"a",9),s(3),l()(),p(4,"lg-button",14),s(5," Calculate "),l(),p(6,"lg-button",15),R("click",function(){b(t);let a=d().$implicit,m=d(2);return D(m.deleteRecipe(a))}),S(7,"mat-icon",16),l()()}if(e&2){let t=d().$implicit;c("center",!0),r(2),c("routerLink","/recipes/edit/"+t.uuid),r(),F(t.name),r(),g("primary"),c("size","small")("link","/recipes/calculate/"+t.uuid)("flat",!0),r(2),g("danger"),c("size","tiny")("icon",!0)}}function Le(e,i){if(e&1&&f(0,Ee,8,12,"ng-template",12),e&2){let t=i.$implicit;c("uuid",t.uuid)}}function be(e,i){if(e&1){let t=w();p(0,"lg-title",10),s(1),l(),p(2,"lg-card-list",11),R("onSelected",function(a){b(t);let m=d();return D(m.selectionZoneService.putSelected(a))}),y(3,Le,1,1,null,12,$),l()}if(e&2){let t=i.$implicit,n=d();c("level",3),r(),x(" ",(t==null?null:t.category)||"Uncategorized"," "),r(),c("mode",n.selectionZoneService.selectionMode())("selectAll",n.selectionZoneService.selectAll())("deselectAll",n.selectionZoneService.deselectAll()),r(),v(t.recipes)}}function De(e,i){e&1&&(p(0,"lg-gap-row",4)(1,"lg-title",10),s(2," No recipes found "),l()()),e&2&&(c("center",!0),r(),c("level",5))}var ue=class e{constructor(i,t,n,a){this._recipesRepository=i;this._notificationsService=t;this._transferDataService=n;this.selectionZoneService=a}draft=P([]);recipes=ne(_(_e));Stores=q;RecipeDbInputScheme=de;ngOnInit(){this.loadRecipes();let i=this._recipesRepository.getDraftRecipe();i&&this.draft.set(i)}deleteRecipe(i){this._recipesRepository.deleteRecipe(i.uuid).then(()=>{this.loadRecipes(),this._notificationsService.success("Recipe deleted")})}loadRecipes(){this._recipesRepository.loadRecipes()}exportRecipes(i){this._transferDataService.exportTable("recipesStore","json",{selected:Array.from(i)})}static \u0275fac=function(t){return new(t||e)(u(I),u(se),u(me),u(T))};static \u0275cmp=O({type:e,selectors:[["lg-recipes-list"]],features:[V([T])],decls:16,vars:9,consts:[["lgQuickActionsTpl",""],[3,"click","flat","size"],[3,"onDone","schema","storeName"],["lgImportRowTpl",""],[3,"center"],[2,"--card-bg","#bee5ff"],[3,"icon","link","size"],["aria-hidden","false","fontIcon","add"],["lgCardListItem",""],[3,"routerLink"],[3,"level"],[3,"onSelected","mode","selectAll","deselectAll"],["lgCardListItem","",3,"uuid"],[1,"expand"],[3,"size","link","flat"],[3,"click","size","icon"],["aria-hidden","false","aria-label","Example home icon","fontIcon","close"]],template:function(t,n){if(t&1&&(p(0,"lg-controls-bar"),f(1,Ce,2,5,"ng-template",0),S(2,"lg-selection-tools"),p(3,"lg-button",1),R("click",function(){return n.exportRecipes(n.selectionZoneService.selected())}),s(4," Export "),l(),p(5,"lg-import",2),R("onDone",function(){return n.loadRecipes()}),f(6,ye,2,1,"ng-template",3),l()(),p(7,"lg-fade-in")(8,"lg-container")(9,"lg-gap-row",4)(10,"lg-title"),s(11," Recipes "),l()(),h(12,Te,3,0,"lg-card-list",5),y(13,be,5,5,null,null,ge,!1,De,3,2,"lg-gap-row",4),l()()),t&2){let a;r(3),g("info"),c("flat",!0)("size","small"),r(2),c("schema",n.RecipeDbInputScheme)("storeName",n.Stores.RECIPES),r(4),c("center",!0),r(3),k((a=n.draft())!=null&&a.length?12:-1),r(),v(n.recipes())}},dependencies:[X,Y,U,ee,J,K,ie,te,re,oe,W,le,pe,ae,Q],styles:["[_nghost-%COMP%]{display:block}"]})};export{ue as RecipesListComponent};
