import{a as De,b as O}from"./chunk-EFPHMVLC.js";import"./chunk-ZM37BWPV.js";import{a as Re}from"./chunk-XMKKZYQZ.js";import{a as Ne}from"./chunk-L4O2BQ67.js";import{a as Ge}from"./chunk-BMB7Y3AG.js";import{a as Fe,b as Ae,c as Ee,d as Pe,e as Me}from"./chunk-KX3GOSXV.js";import{a as Te}from"./chunk-7XWQXZLV.js";import{a as Ve,b as Ie}from"./chunk-O2GJCXTB.js";import"./chunk-LINTSV2P.js";import{b as M}from"./chunk-CVO47RCB.js";import{a as be,b as ye}from"./chunk-EZ5XDXUH.js";import{c as me,e as ue,f as _e,g as K,h as w,j as ge,k as fe,l as Ce,m as xe,n as ve,o as we,q as he}from"./chunk-H4D7ZLOP.js";import{a as Se}from"./chunk-GQAWBXZL.js";import"./chunk-7BACYQJQ.js";import{a as j,d as ke}from"./chunk-4K3JQH4K.js";import{a as se,b as pe}from"./chunk-UW5WEH6W.js";import{$a as m,B as J,Ca as x,Da as v,Ga as U,Ha as X,Ia as r,Ib as re,Ja as l,Ka as R,La as F,Ma as A,Mb as le,Oa as f,Pa as p,Qa as a,Ra as N,Sa as P,U as u,V as _,Wb as ce,Ya as T,Yb as ae,Z as y,Za as D,_a as E,a as h,ab as Z,ac as de,b,bb as G,f as Y,gb as ee,ia as c,la as S,lb as te,mb as ne,na as C,tb as W,wa as d,wb as ie,xb as I,ya as k,yb as oe,za as V,zb as $}from"./chunk-P3KTPPMX.js";var je=["*"];function Oe(o,t){if(o&1&&(r(0,"p",1),m(1),l()),o&2){let e=a();c(),G(" ",e.label()," ")}}var z=class o{constructor(){}label=I("");static \u0275fac=function(e){return new(e||o)};static \u0275cmp=C({type:o,selectors:[["lg-control-group"]],inputs:{label:[1,"label"]},ngContentSelectors:je,decls:4,vars:1,consts:[[1,"control-group"],[1,"control-group__label"],[1,"control-group__content"]],template:function(e,n){e&1&&(N(),r(0,"div",0),x(1,Oe,2,1,"p",1),r(2,"div",2),P(3),l()()),e&2&&(c(),v(n.label()?1:-1))},styles:["[_nghost-%COMP%]{display:flex;flex:1}.control-group[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:16px}.control-group__label[_ngcontent-%COMP%]{font-size:1.2rem;margin:0}.control-group__content[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:flex-end}.control-group__content[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{flex:1}"]})};var ze=["*",[["rowActions"]]],Le=["*","rowActions"],Q=class o{constructor(){}mobileMode=I(!1);static \u0275fac=function(e){return new(e||o)};static \u0275cmp=C({type:o,selectors:[["lg-controls-row"]],inputs:{mobileMode:[1,"mobileMode"]},ngContentSelectors:Le,decls:5,vars:2,consts:[[1,"controls-row"],[1,"controls-row__controls"],[1,"controls-row__actions"]],template:function(e,n){e&1&&(N(ze),r(0,"div",0)(1,"div",1),P(2),l(),r(3,"div",2),P(4,1),l()()),e&2&&k("controls-row__mobile",n.mobileMode())},styles:[`:host{display:flex;gap:16px}.controls-row{width:100%;display:flex;align-items:flex-end;gap:16px;flex:1}.controls-row__controls,.controls-row__actions{display:flex;align-items:flex-end;gap:16px}.controls-row__controls{flex:1}.controls-row__actions{flex:0;white-space:nowrap}.controls-row__controls>*,.controls-row__actions>*{flex:1}@media (max-width: 600px){.controls-row__mobile,.controls-row__mobile .controls-row__controls{flex-direction:column;align-items:stretch}}
`],encapsulation:2})};function Be(o,t){if(o&1){let e=f();r(0,"div",3)(1,"lg-barcode-add-product-widget",4),p("productAdded",function(i){u(e);let s=a();return _(s.onProductAdded(i))}),l()()}}var q=class o{constructor(){}productAdded=ie();selectedWidget=y(null);barCodeComponent=oe(O);selectScanWidgetEffect=W(()=>{this.selectedWidget()==="scan"?this.barCodeComponent()?.openScanner():this.barCodeComponent()?.closeScanner()});onWidgetSelect(t){this.selectedWidget.set(t)}onProductAdded(t){t&&this.productAdded.emit(t)}stopCamera(){this.barCodeComponent()?.closeScanner()}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=C({type:o,selectors:[["lg-product-widgets"]],viewQuery:function(e,n){e&1&&T(n.barCodeComponent,O,5),e&2&&D()},outputs:{productAdded:"productAdded"},decls:5,vars:3,consts:[[1,"product-widgets"],[1,"product-widgets__buttons"],[1,"product-widgets__button",3,"click"],[1,"product-widgets__wrapper"],[3,"productAdded"]],template:function(e,n){e&1&&(r(0,"div",0)(1,"div",1)(2,"button",2),p("click",function(){return n.onWidgetSelect("scan")}),m(3," Scan "),l()(),x(4,Be,2,0,"div",3),l()),e&2&&(k("selected",n.selectedWidget()!=null),c(4),v(n.selectedWidget()==="scan"?4:-1))},dependencies:[O],styles:[".product-widgets[_ngcontent-%COMP%]{display:flex;gap:16px;flex-direction:column}.product-widgets__input[_ngcontent-%COMP%]{flex:1}.product-widgets__buttons[_ngcontent-%COMP%]{display:flex;gap:16px;flex-wrap:wrap;padding:16px;background-color:#fafafa;border-radius:12px;margin:-16px}.product-widgets.selected[_ngcontent-%COMP%]   .product-widgets__buttons[_ngcontent-%COMP%]{margin-bottom:0}.product-widgets__button[_ngcontent-%COMP%]{display:flex;padding:8px 16px;border-radius:16px;background-color:#e5de38;appearance:none;border:none;font-family:inherit;font-size:inherit}"]})};var qe=["tooltipComponent"],He=["products"],Ke=["productsSelector"],Ye=(o,t)=>(t.value.product_id==null?null:t.value.product_id.id)||t.value.name||t.value.amount;function Je(o,t){if(o&1){let e=f();r(0,"lg-gap-column",20)(1,"lg-control",28),F(2,29),r(3,"span",30),p("click",function(){u(e);let i=a().$index,s=a();return _(s.closeTextField(i))}),m(4,"Hide"),l(),A(),r(5,"lg-input",8),p("onInputChanged",function(){u(e);let i=a().$index,s=E(12),g=a();return _(g.onIngredientSelected(s,i,["product_id","recipe_id"]))}),l()()()}o&2&&(d("size","small"),c(5),d("placeholder","Here you can write the name of the ingredient"))}function Ue(o,t){if(o&1){let e=f();r(0,"lg-multiselect",36),p("onSelected",function(){u(e);let i=a(2).$index,s=E(12),g=a();return _(g.onIngredientSelected(s,i,["product_id","name"]))}),l()}o&2&&d("resource","recipes")("autoLoad",!0)}function Xe(o,t){if(o&1){let e=f();r(0,"lg-multiselect",37,4),p("onSelected",function(){u(e);let i=a(2).$index,s=E(12),g=a();return _(g.onIngredientSelected(s,i,["recipe_id","name"]))}),l()}o&2&&d("resource","products")("autoLoad",!0)}function Ze(o,t){if(o&1){let e=f();r(0,"lg-gap-column",20)(1,"lg-control"),F(2,31),r(3,"span",32),p("click",function(){u(e);let i=a().$index,s=a();return _(s.closeRecipeField(i))}),m(4," Product "),l(),A(),F(5,33),r(6,"span",32),p("click",function(){u(e);let i=a().$index,s=a();return _(s.openRecipeField(i))}),m(7,"Recipe"),l(),A(),F(8,29),r(9,"span",30),p("click",function(){u(e);let i=a().$index,s=a();return _(s.openTextField(i))}),m(10,"As text"),l(),A(),x(11,Ue,1,2,"lg-multiselect",34)(12,Xe,2,2,"lg-multiselect",35),l()()}if(o&2){let e=a().$index,n=a();d("size","small"),c(3),d("ngClass",n.recipeFieldState()[e]?"":"text-active text-bold"),c(3),d("ngClass",n.recipeFieldState()[e]?"text-active text-bold":""),c(5),v(n.recipeFieldState()[e]?11:12)}}function et(o,t){if(o&1){let e=f();F(0,17),r(1,"lg-controls-row",19),x(2,Je,6,2,"lg-gap-column",20)(3,Ze,13,4,"lg-gap-column",20),r(4,"lg-tooltip",21,2),p("onClose",function(){u(e);let i=E(9);return _(i.stopCamera())}),m(6," Widgets "),r(7,"div",22)(8,"lg-product-widgets",23,3),p("productAdded",function(i){let s=u(e).$index,g=a();return _(g.productAdded(i,s))}),l()()(),r(10,"lg-control",24)(11,"lg-number-input",25,1),p("onKeydown",function(){u(e);let i=a();return _(i.addLast())}),l()(),R(13,"lg-buttons-group",26),F(14,27),r(15,"lg-button",18),p("click",function(){let i=u(e).$index,s=a();return _(s.deleteIngredient(i))}),m(16," Delete Ingredient "),l(),A(),l(),A()}if(o&2){let e=t.$index,n=E(9),i=a();d("formGroupName",e),c(),d("mobileMode",!0),c(),v(i.textFieldState()[e]?2:3),c(2),d("full",!!n.selectedWidget()),c(7),d("placeholder","In "+((i.form.value.ingredients==null||i.form.value.ingredients[e]==null?null:i.form.value.ingredients[e].unit)||"gram")),c(2),d("items",i.buttons),c(2),V("danger"),d("size","small")}}function tt(o,t){if(o&1){let e=f();r(0,"lg-button",30),p("click",function(){u(e);let i=a();return _(i.editRecipe(i.value))}),m(1," Edit Recipe "),l()}}function nt(o,t){if(o&1){let e=f();r(0,"lg-button",30),p("click",function(){u(e);let i=a();return _(i.addRecipe(i.value))}),m(1," Add Recipe "),l()}}var H=class o{constructor(t,e,n,i){this._recipesRepository=t;this._selectResourcesService=e;this._router=n;this._notificationsService=i}form=new K({name:new w(null,me.required),description:new w(""),outcome_amount:new w(null),outcome_unit:new w(""),ingredients:new we([this._getIngredientGroup()])});uuid=I("");textFieldState=y({});recipeFieldState=y({});buttons=[{label:"Grams",value:"gram",style:"secondary",onClick:()=>{console.log("Grams")}},{label:"Pieces",value:"piece",style:"secondary",onClick:()=>{console.log("Piece")}}];tooltipComponent=$("tooltipComponent");productsWidget=$("products");productsSelector=$("productsSelector");uuidEffect=W(()=>{this.uuid()&&this._recipesRepository.getOne(this.uuid()).then(t=>{this.form.reset(b(h({},t),{ingredients:[]})),this.form.get("ingredients").clear(),t?.ingredients.forEach((e,n)=>{this.ingredients.push(this._getIngredientGroup(e)),e.recipe_id&&this.openRecipeField(n),e.name&&this.openTextField(n)}),this.form.updateValueAndValidity()})});get ingredients(){return this.form.get("ingredients")}get value(){return this.form.value}get _values(){let t=this.form.value;return Ee(Ae(t))}get _formValid(){return this.form.valid&&!this.checkCycleRecipe(this.form.value.ingredients,this.uuid())}productAdded(t,e){return Y(this,null,function*(){yield this._selectResourcesService.load(),this.tooltipComponent()?.at(e)?.close(),this.productsWidget()?.at(e)?.stopCamera(),this.ingredients.at(e).get("product_id")?.reset({uuid:t.uuid,name:t.name})})}addLast(){let t=this.ingredients.at(this.ingredients.length-1);(t.value.name||t.value.amount||t.value.product_id)&&this.addIngredient()}ngOnInit(){this.form.valueChanges.pipe(J(100)).subscribe({next:t=>{this.checkCycleRecipe(t.ingredients,this.uuid())&&this._notificationsService.error("You cannot add a recipe to itself"),console.log(t)}})}ngAfterViewInit(){this._selectResourcesService.load().then(t=>{})}addIngredient(){this.ingredients.push(this._getIngredientGroup())}deleteIngredient(t){this.ingredients.removeAt(t)}addRecipe(t){if(!this._formValid){this._notificationsService.error(this._notificationsService.parseFormErrors(this.form).join(", "));return}this._recipesRepository.addRecipe(this._values).then(()=>{this._router.navigate(["/recipes"])})}editRecipe(t){if(!this._formValid){this._notificationsService.error(this._notificationsService.parseFormErrors(this.form).join(", "));return}this._recipesRepository.editRecipe(this.uuid(),this._values).then(()=>{this._router.navigate(["/recipes"])}).catch(e=>{console.error(e)})}onIngredientSelected(t,e,n){t.focus();let i=this.ingredients.at(e).value,s=i.product_id?.unit==="gram"||i.recipe_id?.unit==="gram";console.log({value:i}),this.ingredients.at(e).patchValue(b(h({},Array.isArray(n)?n.reduce((g,$e)=>b(h({},g),{[$e]:null}),{}):{[n]:null}),{unit:i.product_id?.unit||i.recipe_id?.unit||"gram"}))}openTextField(t){this.textFieldState.update(e=>b(h({},e),{[t]:!0}))}closeTextField(t){this.textFieldState.update(e=>b(h({},e),{[t]:!1}))}openRecipeField(t){this.recipeFieldState.update(e=>b(h({},e),{[t]:!0}))}closeRecipeField(t){this.recipeFieldState.update(e=>b(h({},e),{[t]:!1}))}checkCycleRecipe(t,e){let n=!1;for(let i of t){let s=i.recipe_id?.uuid;if(s&&s===e){n=!0;break}}return n}_getIngredientGroup(t){return new K({name:new w(t?.name),amount:new w(t?.amount?.toString()??null),product_id:new w(t?.product_id?{uuid:t.product_id}:null),recipe_id:new w(t?.recipe_id?{uuid:t.recipe_id}:null),unit:new w(t?.unit??"gram")},e=>{if(!e.value.product_id&&!e.value.name&&!e.value.recipe_id&&!parseInt(e.value.amount))return null;if((e.value.product_id||e.value.name||e.value.recipe_id)&&!parseInt(e.value.amount))return{ingredientAmountRequired:!0};if(!this.uuid)return null;let n=this.uuid();return this.checkCycleRecipe([e.value],n)?{cycleRecipe:!0}:!e.value.product_id&&!e.value.name&&!e.value.recipe_id?{ingredientRequired:!0}:null})}static \u0275fac=function(e){return new(e||o)(S(Ge),S(M),S(ae),S(De))};static \u0275cmp=C({type:o,selectors:[["lg-add-recipe-form"]],viewQuery:function(e,n){e&1&&(T(n.tooltipComponent,qe,5),T(n.productsWidget,He,5),T(n.productsSelector,Ke,5)),e&2&&D(3)},inputs:{uuid:[1,"uuid"]},features:[ee([{provide:M,useClass:M}])],decls:24,vars:15,consts:[["desc",""],["amount",""],["tooltipComponent",""],["products",""],["productsSelector",""],[3,"formGroup"],[3,"position"],["label","Name","lgExpand",""],["formControlName","name",3,"onInputChanged","placeholder"],["label","Description","lgExpand",""],["formControlName","description",3,"placeholder"],["lgExpand","",3,"mobileMode"],["label","Amount of the outcome","lgExpand",""],["formControlName","outcome_amount","lgParseMath","",3,"placeholder"],["formControlName","outcome_unit",3,"items"],["label","Ingredients","lgExpand",""],["formArrayName","ingredients","lgExpand",""],[3,"formGroupName"],[3,"click","size"],[3,"mobileMode"],[3,"size"],["lgShrink","",3,"onClose","full"],["ngProjectAs","content",5,["content"]],[3,"productAdded"],["label","Amount"],["lgParseMath","","formControlName","amount",3,"onKeydown","placeholder"],["formControlName","unit",3,"items"],["ngProjectAs","rowActions",5,["rowActions"]],["label","Name"],["ngProjectAs","endLabelTpl",5,["endLabelTpl"]],[3,"click"],["ngProjectAs","labelTpl",5,["labelTpl"]],[3,"click","ngClass"],["ngProjectAs","afterLabelTpl",5,["afterLabelTpl"]],["formControlName","recipe_id",3,"resource","autoLoad"],["formControlName","product_id",3,"resource","autoLoad"],["formControlName","recipe_id",3,"onSelected","resource","autoLoad"],["formControlName","product_id",3,"onSelected","resource","autoLoad"]],template:function(e,n){if(e&1){let i=f();r(0,"form",5)(1,"lg-gap-column",6)(2,"lg-control",7)(3,"lg-input",8),p("onInputChanged",function(){u(i);let g=E(6);return _(g.focus())}),l()(),r(4,"lg-control",9),R(5,"lg-textarea",10,0),l(),r(7,"lg-controls-row",11)(8,"lg-control",12),R(9,"lg-number-input",13,1),l(),R(11,"lg-buttons-group",14),l(),r(12,"pre"),m(13),te(14,"json"),l(),r(15,"lg-control-group",15)(16,"lg-gap-column",6)(17,"lg-gap-column",16),U(18,et,17,9,"ng-container",17,Ye),l(),r(20,"lg-button",18),p("click",function(){return u(i),_(n.addIngredient())}),m(21," Add Ingredient "),l()()(),x(22,tt,2,0,"lg-button")(23,nt,2,0,"lg-button"),l()()}e&2&&(d("formGroup",n.form),c(),d("position","start"),c(2),d("placeholder","Your recipe name"),c(2),d("placeholder","Describe your recipe, how to make it, what to pay attention to, etc."),c(2),d("mobileMode",!0),c(2),d("placeholder",n.form.value.outcome_unit||"Here you can write the amount of the outcome (e.g. 100, 12, etc.)"),c(2),d("items",n.buttons),c(2),Z(ne(14,13,n.value)),c(3),d("position","start"),c(2),X(n.ingredients.controls),c(2),V("success"),d("size","small"),c(2),v(n.uuid()?22:23))},dependencies:[he,ge,ue,_e,fe,ve,Ce,xe,be,ye,z,Se,j,Re,Fe,Ve,Q,Te,re,Ie,Pe,q,Me,Ne,le],encapsulation:2})};function it(o,t){if(o&1&&(r(0,"lg-button",2),m(1," Calculate "),l()),o&2){let e=a();V("primary"),d("flat",!0)("link","/calc-recipe/"+e.uuid())("size","small")}}var We=class o{constructor(t){this._aRoute=t}uuid=y("");ngOnInit(){this._aRoute.params.subscribe(t=>{this.uuid.set(t.uuid)})}static \u0275fac=function(e){return new(e||o)(S(ce))};static \u0275cmp=C({type:o,selectors:[["app-add-recipe"]],decls:9,vars:10,consts:[[3,"center","mobileMode"],[3,"flat","link","size","style"],[3,"flat","link","size"],[3,"uuid"]],template:function(e,n){e&1&&(r(0,"lg-container")(1,"lg-gap-row",0)(2,"lg-title"),m(3),l(),x(4,it,2,5,"lg-button",1),r(5,"lg-button",2),m(6," Back to list "),l()(),r(7,"lg-card"),R(8,"lg-add-recipe-form",3),l()()),e&2&&(c(),d("center",!0)("mobileMode",!0),c(2),G("",n.uuid()?"Edit":"Add"," Recipe"),c(),v(n.uuid()?4:-1),c(),V("warning"),d("flat",!0)("link","/recipes")("size","small"),c(3),d("uuid",n.uuid()))},dependencies:[de,se,pe,H,j,ke],encapsulation:2})};export{We as AddRecipeComponent};
