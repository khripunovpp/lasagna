import{a as mt}from"./chunk-XMKKZYQZ.js";import{a as st}from"./chunk-L4O2BQ67.js";import{a as ut}from"./chunk-BMB7Y3AG.js";import{a as pe,b as ue}from"./chunk-O2GJCXTB.js";import{a as dt,b as _t,c as gt}from"./chunk-GYUPA5PM.js";import{a as X,c as pt}from"./chunk-LINTSV2P.js";import{a as ce,b as ct}from"./chunk-EZ5XDXUH.js";import{a as Ze,b as et,e as L,f as tt,g as we,h as W,i as re,k as nt,l as it,m as ot,n as at,o as rt,p as le,q as lt}from"./chunk-H4D7ZLOP.js";import{a as me}from"./chunk-GQAWBXZL.js";import"./chunk-7BACYQJQ.js";import{a as se,d as de}from"./chunk-4K3JQH4K.js";import{a as Ye,b as ae}from"./chunk-UW5WEH6W.js";import{$a as m,Ab as qe,Ca as x,Da as h,Ea as Pe,Ga as ne,Ha as ie,I as ke,Ia as r,Ib as He,Ja as l,Ka as O,Kb as $e,L as Ie,La as Oe,M as ee,Ma as Ge,Na as M,Nb as Je,Oa as V,P as Te,Pa as f,Q as Fe,Qa as u,Ra as j,Sa as B,T as Ee,U as _,V as g,Wb as Qe,Y as Ae,Ya as je,Z as S,Za as Be,Zb as Ke,_a as w,a as Y,ab as D,ac as Xe,b as Z,bb as b,db as H,eb as $,f as E,fb as J,gb as Le,i as Re,ia as o,ib as We,la as te,lb as N,na as I,nb as P,ob as Q,pa as Me,ra as R,sb as ze,tb as ve,va as Ve,wa as c,wb as oe,xa as De,xb as K,ya as Ne,yb as Ue,za as F}from"./chunk-P3KTPPMX.js";var ht=["*"],_e=class n{constructor(){}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=I({type:n,selectors:[["lg-table-card"]],ngContentSelectors:ht,decls:4,vars:1,consts:[[3,"flat"],[1,"table"],[1,"table__scroll"]],template:function(e,i){e&1&&(j(),r(0,"lg-card",0)(1,"div",1)(2,"div",2),B(3),l()()()),e&2&&c("flat",!0)},dependencies:[Ye],styles:[`:host{display:flex;width:100%}.table__scroll{overflow-x:auto}table{width:100%;border-collapse:collapse;--border-color: #efefef}table thead tr{border-bottom:1px solid var(--border-color)}table thead th{text-align:left;padding:16px 24px;opacity:.4;font-size:.8em}table tbody tr{border-bottom:1px solid var(--border-color)}table tbody tr:last-child{border-bottom:none}td{padding:16px 24px}
`],encapsulation:2})};var bt=["*"];function Tt(n,t){if(n&1&&m(0),n&2){let e=u();b(" ",e.customMark()," ")}}var fe=class n{constructor(){}value=!1;customMark=K("");onKeydown(t){t.preventDefault(),this.onChangeCheckbox(!this.value)}onCheckboxChanged=oe();onChange=()=>{};onTouched=()=>{};writeValue(t){this._change(t)}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}onChangeCheckbox(t){this._change(t)}_change(t){this.value=t,this.onChange(this.value),this.onCheckboxChanged.emit(this.value)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=I({type:n,selectors:[["lg-checkbox"]],hostBindings:function(e,i){e&1&&f("keydown.enter",function(s){return i.onKeydown(s)})("keydown.space",function(s){return i.onKeydown(s)})},inputs:{customMark:[1,"customMark"]},outputs:{onCheckboxChanged:"onCheckboxChanged"},features:[Le([{provide:Ze,useExisting:Ie(()=>n),multi:!0}])],ngContentSelectors:bt,decls:5,vars:2,consts:[["tabindex","0",1,"lg-checkbox"],["type","checkbox",1,"checkbox",3,"ngModelChange","ngModel"],[1,"lg-checkbox__mark"]],template:function(e,i){e&1&&(j(),r(0,"label",0)(1,"input",1),f("ngModelChange",function(s){return i.onChangeCheckbox(s)}),l(),r(2,"span",2),x(3,Tt,1,1),l(),B(4),l()),e&2&&(o(),c("ngModel",i.value),o(2),h(i.customMark()?3:-1))},dependencies:[le,et,L,re],styles:[`.lg-checkbox{display:flex;border-radius:12px}.lg-checkbox:focus-within{outline-color:var(--active-color)}.lg-checkbox__mark{display:flex;align-items:center;justify-content:center;width:51px;height:51px;border-radius:12px;background-color:var(--control-bg);opacity:.2;cursor:pointer;transition:all .2s ease-in-out}.lg-checkbox__mark:hover{opacity:1}.checkbox{display:none}.checkbox:checked+.lg-checkbox__mark{background-color:var(--control-bg-selected);opacity:1;font-weight:700}
`],encapsulation:2})};var Ce=class n{constructor(){}selfAlign="center";static \u0275fac=function(e){return new(e||n)};static \u0275dir=Me({type:n,selectors:[["","lgSelfCenter",""]],hostVars:2,hostBindings:function(e,i){e&2&&De("align-self",i.selfAlign)}})};function ye(n){n||(Ee(ye),n=Fe(Ae));let t=new Re(e=>n.onDestroy(e.next.bind(e)));return e=>e.pipe(ke(t))}var vt=(n,t)=>t.value.name;function wt(n,t){if(n&1){let e=V();r(0,"section",6)(1,"div",7)(2,"lg-gap-row",8)(3,"small"),m(4,"Apply for all"),l(),r(5,"lg-control",9),O(6,"lg-input",10),l(),r(7,"lg-control",9),O(8,"lg-textarea",11),l(),r(9,"lg-control",9)(10,"lg-number-input",12),f("onInputChange",function(){_(e);let a=u().$index,s=u();return g(s.onTaxValueChange(a))}),l()(),r(11,"lg-control",9)(12,"lg-checkbox",13),f("onCheckboxChanged",function(){_(e);let a=u().$index,s=u();return g(s.onTaxValueChange(a))}),l()(),r(13,"lg-control",9),O(14,"lg-number-input",14),l(),r(15,"lg-button",15),f("click",function(){_(e);let a=u().$index,s=u();return g(s.deleteTxRow(a))}),O(16,"mat-icon",16),l()()()()}if(n&2){let e=u().$index;c("formGroupName",e),o(),Ne("taxes__row--odd",e%2!==0),o(),c("bottom",!0)("fit",!0),o(3),c("label","Name"),o(),c("placeholder","Name"),o(),c("label","Description"),o(),c("rows",3)("placeholder","Description"),o(),c("label","Value"),o(),c("placeholder","Value"),o(),c("label","Use percentage"),o(),c("customMark","%"),o(),c("label","Amount"),o(),c("disabled",!0)("placeholder","Amount"),o(),F("danger"),c("size","small")("icon",!0)}}function yt(n,t){n&1&&R(0,wt,17,21,"ng-template",2)}var z=class n{constructor(){}totalTaxesChanged=oe();rows=K([]);total=K(0);taxesForm=new we({rows:new rt([this._getRowGroup()])});rowsEffect=ve(()=>{this._rowsFormArray.clear(),this.rows().forEach((t,e)=>{this._rowsFormArray.push(this._getRowGroup(t))})});totalTaxes=S(0);totalEffect=ve(()=>{this._recalculateTaxes()});formValues=this.taxesForm.valueChanges.pipe(ye());get _rowsFormArray(){return this.taxesForm.get("rows")}ngOnInit(){this.formValues.subscribe(t=>{this.totalTaxes.set(this._getTotalTaxes()),this.totalTaxesChanged.emit(this.totalTaxes())})}onTaxValueChange(t){let e=this._rowsFormArray.at(t),i=this._getAmount(e.value.value,e.value.percentage);e.get("amount")?.patchValue(i.toFixed(2))}deleteTxRow(t){this._rowsFormArray.removeAt(t)}addTxRow(){this._rowsFormArray.push(this._getRowGroup())}_getTotalTaxes(){return this._rowsFormArray.controls.reduce((t,e)=>{let i=parseFloat(e.get("amount")?.value);return t+(isNaN(i)?0:i)},0)}_getAmount(t,e){let i=parseFloat(t.toString());return e?i*this.total():i}_recalculateTaxes(t=!1){this._rowsFormArray.controls.forEach((e,i)=>{let a=this._getAmount(e.get("value")?.value,e.get("percentage")?.value);e.get("amount")?.patchValue(a.toFixed(2),{emitEvent:!t})})}_getRowGroup(t=null){return new we({name:new W(t?.name||""),description:new W(t?.description||""),value:new W(t?.value||0),amount:new W(0),percentage:new W(t?.percentage||!1)})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=I({type:n,selectors:[["lg-taxes-and-fees-list"]],inputs:{rows:[1,"rows"],total:[1,"total"]},outputs:{totalTaxesChanged:"totalTaxesChanged"},decls:12,vars:6,consts:[[3,"formGroup"],["formArrayName","rows"],["lgCardListItem",""],[3,"level"],[3,"center","mobileMode","relaxed"],["lgSelfCenter","","lgShrink","",3,"click"],[1,"taxes",3,"formGroupName"],[1,"taxes__row"],[3,"bottom","fit"],[3,"label"],["formControlName","name",3,"placeholder"],["formControlName","description",3,"rows","placeholder"],["lgParseMath","","formControlName","value",3,"onInputChange","placeholder"],["formControlName","percentage",3,"onCheckboxChanged","customMark"],["formControlName","amount",3,"disabled","placeholder"],["lgSelfCenter","","lgShrink","",3,"click","size","icon"],["aria-hidden","false","aria-label","Example home icon","fontIcon","close"]],template:function(e,i){e&1&&(r(0,"lg-gap-column")(1,"lg-card-list",0),Oe(2,1),ne(3,yt,1,0,null,2,vt),Ge(),l(),r(5,"lg-title",3)(6,"lg-gap-row",4),m(7," Total taxes and fees "),r(8,"b"),m(9),l()()(),r(10,"lg-button",5),f("click",function(){return i.addTxRow()}),m(11," Add tax "),l()()),e&2&&(o(),c("formGroup",i.taxesForm),o(2),ie(i.taxesForm.controls.rows.controls),o(2),c("level",4),o(),c("center",!0)("mobileMode",!0)("relaxed",!0),o(3),D(i.totalTaxes()))},dependencies:[_t,dt,de,lt,L,tt,nt,at,it,ot,ct,ce,fe,pe,se,gt,Ce,st,me,ue,ae,mt],styles:[".taxes__row--odd[_ngcontent-%COMP%]{--control-bg: #fff}"]})};var St=["*"];function Rt(n,t){n&1&&B(0)}var xe=class n{constructor(){}showed=S(!1);get hidden(){return this.showed()?null:!0}show=()=>{this.showed.set(!0)};hide=()=>{this.showed.set(!1)};static \u0275fac=function(e){return new(e||n)};static \u0275cmp=I({type:n,selectors:[["lg-view-show"]],hostVars:1,hostBindings:function(e,i){e&2&&Ve("hidden",i.hidden)},ngContentSelectors:St,decls:1,vars:1,template:function(e,i){e&1&&(j(),x(0,Rt,1,0)),e&2&&h(i.showed()?0:-1)},encapsulation:2})};var he=class n{constructor(t,e){this._recipeRepository=t;this._productRepository=e}calculation;calculateRecipe(t,e=0){return new Promise((i,a)=>E(this,null,function*(){let s=[],p=0,T=0;yield this._recipeRepository.getOne(t).then(y=>E(this,null,function*(){let v=(e||y?.outcome_amount||1)/(y?.outcome_amount||1),{table:k,totalAmount:C,totalWeight:d}=yield this._makeIngredientTable(y,v);p+=C||0,T+=d||0,s.push(...k),s.push(this._makeTotal(p,T)),i({recipe:y,result:s,total:p,totalWeight:T})}))}))}getRecipe(t){return E(this,null,function*(){if(!t)return;let e=yield this._recipeRepository.getOne(t);if(!e)return;let i=0;return e.outcome_unit&&e.outcome_amount?i=e.outcome_amount:i=e?.ingredients?.reduce((a,s)=>{if(s.unit!=="gram")return a;let p=X(s.amount)||0;return a+p},0)??0,Z(Y({totalAmountInGrams:i||0},e),{pricePerUnit:0})})}_makeRecipeSubTable(t,e=0){return E(this,null,function*(){return new Promise((i,a)=>E(this,null,function*(){let s=[],p=0,T=0,y=t.amount;yield this.getRecipe(t.recipe_id).then(v=>E(this,null,function*(){let k=y/(v?.totalAmountInGrams||1),C=yield this._makeIngredientTable(v,e);C.table=C.table.map((A,Se)=>{let xt=(A.amount||0)*(e||1)*k;return Z(Y({},A),{amount:parseFloat((xt||0).toFixed(5)),total:parseFloat((A.total?A.total*k:0).toFixed(5)),indent:A.indent+1})});let d=C.totalAmount?C.totalAmount/C.totalWeight:0,U=(v?.totalAmountInGrams||0)*e*k,q=C.totalAmount*k;s.push(this._makeRecipeCaption({name:v?.name||"Unknown recipe",price_per_gram:d,amount:U,total:q,unit:t.unit,uuid:v?.uuid||""})),s.push(...C.table),T+=q,p+=C.totalWeight*k,i({table:s,totalAmount:T,totalWeight:p})}))}))})}_makeIngredientTable(t,e=0){let i=[],a=0,s=0;return Promise.all(t?.ingredients.map((p,T)=>E(this,null,function*(){let y=p.recipe_id,v=p.product_id,k=p.name;if(!y&&!v&&!k){let C=p.amount;return}if(y){let C=yield this._makeRecipeSubTable(p,e);i.push(...C.table),s+=C.totalAmount,a+=C.totalWeight}else if(v){let C=yield this._productRepository.getOne(p.product_id).then(d=>E(this,null,function*(){if(!d){i.push(this._makeRow({name:"Unknown product",price_per_gram:void 0,amount:p.amount*(e||1),total:void 0,uuid:d?.uuid||""}));return}if(!d?.price){i.push(this._makeRow({name:d.name,price_per_gram:0,amount:p.amount*(e||1),total:0,uuid:d?.uuid||""}));return}if(!d?.amount){i.push(this._makeRow({name:d.name,price_per_gram:0,amount:p.amount*(e||1),total:0,uuid:d?.uuid||""}));return}let U=p.amount*(e||1),q=(X(d.price)||1)/(X(d.amount)||1),A=q*(X(U)||1),Se=d.unit==="gram"||!d.unit;i.push(this._makeRow({name:d.name,price_per_gram:q,amount:U,total:A,unit:d.unit,uuid:d?.uuid||""})),s+=A,Se&&(a+=+U)}))}else k&&(i.push(this._makeRow({name:p.name,price_per_gram:void 0,amount:p.amount*(e||1),total:void 0,uuid:""})),a+=+p.amount*(e||1))}))??[]).then(()=>({table:i,totalAmount:s,totalWeight:a}))}_makeRow(t){return{name:t.name,price_per_gram:parseFloat(t.price_per_gram?.toFixed(5)??"0"),amount:t.amount,total:parseFloat(t.total?.toFixed(5)??"0"),unit:t.unit||"gram",indent:t.indent??0,type:"row",uuid:t.uuid}}_makeCaption(t){return{name:t,unit:void 0,price_per_gram:void 0,amount:void 0,total:void 0,indent:0,type:"caption"}}_makeRecipeCaption(t){return{name:t.name,price_per_gram:parseFloat(t.price_per_gram.toFixed(5)),amount:t.amount,total:parseFloat(t.total.toFixed(2)),unit:t.unit||"gram",indent:0,type:"recipe-row",uuid:t.uuid}}_makeTotal(t,e){return{name:"Total (without taxes and fees)",amount:e,unit:"gram",price_per_gram:parseFloat((t/e).toFixed(5)),total:parseFloat(t.toFixed(2)),indent:0,type:"total"}}static \u0275fac=function(e){return new(e||n)(Te(ut),Te(pt))};static \u0275prov=ee({token:n,factory:n.\u0275fac,providedIn:"root"})};var be=class n{constructor(){}getTemplates(t){let e=localStorage.getItem(this.getStorageKey(t));return e?JSON.parse(e):[]}getTemplateById(t,e){return this.getTemplates(t).find(a=>a.id===e)}getTemplateByName(t,e){return this.getTemplates(t).find(a=>a.name===e)}saveTemplate(t,e){let i=this.getTemplates(t);i.push(e),this._storeTemplates(t,i)}deleteTemplate(t,e){let i=this.getTemplates(t).filter(a=>a.id!==e);this._storeTemplates(t,i)}updateTemplate(t,e){let i=this.getTemplates(t).map(a=>a.id===e.id?e:a);this._storeTemplates(t,i)}getStorageKey(t){return`template-${t}`}_storeTemplates(t,e){localStorage.setItem(this.getStorageKey(t),JSON.stringify(e))}static \u0275fac=function(e){return new(e||n)};static \u0275prov=ee({token:n,factory:n.\u0275fac,providedIn:"root"})};var Ft=(n,t)=>[n,t];function Et(n,t){n&1&&M(0)}function At(n,t){n&1&&M(0)}function Mt(n,t){n&1&&M(0)}function Vt(n,t){if(n&1){let e=V();r(0,"lg-gap-row",15)(1,"lg-gap-row",16)(2,"div"),m(3," Calculation outcome: "),l(),r(4,"div")(5,"lg-number-input",17),J("ngModelChange",function(a){_(e);let s=u(2);return $(s.outcome_amount,a)||(s.outcome_amount=a),g(a)}),f("onInputChange",function(a){_(e);let s=u(2);return g(s.onOutcomeChange(a))}),l()(),r(6,"b"),m(7),l()(),r(8,"lg-gap-row",18)(9,"div"),m(10," one "),r(11,"b"),m(12),l()(),r(13,"div"),m(14," costs: "),R(15,Et,1,0,"ng-container",19),m(16," ( "),R(17,At,1,0,"ng-container",19),m(18," + "),R(19,Mt,1,0,"ng-container",19),m(20," of taxes and fees) "),l()()()}if(n&2){let e,i,a=u(2),s=w(11),p=w(13),T=w(15);c("fit",!0)("center",!0)("mobileMode",!0),o(),c("size","small")("center",!0),o(4),H("ngModel",a.outcome_amount),c("placeholder","Amount"),o(2),b(" ",(e=a.result())==null||e.recipe==null?null:e.recipe.outcome_unit," "),o(),c("size","small")("mobileMode",!0),o(4),b(" ",(i=a.result())==null||i.recipe==null?null:i.recipe.outcome_unit," "),o(3),c("ngTemplateOutlet",T),o(2),c("ngTemplateOutlet",p),o(2),c("ngTemplateOutlet",s)}}function Dt(n,t){n&1&&M(0)}function Nt(n,t){n&1&&M(0)}function Pt(n,t){n&1&&M(0)}function Ot(n,t){n&1&&M(0)}function Gt(n,t){if(n&1){let e=V();r(0,"lg-gap-row",16)(1,"div"),m(2," Calculation outcome: "),l(),r(3,"div")(4,"lg-number-input",17),J("ngModelChange",function(a){_(e);let s=u(2);return $(s.outcome_amount,a)||(s.outcome_amount=a),g(a)}),f("onInputChange",function(a){_(e);let s=u(2);return g(s.onOutcomeChange(a))}),l()(),r(5,"div"),m(6," costs: "),R(7,Dt,1,0,"ng-container",19),m(8," ( "),R(9,Nt,1,0,"ng-container",19),m(10," + "),R(11,Pt,1,0,"ng-container",19),m(12," of taxes and fees) "),l(),r(13,"div"),m(14," per gram: "),R(15,Ot,1,0,"ng-container",19),l()()}if(n&2){let e=u(2),i=w(11),a=w(13),s=w(15),p=w(17);c("size","small")("center",!0),o(4),H("ngModel",e.outcome_amount),c("placeholder","Amount"),o(3),c("ngTemplateOutlet",s),o(2),c("ngTemplateOutlet",a),o(2),c("ngTemplateOutlet",i),o(4),c("ngTemplateOutlet",p)}}function jt(n,t){if(n&1&&(r(0,"lg-gap-row",8),x(1,Vt,21,14,"lg-gap-row",15)(2,Gt,16,8,"lg-gap-row",16),l()),n&2){let e=u();c("center",!0),o(),h(e.notInGrams()?1:2)}}function Bt(n,t){if(n&1&&(m(0),N(1,"number")),n&2){let e=u(2);b(" ",P(1,1,e.totalTaxes()/e.showedOutcome(),"1.2-2")," ")}}function Lt(n,t){if(n&1&&(m(0),N(1,"number")),n&2){let e=u(2);b(" ",P(1,1,e.totalTaxes(),"1.2-2")," ")}}function Wt(n,t){if(n&1&&x(0,Bt,2,4)(1,Lt,2,4),n&2){let e=u();h(e.notInGrams()?0:1)}}function zt(n,t){if(n&1&&(m(0),N(1,"number")),n&2){let e,i=u(2);b(" ",P(1,1,(((e=i.result())==null?null:e.total)||1)/(i.showedOutcome()||1),"1.2-2")," ")}}function Ut(n,t){if(n&1&&(m(0),N(1,"number")),n&2){let e,i=u(2);b(" ",P(1,1,(e=i.result())==null?null:e.total,"1.2-2")," ")}}function qt(n,t){if(n&1&&x(0,zt,2,4)(1,Ut,2,4),n&2){let e=u();h(e.notInGrams()?0:1)}}function Ht(n,t){if(n&1&&(m(0),N(1,"number")),n&2){let e,i=u(2);b(" ",P(1,1,((((e=i.result())==null?null:e.total)||1)+i.totalTaxes())/(i.showedOutcome()||1),"1.2-2")," ")}}function $t(n,t){if(n&1&&(m(0),N(1,"number")),n&2){let e,i=u(2);b(" ",P(1,1,(((e=i.result())==null?null:e.total)||1)+i.totalTaxes(),"1.2-2")," ")}}function Jt(n,t){if(n&1&&x(0,Ht,2,4)(1,$t,2,4),n&2){let e=u();h(e.notInGrams()?0:1)}}function Qt(n,t){}function Kt(n,t){if(n&1&&(m(0),N(1,"number")),n&2){let e,i=u(2);b(" ",P(1,1,((((e=i.result())==null?null:e.total)||1)+i.totalTaxes())/i.outcome_amount(),"1.2-2")," ")}}function Xt(n,t){if(n&1&&x(0,Qt,0,0)(1,Kt,2,4),n&2){let e=u();h(e.notInGrams()?0:1)}}function Yt(n,t){if(n&1&&(r(0,"a",26),m(1),l()),n&2){let e=u().$implicit;c("routerLink",We(2,Ft,e.type==="recipe-row"?"/edit-recipe/":"/edit-product/",e.uuid)),o(),b(" ",e.name," ")}}function Zt(n,t){if(n&1&&m(0),n&2){let e=u().$implicit;b(" ",e.name," ")}}function en(n,t){if(n&1&&(r(0,"tr",25)(1,"td"),m(2),l(),r(3,"td")(4,"span",25),x(5,Yt,2,5,"a",26)(6,Zt,1,1),l()(),r(7,"td"),m(8),l(),r(9,"td"),m(10),l(),r(11,"td"),m(12),l(),r(13,"td"),m(14),l()()),n&2){let e=t.$implicit,i=t.$index;c("ngClass",e.type),o(2),D(i+1),o(2),c("ngClass","indent-"+e.indent),o(),h(e.type!=="total"?5:6),o(3),D(e.amount),o(2),D(e.unit),o(2),D(e.price_per_gram),o(2),D(e.total)}}function tn(n,t){if(n&1&&(r(0,"table")(1,"colgroup"),O(2,"col",20)(3,"col",21)(4,"col",22)(5,"col",23)(6,"col",22)(7,"col",24),l(),r(8,"thead")(9,"tr")(10,"th"),m(11,"#"),l(),r(12,"th"),m(13,"Name"),l(),r(14,"th"),m(15,"Amount"),l(),r(16,"th"),m(17,"Unit"),l(),r(18,"th"),m(19,"Price per unit"),l(),r(20,"th"),m(21,"Total"),l()()(),r(22,"tbody"),ne(23,en,15,8,"tr",25,Pe),l()()),n&2){let e,i=u();o(23),ie((e=i.result())==null?null:e.result)}}function nn(n,t){n&1&&(r(0,"div"),m(1,"Loading..."),l())}function on(n,t){if(n&1){let e=V();r(0,"lg-button",13),f("click",function(){_(e),u();let a=w(27);return g(a.show())}),m(1," Save as template "),l()}n&2&&(F("primary"),c("flat",!0)("size","small"))}function an(n,t){if(n&1){let e=V();r(0,"lg-button",13),f("click",function(){_(e),u();let a=w(37);return g(a.show())}),m(1," Apply template "),l()}n&2&&(F("warning"),c("flat",!0)("size","small"))}var Ct=class n{constructor(t,e,i){this._aRoute=t;this._calculateRecipeService=e;this._formTemplateService=i}uuid=S("");result=S(null);outcome_amount=qe(0);showedOutcome=S(0);totalTaxes=S(0);notInGrams=ze(()=>this.result()?.recipe?.outcome_unit&&this.result()?.recipe?.outcome_unit!=="gram");taxesComponent=Ue(z);tax_template_name="";taxRows=S([]);onOutcomeChange=t=>{this._calculateRecipeService.calculateRecipe(this.uuid(),t).then(e=>{this.result.set(e),this.showedOutcome.set(t)})};saveTaxTemplate(){this._formTemplateService.saveTemplate("tax",{name:this.tax_template_name,createdAt:new Date().toISOString(),id:new Date().toISOString(),data:this.taxesComponent()?.taxesForm.value.rows?.map(t=>({name:t.name,description:t.description,value:t.value,percentage:t.percentage}))||[]})}saveDefaultTaxTemplate(){this._formTemplateService.saveTemplate("tax",{name:"Default Tax Template",createdAt:new Date().toISOString(),id:new Date().toISOString(),data:this.taxesComponent()?.taxesForm.value.rows?.map(t=>({name:t.name,description:t.description,value:t.value,percentage:t.percentage}))||[]})}loadDefaultTaxTemplate(){let t=this._formTemplateService.getTemplateByName("tax","Default Tax Template");t&&this.taxRows.set(t.data.map(e=>({name:e.name,description:e.description,value:e.value,percentage:e.percentage})))}loadTaxTemplate(){let t=this._formTemplateService.getTemplateByName("tax",this.tax_template_name);t&&this.taxRows.set(t.data.map(e=>({name:e.name,description:e.description,value:e.value,percentage:e.percentage})))}ngOnInit(){this._aRoute.params.subscribe(t=>{this.uuid.set(t.uuid),this._calculateRecipeService.calculateRecipe(t.uuid).then(e=>{this.result.set(e),this.outcome_amount.set(e?.recipe?.outcome_amount||0),this.showedOutcome.set(e?.recipe?.outcome_amount||0),this.loadDefaultTaxTemplate()})})}onTotalTaxesChanged=t=>{this.totalTaxes.set(t)};static \u0275fac=function(e){return new(e||n)(te(Qe),te(he),te(be))};static \u0275cmp=I({type:n,selectors:[["lg-calculate-recipe"]],viewQuery:function(e,i){e&1&&je(i.taxesComponent,z,5),e&2&&Be()},inputs:{outcome_amount:[1,"outcome_amount"]},outputs:{outcome_amount:"outcome_amountChange"},decls:43,vars:43,consts:[["taxAmount",""],["rawAmount",""],["totalAmount",""],["perGramAmount",""],["taxSaveTemplateForm",""],["taxTemplateForm",""],[3,"center","mobileMode"],[3,"flat","link","size"],[3,"center"],[3,"flat","size","style"],[2,"--control-bg","white"],[3,"center","size"],[3,"ngModelChange","ngModel","placeholder"],[3,"click","flat","size"],[3,"totalTaxesChanged","rows","total"],[2,"--control-bg","white",3,"fit","center","mobileMode"],[3,"size","center"],["lgParseMath","",3,"ngModelChange","onInputChange","ngModel","placeholder"],[3,"size","mobileMode"],[4,"ngTemplateOutlet"],["span","1",2,"width","1%"],["span","1",2,"width","20%"],["span","1",2,"width","5%"],["span","1",2,"width","3%"],["span","1",2,"width","7%"],[3,"ngClass"],["target","_blank",3,"routerLink"]],template:function(e,i){if(e&1){let a=V();r(0,"lg-container")(1,"lg-gap-column")(2,"lg-gap-row",6)(3,"lg-title"),m(4),l(),r(5,"lg-button",7),m(6," Edit "),l(),r(7,"lg-button",7),m(8," Back to list "),l()(),x(9,jt,3,2,"lg-gap-row",8),R(10,Wt,2,1,"ng-template",null,0,Q)(12,qt,2,1,"ng-template",null,1,Q)(14,Jt,2,1,"ng-template",null,2,Q)(16,Xt,2,1,"ng-template",null,3,Q),r(18,"lg-table-card"),x(19,tn,25,0,"table")(20,nn,2,0,"div"),l(),r(21,"lg-gap-row",6)(22,"lg-title"),m(23," Taxes and fees "),l(),r(24,"lg-gap-row",8),x(25,on,2,4,"lg-button",9),r(26,"lg-view-show",10,4)(28,"lg-gap-row",11)(29,"lg-input",12),J("ngModelChange",function(p){return _(a),$(i.tax_template_name,p)||(i.tax_template_name=p),g(p)}),l(),r(30,"lg-button",13),f("click",function(){return _(a),g(i.saveTaxTemplate())}),m(31," Save "),l()()()(),r(32,"lg-button",13),f("click",function(){return _(a),g(i.saveDefaultTaxTemplate())}),m(33," Save as default template "),l(),r(34,"lg-gap-row",8),x(35,an,2,4,"lg-button",9),r(36,"lg-view-show",10,5)(38,"lg-gap-row",11)(39,"lg-input",12),J("ngModelChange",function(p){return _(a),$(i.tax_template_name,p)||(i.tax_template_name=p),g(p)}),l(),r(40,"lg-button",13),f("click",function(){return _(a),g(i.loadTaxTemplate())}),m(41," Apply "),l()()()()(),r(42,"lg-taxes-and-fees-list",14),f("totalTaxesChanged",function(p){return _(a),g(i.onTotalTaxesChanged(p))}),l()()()}if(e&2){let a,s,p,T,y=w(27),v=w(37);o(2),c("center",!0)("mobileMode",!0),o(2),b(" ",(a=i.result())==null||a.recipe==null?null:a.recipe.name," cost calculation "),o(),F("primary"),c("flat",!0)("link","/edit-recipe/"+((s=i.result())==null||s.recipe==null?null:s.recipe.uuid))("size","small"),o(2),F("warning"),c("flat",!0)("link","/recipes")("size","small"),o(2),h((p=i.result())!=null&&p.total?9:-1),o(10),h(i.result()?19:20),o(2),c("center",!0)("mobileMode",!0),o(3),c("center",!0),o(),h(y.showed()?-1:25),o(3),c("center",!0)("size","small"),o(),H("ngModel",i.tax_template_name),c("placeholder","Template name"),o(),F("primary"),c("flat",!0)("size","small"),o(2),F("primary"),c("flat",!0)("size","small"),o(2),c("center",!0),o(),h(v.showed()?-1:35),o(3),c("center",!0)("size","small"),o(),H("ngModel",i.tax_template_name),c("placeholder","Template name"),o(),F("primary"),c("flat",!0)("size","small"),o(2),c("rows",i.taxRows())("total",((T=i.result())==null?null:T.total)??0)}},dependencies:[Xe,ae,_e,He,se,de,Je,pe,le,L,re,ue,Ke,me,z,$e,xe,ce],styles:[`lg-number-input .lg-number-input{width:100px}
`],encapsulation:2})};export{Ct as CalculateRecipeComponent};
