import{a as ue,b as de}from"./chunk-I2VSWZNG.js";import{a as C}from"./chunk-HJLFP4TR.js";import{a as x}from"./chunk-6YY7CAC7.js";import{c as le}from"./chunk-2MXD6BT6.js";import"./chunk-XB3AHOA5.js";import{a as _}from"./chunk-JVZXL7NL.js";import{a as ge}from"./chunk-YBLVVA3I.js";import{b as he}from"./chunk-SE7OTRAS.js";import{d as fe}from"./chunk-DDUOHXAE.js";import{a as ve}from"./chunk-3VZX72VK.js";import{$a as y,$b as ce,Bb as re,C as v,Ca as $,Da as J,H as b,Ia as g,Ja as f,Ka as V,M as W,O as K,Oa as Q,P as B,Pa as X,Q as a,Qa as ee,Qb as ne,R as H,Sb as ie,U as Z,Ub as se,V as G,Vb as ae,W as q,Xb as pe,a as z,ac as me,ea as Y,f as d,gb as te,i as P,ia as M,j as A,na as T,qb as oe,r as R,ta as O,ua as U,w as h,wa as I,x as j,za as k}from"./chunk-6C36DQV4.js";var D=(e,r)=>e.reduce((t,n)=>{let o=n[r]||"unknown";return t[o]||(t[o]=[]),t[o].push(n),t},{});var ye=(e,r)=>d(void 0,null,function*(){let t=a(C),n=a(x),s=(yield t.getRecipes()).toSorted((p,m)=>p.name.localeCompare(m.name)),i=D(s,"category_id"),c=[];for(let p in i){let m=i[p],L=yield n.getOne(p);c.push({category:L?.name,recipes:m})}if(!c.length)return[];let[l,...u]=c.toSorted((p,m)=>p.category>m.category?1:-1);return l?.category?[l].concat(u):u.concat([l])});var Ce=(e,r)=>d(void 0,null,function*(){let t=e.paramMap.get("uuid");return a(C)?.getOne(t)});var we=(e,r)=>d(void 0,null,function*(){let t=e.paramMap.get("uuid");return a(ue)?.calculateRecipe(t)});var Re=(e,r)=>d(void 0,null,function*(){let t=e.paramMap.get("uuid"),n=a(C),o=a(de),i=(yield n.getOne(t))?.taxTemplateName;return i?o.getTemplateByName("tax",i):null});var be=(e,r)=>d(void 0,null,function*(){let t=a(le),n=a(_),s=(yield t.getProducts()).toSorted((p,m)=>p.name.localeCompare(m.name)),i=D(s,"category_id"),c=[];for(let p in i){let m=i[p],L=yield n.getOne(p);c.push({category:L?.name,products:m})}if(!c.length)return[];let[l,...u]=c.toSorted((p,m)=>p.category>m.category?1:-1);return l?.category?[l].concat(u):u.concat([l])});var Se=[{path:"",children:[{path:"",redirectTo:"home",pathMatch:"full"},{path:"home",loadComponent:()=>import("./chunk-WPKYH76Q.js").then(e=>e.ApplicationComponent)},{path:"add-recipe",loadComponent:()=>import("./chunk-HS22MBLN.js").then(e=>e.AddRecipeComponent)},{path:"edit-recipe/:uuid",loadComponent:()=>import("./chunk-HS22MBLN.js").then(e=>e.AddRecipeComponent),resolve:{recipe:Ce}},{path:"calc-recipe/:uuid",loadComponent:()=>import("./chunk-KP3QHGPX.js").then(e=>e.CalculateRecipeComponent),resolve:{result:we,template:Re}},{path:"recipes",loadComponent:()=>import("./chunk-NQ6LWMGT.js").then(e=>e.RecipesListComponent),resolve:{list:ye}},{path:"add-product",loadComponent:()=>import("./chunk-EZELU4YL.js").then(e=>e.AddProductComponent)},{path:"edit-product/:uuid",loadComponent:()=>import("./chunk-EZELU4YL.js").then(e=>e.AddProductComponent)},{path:"products",loadComponent:()=>import("./chunk-YUNFBYUV.js").then(e=>e.ProductListComponent),resolve:{list:be}},{path:"add-product-category",loadComponent:()=>import("./chunk-7EMERJLH.js").then(e=>e.AddCategoryComponent)},{path:"edit-product-category/:uuid",loadComponent:()=>import("./chunk-7EMERJLH.js").then(e=>e.AddCategoryComponent)},{path:"products-categories",loadComponent:()=>import("./chunk-YDBXJHN7.js").then(e=>e.CategoryListComponent)},{path:"add-recipe-category",loadComponent:()=>import("./chunk-76XDD5P6.js").then(e=>e.AddCategoryRecipeComponent)},{path:"edit-recipe-category/:uuid",loadComponent:()=>import("./chunk-76XDD5P6.js").then(e=>e.AddCategoryRecipeComponent)},{path:"recipes-categories",loadComponent:()=>import("./chunk-VMVIT3E7.js").then(e=>e.CategoryRecipeListComponent)},{path:"widgets",loadComponent:()=>import("./chunk-QVGY4GZB.js").then(e=>e.WidgetsPageComponent)},{path:"settings",loadComponent:()=>import("./chunk-3TSAXHKR.js").then(e=>e.SettingsComponent)}]}];var S="Service workers are disabled or not supported by this browser",w=class{serviceWorker;worker;registration;events;constructor(r,t){if(this.serviceWorker=r,!r)this.worker=this.events=this.registration=new P(n=>n.error(new Error(S)));else{let n=null,o=new A;this.worker=new P(u=>(n!==null&&u.next(n),o.subscribe(p=>u.next(p))));let s=()=>{let{controller:u}=r;u!==null&&(n=u,o.next(n))};r.addEventListener("controllerchange",s),s(),this.registration=this.worker.pipe(b(()=>r.getRegistration()));let i=new A;this.events=i.asObservable();let c=u=>{let{data:p}=u;p?.type&&i.next(p)};r.addEventListener("message",c),t?.get(U,null,{optional:!0})?.onDestroy(()=>{r.removeEventListener("controllerchange",s),r.removeEventListener("message",c)})}}postMessage(r,t){return new Promise(n=>{this.worker.pipe(v(1)).subscribe(o=>{o.postMessage(z({action:r},t)),n()})})}postMessageWithOperation(r,t,n){let o=this.waitForOperationCompleted(n),s=this.postMessage(r,t);return Promise.all([s,o]).then(([,i])=>i)}generateNonce(){return Math.round(Math.random()*1e7)}eventsOfType(r){let t;return typeof r=="string"?t=n=>n.type===r:t=n=>r.includes(n.type),this.events.pipe(j(t))}nextEventOfType(r){return this.eventsOfType(r).pipe(v(1))}waitForOperationCompleted(r){return new Promise((t,n)=>{this.eventsOfType("OPERATION_COMPLETED").pipe(j(o=>o.nonce===r),v(1),R(o=>{if(o.result!==void 0)return o.result;throw new Error(o.error)})).subscribe({next:t,error:n})})}get isEnabled(){return!!this.serviceWorker}},Oe=(()=>{class e{sw;messages;notificationClicks;subscription;get isEnabled(){return this.sw.isEnabled}pushManager=null;subscriptionChanges=new A;constructor(t){if(this.sw=t,!t.isEnabled){this.messages=h,this.notificationClicks=h,this.subscription=h;return}this.messages=this.sw.eventsOfType("PUSH").pipe(R(o=>o.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(R(o=>o.data)),this.pushManager=this.sw.registration.pipe(R(o=>o.pushManager));let n=this.pushManager.pipe(b(o=>o.getSubscription()));this.subscription=new P(o=>{let s=n.subscribe(o),i=this.subscriptionChanges.subscribe(o);return()=>{s.unsubscribe(),i.unsubscribe()}})}requestSubscription(t){if(!this.sw.isEnabled||this.pushManager===null)return Promise.reject(new Error(S));let n={userVisibleOnly:!0},o=this.decodeBase64(t.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),s=new Uint8Array(new ArrayBuffer(o.length));for(let i=0;i<o.length;i++)s[i]=o.charCodeAt(i);return n.applicationServerKey=s,new Promise((i,c)=>{this.pushManager.pipe(b(l=>l.subscribe(n)),v(1)).subscribe({next:l=>{this.subscriptionChanges.next(l),i(l)},error:c})})}unsubscribe(){if(!this.sw.isEnabled)return Promise.reject(new Error(S));let t=n=>{if(n===null)throw new Error("Not subscribed to push notifications.");return n.unsubscribe().then(o=>{if(!o)throw new Error("Unsubscribe failed!");this.subscriptionChanges.next(null)})};return new Promise((n,o)=>{this.subscription.pipe(v(1),b(t)).subscribe({next:n,error:o})})}decodeBase64(t){return atob(t)}static \u0275fac=function(n){return new(n||e)(B(w))};static \u0275prov=W({token:e,factory:e.\u0275fac})}return e})(),Ie=(()=>{class e{sw;versionUpdates;unrecoverable;get isEnabled(){return this.sw.isEnabled}constructor(t){if(this.sw=t,!t.isEnabled){this.versionUpdates=h,this.unrecoverable=h;return}this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY","NO_NEW_VERSION_DETECTED"]),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(S));let t=this.sw.generateNonce();return this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:t},t)}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(S));let t=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:t},t)}static \u0275fac=function(n){return new(n||e)(B(w))};static \u0275prov=W({token:e,factory:e.\u0275fac})}return e})();var Ae=new K("");function ke(){let e=a(E);if(!("serviceWorker"in navigator&&e.enabled!==!1))return;let r=a(Ae),t=a(Y),n=a(U);t.runOutsideAngular(()=>{let o=navigator.serviceWorker,s=()=>o.controller?.postMessage({action:"INITIALIZE"});o.addEventListener("controllerchange",s),n.onDestroy(()=>{o.removeEventListener("controllerchange",s)})}),t.runOutsideAngular(()=>{let o,{registrationStrategy:s}=e;if(typeof s=="function")o=new Promise(i=>s().subscribe(()=>i()));else{let[i,...c]=(s||"registerWhenStable:30000").split(":");switch(i){case"registerImmediately":o=Promise.resolve();break;case"registerWithDelay":o=Ee(+c[0]||0);break;case"registerWhenStable":o=Promise.race([n.whenStable(),Ee(+c[0])]);break;default:throw new Error(`Unknown ServiceWorker registration strategy: ${e.registrationStrategy}`)}}o.then(()=>navigator.serviceWorker.register(r,{scope:e.scope}).catch(i=>console.error("Service worker registration failed with:",i)))})}function Ee(e){return new Promise(r=>setTimeout(r,e))}function xe(e,r){return new w(e.enabled!==!1?navigator.serviceWorker:void 0,r)}var E=class{enabled;scope;registrationStrategy};function Me(e,r={}){return H([Oe,Ie,{provide:Ae,useValue:e},{provide:E,useValue:r},{provide:w,useFactory:xe,deps:[E,q]},O(ke)])}var Te={providers:[oe({eventCoalescing:!0}),ce(Se),ae(se()),he(),ie(),O(()=>{let e=a(_),r=a(x);return Promise.all([e.preloadCategories(),r.preloadCategories()])}),Me("ngsw-worker.js",{enabled:!re(),registrationStrategy:"registerWhenStable:30000"})]};function De(e,r){if(e&1){let t=Q();g(0,"button",0),X("click",function(){Z(t);let o=ee();return G(o.installPWA())}),y(1,"\u0423\u0441\u0442\u0430\u043D\u043E\u0432\u0438\u0442\u044C PWA"),f()}}var N=class e{deferredPrompt=null;showButton=!1;ngOnInit(){window.addEventListener("beforeinstallprompt",r=>{r.preventDefault(),this.deferredPrompt=r,this.showButton=!0})}installPWA(){return d(this,null,function*(){if(!this.deferredPrompt)return;this.deferredPrompt.prompt();let{outcome:r}=yield this.deferredPrompt.userChoice;r==="accepted"?(this.showButton=!1,console.log("PWA \u0443\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D\u0430!")):console.log("\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C \u043E\u0442\u043A\u0430\u0437\u0430\u043B\u0441\u044F \u043E\u0442 \u0443\u0441\u0442\u0430\u043D\u043E\u0432\u043A\u0438"),this.deferredPrompt=null,this.showButton=!1})}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=T({type:e,selectors:[["lg-pwa-install"]],decls:1,vars:1,consts:[[3,"click"]],template:function(t,n){t&1&&$(0,De,2,0,"button"),t&2&&J(n.showButton?0:-1)},styles:["lg-pwa-install[_ngcontent-%COMP%]{display:flex}button[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;border:none;padding:10px 20px;cursor:pointer;width:100%}button[_ngcontent-%COMP%]:hover{background-color:#0056b3}"]})};var F=class e{title="lasagna";static \u0275fac=function(t){return new(t||e)};static \u0275cmp=T({type:e,selectors:[["app-root"]],features:[te([])],decls:13,vars:15,consts:[[1,"app"],[3,"flat","link","size"]],template:function(t,n){t&1&&(V(0,"lg-pwa-install"),g(1,"main",0)(2,"lg-gap-column")(3,"lg-container")(4,"lg-gap-row")(5,"lg-button",1),y(6," My store "),f(),g(7,"lg-button",1),y(8," Widgets "),f(),g(9,"lg-button",1),y(10," Settings "),f()()(),g(11,"div"),V(12,"router-outlet"),f()()()),t&2&&(M(5),k("primary"),I("flat",!0)("link","/home")("size","small"),M(2),k("info"),I("flat",!0)("link","/widgets")("size","small"),M(2),k("danger"),I("flat",!0)("link","/settings")("size","small"))},dependencies:[pe,ge,me,fe,ve,N],styles:[".app[_ngcontent-%COMP%]{padding:32px 0}"]})};ne(F,Te).catch(e=>console.error(e));
