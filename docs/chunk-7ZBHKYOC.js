import{a as Xe}from"./chunk-VK7E3N73.js";import{b as ce}from"./chunk-5L4JZXUU.js";import{a as Ve,b as Ne,c as je,d as He,e as p,f as Qe,g as $e,h as We}from"./chunk-WRYQAUJM.js";import"./chunk-IF3ZC4A3.js";import{a as Ze}from"./chunk-6WYJVZZH.js";import"./chunk-QACA2TAM.js";import{a as se,b as qe,c as Je}from"./chunk-6L5REYZP.js";import{a as Ae,b as Fe}from"./chunk-55RDZAIO.js";import"./chunk-EREALSKM.js";import{a as re,b as le}from"./chunk-VOJQ4E4Z.js";import{a as ne}from"./chunk-I3VFKB54.js";import{a as Ke}from"./chunk-57LFT7RH.js";import{a as oe}from"./chunk-3BUOAPBA.js";import{a as ie}from"./chunk-YI33527W.js";import"./chunk-QNVOGMZG.js";import{a as Pe}from"./chunk-JUQUZQM3.js";import{a as Be}from"./chunk-7Q3OE7QW.js";import{a as te}from"./chunk-BKSOKEL4.js";import"./chunk-SNDQO5FA.js";import{j as Y,n as h,o as Ge,q as ee}from"./chunk-FDX4ZR27.js";import"./chunk-G4MUTO2L.js";import"./chunk-5KSZNU56.js";import"./chunk-57P3MUNF.js";import"./chunk-A2JL76VU.js";import{f as Me,i as Oe,m as Le,t as ze,v as U,w as P,x as R}from"./chunk-2FCEVR2H.js";import"./chunk-X7V7MNYG.js";import{o as ke,r as Ie,s as W,w as X}from"./chunk-B6IEM4UA.js";import{a as Ee}from"./chunk-652DFWNF.js";import{h as Te}from"./chunk-AQAYOHHC.js";import{$a as u,$b as m,Ac as j,Bb as he,Cb as F,Db as V,Eb as l,Ec as we,Fa as Z,Fb as s,Gb as O,Jb as De,Kb as D,Nb as d,Ob as g,Pb as $,Qb as N,Tb as L,Va as A,Vb as z,Wa as r,Wb as G,Ya as Q,aa as I,ac as Ce,bc as _,cc as q,eb as x,gb as M,ha as S,ia as y,jb as b,jc as J,kc as be,lc as K,na as ve,oa as E,pc as C,qb as ye,qc as v,rb as c,rc as Re,tb as xe,ub as f,va as Se,xb as T,zb as k}from"./chunk-MWDKUV2C.js";import"./chunk-DELOOZDJ.js";import"./chunk-2WH2EVR6.js";var Ye=p.object({name:p.string(),amount:p.number().or(p.string()),uuid:p.string().optional(),product_id:$e,recipe_id:p.lazy(()=>ae),unit:p.enum(["gram","portion","piece"])});var ae=p.object({name:p.string(),uuid:p.string().optional(),description:p.string(),ingredients:p.array(p.lazy(()=>Ye)),outcome_unit:Qe,outcome_amount:p.number().or(p.string()),taxTemplateName:p.string().optional(),category_id:p.string().nullable().optional(),createdAt:p.union([p.string(),p.number()]).optional(),updatedAt:p.union([p.string(),p.number()]).optional(),tags:p.array(p.string()).optional(),color:p.string().optional()});var tt=i=>({length:i}),it=(i,t)=>t.uuid;function nt(i,t){if(i&1){let e=D();l(0,"lg-button",4),d("click",function(){S(e);let o=g(2);return y(o.selectionZoneService.onSelection())}),m(1),C(2,"translate"),s()}i&2&&(f("success"),c("flat",!0)("size","small"),r(),_(" ",v(2,5,"select-many-label")," "))}function ot(i,t){if(i&1){let e=D();l(0,"lg-button",4),d("click",function(){S(e);let o=g(2);return y(o.deleteAllDrafts())}),m(1),C(2,"translate"),s()}i&2&&(f("danger"),c("flat",!0)("size","small"),r(),_(" ",v(2,5,"delete-all-label")," "))}function rt(i,t){if(i&1){let e=D();l(0,"lg-button",5),d("click",function(){S(e);let o=g(3);return y(o.deletedSelectedDrafts())}),m(1),C(2,"translate"),s()}if(i&2){let e=g();f("danger"),c("flat",!0)("disabled",!(e!=null&&e.size))("size","small"),r(),_(" ",v(2,6,"delete-selected-label")," ")}}function lt(i,t){i&1&&b(0,rt,3,8,"ng-template",1)}function st(i,t){i&1&&(m(0),C(1,"translate")),i&2&&_(" ",v(1,1,"draft.list-prefix.existing")," ")}function ct(i,t){i&1&&(m(0),C(1,"translate")),i&2&&_(" ",v(1,1,"draft.list-prefix.new")," ")}function at(i,t){if(i&1&&(l(0,"lg-gap-row",6)(1,"a",7),T(2,st,2,3)(3,ct,2,3),m(4),s(),l(5,"small",8),m(6),C(7,"translate"),C(8,"timeAgo"),s()()),i&2){let e=g().$implicit;c("center",!0),r(),c("routerLink","/recipes/draft/"+(e==null?null:e.uuid)),r(),k(!(e==null||e.meta==null)&&e.meta.uuid?2:3),r(2),_(" ",(e==null||e.data==null?null:e.data.name)??""," "),r(2),q(" ",v(7,6,"edited-at-label")," ",v(8,8,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," ")}}function pt(i,t){if(i&1&&b(0,at,9,10,"ng-template",3),i&2){let e=t.$implicit;c("uuid",e.uuid)}}function mt(i,t){if(i&1){let e=D();l(0,"lg-expander",0),C(1,"translate"),C(2,"translate"),l(3,"lg-inline-separated-group"),b(4,nt,3,7,"ng-template",1)(5,ot,3,7,"ng-template",1),T(6,lt,1,0,null,1),s(),l(7,"lg-card-list",2),d("onDeleteOne",function(o){S(e);let a=g();return y(a.deleteDraft(o==null?null:o.uuid))})("onSelected",function(o){S(e);let a=g();return y(a.selectionZoneService.putSelected(o))}),F(8,pt,1,1,null,3,it),s()()}if(i&2){let e,n,o=g();c("closeLabel",v(1,6,"drafts-close-label"))("openLabel",Re(2,8,"drafts-label",K(11,tt,(e=o.drafts())==null?null:e.length))),r(6),k((n=o.selectionZoneService.selected())?6:-1,n),r(),c("mode",o.selectionZoneService.selectionMode())("selectAll",o.selectionZoneService.selectAll())("deselectAll",o.selectionZoneService.deselectAll()),r(),V(o.drafts())}}var pe=class i{constructor(t,e,n){this._recipesRepository=t;this._notificationsService=e;this.selectionZoneService=n}drafts=E([]);Stores=X;get hidden(){return this.drafts()?.length===0?!0:null}ngOnInit(){let t=this._recipesRepository.getDraftRecipe();t&&this.drafts.set(t)}deleteAllDrafts(){this._recipesRepository.removeDraftMany(this.drafts().map(t=>t.uuid)).then(()=>{this.drafts.set([]),this._notificationsService.success("Drafts deleted")})}deletedSelectedDrafts(){let t=this.selectionZoneService.selected();t&&this._recipesRepository.removeDraftMany(Array.from(t)).then(()=>{this.drafts.update(e=>e.filter(n=>!t.has(n.uuid))),this._notificationsService.success("Drafts deleted")})}deleteDraft(t){t&&(this._recipesRepository.removeDraftRecipe(t),this.drafts.update(e=>e.filter(n=>n?.uuid!==t)))}static \u0275fac=function(e){return new(e||i)(u(ee),u(U),u(h))};static \u0275cmp=x({type:i,selectors:[["lg-draft-recipes-list"]],hostVars:1,hostBindings:function(e,n){e&2&&ye("hidden",n.hidden)},features:[J([h])],decls:1,vars:1,consts:[[3,"closeLabel","openLabel"],["lgInlineSeparatedGroup",""],[2,"--card-bg","#bee5ff",3,"onDeleteOne","onSelected","mode","selectAll","deselectAll"],["lgCardListItem","","type","draft",3,"uuid"],[3,"click","flat","size"],[3,"click","flat","disabled","size"],[3,"center"],["lgExpand","",3,"routerLink"],[1,"text-muted","text-cursive"]],template:function(e,n){if(e&1&&T(0,mt,10,13,"lg-expander",0),e&2){let o;k((o=n.drafts())!=null&&o.length?0:-1)}},dependencies:[P,R,Je,se,W,ne,Ke,Y,We,le,re],encapsulation:2})};var me=class i{constructor(t){this.elementRef=t}lgClickOutside=new Z;onClick(t){this.elementRef.nativeElement.contains(t.target)||this.lgClickOutside.emit(t)}static \u0275fac=function(e){return new(e||i)(u(Se))};static \u0275dir=M({type:i,selectors:[["","lgClickOutside",""]],hostBindings:function(e,n){e&1&&d("click",function(a){return n.onClick(a)},A)("touchstart",function(a){return n.onClick(a)},A)("mousedown",function(a){return n.onClick(a)},A)("mouseup",function(a){return n.onClick(a)},A)},outputs:{lgClickOutside:"lgClickOutside"}})};var dt=[[["","lgDropdownAnchor",""]],"*"],ut=["[lgDropdownAnchor]","*"],de=class i{constructor(){}display=E(!1);onClick(t){t.stopPropagation()}toggleDropdown(){this.display.set(!this.display())}closeDropdown(){this.display.set(!1)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=x({type:i,selectors:[["lg-dropdown"]],hostBindings:function(e,n){e&1&&d("click",function(a){return n.onClick(a)})},ngContentSelectors:ut,decls:5,vars:2,consts:[[1,"lg-dropdown",3,"lgClickOutside"],[1,"lg-dropdown-anchor",3,"click"],[1,"lg-dropdown-content"]],template:function(e,n){e&1&&($(dt),l(0,"div",0),d("lgClickOutside",function(){return n.closeDropdown()}),l(1,"div",1),d("click",function(){return n.toggleDropdown()}),N(2),s(),l(3,"div",2),N(4,1),s()()),e&2&&xe("lg-dropdown-open",n.display())},dependencies:[me],styles:["[_nghost-%COMP%]{display:block;position:relative;z-index:2}.lg-dropdown[_ngcontent-%COMP%]{position:relative;display:inline-block}.lg-dropdown-content[_ngcontent-%COMP%]{display:none;position:absolute;top:calc(100% + 8px);background-color:#f9f9f9;min-width:160px;box-shadow:0 8px 16px #0003;z-index:1;border-radius:16px;padding:16px}.lg-dropdown-open[_ngcontent-%COMP%]   .lg-dropdown-content[_ngcontent-%COMP%]{display:block}.lg-dropdown-item[_ngcontent-%COMP%]{color:#000;padding:12px 16px;text-decoration:none;display:block}.lg-dropdown-item[_ngcontent-%COMP%]:hover{background-color:#f1f1f1}"]})};var ue=class i{constructor(t){this.templateRef=t}static \u0275fac=function(e){return new(e||i)(u(Q))};static \u0275dir=M({type:i,selectors:[["","lgGroupingSortingContainer",""]]})};var ge=class i{constructor(){}router=I(Ie);aRouter=I(ke);context;sortChange=new Z;groupChange=new Z;groupingParam=ce("groupBy");sortDirection=ce("sortDirection");sortField=ce("sortField");defaultDirection="asc";sorting=E({field:"name",direction:this.defaultDirection,group:"category"});sortingEffect=j(()=>{let t=this.sorting();this.sortChange.emit(t)});ngOnInit(){let t=this.aRouter.snapshot.queryParams,e=this.groupingParam(),n=this.sortDirection(),o=this.sortField();this.sorting.set({field:o?.toString()||"name",direction:n?n==="asc"?"asc":"desc":this.defaultDirection,group:e?.toString()||"category"})}onSortChange(t){debugger;console.log("Sorting changed",t,this.sorting()),this.sorting.set({field:t.field||this.sorting().field,direction:t.direction||this.sorting().direction,group:t.group||this.sorting().group}),this.sortChange.emit(this.sorting()),this.router.navigate([],{queryParams:{sortField:t.field||this.sorting().field,sortDirection:t.direction||this.sorting().direction,groupBy:t.group||this.sorting().group},relativeTo:this.aRouter}).then(()=>{window.location.reload()})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=x({type:i,selectors:[["lg-grouping-sorting"]],contentQueries:function(e,n,o){if(e&1&&L(o,ue,5),e&2){let a;z(a=G())&&(n.context=a.first)}},outputs:{sortChange:"sortChange",groupChange:"groupChange"},decls:25,vars:33,consts:[["lgDropdownAnchor","",3,"size"],[3,"size"],[3,"click","size","flat"]],template:function(e,n){e&1&&(l(0,"lg-gap-row")(1,"lg-dropdown")(2,"lg-button",0),m(3),s(),l(4,"lg-gap-column",1)(5,"lg-button",2),d("click",function(){return n.onSortChange({group:"category"})}),m(6," Category "),s(),l(7,"lg-button",2),d("click",function(){return n.onSortChange({group:"createdAt"})}),m(8," Date "),s()()(),l(9,"lg-dropdown")(10,"lg-button",0),m(11),s(),l(12,"lg-gap-column",1)(13,"lg-button",2),d("click",function(){return n.onSortChange({field:"name"})}),m(14," Name "),s(),l(15,"lg-button",2),d("click",function(){return n.onSortChange({field:"createdAt"})}),m(16," Date "),s()()(),l(17,"lg-dropdown")(18,"lg-button",0),m(19),s(),l(20,"lg-gap-column",1)(21,"lg-button",2),d("click",function(){return n.onSortChange({direction:"asc"})}),m(22," Ascending "),s(),l(23,"lg-button",2),d("click",function(){return n.onSortChange({direction:"desc"})}),m(24," Descending "),s()()()()),e&2&&(r(2),c("size","small"),r(),_(" Group by: ",n.sorting().group," "),r(),c("size","small"),r(),f("warning"),c("size","small")("flat",!0),r(2),f("warning"),c("size","small")("flat",!0),r(3),c("size","small"),r(),_(" Sort by: ",n.sorting().field," "),r(),c("size","small"),r(),f("warning"),c("size","small")("flat",!0),r(2),f("warning"),c("size","small")("flat",!0),r(3),c("size","small"),r(),_(" Sort direction: ",n.sorting().direction," "),r(),c("size","small"),r(),f("warning"),c("size","small")("flat",!0),r(2),f("warning"),c("size","small")("flat",!0))},dependencies:[P,R,de,ie],encapsulation:2})};var B=class i{constructor(t){this.templateRef=t}static \u0275fac=function(e){return new(e||i)(u(Q))};static \u0275dir=M({type:i,selectors:[["","lgGroupingTail",""]]})};var gt=["*"];function ft(i,t){if(i&1){let e=D();l(0,"lg-checkbox",4),d("onCheckboxChanged",function(o){S(e);let a=g();return y(a.onChanges(o))}),s()}if(i&2){let e=g();c("size","medium")("formControl",e.selected)("value",e.key())}}function _t(i,t){if(i&1){let e=D();l(0,"lg-button",5),d("click",function(){S(e);let o=g();return y(o.selectionZoneService.putDelete(o.key()))}),O(1,"mat-icon",6),s()}i&2&&(f("danger"),c("size","tiny")("icon",!0))}var fe=class i{constructor(t){this.selectionZoneService=t}key=we(Ee());items;selected=new Oe;effectMode=j(()=>{console.log("Selection mode changed",this.selectionZoneService.selectionMode()),this.selectionZoneService.selectionMode()&&this.selected.reset()});effectSelectAll=j(()=>{this.selectionZoneService.selectAll()?this.selected.setValue(!0):this.selectionZoneService.deselectAll()&&this.selected.setValue(!1)});onChanges(t){this.selectionZoneService.putSelected([!!t,this.key()])}static \u0275fac=function(e){return new(e||i)(u(h,12))};static \u0275cmp=x({type:i,selectors:[["lg-selectable-section"]],contentQueries:function(e,n,o){if(e&1&&L(o,se,4),e&2){let a;z(a=G())&&(n.items=a)}},inputs:{key:[1,"key"]},ngContentSelectors:gt,decls:5,vars:2,consts:[[1,"lg-selectable-section"],[3,"size","formControl","value"],[1,"lg-selectable-section__inner"],[3,"style","size","icon"],[3,"onCheckboxChanged","size","formControl","value"],[3,"click","size","icon"],["aria-hidden","false","fontIcon","close"]],template:function(e,n){e&1&&($(),l(0,"section",0),T(1,ft,1,3,"lg-checkbox",1),l(2,"div",2),N(3),s(),T(4,_t,2,4,"lg-button",3),s()),e&2&&(r(),k(n.selectionZoneService.selectionMode()==="selection"?1:-1),r(3),k(n.selectionZoneService.selectionMode()==="selection"?4:-1))},dependencies:[ze,Me,Le,qe,R,oe],styles:[".lg-checkbox[_ngcontent-%COMP%]{--control-bg: #abc2ff;--control-bg-selected: #abc2ff}.lg-selectable-section[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}"]})};var Ct=i=>({$implicit:i}),vt=(i,t)=>t==null?null:t.field;function St(i,t){if(i&1&&(l(0,"div",5)(1,"lg-selectable-section",6)(2,"div",7),De(3,8),s()()()),i&2){let e=t.$implicit,n=g(2);r(),c("key",e.uuid),r(2),c("ngTemplateOutlet",n.groupingTailDirective.templateRef)("ngTemplateOutletContext",K(3,Ct,e))}}function yt(i,t){if(i&1&&(l(0,"section",1)(1,"header",2)(2,"lg-title",3),m(3),s()(),l(4,"div",4),F(5,St,4,5,"div",5,he),s()()),i&2){let e=t.$implicit;r(2),c("level",3),r(),_(" ",e==null?null:e.field," "),r(2),V(e==null?null:e.items)}}var _e=class i{constructor(t){this.selectionZoneService=t}sortResult;groupingTailDirective;static \u0275fac=function(e){return new(e||i)(u(h,8))};static \u0275cmp=x({type:i,selectors:[["lg-grouping-tails"]],contentQueries:function(e,n,o){if(e&1&&L(o,B,5),e&2){let a;z(a=G())&&(n.groupingTailDirective=a.first)}},inputs:{sortResult:"sortResult"},decls:3,vars:0,consts:[[1,"grouping-tails"],[1,"grouping-tails__section"],[1,"grouping-tails__header"],[3,"level"],[1,"grouping-tails__content"],[1,"grouping-tails__item"],[3,"key"],[1,"grouping-tails__item-inner"],[3,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(e,n){e&1&&(l(0,"section",0),F(1,yt,7,2,"section",1,vt),s()),e&2&&(r(),V(n.sortResult==null?null:n.sortResult.groups))},dependencies:[te,Te,fe],styles:[".grouping-tails[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:32px}.grouping-tails__section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}.grouping-tails__content[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:16px}.grouping-tails__item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.grouping-tails__item-inner[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;padding:16px;border-radius:32px;background-color:#fff}"]})};var xt=()=>["recipe"];function ht(i,t){if(i&1){let e=D();l(0,"lg-button",8),d("click",function(){S(e);let o=g();return y(o.exportRecipes(o.selectionZoneService.selected()))}),m(1),C(2,"translate"),s()}i&2&&(f("info"),c("flat",!0)("size","small"),r(),_(" ",v(2,5,"export-label")," recipes "))}function Dt(i,t){if(i&1&&(l(0,"span"),m(1),s()),i&2){let e=t.$implicit;r(),Ce(e==null?null:e.name)}}function bt(i,t){if(i&1){let e=D();l(0,"lg-import",9),C(1,"translate"),d("onDone",function(){S(e);let o=g();return y(o.loadRecipes())}),b(2,Dt,2,1,"ng-template",10),s()}if(i&2){let e=g();c("label",v(1,3,"import-label")+" products")("schema",e.RecipeScheme)("storeName",e.Stores.RECIPES)}}function Rt(i,t){if(i&1&&(l(0,"lg-gap-column")(1,"a",11),m(2),s(),l(3,"lg-gap-row")(4,"lg-button",12),m(5),C(6,"translate"),s(),l(7,"small",13),m(8),C(9,"translate"),C(10,"timeAgo"),s()()()),i&2){let e=t.$implicit;r(),c("routerLink","/recipes/edit/"+e.uuid),r(),Ce(e.name),r(2),f("primary"),c("size","small")("link","/recipes/calculate/"+e.uuid)("flat",!0),r(),_(" ",v(6,10,"recipes.calculate-btn")," "),r(3),q(" ",v(9,12,"edited-at-label")," ",v(10,14,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," ")}}var et=class i{constructor(t,e,n,o){this._recipesRepository=t;this._notificationsService=e;this._transferDataService=n;this.selectionZoneService=o;this._recipesRepository.recipes$.subscribe({next:a=>{console.log("recipes loaded",a)},error:a=>{}}),this.selectionZoneService.onDelete.pipe(Ae(this.destroyRef)).subscribe(a=>{this.deleteRecipe(a)})}destroyRef=I(ve);recipes=Fe(I(Xe));Stores=X;RecipeScheme=ae;ngOnInit(){this.loadRecipes()}deleteRecipe(t){t&&this._recipesRepository.deleteOne(t).then(()=>{this._notificationsService.success("Recipe deleted"),this.loadRecipes()})}loadRecipes(){return this._recipesRepository.loadRecipes()}exportRecipes(t){return this._transferDataService.exportTable("recipesStore","json",{selected:Array.from(t||[])})}static \u0275fac=function(e){return new(e||i)(u(ee),u(U),u(Ge),u(h))};static \u0275cmp=x({type:i,selectors:[["lg-recipes-list"]],features:[J([h])],decls:18,vars:13,consts:[[3,"icon","link","size"],["aria-hidden","false","fontIcon","add"],["lgInlineSeparatedGroup",""],[3,"center"],[3,"size"],[3,"selectionTypes"],[3,"sortResult"],["lgGroupingTail",""],[3,"click","flat","size"],[3,"onDone","label","schema","storeName"],["lgImportRowTpl",""],[3,"routerLink"],[3,"size","link","flat"],["lgPull","",1,"text-muted","text-cursive"]],template:function(e,n){e&1&&(l(0,"lg-controls-bar")(1,"lg-button",0),O(2,"mat-icon",1),s(),l(3,"lg-inline-separated-group"),b(4,ht,3,7,"ng-template",2)(5,bt,3,5,"ng-template",2),s()(),l(6,"lg-fade-in")(7,"lg-container")(8,"lg-gap-row",3)(9,"lg-title"),m(10),C(11,"translate"),s()(),O(12,"lg-draft-recipes-list"),l(13,"lg-gap-column",4),O(14,"lg-grouping-sorting")(15,"lg-selection-tools",5),s(),l(16,"lg-grouping-tails",6),b(17,Rt,11,16,"ng-template",7),s()()()),e&2&&(r(),f("success"),c("icon",!0)("link","/recipes/add")("size","medium"),r(7),c("center",!0),r(2),_(" ",v(11,10,"recipes.list-title")," "),r(3),c("size","medium"),r(2),c("selectionTypes",be(12,xt)),r(),c("sortResult",n.recipes()))},dependencies:[P,R,W,oe,Pe,te,Ne,Ve,Be,je,He,ne,Ze,Y,pe,le,re,ge,_e,B,ie],styles:["[_nghost-%COMP%]{display:block}"]})};export{et as RecipesListComponent};
