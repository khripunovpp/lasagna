import{a as Ae,b as Ge}from"./chunk-MLWLSOXH.js";import"./chunk-VKWU2J5T.js";import{a as We}from"./chunk-DECIG3UW.js";import{a as Ne}from"./chunk-LMX6ZEJS.js";import{a as Fe,c as Ve,d as J}from"./chunk-2W3CALAX.js";import{a as De}from"./chunk-BREASPLR.js";import{a as z}from"./chunk-QILXMN5K.js";import{a as Ee}from"./chunk-MTKE3TKK.js";import{a as G}from"./chunk-KB5VWG36.js";import"./chunk-ACHQGNI7.js";import{a as Re,b as M}from"./chunk-4GMAHVOM.js";import{a as Pe}from"./chunk-2AG3W6NR.js";import{a as A}from"./chunk-6OA5NOZV.js";import"./chunk-SNDQO5FA.js";import{a as Ce,d as he,m as Ie,p as Me}from"./chunk-EKJQYQH6.js";import"./chunk-PPZB7COH.js";import"./chunk-5KSZNU56.js";import"./chunk-TCTFHDUI.js";import"./chunk-H5OOR6F4.js";import{a as F,c as ve,f as T,g as ye,h as V,i as B,j as N,k as be,l as we,n as xe,o as Se,q as ke,s as I,t as Te,v as Be,w as O}from"./chunk-N4C567K3.js";import"./chunk-6D4L3YT6.js";import"./chunk-2UE5YCBQ.js";import"./chunk-652DFWNF.js";import{k as _e}from"./chunk-GM4BKM5X.js";import{$ as ne,$b as y,Ab as le,Ac as ge,Bb as E,Cb as D,Cc as fe,Db as l,Dc as W,Eb as a,Fb as d,Jb as S,Mb as v,Nb as p,V as te,Va as r,_a as P,_b as m,ac as se,cc as b,db as _,dc as w,ec as x,fc as ce,ga as u,gc as me,ha as g,hc as pe,ib as ie,ic as k,ma as oe,na as f,oc as X,qb as c,qc as Z,rb as re,sb as Q,tb as ae,wb as C,yb as h,yc as de,zc as ue}from"./chunk-ESI6QU3H.js";import"./chunk-DELOOZDJ.js";import{a as $,f as ee}from"./chunk-2WH2EVR6.js";function Le(n,e){if(n&1){let t=S();l(0,"lg-gap-column",0)(1,"lg-control",6)(2,"lg-input",4),x("ngModelChange",function(i){u(t);let s=p(2);return w(s.product.name,i)||(s.product.name=i),g(i)}),a()(),l(3,"lg-control",6)(4,"lg-number-input",4),x("ngModelChange",function(i){u(t);let s=p(2);return w(s.product.amount,i)||(s.product.amount=i),g(i)}),a()(),l(5,"lg-control",6)(6,"lg-number-input",4),x("ngModelChange",function(i){u(t);let s=p(2);return w(s.product.price,i)||(s.product.price=i),g(i)}),a(),l(7,"div"),m(8),a()(),l(9,"lg-button",7),v("click",function(){u(t);let i=p(2);return g(i.addProduct())}),m(10,"Add product"),a()()}if(n&2){let t=p(2);c("size","medium"),r(),c("label","Name"),r(),b("ngModel",t.product.name),c("placeholder","Name"),r(),c("label","Amount"),r(),b("ngModel",t.product.amount),c("placeholder","Amount"),r(),c("label","Price"),r(),b("ngModel",t.product.price),c("placeholder","Price"),r(2),y(t.product.unit)}}function je(n,e){if(n&1){let t=S();d(0,"video",2),l(1,"lg-gap-column")(2,"lg-gap-row",3)(3,"lg-input",4),x("ngModelChange",function(i){u(t);let s=p();return w(s.barcode,i)||(s.barcode=i),g(i)}),a(),l(4,"lg-button",5),v("click",function(){u(t);let i=p();return g(i.onBarcodeManualInput())}),m(5,"Search"),a(),l(6,"lg-button",5),v("click",function(){u(t);let i=p();return g(i.clear())}),m(7,"Clear"),a()(),C(8,Le,11,11,"lg-gap-column",0),a()}if(n&2){let t=p();r(3),b("ngModel",t.barcode),c("placeholder","Barcode"),r(5),h(t.showProductForm()&&t.productResult()?8:-1)}}function qe(n,e){if(n&1){let t=S();l(0,"lg-button",5),v("click",function(){u(t);let i=p();return g(i.openScanner())}),m(1,"Scan"),a()}}var L=class n{constructor(e,t,o,i){this._openFoodFactsService=e;this._arcodeReaderService=t;this._productRepository=o;this._notificationService=i}productAdded=fe();barcode=f("");product={name:"",price:0,amount:0,unit:"gram"};lockRequest=!1;showFormInitially=W(!1);showScanerInitially=W(!1);showScanner=f(!1);showProductForm=f(!1);userResource=ge({request:()=>({id:this.barcode()}),loader:({request:e,abortSignal:t})=>this.lockRequest||!e.id?Promise.resolve(null):(this._notificationService.info("Barcode detected: "+e.id),this.lockRequest=!0,this._openFoodFactsService.getProductByBarcode(e.id).then(o=>(this.showProductForm.set(!0),o)))});productResult=de(()=>{let e=this.userResource.value();if(e?.status===1){let t=e.product;return this.product.name=(t.product_name||"")+" ("+(t.brands||"")+")",this.product.amount=this.extractAmount(t),this.product.unit=this.detectUnit(t),$({},this.product)}return null});onBarcodeManualInput(){this.lockRequest=!1}openScanner(){this.showScanner.set(!0),this.startCamera()}clear(){this.barcode.set(""),this.product={name:"",price:0,amount:0,unit:"gram"},this.showProductForm.set(!1),this.lockRequest=!1}closeScanner(){this.showScanner.set(!1),this.stopCamera()}extractAmount(e){if(e.quantity){let t=e.quantity.match(/\d+/);return t?+t[0]:0}return 0}stopCamera(){this._arcodeReaderService.stopCamera()}detectUnit(e){let t=(e.serving_quantity_unit||"").toLowerCase();return t.includes("g")||t.includes("ml")?"gram":t.includes("pc")||t.includes("\u0448\u0442")?"piece":"gram"}addProduct(){this._productRepository.addOne(Ce.fromRaw({name:this.product.name,price:this.product.price,amount:this.product.amount,unit:this.product.unit,source:"openfoodfacts",category_id:"",tags:[],createdAt:Date.now()})).then(e=>{this.productAdded.emit({uuid:e,name:this.product.name}),this.product={name:"",price:0,amount:0,unit:"gram"},this.barcode.set(""),this.lockRequest=!1})}startCamera(){return this._arcodeReaderService.startCamera("video",e=>{e&&this.barcode.set(e)})}ngAfterViewInit(){return ee(this,null,function*(){this.showScanerInitially()&&(this.showScanner.set(!0),yield this.startCamera())})}ngOnDestroy(){this.stopCamera()}static \u0275fac=function(t){return new(t||n)(P(Ie),P(he),P(Me),P(Be))};static \u0275cmp=_({type:n,selectors:[["lg-barcode-add-product-widget"]],inputs:{showFormInitially:[1,"showFormInitially"],showScanerInitially:[1,"showScanerInitially"]},outputs:{productAdded:"productAdded"},features:[k([])],decls:6,vars:4,consts:[[3,"size"],[3,"top","mobileMode"],["id","video"],["lgExpand",""],["lgExpand","","lgParseMath","",3,"ngModelChange","ngModel","placeholder"],[3,"click"],[3,"label"],["lgShrink","",3,"click"]],template:function(t,o){t&1&&(l(0,"lg-gap-column",0)(1,"lg-title"),m(2," \u{1F4F7} Scan barcode or enter manually "),a(),l(3,"lg-gap-row",1),C(4,je,9,3)(5,qe,2,0,"lg-button"),a()()),t&2&&(c("size","medium"),r(3),c("top",!0)("mobileMode",!0),r(),h(o.showScanner()?4:5))},dependencies:[I,T,N,G,z,A,O,Ee,Ve,M,Fe,De,J],encapsulation:2})};var Ue=(n,e)=>e.value;function He(n,e){if(n&1){let t=S();l(0,"lg-button",2),v("click",function(){let i=u(t),s=i.$implicit,R=i.$index,Je=p();return g(Je.onClickItem(s,R))}),m(1),a()}if(n&2){let t=e.$implicit,o=e.$index,i=e.$count,s=p();ae(t.style||"default"),Q("buttons-group__item--active",s.activeIndex()==o),c("active",s.activeIndex()==o)("flat",s.flat)("noScale",!0)("size",t.size||"default")("noLeftRadius",o===i-1)("noRightRadius",o===0)("noRadius",o!==0&&o!==i-1),r(),se(" ",t.label," ")}}var U=class n{flat=!1;items=W();activeIndex=f(0);value=f("");effect=ue(()=>{let e=this.items()?.findIndex(t=>t.value===this.value())??-1;this.activeIndex.set(e===-1?0:e)});onClickItem(e,t){this.activeIndex.set(t),this.writeValue(e.value),e.onClick?.()}onChange=()=>{};onTouched=()=>{};writeValue(e){this._change(e)}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}onChangeInput(e){this._change(e.target.value)}_change(e){this.value.set(e),this.onChange(this.value())}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=_({type:n,selectors:[["lg-buttons-group"]],inputs:{flat:"flat",items:[1,"items"]},features:[k([{provide:F,useExisting:te(()=>n),multi:!0}])],decls:3,vars:2,consts:[[1,"buttons-group"],[1,"buttons-group__item",3,"active","flat","noScale","style","size","noLeftRadius","noRightRadius","noRadius","buttons-group__item--active"],[1,"buttons-group__item",3,"click","active","flat","noScale","size","noLeftRadius","noRightRadius","noRadius"]],template:function(t,o){t&1&&(l(0,"div",0),E(1,He,2,12,"lg-button",1,Ue),a()),t&2&&(Q("buttons-group--flat",o.flat),r(),D(o.items()))},dependencies:[O],styles:[`.buttons-group{display:flex}.buttons-group lg-button{flex:1}.buttons-group lg-button button{width:100%}.buttons-group--flat{gap:16px;width:100%}
`],encapsulation:2})};var Ye={powder:{mass:n=>n*5+n},leaf:{mass:n=>n*5+n},mass:{powder:n=>n/6,leaf:n=>n/6}},Ke=n=>n*5,Qe=n=>n*5/6,Xe=(n,e)=>n/e,H=class{constructor(e,t=1){this.type=e;this.bloom=t}convertToBase(e,t,o=1){let i=Xe(this.bloom,o);return(Ye[this.type]?.[e]?.(t)||t)*i}convertToWater(e,t){return this.type==="mass"&&e==="mass"||this.type==="leaf"||e==="leaf"?0:this.type==="mass"?Ke(t):e==="mass"?Qe(t):0}};function Ze(n,e){if(n&1&&(l(0,"div",4),d(1,"div",5),l(2,"div",6),m(3),a()()),n&2){let t=e.$implicit,o=p();re("left",(t-o.min)/(o.max-o.min)*100,"%"),r(3),y(t)}}var Y=class n{constructor(){}min=0;max=100;step=1;tickInterval;customTicks;value="";get ticks(){if(this.customTicks)return this.customTicks;if(this.tickInterval){let e=[];for(let t=this.min;t<=this.max;t+=this.tickInterval)e.push(t);return e}return[]}onChange=()=>{};onTouched=()=>{};writeValue(e){this.changeValue(e)}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}changeValue(e){this.value=e,this.onChange(this.value)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=_({type:n,selectors:[["lg-range"]],inputs:{min:"min",max:"max",step:"step",tickInterval:"tickInterval",customTicks:"customTicks"},features:[k([{provide:F,useExisting:n,multi:!0}])],decls:5,vars:4,consts:[[1,"range-wrapper"],["type","range",1,"custom-range",3,"ngModelChange","min","max","step","ngModel"],[1,"ticks"],[1,"tick",3,"left"],[1,"tick"],[1,"tick-line"],[1,"label"]],template:function(t,o){t&1&&(l(0,"div",0)(1,"input",1),x("ngModelChange",function(s){return w(o.value,s)||(o.value=s),s}),v("ngModelChange",function(s){return o.changeValue(s)}),a(),l(2,"div",2),E(3,Ze,4,3,"div",3,le),a()()),t&2&&(r(),c("min",o.min)("max",o.max)("step",o.step),b("ngModel",o.value),r(2),D(o.ticks))},dependencies:[I,ve,we,T,N],styles:[".range-wrapper[_ngcontent-%COMP%]{position:relative;width:100%;padding-bottom:30px}.custom-range[_ngcontent-%COMP%]{width:100%;-webkit-appearance:none;background:transparent;position:relative;z-index:2;margin:0}.custom-range[_ngcontent-%COMP%]::-webkit-slider-runnable-track{height:6px;background:#ddd;border-radius:3px}.custom-range[_ngcontent-%COMP%]::-moz-range-track{height:6px;background:#ddd;border-radius:3px}.custom-range[_ngcontent-%COMP%]::-webkit-slider-thumb{-webkit-appearance:none;height:20px;width:20px;background:var(--accent-color);border-radius:50%;margin-top:-7px;cursor:pointer}.custom-range[_ngcontent-%COMP%]::-moz-range-thumb{height:20px;width:20px;background:var(--accent-color);border-radius:50%;cursor:pointer}.ticks[_ngcontent-%COMP%]{position:absolute;top:28px;left:2.4%;right:2.4%;height:30px;pointer-events:none}.tick[_ngcontent-%COMP%]{position:absolute;text-align:center;transform:translate(-50%)}.tick-line[_ngcontent-%COMP%]{width:1px;height:10px;background-color:#666;margin:0 auto}.label[_ngcontent-%COMP%]{font-size:10px;color:#666;margin-top:2px;display:block}"]})};function $e(n,e){n&1&&m(0," \u{1F35A} ")}function et(n,e){n&1&&m(0," \u{1F343} ")}function tt(n,e){n&1&&m(0," \u{1F9EB} ")}function nt(n,e){n&1&&(l(0,"div"),m(1," With "),a())}function ot(n,e){n&1&&(l(0,"div"),m(1," And "),a())}function it(n,e){n&1&&(l(0,"div"),m(1," And "),a())}function rt(n,e){n&1&&(d(0,"br"),m(1,"included "))}function at(n,e){if(n&1&&(l(0,"lg-gap-column",9)(1,"div"),C(2,nt,2,0,"div"),C(3,ot,2,0,"div")(4,it,2,0,"div"),a(),l(5,"lg-gap-row",10)(6,"div"),m(7),X(8,"number"),a(),m(9," \u{1F4A7} "),a(),l(10,"div"),m(11," ml of water "),C(12,rt,2,0),a()()),n&2){let t,o,i,s=p(),R=pe(12);c("size","small")("position","center"),r(2),h((t=R)==="mass"?2:-1),r(),h((o=R)==="powder"?3:o==="leaf"?4:-1),r(2),c("size","small"),r(2),y(Z(8,7,s.waterNeeded(),"1.0-2")),r(5),h((i=R)==="mass"?12:-1)}}var K=class n{constructor(){this.form.valueChanges.pipe(We(this.destroyRef)).subscribe(e=>{let t=parseInt(String(e?.from?.amount));if(isNaN(t))return;let o=new H(e?.from?.type,e?.from?.bloom),i=o.convertToBase(e?.to?.type,t,e?.to?.bloom),s=o.convertToWater(e?.to?.type,i);this.result.set(i),this.waterNeeded.set(s)})}result=f(0);waterNeeded=f(0);destroyRef=ne(oe);form=new V({from:new V({type:new B("mass"),amount:new B(null),bloom:new B(140)}),to:new V({type:new B("powder"),bloom:new B(200)})});typeButtons=[{label:"powder",value:"powder",style:"secondary"},{label:"leaf",value:"leaf",style:"secondary"},{label:"mass",value:"mass",style:"secondary"}];static \u0275fac=function(t){return new(t||n)};static \u0275cmp=_({type:n,selectors:[["lg-jelly-widget"]],decls:29,vars:25,consts:[[3,"formGroup"],[3,"bottom","mobileMode"],["formGroupName","from"],["formControlName","amount",3,"placeholder"],["ngProjectAs","after",5,["after"]],["formControlName","bloom",3,"min","max","step","tickInterval"],["formControlName","type",3,"items"],["formGroupName","to"],[1,"text-center",3,"strictCenter"],["lgShrink","",3,"size","position"],[2,"font-size","2rem",3,"size"]],template:function(t,o){if(t&1&&(l(0,"lg-gap-column")(1,"form",0)(2,"lg-gap-row",1)(3,"lg-gap-column",2),m(4," In recipe you have "),l(5,"lg-input",3)(6,"div",4),m(7," grams of "),a()(),d(8,"lg-range",5)(9,"lg-buttons-group",6),a(),l(10,"lg-gap-column",7),ce(11)(12),l(13,"lg-gap-row",8)(14,"lg-gap-column",9)(15,"div"),m(16," You need "),a(),l(17,"lg-gap-row",10)(18,"div"),m(19),X(20,"number"),a(),C(21,$e,1,0)(22,et,1,0)(23,tt,1,0),a(),l(24,"div"),m(25," grams of "),a()(),C(26,at,13,10,"lg-gap-column",9),a(),d(27,"lg-range",5)(28,"lg-buttons-group",6),a()()()()),t&2){let i;r(),c("formGroup",o.form),r(),c("bottom",!0)("mobileMode",!0),r(3),c("placeholder","Amount"),r(3),c("min",120)("max",220)("step",10)("tickInterval",20),r(),c("items",o.typeButtons),o.form.value==null||o.form.value.from==null||o.form.value.from.type,r(3);let s=me(o.form.value==null||o.form.value.to==null?null:o.form.value.to.type);r(),c("strictCenter",!0),r(),c("size","small")("position","center"),r(3),c("size","small"),r(2),y(Z(20,22,o.result(),"1.0-2")),r(2),h((i=s)==="powder"?21:i==="leaf"?22:i==="mass"?23:-1),r(5),h(o.waterNeeded()?26:-1),r(),c("min",120)("max",220)("step",10)("tickInterval",20),r(),c("items",o.typeButtons)}},dependencies:[I,be,T,ye,Te,xe,ke,Se,G,z,M,U,_e,J,Y],styles:[`:host{--control-bg: #fcfcfc}lg-eggs-widget{display:flex}.eggs-widget{display:flex;flex-direction:column}.eggs-widget__eggs{display:flex;align-items:flex-end;gap:8px}.eggs-widget__eggs img{width:40px}.eggs-widget__egg{display:flex;align-items:center;justify-content:center;flex:1;flex-direction:column;white-space:nowrap;gap:8px;background-color:var(--control-bg);border-radius:24px;padding:16px}.eggs-widget__egg:first-child img{transform:scale(.8)}.eggs-widget__egg:last-child img{transform:scale(1.2)}.eggs-widget__egg.selected{background-color:#61b789}.eggs-widget__egg.selected:first-child{background-color:#b4b8f8}.eggs-widget__egg.selected:last-child{background-color:#ff8080}
`],encapsulation:2})};function lt(n,e){n&1&&d(0,"lg-jelly-widget")}function st(n,e){n&1&&d(0,"lg-eggs-widget")}function ct(n,e){n&1&&d(0,"lg-barcode-add-product-widget")}var ze=class n{static \u0275fac=function(t){return new(t||n)};static \u0275cmp=_({type:n,selectors:[["lg-widgets-page"]],decls:9,vars:1,consts:[[3,"center"],["label","Jelly calculator","alias","jelly-calculator","lgTab",""],["label","Eggs calculator","alias","eggs-calculator","lgTab",""],["label","Barcode Seeker","alias","barcode-seeker","lgTab",""]],template:function(t,o){t&1&&(l(0,"lg-fade-in")(1,"lg-container")(2,"lg-gap-row",0)(3,"lg-title"),m(4," Widgets "),a()(),l(5,"lg-tabs"),ie(6,lt,1,0,"ng-template",1)(7,st,1,0,"ng-template",2)(8,ct,1,0,"ng-template",3),a()()()),t&2&&(r(2),c("center",!0))},dependencies:[Ne,Re,M,A,L,Pe,Ae,Ge,K],encapsulation:2})};export{ze as WidgetsPageComponent};
