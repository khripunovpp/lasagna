import{a as Ie,b as ge}from"./chunk-BTXDQPFW.js";import{a as de,b as ue}from"./chunk-FI4EEUH6.js";import{a as _e}from"./chunk-YNVNIL7S.js";import{a as ve}from"./chunk-QL7ZW4I4.js";import"./chunk-DR46QMBJ.js";import"./chunk-HCUERNTX.js";import{a as fe}from"./chunk-C5H2I4FC.js";import{v as me}from"./chunk-VLSBBD43.js";import{a as oe}from"./chunk-TBBEROLX.js";import{a as ce}from"./chunk-U5RG623K.js";import{a as ae}from"./chunk-MUGSSU5U.js";import{a as le}from"./chunk-7C3OD2VZ.js";import{a as se}from"./chunk-VPY63KRA.js";import"./chunk-MPFUNZLY.js";import{a as re}from"./chunk-O2QGAP6D.js";import{h as X,ja as S,ma as ne,na as T,oa as pe,q as Y,y as ee,z as te}from"./chunk-SCGAETAM.js";import{C as ie,p as J,q as Q,u as W}from"./chunk-J6CDYHKM.js";import"./chunk-CABIONZL.js";import"./chunk-EMIJRNYJ.js";import{f as U,l as K,m as q,n as H}from"./chunk-ZA7VU5CB.js";import{$a as n,Bb as N,Cc as p,Dc as u,Ec as C,Gb as j,Ib as E,Jb as w,Kb as l,Lb as c,Mb as a,Mc as O,Nb as A,Rb as P,V as D,Vb as k,Wb as _,ca as F,ea as g,eb as f,hc as $,jc as m,l as R,la as b,lb as M,lc as x,ma as h,mc as y,nc as V,qb as Z,r as L,t as B,wc as z,xc as G}from"./chunk-X5WXA3YI.js";import"./chunk-2RGDSI3Q.js";import"./chunk-FK6H3RFT.js";import"./chunk-C6Q5SG76.js";var xe=new F("CategorizedInvoicesList",{factory:()=>{let r=g(S);return R(r.loadToObservable()).pipe(D(()=>r.items$)).pipe(L(e=>e.toSorted((t,s)=>t.prefix.localeCompare(s.prefix))),L(e=>X(e,"prefix")),B(async e=>{let t=[];for(let v in e)t.push({group_key:v,items:e[v]?.toSorted((d,I)=>d.createdAt>I.createdAt?-1:1)||[]});if(!t.length)return[];let[s,...i]=t.toSorted((v,d)=>v.group_key>d.group_key?1:-1);return s?.group_key?[s].concat(i):i.concat([s])}))}});var Ce=()=>["invoice"],Se=(r,o)=>(o.uuid??"")+r;function Te(r,o){if(r&1&&(c(0,"lg-flex-column",7)(1,"lg-flex-row",3)(2,"lg-flex-row",8)(3,"a",9),m(4),a(),c(5,"div",10),m(6),a()(),c(7,"small",11),p(8,"date"),m(9),p(10,"translate"),p(11,"timeAgo"),a()(),c(12,"lg-flex-row",3)(13,"div"),m(14),p(15,"translate"),p(16,"date"),a(),c(17,"div"),m(18),p(19,"translate"),p(20,"number"),a()()()),r&2){let e,t,s=_(),i=s.$implicit,v=s.$index,d=_().$index,I=_();l("size","medium"),n(),l("center",!0),n(),l("center",!0),n(),l("routerLink","/invoices/edit/"+i.uuid),n(),V(" #",i.prefix,"/",i.invoice_number," - ",i.name," "),n(),l("ngClass",(e=I.stateBadgeClasses())==null||e[d]==null?null:e[d][v]),n(),x(" ",(t=I.stateLabels())==null||t[d]==null?null:t[d][v]," "),n(),N("title",C(8,17,(i==null?null:i.updatedAt)||(i==null?null:i.createdAt),"short")),n(2),y(" ",u(10,20,"edited-at-label")," ",u(11,22,(i==null?null:i.updatedAt)||(i==null?null:i.createdAt))," "),n(3),l("center",!0),n(2),y(" ",u(15,24,"invoices.date-due"),": ",C(16,26,i.date_due,"shortDate")," "),n(4),y(" ",u(19,29,"invoices.days-left"),": ",C(20,31,(i.date_due-I.nowDate)/(1e3*60*60*24),"1.0-0")," ")}}function Le(r,o){if(r&1&&Z(0,Te,21,34,"ng-template",6),r&2){let e=o.$implicit;l("uuid",e.uuid)}}function be(r,o){if(r&1){let e=P();c(0,"lg-title",4),m(1),p(2,"translate"),a(),c(3,"lg-card-list",5),k("onSelected",function(s){b(e);let i=_();return h(i.selectionZoneService.putSelected(s))})("onDeleteOne",function(s){b(e);let i=_();return h(i.deleteOne(s))}),E(4,Le,1,1,null,6,Se),a()}if(r&2){let e=o.$implicit,t=_();l("level",3),n(),x(" ",(e==null?null:e.group_key)||u(2,5,"without-category-label")," "),n(2),l("mode",t.selectionZoneService.selectionMode())("selectAll",t.selectionZoneService.selectAll())("deselectAll",t.selectionZoneService.deselectAll()),n(),w(e.items)}}function he(r,o){r&1&&(c(0,"lg-flex-row",3)(1,"lg-title",4),m(2),p(3,"translate"),a()()),r&2&&(l("center",!0),n(),l("level",5),n(),x(" ",u(3,3,"no-invoices")," "))}var ye=class r{constructor(o,e,t,s,i){this._notificationsService=o;this.selectionZoneService=e;this._invoicesRepository=t;this._router=s;this._translateService=i}_userLang=g(ie);nowDate=Date.now();invoices=Y(g(xe));stateLabels=O(()=>(this._userLang(),this.invoices()?.map(o=>o?.items?.map(e=>{let t=e.state,s=ge[t];return s?this._translateService.instant(s):this._translateService.instant("invoices.state.unknown")}))));stateBadgeClasses=O(()=>this.invoices()?.map(o=>o?.items?.map(e=>{let t=e.state;return Ie[t||"draft"]})));Stores=W;deleteOne(o){o?.uuid&&this._invoicesRepository.deleteOne(o.uuid).then(()=>{this._notificationsService.success("invoices.deleted"),this.loadItems()})}ngOnInit(){this.loadItems()}loadItems(){this._invoicesRepository.loadToObservable()}onAddInvoice(){this._invoicesRepository.createEmpty().then(o=>{this._router.navigate(["/invoices/edit",o])})}static \u0275fac=function(e){return new(e||r)(f(ne),f(T),f(S),f(J),f(ee))};static \u0275cmp=M({type:r,selectors:[["lg-invoices-list"]],features:[z([T,H])],decls:12,vars:10,consts:[[3,"click","icon","size"],["aria-hidden","false","fontIcon","add"],[3,"selectionTypes"],[3,"center"],[3,"level"],[3,"onSelected","onDeleteOne","mode","selectAll","deselectAll"],["lgCardListItem","","type","invoice",3,"uuid"],[3,"size"],["lgExpand","",3,"center"],[3,"routerLink"],[3,"ngClass"],[1,"text-muted","text-cursive"]],template:function(e,t){e&1&&(c(0,"lg-controls-bar")(1,"lg-button",0),k("click",function(){return t.onAddInvoice()}),A(2,"mat-icon",1),a()(),c(3,"lg-fade-in")(4,"lg-container")(5,"lg-title"),m(6),p(7,"translate"),a(),A(8,"lg-selection-tools",2),E(9,be,6,7,null,null,j,!1,he,4,5,"lg-flex-row",3),a()()),e&2&&(n(),$("success"),l("icon",!0)("size","medium"),n(5),x(" ",u(7,7,"invoices.list-title")," "),n(2),l("selectionTypes",G(9,Ce)),n(),w(t.invoices()))},dependencies:[ce,pe,me,oe,re,_e,ve,Q,se,de,ue,ae,fe,te,le,K,q,U],styles:["[_nghost-%COMP%]{display:block}"]})};export{ye as InvoicesListComponent};
