import{a as ke}from"./chunk-XGYLWNA3.js";import{a as Oe}from"./chunk-R5HZ2CHP.js";import{a as je}from"./chunk-HXFWMFTO.js";import{c as B}from"./chunk-AD2SMGJQ.js";import"./chunk-GALYHWJT.js";import{a as Re}from"./chunk-T4SSLVVO.js";import{a as We}from"./chunk-ITJQZPJZ.js";import{a as ze,c as Ge}from"./chunk-HJNGTLSS.js";import{a as Ne}from"./chunk-B4BPCK6P.js";import"./chunk-CWUUYJTE.js";import"./chunk-FK6H3RFT.js";import{a as Ue}from"./chunk-GFKJ3IXC.js";import{a as M}from"./chunk-ZL6WWUML.js";import{a as De}from"./chunk-VQHUADFJ.js";import{a as Ee}from"./chunk-IVWGGHZS.js";import{a as Fe}from"./chunk-OIONDWIZ.js";import{c as Pe}from"./chunk-BJIJ7REJ.js";import{a as Be}from"./chunk-I27O3RKJ.js";import"./chunk-MPFUNZLY.js";import{a as Me}from"./chunk-Q75E6UIP.js";import{H as xe,I as ge,J as he,L as E,M as ve,Q as ye,T as be,V as we,W as Se,Y as Te,_ as Ie,d as Le,da as Ae,g as de,o as se,p as me,q as Ce,x as _e,z as fe}from"./chunk-N3CXADBY.js";import{m as re,p as ce,q as pe}from"./chunk-3NSY2Z6P.js";import{c as ue}from"./chunk-CABIONZL.js";import"./chunk-EMIJRNYJ.js";import{f as ne,i as ae,m as le,n as oe}from"./chunk-HDEG74LV.js";import{$b as N,Bc as u,Cb as x,Cc as C,Dc as f,Eb as g,Ec as te,Fb as O,G as z,Hb as k,Ib as V,Jb as p,Kb as o,Lb as r,Lc as v,Mb as R,Pb as H,Qb as Q,Ub as F,Vb as s,Vc as ie,Wb as L,Xb as q,Zb as A,_a as i,_b as U,da as G,db as w,dc as $,gc as J,ic as c,jc as m,ka as T,kb as P,kc as _,la as I,lc as S,nc as K,oa as W,oc as X,pb as y,pc as Y,ua as j,vc as Z,yc as ee}from"./chunk-NHWKWTII.js";import"./chunk-2RGDSI3Q.js";import{e as Qe}from"./chunk-C6Q5SG76.js";var Je=["*"],D=class t{constructor(){}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=P({type:t,selectors:[["lg-table-card"]],ngContentSelectors:Je,decls:4,vars:1,consts:[[3,"flat"],[1,"table"],[1,"table__scroll"]],template:function(e,a){e&1&&(L(),o(0,"lg-card",0)(1,"div",1)(2,"div",2),q(3),r()()()),e&2&&p("flat",!0)},dependencies:[M],styles:[`:host{display:flex;width:100%}.table__scroll{overflow-x:auto}table{width:100%;border-collapse:collapse;--border-color: #efefef}table thead tr{border-bottom:1px solid var(--border-color)}table thead th{text-align:left;padding:16px 24px;opacity:.4;font-size:.8em}table tbody tr{border-bottom:1px solid var(--border-color)}table tbody tr:last-child{border-bottom:none}td{padding:16px 24px}
`],encapsulation:2})};var He=Qe(Le());var Ke=["priceChart"],Xe=["weightChart"],Ye=(t,l)=>[t,l];function Ze(t,l){t&1&&H(0)}function et(t,l){if(t&1&&y(0,Ze,1,0,"ng-container",20),t&2){s(2);let e=$(12);p("ngTemplateOutlet",e)}}function tt(t,l){if(t&1&&(c(0),u(1,"userCurrency")),t&2){let e,a=s(2);_(" ",f(1,1,(e=a.result())==null||e.calculation==null?null:e.calculation.pricePerUnit,"1.2-5")," ")}}function it(t,l){if(t&1&&R(0,"lg-unit-switcher",21),t&2){let e=s(2);p("items",e.additionalPriceAction)}}function nt(t,l){if(t&1&&R(0,"lg-unit-switcher",22),t&2){let e=s(3);p("items",e.additionalPriceUnit)}}function at(t,l){t&1&&y(0,nt,1,1,"ng-template",13)}function lt(t,l){if(t&1&&(o(0,"b"),c(1),u(2,"currencySymbol"),r()),t&2){let e,a=s(3);i(),S("",C(2,2,a.userSettings().currency)," / ",(e=a.result())==null||e.calculation==null?null:e.calculation.outcomeUnit," ")}}function ot(t,l){t&1&&y(0,lt,3,4,"ng-template",13)}function rt(t,l){if(t&1&&(c(0," > "),o(1,"span",23),c(2),u(3,"userCurrency"),r(),o(4,"span",24),c(5),u(6,"userCurrency"),r()),t&2){let e=s(2),a=e.totalPriceDifference();i(2),_(" ",f(3,4,e.totalPriceWithAdditions(),"1.2-2")," "),i(2),p("ngClass",a>0?"text-success":"text-danger"),i(),S(" (",a>0?"+":""," ",f(6,7,a,"1.2-2"),") ")}}function ct(t,l){t&1&&c(0," Recalculate for ")}function pt(t,l){if(t&1&&(o(0,"b"),c(1),r()),t&2){let e,a=s(3);i(),_(" ",(e=a.result())==null||e.calculation==null?null:e.calculation.outcomeUnit," ")}}function ut(t,l){t&1&&y(0,pt,2,1,"ng-template",13)}function dt(t,l){if(t&1){let e=Q();o(0,"lg-gap-row",5)(1,"lg-gap-column",6)(2,"lg-card",7)(3,"lg-gap-row",8)(4,"div"),c(5),u(6,"translate"),r(),o(7,"b"),c(8),u(9,"number"),r()()(),o(10,"lg-gap-column",9)(11,"lg-card",7)(12,"lg-gap-row",8)(13,"div"),c(14),u(15,"translate"),o(16,"b"),c(17),r()(),o(18,"b"),x(19,et,1,1,"ng-container")(20,tt,2,4),r()()(),o(21,"lg-gap-row",10)(22,"lg-number-input",11),y(23,it,1,1,"ng-template",12),x(24,at,1,0,null,13),x(25,ot,1,0,null,13),r()()(),o(26,"lg-gap-column",9)(27,"lg-card",7)(28,"lg-gap-row",8)(29,"div"),c(30),u(31,"translate"),r(),o(32,"b"),c(33),u(34,"userCurrency"),x(35,rt,7,10),r()()(),o(36,"lg-gap-row",14)(37,"lg-number-input",15),Y("ngModelChange",function(n){T(e);let d=s();return X(d.recalculateTotalsModel,n)||(d.recalculateTotalsModel=n),I(n)}),y(38,ct,1,0,"ng-template",12),x(39,ut,1,0,null,13),r()()()(),o(40,"lg-card",16)(41,"lg-gap-column",17)(42,"lg-title",18)(43,"div"),c(44),u(45,"translate"),r()(),o(46,"canvas",19,1),F("chartHover",function(n){T(e);let d=s();return I(d.onChartHover("price",n.event,n.active))}),r()()(),o(48,"lg-card",16)(49,"lg-gap-column",17)(50,"lg-title",18)(51,"div"),c(52),u(53,"translate"),r()(),o(54,"canvas",19,2),F("chartHover",function(n){T(e);let d=s();return I(d.onChartHover("weight",n.event,n.active))}),r()()()()}if(t&2){let e,a,n=s();p("center",!0)("mobileMode",!0),i(),p("position","stretch"),i(2),p("size","small")("relaxed",!0),i(2),m(C(6,41,"recipe.calculation.outcome.label")),i(3),S(" ",f(9,43,(e=n.result())==null||e.calculation==null?null:e.calculation.outcomeAmount,"1.0-2")," ",(e=n.result())==null||e.calculation==null?null:e.calculation.outcomeUnit," "),i(2),p("position","stretch"),i(2),p("size","small")("relaxed",!0),i(2),_(" ",C(15,46,"recipe.calculation.one-unit.label")," "),i(3),_(" ",(a=n.result())==null||a.calculation==null?null:a.calculation.outcomeUnit," "),i(2),g(n.notInGrams()?19:20),i(2),p("formGroup",n.recipePriceAdditionsForm)("size","small")("relaxed",!0),i(3),g(n.showPriceAdditionUnits()?24:-1),i(),g(n.roundActionSelected()?25:-1),i(),p("position","stretch"),i(2),p("size","small")("relaxed",!0),i(2),m(C(31,48,"recipe.calculation.total-price.label")),i(3),_(" ",f(34,50,n.totalPrice(),"1.2-2")," "),i(2),g(n.totalPriceDifference()?35:-1),i(),p("size","small")("relaxed",!0),i(),K("ngModel",n.recalculateTotalsModel),i(2),g(n.roundActionSelected()?39:-1),i(2),p("size","small"),i(),p("level",5),i(2),m(C(45,53,"recipe.calculation.price-chart")),i(2),p("data",n.doughnutChartData().prices)("options",n.doughnutChartOptions)("type",n.doughnutChartType),i(3),p("size","small"),i(),p("level",5),i(2),m(C(53,55,"recipe.calculation.weight-chart")),i(2),p("data",n.doughnutChartData().weight)("options",n.doughnutChartOptions)("type",n.doughnutChartType)}}function st(t,l){if(t&1&&(c(0," > "),o(1,"span",23),c(2),u(3,"userCurrency"),r(),o(4,"span",24),c(5),u(6,"userCurrency"),r()),t&2){let e,a,n=s(3),d=((e=n.result())==null||e.calculation==null?null:e.calculation.pricePerUnitDifference)??0;i(2),_(" ",f(3,4,(a=n.result())==null||a.calculation==null?null:a.calculation.pricePerUnitModified,"1.2-2")," "),i(2),p("ngClass",d>0?"text-success":"text-danger"),i(),S(" (",d>0?"+":""," ",f(6,7,d,"1.2-2"),") ")}}function mt(t,l){if(t&1&&(c(0),u(1,"userCurrency"),x(2,st,7,10),c(3),u(4,"number")),t&2){let e,a,n,d=s(2);_(" ",f(1,3,(e=d.result())==null||e.calculation==null?null:e.calculation.pricePerOutcomeUnit,"1.2-2")," "),i(2),g(!((a=d.result())==null||a.calculation==null)&&a.calculation.totalPriceDifference?2:-1),i(),_(" / ",f(4,6,(n=d.result())==null||n.calculation==null?null:n.calculation.weightForUnit,"1.0-2")," gram ")}}function Ct(t,l){if(t&1&&(c(0),u(1,"userCurrency")),t&2){let e,a=s(2);_(" ",f(1,1,(e=a.result())==null||e.calculation==null?null:e.calculation.totalPrice,"1.2-2")," ")}}function _t(t,l){if(t&1&&x(0,mt,5,9)(1,Ct,2,4),t&2){let e=s();g(e.notInGrams()?0:1)}}function ft(t,l){if(t&1&&(o(0,"a",30),c(1),r()),t&2){let e=s().$implicit;p("routerLink",ee(2,Ye,e.type==="recipe-row"?"/recipes/edit/":"/products/edit/",e.uuid)),i(),_(" ",e.name," ")}}function xt(t,l){if(t&1&&(c(0),u(1,"translate")),t&2){let e=s().$implicit;_(" ",C(1,1,e.name)," ")}}function gt(t,l){if(t&1&&(o(0,"tr",24)(1,"td"),c(2),r(),o(3,"td")(4,"div",24),x(5,ft,2,5,"a",30)(6,xt,2,3),r()(),o(7,"td"),c(8),u(9,"number"),r(),o(10,"td"),c(11),r(),o(12,"td"),c(13),u(14,"userCurrency"),r(),o(15,"td"),c(16),u(17,"userCurrency"),r()()),t&2){let e=l.$implicit,a=l.$index;p("ngClass",e.type),i(2),m(a+1),i(2),p("ngClass","indent-"+e.indent),i(),g(e.type!=="total"?5:6),i(3),m(f(9,8,e.amount,"1.0-2")),i(3),m(e.unit),i(2),m(f(14,11,e.price_per_gram,"1.2-5")),i(3),m(f(17,14,e.total,"1.0-2"))}}function ht(t,l){if(t&1&&(o(0,"table")(1,"colgroup"),R(2,"col",25)(3,"col",26)(4,"col",27)(5,"col",28)(6,"col",27)(7,"col",29),r(),o(8,"thead")(9,"tr")(10,"th"),c(11,"#"),r(),o(12,"th"),c(13),u(14,"translate"),r(),o(15,"th"),c(16),u(17,"translate"),r(),o(18,"th"),c(19),u(20,"translate"),r(),o(21,"th"),c(22),u(23,"translate"),r(),o(24,"th"),c(25),u(26,"translate"),r()()(),o(27,"tbody"),k(28,gt,18,17,"tr",24,O),r()()),t&2){let e,a=s();i(13),m(C(14,5,"recipe.calculation.table.name.title")),i(3),m(C(17,7,"recipe.calculation.table.amount.title")),i(3),m(C(20,9,"recipe.calculation.table.unit.title")),i(3),m(C(23,11,"recipe.calculation.table.price.title")),i(3),m(C(26,13,"recipe.calculation.table.total.title")),i(3),V((e=a.result())==null?null:e.table)}}function vt(t,l){}var Ve=class t{constructor(l,e,a,n,d,h){this._aRoute=l;this._calculateRecipeService=e;this._formTemplateService=a;this._injector=n;this._router=d;this._notificationService=h;this._aRoute.data.pipe(se()).subscribe(b=>{this.result.set(b.result),this.recipePriceAdditionsForm.patchValue({action:this.result()?.calculation?.perUnitPriceModifier?.action||"add",value:this.result()?.calculation?.perUnitPriceModifier?.value||0,unit:this.result()?.calculation?.perUnitPriceModifier?.unit||"currency"})})}userSettings=G(Re);additionalPriceUnit=[{label:"$",value:"currency",style:"secondary"},{label:"%",value:"percent",style:"secondary"}];additionalPriceAction=[{label:"Add",value:"add",style:"secondary"},{label:"Round to",value:"round",style:"secondary"}];doughnutChartType="pie";uuid=Ce("uuid");result=j(null);doughnutChartData=v(()=>{let l=this.result(),{prices:e,weight:a,labels:n,colors:d}=l?.calculation?.ingredients?.reduce((h,b)=>(h.prices.push(b.totalPrice),h.weight.push(b.totalWeightGram),h.labels.push(b.generalName),h.colors.push(b.product_id?.ownColor??b.recipe_id?.ownColor??ue()),h),{prices:[],weight:[],labels:[],colors:[]})||{prices:[],weight:[],labels:[],colors:[]};return{prices:{labels:n,datasets:[{label:"Cost",data:e,backgroundColor:d,borderWidth:0}]},weight:{labels:n,datasets:[{label:"Amount",data:a,backgroundColor:d,borderWidth:0}]},ingredients:l?.calculation?.ingredients||[]}});doughnutChartOptions={plugins:{legend:{display:!1}},onClick:(l,e,a)=>{}};chartPrices;chartWeight;recalculateTotalsModel=ie(0);notInGrams=v(()=>this.result()?.calculation?.outcomeUnit&&this.result()?.calculation?.outcomeUnit!=="gram");recipePriceAdditionsForm=new he({action:new E("add"),value:new E(0),unit:new E("currency")});values=me(this.recipePriceAdditionsForm.valueChanges);roundActionSelected=v(()=>this.values()?.action==="round");showPriceAdditionUnits=v(()=>{let l=this.result()?.calculation?.perUnitPriceModifier?.action;return l==="add"||!l});totalScaleFactor=v(()=>this.recalculateTotalsModel()?this.recalculateTotalsModel()/(this.result()?.calculation?.outcomeAmount||1):1);totalPrice=v(()=>(this.result()?.calculation?.totalPrice||0)*this.totalScaleFactor());totalPriceDifference=v(()=>(this.result()?.calculation?.totalPriceDifference||0)*this.totalScaleFactor());totalPriceWithAdditions=v(()=>(this.result()?.calculation?.totalPriceWithAdditions||0)*this.totalScaleFactor());ngOnInit(){}ngAfterViewInit(){window.chartPrices=this.chartPrices,window.chartWeight=this.chartWeight,this.recipePriceAdditionsForm.valueChanges.pipe(z(300)).subscribe(l=>{this.updatePriceAdditions(l)})}onChartHover(l,e,a){if(!a?.length)return;let n=l==="price"?this.chartWeight:this.chartPrices,d=a[0].index;n?.chart?.update()}async updatePriceAdditions(l){try{await this._calculateRecipeService.updateRecipe({perUnitPriceModifier:{action:l.action,value:parseFloat(l.value)||0,unit:l.unit}});let e=await this._calculateRecipeService.calculateRecipe(this.uuid());this.result.set(e)}catch(e){this._notificationService.error(de(e))}}difference=He.difference;static \u0275fac=function(e){return new(e||t)(w(re),w(_e),w(fe),w(W),w(ce),w(Te))};static \u0275cmp=P({type:t,selectors:[["lg-calculate-recipe"]],viewQuery:function(e,a){if(e&1&&(A(Ke,5,B),A(Xe,5,B)),e&2){let n;U(n=N())&&(a.chartPrices=n.first),U(n=N())&&(a.chartWeight=n.first)}},inputs:{recalculateTotalsModel:[1,"recalculateTotalsModel"]},outputs:{recalculateTotalsModel:"recalculateTotalsModelChange"},features:[Z([Ie,oe])],decls:16,vars:16,consts:[["totalAmount",""],["priceChart",""],["weightChart",""],[3,"center","mobileMode"],[3,"flat","link","size"],["lgExpand","",2,"max-width","1200px",3,"center","mobileMode"],[3,"position"],["size","small"],[3,"size","relaxed"],["size","small",3,"position"],[2,"--control-bg","#fff","padding","0 16px",3,"formGroup","size","relaxed"],["lgParseMath","","placeholder","extra price","formControlName","value"],["lgExtraTpl","","place","before"],["lgExtraTpl","","place","after"],[2,"--control-bg","#fff","padding","0 16px",3,"size","relaxed"],["lgParseMath","","placeholder","amount",3,"ngModelChange","ngModel"],["lgWidth","270px","size","small"],[3,"size"],[3,"level"],["baseChart","",3,"chartHover","data","options","type"],[4,"ngTemplateOutlet"],["formControlName","action",3,"items"],["formControlName","unit",3,"items"],[1,"text-underlined"],[3,"ngClass"],["span","1",2,"width","1%"],["span","1",2,"width","20%"],["span","1",2,"width","5%"],["span","1",2,"width","3%"],["span","1",2,"width","7%"],[3,"routerLink"]],template:function(e,a){if(e&1&&(o(0,"lg-fade-in")(1,"lg-container")(2,"lg-gap-column")(3,"lg-gap-row",3)(4,"lg-title"),c(5),u(6,"translate"),r(),o(7,"lg-button",4),c(8),u(9,"translate"),r()(),x(10,dt,56,57,"lg-gap-row",5),y(11,_t,2,1,"ng-template",null,0,te),o(13,"lg-table-card"),x(14,ht,30,15,"table")(15,vt,0,0),r()()()()),e&2){let n,d,h;i(3),p("center",!0)("mobileMode",!0),i(2),S(" ",(n=a.result())==null||n.calculation==null?null:n.calculation.recipeName," ",C(6,12,"recipe.calculation.title.after-text")," "),i(2),J("primary"),p("flat",!0)("link","/recipes/edit/"+((d=a.result())==null||d.calculation==null?null:d.calculation.recipeUuid))("size","small"),i(),_(" ",C(9,14,"edit-label")," "),i(2),g(!((h=a.result())==null||h.calculation==null)&&h.calculation.totalPrice?10:-1),i(4),g(a.result()?14:15)}},dependencies:[Ee,Me,D,ne,Ae,Fe,le,we,xe,ge,ve,pe,De,ae,Be,B,M,je,Ue,Oe,Pe,Se,ye,be,We,Ge,Ne,ke,ze],styles:[`lg-number-input .lg-number-input{width:100px}
`],encapsulation:2})};export{Ve as CalculateRecipeComponent};
