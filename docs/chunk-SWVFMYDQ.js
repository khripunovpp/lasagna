import{a as Ve}from"./chunk-ZZ7RMZQH.js";import{b as te}from"./chunk-VKWU2J5T.js";import{a as Oe,b as Le,c as Me,d as Ge,e as s,f as Pe,g as Be,h as Ne}from"./chunk-VKWWG2RQ.js";import"./chunk-6ZKMU4GX.js";import{a as ke}from"./chunk-WHV6YTRB.js";import"./chunk-QACA2TAM.js";import{a as ze,c as Ae}from"./chunk-M47ACRCX.js";import{b as Ee}from"./chunk-DECIG3UW.js";import"./chunk-KVVEVKET.js";import{a as U,b as ee}from"./chunk-LLOITE6A.js";import{a as Y}from"./chunk-Q3MS5KTD.js";import{a as Fe}from"./chunk-MTKE3TKK.js";import{a as Ie}from"./chunk-VNTOICFK.js";import{a as X}from"./chunk-KB5VWG36.js";import"./chunk-ACHQGNI7.js";import{a as Te,b as k}from"./chunk-4GMAHVOM.js";import{a as be}from"./chunk-2AG3W6NR.js";import{a as W}from"./chunk-6OA5NOZV.js";import"./chunk-SNDQO5FA.js";import{j as q,n as R,o as we,q as K}from"./chunk-EKJQYQH6.js";import"./chunk-PPZB7COH.js";import"./chunk-5KSZNU56.js";import"./chunk-TCTFHDUI.js";import"./chunk-H5OOR6F4.js";import{v as J,w as I}from"./chunk-N4C567K3.js";import"./chunk-6D4L3YT6.js";import{o as he,r as Re,s as Q,w as $}from"./chunk-2UE5YCBQ.js";import"./chunk-652DFWNF.js";import{h as De}from"./chunk-GM4BKM5X.js";import{$ as O,$b as de,Ab as _e,Bb as G,Cb as P,Db as l,Ea as L,Eb as p,Fb as ce,Ib as Ce,Jb as h,Mb as d,Nb as C,Ob as ve,Pb as me,Sb as F,Ua as M,Ub as N,Va as r,Vb as V,Xa as B,_a as _,_b as c,ac as g,bc as j,db as y,fb as b,ga as S,ha as x,ib as D,ic as Z,jc as ye,kc as H,na as T,oc as u,pb as ge,pc as f,qb as a,qc as Se,sb as fe,tb as v,ua as ue,wb as z,yb as A,zc as xe}from"./chunk-ESI6QU3H.js";import"./chunk-DELOOZDJ.js";import"./chunk-2WH2EVR6.js";var je=s.object({name:s.string(),amount:s.number().or(s.string()),uuid:s.string().optional(),product_id:Be,recipe_id:s.lazy(()=>ie),unit:s.enum(["gram","portion","piece"])});var ie=s.object({name:s.string(),uuid:s.string().optional(),description:s.string(),ingredients:s.array(s.lazy(()=>je)),outcome_unit:Pe,outcome_amount:s.number().or(s.string()),taxTemplateName:s.string().optional(),category_id:s.string().nullable().optional(),createdAt:s.union([s.string(),s.number()]).optional(),updatedAt:s.union([s.string(),s.number()]).optional(),tags:s.array(s.string()).optional(),color:s.string().optional()});var He=i=>({length:i}),Qe=(i,t)=>t.uuid;function $e(i,t){if(i&1){let e=h();l(0,"lg-button",4),d("click",function(){S(e);let o=C(2);return x(o.selectionZoneService.onSelection())}),c(1),u(2,"translate"),p()}i&2&&(v("success"),a("flat",!0)("size","small"),r(),g(" ",f(2,5,"select-many-label")," "))}function qe(i,t){if(i&1){let e=h();l(0,"lg-button",4),d("click",function(){S(e);let o=C(2);return x(o.deleteAllDrafts())}),c(1),u(2,"translate"),p()}i&2&&(v("danger"),a("flat",!0)("size","small"),r(),g(" ",f(2,5,"delete-all-label")," "))}function Je(i,t){if(i&1){let e=h();l(0,"lg-button",5),d("click",function(){S(e);let o=C(3);return x(o.deletedSelectedDrafts())}),c(1),u(2,"translate"),p()}if(i&2){let e=C();v("danger"),a("flat",!0)("disabled",!(e.draft!=null&&e.draft.size))("size","small"),r(),g(" ",f(2,6,"delete-selected-label")," ")}}function Ke(i,t){i&1&&D(0,Je,3,8,"ng-template",1)}function We(i,t){i&1&&(c(0),u(1,"translate")),i&2&&g(" ",f(1,1,"draft.list-prefix.existing")," ")}function Xe(i,t){i&1&&(c(0),u(1,"translate")),i&2&&g(" ",f(1,1,"draft.list-prefix.new")," ")}function Ye(i,t){if(i&1&&(l(0,"lg-gap-row",6)(1,"a",7),z(2,We,2,3)(3,Xe,2,3),c(4),p(),l(5,"small",8),c(6),u(7,"translate"),u(8,"timeAgo"),p()()),i&2){let e=C().$implicit;a("center",!0),r(),a("routerLink","/recipes/draft/"+(e==null?null:e.uuid)),r(),A(!(e==null||e.meta==null)&&e.meta.uuid?2:3),r(2),g(" ",(e==null||e.data==null?null:e.data.name)??""," "),r(2),j(" ",f(7,6,"edited-at-label")," ",f(8,8,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," ")}}function Ue(i,t){if(i&1&&D(0,Ye,9,10,"ng-template",3),i&2){let e=t.$implicit;a("uuid",e.uuid)}}function et(i,t){if(i&1){let e=h();l(0,"lg-expander",0),u(1,"translate"),u(2,"translate"),l(3,"lg-inline-separated-group"),D(4,$e,3,7,"ng-template",1)(5,qe,3,7,"ng-template",1),z(6,Ke,1,0,null,1),p(),l(7,"lg-card-list",2),d("onDeleteOne",function(o){S(e);let m=C();return x(m.deleteDraft(o==null?null:o.uuid))})("onSelected",function(o){S(e);let m=C();return x(m.selectionZoneService.putSelected(o))}),G(8,Ue,1,1,null,3,Qe),p()()}if(i&2){let e,n,o=C();a("closeLabel",f(1,6,"drafts-close-label"))("openLabel",Se(2,8,"drafts-label",H(11,He,(e=o.drafts())==null?null:e.length))),r(6),A((n=o.selectionZoneService.selected())?6:-1,n),r(),a("mode",o.selectionZoneService.selectionMode())("selectAll",o.selectionZoneService.selectAll().draft)("deselectAll",o.selectionZoneService.deselectAll().draft),r(),P(o.drafts())}}var ne=class i{constructor(t,e,n){this._recipesRepository=t;this._notificationsService=e;this.selectionZoneService=n}drafts=T([]);Stores=$;get hidden(){return this.drafts()?.length===0?!0:null}ngOnInit(){let t=this._recipesRepository.getDraftRecipe();t&&this.drafts.set(t)}deleteAllDrafts(){this._recipesRepository.removeDraftMany(this.drafts().map(t=>t.uuid)).then(()=>{this.drafts.set([]),this._notificationsService.success("Drafts deleted")})}deletedSelectedDrafts(){let t=this.selectionZoneService.selected().draft;t&&this._recipesRepository.removeDraftMany(Array.from(t)).then(()=>{this.drafts.update(e=>e.filter(n=>!t.has(n.uuid))),this._notificationsService.success("Drafts deleted")})}deleteDraft(t){t&&(this._recipesRepository.removeDraftRecipe(t),this.drafts.update(e=>e.filter(n=>n?.uuid!==t)))}static \u0275fac=function(e){return new(e||i)(_(K),_(J),_(R))};static \u0275cmp=y({type:i,selectors:[["lg-draft-recipes-list"]],hostVars:1,hostBindings:function(e,n){e&2&&ge("hidden",n.hidden)},features:[Z([R])],decls:1,vars:1,consts:[[3,"closeLabel","openLabel"],["lgInlineSeparatedGroup",""],[2,"--card-bg","#bee5ff",3,"onDeleteOne","onSelected","mode","selectAll","deselectAll"],["lgCardListItem","","type","draft",3,"uuid"],[3,"click","flat","size"],[3,"click","flat","disabled","size"],[3,"center"],["lgExpand","",3,"routerLink"],[1,"text-muted","text-cursive"]],template:function(e,n){if(e&1&&z(0,et,10,13,"lg-expander",0),e&2){let o;A((o=n.drafts())!=null&&o.length?0:-1)}},dependencies:[k,I,Ae,ze,Q,Y,Fe,q,Ne,ee,U],encapsulation:2})};var re=class i{constructor(t){this.elementRef=t}lgClickOutside=new L;onClick(t){this.elementRef.nativeElement.contains(t.target)||this.lgClickOutside.emit(t)}static \u0275fac=function(e){return new(e||i)(_(ue))};static \u0275dir=b({type:i,selectors:[["","lgClickOutside",""]],hostBindings:function(e,n){e&1&&d("click",function(m){return n.onClick(m)},M)("touchstart",function(m){return n.onClick(m)},M)("mousedown",function(m){return n.onClick(m)},M)("mouseup",function(m){return n.onClick(m)},M)},outputs:{lgClickOutside:"lgClickOutside"}})};var tt=[[["","lgDropdownAnchor",""]],"*"],it=["[lgDropdownAnchor]","*"],le=class i{constructor(){}display=T(!1);onClick(t){t.stopPropagation()}toggleDropdown(){this.display.set(!this.display())}closeDropdown(){this.display.set(!1)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=y({type:i,selectors:[["lg-dropdown"]],hostBindings:function(e,n){e&1&&d("click",function(m){return n.onClick(m)})},ngContentSelectors:it,decls:5,vars:2,consts:[[1,"lg-dropdown",3,"lgClickOutside"],[1,"lg-dropdown-anchor",3,"click"],[1,"lg-dropdown-content"]],template:function(e,n){e&1&&(ve(tt),l(0,"div",0),d("lgClickOutside",function(){return n.closeDropdown()}),l(1,"div",1),d("click",function(){return n.toggleDropdown()}),me(2),p(),l(3,"div",2),me(4,1),p()()),e&2&&fe("lg-dropdown-open",n.display())},dependencies:[re],styles:["[_nghost-%COMP%]{display:block;position:relative;z-index:2}.lg-dropdown[_ngcontent-%COMP%]{position:relative;display:inline-block}.lg-dropdown-content[_ngcontent-%COMP%]{display:none;position:absolute;top:calc(100% + 8px);background-color:#f9f9f9;min-width:160px;box-shadow:0 8px 16px #0003;z-index:1;border-radius:16px;padding:16px}.lg-dropdown-open[_ngcontent-%COMP%]   .lg-dropdown-content[_ngcontent-%COMP%]{display:block}.lg-dropdown-item[_ngcontent-%COMP%]{color:#000;padding:12px 16px;text-decoration:none;display:block}.lg-dropdown-item[_ngcontent-%COMP%]:hover{background-color:#f1f1f1}"]})};var pe=class i{constructor(t){this.templateRef=t}static \u0275fac=function(e){return new(e||i)(_(B))};static \u0275dir=b({type:i,selectors:[["","lgGroupingSortingContainer",""]]})};var ae=class i{constructor(){}router=O(Re);aRouter=O(he);context;sortChange=new L;groupChange=new L;groupingParam=te("groupBy");sortDirection=te("sortDirection");sortField=te("sortField");defaultDirection="asc";sorting=T({field:"name",direction:this.defaultDirection,group:"category"});sortingEffect=xe(()=>{let t=this.sorting();this.sortChange.emit(t)});ngOnInit(){let t=this.aRouter.snapshot.queryParams,e=this.groupingParam(),n=this.sortDirection(),o=this.sortField();this.sorting.set({field:o?.toString()||"name",direction:n?n==="asc"?"asc":"desc":this.defaultDirection,group:e?.toString()||"category"})}onSortChange(t){debugger;console.log("Sorting changed",t,this.sorting()),this.sorting.set({field:t.field||this.sorting().field,direction:t.direction||this.sorting().direction,group:t.group||this.sorting().group}),this.sortChange.emit(this.sorting()),this.router.navigate([],{queryParams:{sortField:t.field||this.sorting().field,sortDirection:t.direction||this.sorting().direction,groupBy:t.group||this.sorting().group},relativeTo:this.aRouter}).then(()=>{window.location.reload()})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=y({type:i,selectors:[["lg-grouping-sorting"]],contentQueries:function(e,n,o){if(e&1&&F(o,pe,5),e&2){let m;N(m=V())&&(n.context=m.first)}},outputs:{sortChange:"sortChange",groupChange:"groupChange"},decls:17,vars:22,consts:[["lgDropdownAnchor","",3,"size"],[3,"size"],[3,"click","size","flat"]],template:function(e,n){e&1&&(l(0,"lg-gap-row")(1,"lg-dropdown")(2,"lg-button",0),c(3),p(),l(4,"lg-gap-column",1)(5,"lg-button",2),d("click",function(){return n.onSortChange({group:"category"})}),c(6," Category "),p(),l(7,"lg-button",2),d("click",function(){return n.onSortChange({group:"createdAt"})}),c(8," Date "),p()()(),l(9,"lg-dropdown")(10,"lg-button",0),c(11),p(),l(12,"lg-gap-column",1)(13,"lg-button",2),d("click",function(){return n.onSortChange({direction:"asc"})}),c(14," Ascending "),p(),l(15,"lg-button",2),d("click",function(){return n.onSortChange({direction:"desc"})}),c(16," Descending "),p()()()()),e&2&&(r(2),a("size","small"),r(),g(" Group by: ",n.sorting().group," "),r(),a("size","small"),r(),v("warning"),a("size","small")("flat",!0),r(2),v("warning"),a("size","small")("flat",!0),r(3),a("size","small"),r(),g(" Sort direction: ",n.sorting().direction," "),r(),a("size","small"),r(),v("warning"),a("size","small")("flat",!0),r(2),v("warning"),a("size","small")("flat",!0))},dependencies:[k,I,le,X],encapsulation:2})};var E=class i{constructor(t){this.templateRef=t}static \u0275fac=function(e){return new(e||i)(_(B))};static \u0275dir=b({type:i,selectors:[["","lgGroupingTail",""]]})};var nt=i=>({$implicit:i}),ot=(i,t)=>t==null?null:t.field;function rt(i,t){if(i&1&&(l(0,"div",5),Ce(1,6),p()),i&2){let e=t.$implicit,n=C(2);r(),a("ngTemplateOutlet",n.groupingTailDirective.templateRef)("ngTemplateOutletContext",H(2,nt,e))}}function lt(i,t){if(i&1&&(l(0,"section",1)(1,"header",2)(2,"lg-title",3),c(3),p()(),l(4,"div",4),G(5,rt,2,4,"div",5,_e),p()()),i&2){let e=t.$implicit;r(2),a("level",3),r(),g(" ",e==null?null:e.field," "),r(2),P(e==null?null:e.items)}}var se=class i{constructor(){}sortResult;groupingTailDirective;static \u0275fac=function(e){return new(e||i)};static \u0275cmp=y({type:i,selectors:[["lg-grouping-tails"]],contentQueries:function(e,n,o){if(e&1&&F(o,E,5),e&2){let m;N(m=V())&&(n.groupingTailDirective=m.first)}},inputs:{sortResult:"sortResult"},decls:3,vars:0,consts:[[1,"grouping-tails"],[1,"grouping-tails__section"],[1,"grouping-tails__header"],[3,"level"],[1,"grouping-tails__content"],[1,"grouping-tails__item"],[3,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(e,n){e&1&&(l(0,"section",0),G(1,lt,7,2,"section",1,ot),p()),e&2&&(r(),P(n.sortResult==null?null:n.sortResult.groups))},dependencies:[W,De],styles:[".grouping-tails[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:32px}.grouping-tails__section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}.grouping-tails__content[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:16px}.grouping-tails__item[_ngcontent-%COMP%]{padding:16px;border-radius:32px;background-color:var(--accent-sahde-color)}"]})};var pt=()=>["recipe"];function at(i,t){if(i&1){let e=h();l(0,"lg-button",7),d("click",function(){S(e);let o=C();return x(o.exportRecipes(o.selectionZoneService.selected().recipe))}),c(1),u(2,"translate"),p()}i&2&&(v("info"),a("flat",!0)("size","small"),r(),g(" ",f(2,5,"export-label")," recipes "))}function st(i,t){if(i&1&&(l(0,"span"),c(1),p()),i&2){let e=t.$implicit;r(),de(e==null?null:e.name)}}function ct(i,t){if(i&1){let e=h();l(0,"lg-import",8),u(1,"translate"),d("onDone",function(){S(e);let o=C();return x(o.loadRecipes())}),D(2,st,2,1,"ng-template",9),p()}if(i&2){let e=C();a("label",f(1,3,"import-label")+" products")("schema",e.RecipeScheme)("storeName",e.Stores.RECIPES)}}function mt(i,t){if(i&1&&(l(0,"lg-gap-column")(1,"a",10),c(2),p(),l(3,"lg-gap-row")(4,"lg-button",11),c(5),u(6,"translate"),p(),l(7,"small",12),c(8),u(9,"translate"),u(10,"timeAgo"),p()()()),i&2){let e=t.$implicit;r(),a("routerLink","/recipes/edit/"+e.uuid),r(),de(e.name),r(2),v("primary"),a("size","small")("link","/recipes/calculate/"+e.uuid)("flat",!0),r(),g(" ",f(6,10,"recipes.calculate-btn")," "),r(3),j(" ",f(9,12,"edited-at-label")," ",f(10,14,(e==null?null:e.updatedAt)||(e==null?null:e.createdAt))," ")}}var Ze=class i{constructor(t,e,n,o){this._recipesRepository=t;this._notificationsService=e;this._transferDataService=n;this.selectionZoneService=o;this._recipesRepository.recipes$.subscribe({next:m=>{console.log("recipes loaded",m)},error:m=>{}})}recipes=Ee(O(Ve));Stores=$;RecipeScheme=ie;ngOnInit(){this.loadRecipes()}deleteRecipe(t){t?.uuid&&this._recipesRepository.deleteOne(t.uuid).then(()=>{this._notificationsService.success("Recipe deleted"),this.loadRecipes()})}loadRecipes(){this._recipesRepository.loadRecipes()}exportRecipes(t){this._transferDataService.exportTable("recipesStore","json",{selected:Array.from(t||[])})}static \u0275fac=function(e){return new(e||i)(_(K),_(J),_(we),_(R))};static \u0275cmp=y({type:i,selectors:[["lg-recipes-list"]],features:[Z([R])],decls:17,vars:12,consts:[[3,"icon","link","size"],["aria-hidden","false","fontIcon","add"],["lgInlineSeparatedGroup",""],[3,"center"],[3,"selectionTypes"],[3,"sortResult"],["lgGroupingTail",""],[3,"click","flat","size"],[3,"onDone","label","schema","storeName"],["lgImportRowTpl",""],[3,"routerLink"],[3,"size","link","flat"],["lgPull","",1,"text-muted","text-cursive"]],template:function(e,n){e&1&&(l(0,"lg-controls-bar")(1,"lg-button",0),ce(2,"mat-icon",1),p(),l(3,"lg-inline-separated-group"),D(4,at,3,7,"ng-template",2)(5,ct,3,5,"ng-template",2),p()(),l(6,"lg-fade-in")(7,"lg-container")(8,"lg-gap-row",3)(9,"lg-title"),c(10),u(11,"translate"),p()(),ce(12,"lg-draft-recipes-list")(13,"lg-grouping-sorting")(14,"lg-selection-tools",4),l(15,"lg-grouping-tails",5),D(16,mt,11,16,"ng-template",6),p()()()),e&2&&(r(),v("success"),a("icon",!0)("link","/recipes/add")("size","medium"),r(7),a("center",!0),r(2),g(" ",f(11,9,"recipes.list-title")," "),r(4),a("selectionTypes",ye(11,pt)),r(),a("sortResult",n.recipes()))},dependencies:[k,I,Q,Ie,Te,W,Le,Oe,be,Me,Ge,Y,ke,q,ne,ee,U,ae,se,E,X],styles:["[_nghost-%COMP%]{display:block}"]})};export{Ze as RecipesListComponent};
