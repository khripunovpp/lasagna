import{a as ae}from"./chunk-6FM27WYZ.js";import{a as ne}from"./chunk-GSKV4P7T.js";import{a as re}from"./chunk-INQ3SC5K.js";import{a as T}from"./chunk-3DMBXY5D.js";import{a as Z}from"./chunk-GNJUJALG.js";import{a as ee}from"./chunk-BU6WNSZU.js";import{a as ie}from"./chunk-KLASXVLN.js";import{a as te,c as oe}from"./chunk-VJKMITA2.js";import{v as Y}from"./chunk-4JACCPQC.js";import{a as L}from"./chunk-TKRM7P4A.js";import{a as Q}from"./chunk-57SGI4YT.js";import{C as B,D as H,E as v,G as m,L as O,M as W,N as j,O as z,Q as J,R as U,S as q,U as K,W as X,g as E,o as P,s as $}from"./chunk-BMRUAQFN.js";import{$a as n,Db as w,Fb as F,Ib as A,Jb as b,Kb as a,Lb as s,Mb as l,Mc as G,Nb as y,Nc as M,Ob as N,Pb as R,Rb as D,Vb as c,Wb as x,eb as C,fc as V,gc as I,hc as _,jc as p,la as u,lb as S,ma as f,nb as k,va as h}from"./chunk-TMZLFVGH.js";var g=class i{constructor(){}selfAlign="center";static \u0275fac=function(t){return new(t||i)};static \u0275dir=k({type:i,selectors:[["","lgSelfCenter",""]],hostVars:2,hostBindings:function(t,o){t&2&&V("align-self",o.selfAlign)}})};var le=(i,e)=>e.name+e.uuid+i;function ce(i,e){i&1&&p(0," Fees ")}function pe(i,e){if(i&1){let t=D();w(0,ce,1,0),s(1,"section",4)(2,"div",5)(3,"lg-flex-row",6),y(4,"lg-input",7)(5,"lg-textarea",8),s(6,"lg-checkbox",9),c("onCheckboxChanged",function(){let r=u(t).$index,d=x();return f(d.onTaxValueChange(r))}),l(),s(7,"lg-number-input",10),c("onInputChange",function(){let r=u(t).$index,d=x();return f(d.onTaxValueChange(r))}),l(),s(8,"lg-button",11),c("click",function(){let r=u(t).$index,d=x();return f(d.deleteTxRow(r))}),y(9,"mat-icon",12),l()()()()}if(i&2){let t=e.$implicit,o=e.$index,r=x();r.taxesForm.controls.rows.controls[o],F(r.feesIndex()===o?0:-1),n(),a("formGroupName",o),n(),I("taxes__row--odd",o%2!==0),n(),a("fit",!0)("top",!0),n(),a("placeholder","Name"),n(),a("placeholder","Description")("rows",3),n(),a("customMark","%")("name",t.name+o),n(),a("placeholder","Value"),n(),_("danger"),a("icon",!0)("size","tiny")}}function de(i,e){i&1&&p(0," Save changes ")}function xe(i,e){i&1&&p(0," No changes ")}var se=class i{constructor(e,t){this._taxesRepository=e;this._notificationService=t}taxesAndFees=h([]);feesIndex=G(()=>this.taxesAndFees().findIndex(e=>!e.percentage));taxesForm=new v({rows:new J([this._getRowGroup()])});rowsEffect=M(()=>{this._rowsFormArray.clear(),this.taxesAndFees().forEach((e,t)=>{this._rowsFormArray.push(this._getRowGroup(e))}),this.taxesForm.updateValueAndValidity(),this.taxesForm.markAsPristine()});totalTaxes=h(0);formValues=this.taxesForm.valueChanges.pipe(P());get _rowsFormArray(){return this.taxesForm.get("rows")}ngOnInit(){this._taxesRepository.getAll().then(e=>{this.taxesAndFees.set(e.toSorted((t,o)=>t.name.localeCompare(o.name)&&+o.percentage-+t.percentage))})}onTaxValueChange(e){}deleteTxRow(e){let t=this.taxesForm.value.rows?.[e]?.uuid;this._rowsFormArray.removeAt(e),this.taxesAndFees.update(o=>o.filter(r=>r.uuid!==t)),this.taxesForm.markAsDirty(),t&&this._taxesRepository.deleteOne(t)}addTaxRow(){let e=T.empty();this._rowsFormArray.push(this._getRowGroup(e)),this.taxesAndFees.update(t=>[...t,e]),this.taxesForm.markAsDirty()}async saveTaxes(){try{let e=this.taxesForm.value.rows?.map(t=>T.fromRaw($(t)))??[];await this._taxesRepository.addMany(e),this._notificationService.success("Taxes saved successfully"),this.taxesForm.markAsPristine()}catch(e){this._notificationService.error(E(e))}}_getRowGroup(e){return new v({name:new m(e?.name||""),description:new m(e?.description||""),value:new m(e?.amount||0),amount:new m(0),percentage:new m(e?.percentage||!1),uuid:new m(e?.uuid||"")})}static \u0275fac=function(t){return new(t||i)(C(ae),C(K))};static \u0275cmp=S({type:i,selectors:[["lg-taxes-settings"]],decls:12,vars:7,consts:[[3,"formGroup"],["formArrayName","rows"],["lgSelfCenter","","lgShrink","",3,"click","disabled"],["lgSelfCenter","","lgShrink","",3,"click"],[1,"taxes",3,"formGroupName"],[1,"taxes__row"],[3,"fit","top"],["formControlName","name","lgWidth","35%",3,"placeholder"],["formControlName","description","lgWidth","35%",3,"placeholder","rows"],["formControlName","percentage","lgShrink","",3,"onCheckboxChanged","customMark","name"],["formControlName","value","lgParseMath","",3,"onInputChange","placeholder"],["lgShrink","",3,"click","icon","size"],["aria-hidden","false","aria-label","Example home icon","fontIcon","close"]],template:function(t,o){t&1&&(s(0,"lg-flex-column"),N(1,0)(2,1),p(3," Taxes "),A(4,pe,10,16,null,null,le),R()(),s(6,"lg-flex-row")(7,"lg-button",2),c("click",function(){return o.saveTaxes()}),w(8,de,1,0)(9,xe,1,0),l(),s(10,"lg-button",3),c("click",function(){return o.addTaxRow()}),p(11," Add tax "),l()()()),t&2&&(n(),a("formGroup",o.taxesForm),n(3),b(o.taxesAndFees()),n(3),_("success"),a("disabled",!o.taxesForm.dirty),n(),F(o.taxesForm.dirty?8:9),n(2),_("warning"))},dependencies:[Q,Z,U,B,H,X,re,Y,te,oe,q,O,z,W,j,g,ie,ee,ne,L],encapsulation:2})};export{g as a,se as b};
