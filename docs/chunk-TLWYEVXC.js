import{a as ne,b as re,c as ce,d as ae,e as le,f as se}from"./chunk-KFT4H3KY.js";import{a as te,c as ie}from"./chunk-LT55FNNA.js";import{a as ee}from"./chunk-7FCO3ACG.js";import{b as oe}from"./chunk-NVVJOV7R.js";import{a as pe}from"./chunk-B4GE2TBC.js";import"./chunk-CEEQQY3I.js";import{a as k,b as H,c as L}from"./chunk-LR2FKNSU.js";import{a as J}from"./chunk-67MQKHDP.js";import"./chunk-RKFCCI7E.js";import"./chunk-MQ26JLPX.js";import"./chunk-KPGIGGUF.js";import{a as q,d as Y}from"./chunk-OIUOAUKL.js";import"./chunk-FTNH4PRO.js";import{a as X}from"./chunk-PFLOR5BA.js";import{a as K,c as Q}from"./chunk-42ANHTC5.js";import{f as U,s as B,v as W}from"./chunk-2WRE22FH.js";import{$b as w,Ab as z,Cb as b,Db as h,Eb as r,Fb as c,Gb as j,Kb as I,Nb as v,Ob as s,W as M,Xa as o,Zb as T,_b as a,ab as g,ac as d,bc as F,ca as N,ea as u,f as O,fb as $,ka as _,kb as D,la as f,lc as Z,nc as G,r as V,sb as l,vb as S,x as E,yb as C,z as A,zb as x}from"./chunk-7IKCFNVS.js";var me=new N("CategorizedProductsList",{factory:()=>{let t=u(L),i=u(J);return V(t.loadRecipes()).pipe(M(()=>t.products$)).pipe(E(n=>n.toSorted((p,m)=>p.name.localeCompare(m.name))),E(n=>ae(n,"category_id")),A(n=>O(void 0,null,function*(){let p=[];for(let y in n){let R=n[y],ue=yield i.getOne(y);p.push({category:ue?.name,products:R})}if(!p.length)return[];let[m,...P]=p.toSorted((y,R)=>y.category>R.category?1:-1);return m?.category?[m].concat(P):P.concat([m])})))}});var _e=(t,i)=>i==null?null:i.category;function fe(t,i){if(t&1&&(r(0,"span"),a(1),c()),t&2){let e=s(2).$implicit;o(),d("from ",e.source)}}function ge(t,i){if(t&1&&(r(0,"span"),a(1),c(),r(2,"span"),a(3),c(),C(4,fe,2,1,"span")),t&2){let e=s().$implicit;o(),w(e.name),o(2),F("",e.amount,"gr for ",e.price),o(),x(e.source?4:-1)}}function Ce(t,i){if(t&1&&(r(0,"span"),a(1),c()),t&2){let e=s(2).$implicit;o(),d("from ",e==null?null:e.source)}}function xe(t,i){if(t&1&&(r(0,"span"),a(1),c(),r(2,"span"),a(3),c(),C(4,Ce,2,1,"span")),t&2){let e=s().$implicit;o(),w(e==null?null:e.name),o(2),F("",e==null?null:e.amount," gr for ",e==null?null:e.price),o(),x(e!=null&&e.source?4:-1)}}function ve(t,i){if(t&1&&C(0,ge,5,4)(1,xe,5,4),t&2){let e=i.flow;x(e==="new"?0:1)}}function Pe(t,i){t&1&&a(0," per gram ")}function ye(t,i){if(t&1&&a(0),t&2){let e=s(2).$implicit;d(" per ",e.unit," ")}}function Se(t,i){if(t&1){let e=I();r(0,"lg-gap-row",1)(1,"div",9)(2,"lg-gap-row",1)(3,"div",10)(4,"a",11),a(5),c()(),r(6,"div",12),a(7),c(),r(8,"div",13),a(9),Z(10,"number"),C(11,Pe,1,0)(12,ye,1,1),c()()(),r(13,"lg-button",14),v("click",function(){_(e);let p=s().$implicit,m=s(2);return f(m.deleteProduct(p))}),j(14,"mat-icon",15),c()()}if(t&2){let e=s().$implicit,n=s(2);l("center",!0),o(2),l("center",!0),o(2),l("routerLink","/products/edit/"+e.uuid),o(),w(e.name),o(2),d(" ",e.source??""),o(2),d(" ",G(10,11,n.getPricePerGram(e),"1.2-5")," "),o(2),x(!e.unit||e.unit==="gram"?11:12),o(2),S("danger"),l("size","small")("icon",!0)}}function Ie(t,i){if(t&1&&D(0,Se,15,14,"ng-template",8),t&2){let e=i.$implicit;l("uuid",e.uuid)}}function Te(t,i){if(t&1){let e=I();r(0,"lg-title",6),a(1),c(),r(2,"lg-card-list",7),v("onSelected",function(p){_(e),s();let m=T(12);return f(m.putSelected(p))}),b(3,Ie,1,1,null,8,z),c()}if(t&2){let e=i.$implicit;s();let n=T(12);l("level",3),o(),d(" ",(e==null?null:e.category)||"Uncategorized"," "),o(),l("mode",n.selectionMode())("selectAll",n.selectAll())("deselectAll",n.deselectAll()),o(),h(e.products)}}function we(t,i){t&1&&(r(0,"lg-gap-row",1)(1,"lg-title",6),a(2," No products found "),c()()),t&2&&(l("center",!0),o(),l("level",5))}var de=class t{constructor(i,e,n,p){this._productsRepository=i;this._csvReaderService=e;this._transferDataService=n;this._notificationsService=p}products=oe(u(me));ProductDbInputScheme=H;Stores=q;getPricePerGram(i){return(k(i.price)||1)/(k(i.amount)||1)}exportProducts(i){this._transferDataService.exportTable("productsStore","json",{selected:Array.from(i)})}deleteProduct(i){i.uuid&&this._productsRepository.deleteProduct(i.uuid).then(()=>{this._notificationsService.success("Product deleted"),this.loadProducts()})}ngOnInit(){this.loadProducts()}loadProducts(){this._productsRepository.loadRecipes()}static \u0275fac=function(e){return new(e||t)(g(L),g(re),g(se),g(pe))};static \u0275cmp=$({type:t,selectors:[["lg-product-list"]],decls:16,vars:13,consts:[["selectionZone",""],[3,"center"],[3,"flat","link","size"],[3,"click","flat","size"],[3,"onDone","schema","storeName"],["lgImportRowTpl",""],[3,"level"],[3,"onSelected","mode","selectAll","deselectAll"],["lgCardListItem","",3,"uuid"],[1,"expand"],[2,"flex","20%"],[3,"routerLink"],[2,"flex","10%"],[2,"flex","70%"],[3,"click","size","icon"],["aria-hidden","false","aria-label","Example home icon","fontIcon","close"]],template:function(e,n){if(e&1){let p=I();r(0,"lg-fade-in")(1,"lg-container")(2,"lg-title"),a(3," Products "),c(),r(4,"lg-gap-row",1)(5,"lg-button",2),a(6," Add "),c(),r(7,"lg-button",3),v("click",function(){_(p);let P=T(12);return f(n.exportProducts(P.selected()))}),a(8," Export "),c(),r(9,"lg-import",4),v("onDone",function(){return _(p),f(n.loadProducts())}),D(10,ve,2,1,"ng-template",5),c()(),r(11,"lg-selection-zone",null,0),b(13,Te,5,5,null,null,_e,!1,we,3,2,"lg-gap-row",1),c()()()}e&2&&(o(4),l("center",!0),o(),S("primary"),l("flat",!0)("link","/products/add")("size","small"),o(2),S("info"),l("flat",!0)("size","small"),o(2),l("schema",n.ProductDbInputScheme)("storeName",n.Stores.PRODUCTS),o(4),h(n.products()))},dependencies:[X,Y,ee,K,Q,U,ie,te,ce,B,ne,le,W],styles:["[_nghost-%COMP%]{display:block}"]})};export{de as ProductListComponent};
