import{v as m,z as u}from"./chunk-K7R7MOA3.js";import{V as c,Z as v}from"./chunk-PNZYYIKS.js";import{f as i}from"./chunk-2WH2EVR6.js";var l=class o{constructor(){}readFromCSVFile(e){return new Promise((t,a)=>{let r=new FileReader;r.onload=()=>{let s=r.result,n=this.parseData(s),[d,...b]=n,S=this.arrayToObjects(b,d);t(S)},r.onerror=()=>{a(r.error)},r.readAsText(e)})}readFromJSONFile(e){return new Promise((t,a)=>{let r=new FileReader;r.onload=()=>{try{let s=r.result,n=JSON.parse(s);t(n)}catch(s){a(s)}},r.onerror=()=>{a(r.error)},r.readAsText(e)})}parseData(e){return e.split(/\r\n|\n/).map(t=>t.split(",")).filter(t=>t.length>1&&t.some(a=>a.length>0))}arrayToObjects(e,t){return e.map(a=>{let r={};return t.forEach((s,n)=>{r[s]=a[n]}),r})}makeCsv(e){let t=Object.keys(e[0]),a=e.map(s=>t.map(n=>s[n]));return[t,...a].map(s=>s.join(",")).join(`\r
`)}saveToCSVFile(e,t){let a=this.makeCsv(e),r=new Blob([a],{type:"text/csv"}),s=URL.createObjectURL(r),n=document.createElement("a");document.body.appendChild(n),n.setAttribute("href",s),n.setAttribute("download",t),n.click(),URL.revokeObjectURL(s)}saveToJSONFile(e,t){let a=JSON.stringify(e,null,2),r=new Blob([a],{type:"application/json"}),s=URL.createObjectURL(r),n=document.createElement("a");document.body.appendChild(n),n.setAttribute("href",s),n.setAttribute("download",t),n.click(),URL.revokeObjectURL(s)}static \u0275fac=function(t){return new(t||o)};static \u0275prov=c({token:o,factory:o.\u0275fac,providedIn:"root"})};var p=class o{constructor(e,t){this._indexDbService=e;this._csvReaderService=t}get currenBackupDate(){let e=localStorage.getItem("lastBackupDate");return e?new Date(Number(e)):null}exportTable(r){return i(this,arguments,function*(e,t="csv",a={}){let s=[];if(a.selected?.length?s=yield this._indexDbService.getMany(e,a.selected):s=yield this._indexDbService.getAll(e),t==="json"){this._csvReaderService.saveToJSONFile(s,this._getFileName(e,t));return}this._csvReaderService.saveToCSVFile(s,this._getFileName(e,t))})}exportAll(e="csv"){return i(this,null,function*(){let t=[],a=Object.values(m).filter(r=>r!=="indicesStore");for(let r of a){let s=yield this._indexDbService.getAll(r),n=yield this._indexDbService.getVersion(r),d=Date.now();t.push({store:r,data:s,version:n,createdAt:d})}if(e==="json"){this._csvReaderService.saveToJSONFile(t,this._getFileName("buckup",e));return}this._csvReaderService.saveToCSVFile(t,this._getFileName("buckup",e))})}restoreAllData(e){return i(this,null,function*(){if(e?.length&&e.length>1)throw new Error("Only one file is allowed");let t=yield this._csvReaderService.readFromJSONFile(e[0]);console.log({data:t}),yield this._indexDbService.restoreAllData(t)})}makeCsv(e){return this._csvReaderService.makeCsv(e)}_getFileName(e,t){let a=new Date().toISOString();return`${e}_export_${a}.${t}`}static \u0275fac=function(t){return new(t||o)(v(u),v(l))};static \u0275prov=c({token:o,factory:o.\u0275fac,providedIn:"root"})};export{l as a,p as b};
