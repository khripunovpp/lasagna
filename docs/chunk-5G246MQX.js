import{c as oe}from"./chunk-BVMETGFH.js";import{b as re}from"./chunk-XBLVHOT4.js";import{h as ae}from"./chunk-ZO5ONA6L.js";import{b as ie}from"./chunk-BF6WJXXA.js";import{A as ne,B as se,w as B}from"./chunk-I5MUGXQZ.js";import{Dc as te,E as Z,Ea as E,H as L,P as M,R as U,W as l,X as Q,Z as y,Za as k,_ as o,db as q,fb as ee,l as b,n as p,na as h,q as O,sa as j,u as N,v as V,w as W}from"./chunk-OZXQ5JHJ.js";import{a as F,f as u}from"./chunk-2WH2EVR6.js";var A=class n{constructor(){}readFromCSVFile(r){return new Promise((e,t)=>{let s=new FileReader;s.onload=()=>{let i=s.result,a=this.parseData(i),[d,...c]=a,g=this.arrayToObjects(c,d);e(g)},s.onerror=()=>{t(s.error)},s.readAsText(r)})}readFromJSONFile(r){return new Promise((e,t)=>{let s=new FileReader;s.onload=()=>{try{let i=s.result,a=JSON.parse(i);e(a)}catch(i){t(i)}},s.onerror=()=>{t(s.error)},s.readAsText(r)})}parseData(r){return r.split(/\r\n|\n/).map(e=>e.split(",")).filter(e=>e.length>1&&e.some(t=>t.length>0))}arrayToObjects(r,e){return r.map(t=>{let s={};return e.forEach((i,a)=>{s[i]=t[a]}),s})}makeCsv(r){let e=Object.keys(r[0]),t=r.map(i=>e.map(a=>i[a]));return[e,...t].map(i=>i.join(",")).join(`\r
`)}saveToCSVFile(r,e){let t=this.makeCsv(r),s=new Blob([t],{type:"text/csv"}),i=URL.createObjectURL(s),a=document.createElement("a");document.body.appendChild(a),a.setAttribute("href",i),a.setAttribute("download",e),a.click(),URL.revokeObjectURL(i)}saveToJSONFile(r,e){let t=JSON.stringify(r,null,2),s=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(s),a=document.createElement("a");document.body.appendChild(a),a.setAttribute("href",i),a.setAttribute("download",e),a.click(),URL.revokeObjectURL(i)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=l({token:n,factory:n.\u0275fac,providedIn:"root"})};var m=class{},le=(()=>{class n extends m{getTranslation(e){return b({})}static \u0275fac=(()=>{let e;return function(s){return(e||(e=j(n)))(s||n)}})();static \u0275prov=l({token:n,factory:n.\u0275fac})}return n})(),D=class{},ce=(()=>{class n{handle(e){return e.key}static \u0275fac=function(t){return new(t||n)};static \u0275prov=l({token:n,factory:n.\u0275fac})}return n})();function _(n,r){if(n===r)return!0;if(n===null||r===null)return!1;if(n!==n&&r!==r)return!0;let e=typeof n,t=typeof r,s,i,a;if(e==t&&e=="object")if(Array.isArray(n)){if(!Array.isArray(r))return!1;if((s=n.length)==r.length){for(i=0;i<s;i++)if(!_(n[i],r[i]))return!1;return!0}}else{if(Array.isArray(r))return!1;a=Object.create(null);for(i in n){if(!_(n[i],r[i]))return!1;a[i]=!0}for(i in r)if(!(i in a)&&typeof r[i]<"u")return!1;return!0}return!1}function f(n){return typeof n<"u"&&n!==null}function T(n){return P(n)&&!X(n)&&n!==null}function P(n){return typeof n=="object"}function X(n){return Array.isArray(n)}function z(n){return typeof n=="string"}function Ce(n){return typeof n=="function"}function K(n,r){let e=Object.assign({},n);return P(n)?(P(n)&&P(r)&&Object.keys(r).forEach(t=>{T(r[t])?t in n?e[t]=K(n[t],r[t]):Object.assign(e,{[t]:r[t]}):Object.assign(e,{[t]:r[t]})}),e):K({},r)}function G(n,r){let e=r.split(".");r="";do r+=e.shift(),f(n)&&f(n[r])&&(T(n[r])||X(n[r])||!e.length)?(n=n[r],r=""):e.length?r+=".":n=void 0;while(e.length);return n}function be(n,r,e){let t=r.split("."),s=n;for(let i=0;i<t.length;i++){let a=t[i];i===t.length-1?s[a]=e:((!s[a]||!T(s[a]))&&(s[a]={}),s=s[a])}}var v=class{},ue=(()=>{class n extends v{templateMatcher=/{{\s?([^{}\s]*)\s?}}/g;interpolate(e,t){if(z(e))return this.interpolateString(e,t);if(Ce(e))return this.interpolateFunction(e,t)}interpolateFunction(e,t){return e(t)}interpolateString(e,t){return t?e.replace(this.templateMatcher,(s,i)=>{let a=G(t,i);return f(a)?a:s}):e}static \u0275fac=(()=>{let e;return function(s){return(e||(e=j(n)))(s||n)}})();static \u0275prov=l({token:n,factory:n.\u0275fac})}return n})(),C=class{},he=(()=>{class n extends C{compile(e,t){return e}compileTranslations(e,t){return e}static \u0275fac=(()=>{let e;return function(s){return(e||(e=j(n)))(s||n)}})();static \u0275prov=l({token:n,factory:n.\u0275fac})}return n})(),w=class{defaultLang;currentLang=this.defaultLang;translations={};langs=[];onTranslationChange=new E;onLangChange=new E;onDefaultLangChange=new E},J=new y("ISOLATE_TRANSLATE_SERVICE"),Y=new y("USE_DEFAULT_LANG"),$=new y("DEFAULT_LANGUAGE"),H=new y("USE_EXTEND"),S=n=>p(n)?n:b(n),x=(()=>{class n{store;currentLoader;compiler;parser;missingTranslationHandler;useDefaultLang;extend;loadingTranslations;pending=!1;_translationRequests={};lastUseLanguage=null;get onTranslationChange(){return this.store.onTranslationChange}get onLangChange(){return this.store.onLangChange}get onDefaultLangChange(){return this.store.onDefaultLangChange}get defaultLang(){return this.store.defaultLang}set defaultLang(e){this.store.defaultLang=e}get currentLang(){return this.store.currentLang}set currentLang(e){this.store.currentLang=e}get langs(){return this.store.langs}set langs(e){this.store.langs=e}get translations(){return this.store.translations}set translations(e){this.store.translations=e}constructor(e,t,s,i,a,d=!0,c=!1,g=!1,I){this.store=e,this.currentLoader=t,this.compiler=s,this.parser=i,this.missingTranslationHandler=a,this.useDefaultLang=d,this.extend=g,c&&(this.store=new w),I&&this.setDefaultLang(I)}setDefaultLang(e){if(e===this.defaultLang)return;let t=this.retrieveTranslations(e);typeof t<"u"?(this.defaultLang==null&&(this.defaultLang=e),t.pipe(L(1)).subscribe(()=>{this.changeDefaultLang(e)})):this.changeDefaultLang(e)}getDefaultLang(){return this.defaultLang}use(e){if(this.lastUseLanguage=e,e===this.currentLang)return b(this.translations[e]);this.currentLang||(this.currentLang=e);let t=this.retrieveTranslations(e);return p(t)?(t.pipe(L(1)).subscribe(()=>{this.changeLang(e)}),t):(this.changeLang(e),b(this.translations[e]))}changeLang(e){e===this.lastUseLanguage&&(this.currentLang=e,this.onLangChange.emit({lang:e,translations:this.translations[e]}),this.defaultLang==null&&this.changeDefaultLang(e))}retrieveTranslations(e){if(typeof this.translations[e]>"u"||this.extend)return this._translationRequests[e]=this._translationRequests[e]||this.loadAndCompileTranslations(e),this._translationRequests[e]}getTranslation(e){return this.loadAndCompileTranslations(e)}loadAndCompileTranslations(e){this.pending=!0;let t=this.currentLoader.getTranslation(e).pipe(M(1),L(1));return this.loadingTranslations=t.pipe(O(s=>this.compiler.compileTranslations(s,e)),M(1),L(1)),this.loadingTranslations.subscribe({next:s=>{this.translations[e]=this.extend&&this.translations[e]?F(F({},s),this.translations[e]):s,this.updateLangs(),this.pending=!1},error:s=>{this.pending=!1}}),t}setTranslation(e,t,s=!1){let i=this.compiler.compileTranslations(t,e);(s||this.extend)&&this.translations[e]?this.translations[e]=K(this.translations[e],i):this.translations[e]=i,this.updateLangs(),this.onTranslationChange.emit({lang:e,translations:this.translations[e]})}getLangs(){return this.langs}addLangs(e){let t=e.filter(s=>!this.langs.includes(s));t.length>0&&(this.langs=[...this.langs,...t])}updateLangs(){this.addLangs(Object.keys(this.translations))}getParsedResultForKey(e,t,s){let i;if(e&&(i=this.runInterpolation(G(e,t),s)),i===void 0&&this.defaultLang!=null&&this.defaultLang!==this.currentLang&&this.useDefaultLang&&(i=this.runInterpolation(G(this.translations[this.defaultLang],t),s)),i===void 0){let a={key:t,translateService:this};typeof s<"u"&&(a.interpolateParams=s),i=this.missingTranslationHandler.handle(a)}return i!==void 0?i:t}runInterpolation(e,t){if(X(e))return e.map(s=>this.runInterpolation(s,t));if(T(e)){let s={};for(let i in e){let a=this.runInterpolation(e[i],t);a!==void 0&&(s[i]=a)}return s}else return this.parser.interpolate(e,t)}getParsedResult(e,t,s){if(t instanceof Array){let i={},a=!1;for(let c of t)i[c]=this.getParsedResultForKey(e,c,s),a=a||p(i[c]);if(!a)return i;let d=t.map(c=>S(i[c]));return W(d).pipe(O(c=>{let g={};return c.forEach((I,me)=>{g[t[me]]=I}),g}))}return this.getParsedResultForKey(e,t,s)}get(e,t){if(!f(e)||!e.length)throw new Error('Parameter "key" is required and cannot be empty');return this.pending?this.loadingTranslations.pipe(Z(s=>S(this.getParsedResult(s,e,t)))):S(this.getParsedResult(this.translations[this.currentLang],e,t))}getStreamOnTranslationChange(e,t){if(!f(e)||!e.length)throw new Error('Parameter "key" is required and cannot be empty');return N(V(()=>this.get(e,t)),this.onTranslationChange.pipe(U(s=>{let i=this.getParsedResult(s.translations,e,t);return S(i)})))}stream(e,t){if(!f(e)||!e.length)throw new Error('Parameter "key" required');return N(V(()=>this.get(e,t)),this.onLangChange.pipe(U(s=>{let i=this.getParsedResult(s.translations,e,t);return S(i)})))}instant(e,t){if(!f(e)||e.length===0)throw new Error('Parameter "key" is required and cannot be empty');let s=this.getParsedResult(this.translations[this.currentLang],e,t);return p(s)?Array.isArray(e)?e.reduce((i,a)=>(i[a]=a,i),{}):e:s}set(e,t,s=this.currentLang){be(this.translations[s],e,z(t)?this.compiler.compile(t,s):this.compiler.compileTranslations(t,s)),this.updateLangs(),this.onTranslationChange.emit({lang:s,translations:this.translations[s]})}changeDefaultLang(e){this.defaultLang=e,this.onDefaultLangChange.emit({lang:e,translations:this.translations[e]})}reloadLang(e){return this.resetLang(e),this.loadAndCompileTranslations(e)}resetLang(e){delete this._translationRequests[e],delete this.translations[e]}getBrowserLang(){if(typeof window>"u"||!window.navigator)return;let e=this.getBrowserCultureLang();return e?e.split(/[-_]/)[0]:void 0}getBrowserCultureLang(){if(!(typeof window>"u"||typeof window.navigator>"u"))return window.navigator.languages?window.navigator.languages[0]:window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage}static \u0275fac=function(t){return new(t||n)(o(w),o(m),o(C),o(v),o(D),o(Y),o(J),o(H),o($))};static \u0275prov=l({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Fe=(()=>{class n{translate;_ref;value="";lastKey=null;lastParams=[];onTranslationChange;onLangChange;onDefaultLangChange;constructor(e,t){this.translate=e,this._ref=t}updateValue(e,t,s){let i=a=>{this.value=a!==void 0?a:e,this.lastKey=e,this._ref.markForCheck()};if(s){let a=this.translate.getParsedResult(s,e,t);p(a)?a.subscribe(i):i(a)}this.translate.get(e,t).subscribe(i)}transform(e,...t){if(!e||!e.length)return e;if(_(e,this.lastKey)&&_(t,this.lastParams))return this.value;let s;if(f(t[0])&&t.length)if(z(t[0])&&t[0].length){let i=t[0].replace(/(')?([a-zA-Z0-9_]+)(')?(\s)?:/g,'"$2":').replace(/:(\s)?(')(.*?)(')/g,':"$3"');try{s=JSON.parse(i)}catch(a){throw new SyntaxError(`Wrong parameter in TranslatePipe. Expected a valid Object, received: ${t[0]}`)}}else T(t[0])&&(s=t[0]);return this.lastKey=e,this.lastParams=t,this.updateValue(e,s),this._dispose(),this.onTranslationChange||(this.onTranslationChange=this.translate.onTranslationChange.subscribe(i=>{this.lastKey&&i.lang===this.translate.currentLang&&(this.lastKey=null,this.updateValue(e,s,i.translations))})),this.onLangChange||(this.onLangChange=this.translate.onLangChange.subscribe(i=>{this.lastKey&&(this.lastKey=null,this.updateValue(e,s,i.translations))})),this.onDefaultLangChange||(this.onDefaultLangChange=this.translate.onDefaultLangChange.subscribe(()=>{this.lastKey&&(this.lastKey=null,this.updateValue(e,s))})),this.value}_dispose(){typeof this.onTranslationChange<"u"&&(this.onTranslationChange.unsubscribe(),this.onTranslationChange=void 0),typeof this.onLangChange<"u"&&(this.onLangChange.unsubscribe(),this.onLangChange=void 0),typeof this.onDefaultLangChange<"u"&&(this.onDefaultLangChange.unsubscribe(),this.onDefaultLangChange=void 0)}ngOnDestroy(){this._dispose()}static \u0275fac=function(t){return new(t||n)(k(x,16),k(te,16))};static \u0275pipe=ee({name:"translate",type:n,pure:!1});static \u0275prov=l({token:n,factory:n.\u0275fac})}return n})();var Oe=(()=>{class n{static forRoot(e={}){return{ngModule:n,providers:[e.loader||{provide:m,useClass:le},e.compiler||{provide:C,useClass:he},e.parser||{provide:v,useClass:ue},e.missingTranslationHandler||{provide:D,useClass:ce},w,{provide:J,useValue:e.isolate},{provide:Y,useValue:e.useDefaultLang},{provide:H,useValue:e.extend},{provide:$,useValue:e.defaultLanguage},x]}}static forChild(e={}){return{ngModule:n,providers:[e.loader||{provide:m,useClass:le},e.compiler||{provide:C,useClass:he},e.parser||{provide:v,useClass:ue},e.missingTranslationHandler||{provide:D,useClass:ce},{provide:J,useValue:e.isolate},{provide:Y,useValue:e.useDefaultLang},{provide:H,useValue:e.extend},{provide:$,useValue:e.defaultLanguage},x]}}static \u0275fac=function(t){return new(t||n)};static \u0275mod=q({type:n});static \u0275inj=Q({})}return n})();var de=class n{constructor(){}selectionMode=h("default");selectAll=h(!1);deselectAll=h(!1);selected=h(new Set);onSelection(){this.selectionMode.set(this.selectionMode()==="default"?"selection":"default"),this.selected.set(new Set)}onAllSelection(){this.selectAll.set(!0),this.deselectAll.set(!1)}onDeselectAll(){this.selectAll.set(!1),this.deselectAll.set(!0)}putSelected(r){let[e,t]=r;this.selected.update(s=>(e?s.add(t):s.delete(t),s))}static \u0275fac=function(e){return new(e||n)};static \u0275prov=l({token:n,factory:n.\u0275fac})};var fe=class n{constructor(r,e){this._indexDbService=r;this._csvReaderService=e}get currenBackupDate(){let r=localStorage.getItem("lastBackupDate");return r?new Date(Number(r)):null}exportTable(s){return u(this,arguments,function*(r,e="csv",t={}){let i=[];if(t.selected?.length?i=yield this._indexDbService.getMany(r,t.selected):i=yield this._indexDbService.getAll(r),e==="json"){this._csvReaderService.saveToJSONFile(i,this._getFileName(r,e));return}this._csvReaderService.saveToCSVFile(i,this._getFileName(r,e))})}exportAll(r="csv"){return u(this,null,function*(){let e=[],t=Object.values(B).filter(s=>s!=="indicesStore");for(let s of t){let i=yield this._indexDbService.getAll(s),a=yield this._indexDbService.getVersion(s),d=Date.now();e.push({store:s,data:i,version:a,createdAt:d})}if(r==="json"){this._csvReaderService.saveToJSONFile(e,this._getFileName("buckup",r));return}this._csvReaderService.saveToCSVFile(e,this._getFileName("buckup",r))})}restoreAllData(r){return u(this,null,function*(){if(r?.length&&r.length>1)throw new Error("Only one file is allowed");let e=yield this._csvReaderService.readFromJSONFile(r[0]);console.log({data:e}),yield this._indexDbService.restoreAllData(e)})}makeCsv(r){return this._csvReaderService.makeCsv(r)}_getFileName(r,e){let t=new Date().toISOString();return`${r}_export_${t}.${e}`}static \u0275fac=function(e){return new(e||n)(o(se),o(A))};static \u0275prov=l({token:n,factory:n.\u0275fac,providedIn:"root"})};var ge=class n{constructor(r,e,t,s,i){this._flexsearchIndexService=r;this._productsRepository=e;this._recipesRepository=t;this._categoryProductsRepository=s;this._categoryRecipesRepository=i}displayBar=h(!1);results=h([]);resultsPayload=h([]);showBar(){this.displayBar.set(!0)}hideBar(){this.displayBar.set(!1)}search(r){return u(this,null,function*(){let t=(yield Promise.all([this._searchInProducts(r),this._searchInRecipes(r),this._searchInProductsCategories(r),this._searchInRecipesCategories(r)])).flat(),s=[];for(let i of t){let a=yield this.getResource(i);if(a&&a.length!==0)for(let d of a)s.push({context:i.context,uuid:encodeURIComponent(d?.uuid??""),data:d})}return this.resultsPayload.set(s),s})}getResource(r){return u(this,null,function*(){let e=[];for(let t of r.result)switch(r.context){case"product":{let s=yield this._productsRepository.getOne(t);e.push(s);break}case"recipe":{let s=yield this._recipesRepository.getOne(t);e.push(s);break}case"category_product":{let s=yield this._categoryProductsRepository.getOne(t);e.push(s);break}case"category_recipe":{let s=yield this._categoryRecipesRepository.getOne(t);e.push(s);break}}return e})}_searchInProducts(r){return u(this,null,function*(){return(yield this._flexsearchIndexService.search("productsStore",r)).flatMap(t=>({context:"product",field:t.field,result:t.result}))})}_searchInRecipes(r){return u(this,null,function*(){return(yield this._flexsearchIndexService.search("recipesStore",r)).flatMap(t=>({context:"recipe",field:t.field,result:t.result}))})}_searchInProductsCategories(r){return u(this,null,function*(){return(yield this._flexsearchIndexService.search("categoryProductsStore",r)).flatMap(t=>({context:"category_product",field:t.field,result:t.result}))})}_searchInRecipesCategories(r){return u(this,null,function*(){return(yield this._flexsearchIndexService.search("categoryRecipesStore",r)).flatMap(t=>({context:"category_recipe",field:t.field,result:t.result}))})}static \u0275fac=function(e){return new(e||n)(o(ne),o(ae),o(oe),o(ie),o(re))};static \u0275prov=l({token:n,factory:n.\u0275fac,providedIn:"root"})};var ye=["pt","ru","en"],pe=class n{constructor(r){this.translate=r;this.translate.addLangs(ye),this.translate.setDefaultLang("en");let e=localStorage.getItem("lang")||this._defaultLang;this.changeLang(e)}getTranslate(r){return this.translate.instant(r)}_lang=h(this._defaultLang);get lang(){return this._lang}get currentLang(){return this.translate.currentLang}get languages(){return this.translate.getLangs()}get _defaultLang(){return this.translate?.getBrowserLang()||"en"}changeLang(r){this.languages.includes(r)&&(this.translate.use(r),localStorage.setItem("lang",r),this._lang.set(r))}static \u0275fac=function(e){return new(e||n)(o(x))};static \u0275prov=l({token:n,factory:n.\u0275fac,providedIn:"root"})};export{A as a,ge as b,m as c,Fe as d,Oe as e,pe as f,de as g,fe as h};
